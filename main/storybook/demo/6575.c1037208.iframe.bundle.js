/*! For license information please see 6575.c1037208.iframe.bundle.js.LICENSE.txt */
(self.webpackChunkgeonetwork_ui=self.webpackChunkgeonetwork_ui||[]).push([[6575],{"./node_modules/@geospatial-sdk/core/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function removeSearchParams(url,searchParams){const toDelete=[],urlObj=new URL(url,window.location.toString()),keysLower=searchParams.map((p=>p.toLowerCase()));for(const param of urlObj.searchParams.keys())keysLower.indexOf(param.toLowerCase())>-1&&toDelete.push(param);return toDelete.map((param=>urlObj.searchParams.delete(param))),urlObj.toString()}function getHash(input,ignoreKeys=[]){if(input instanceof Object&&function isGeoJsonGeometry(object){return"type"in object&&"coordinates"in object}(input))return JSON.stringify(input);if(input instanceof Object){const obj={},keys=Object.keys(input).sort();for(const key of keys)ignoreKeys.includes(key)||(obj[key]=getHash(input[key]));return(JSON.stringify(obj).split("").reduce(((prev,curr)=>(prev<<5)-prev+curr.charCodeAt(0)),0)>>>0).toString()}return JSON.stringify(input)}function getLayerHash(layer,includeExtras=!1){return getHash(layer,includeExtras?[]:["extras"])}function isLayerSame(layerA,layerB){return"id"in layerA&&"id"in layerB?layerA.id==layerB.id:getLayerHash(layerA)===getLayerHash(layerB)}function computeMapContextDiff(nextContext,previousContext){function getLayerPosition(layer,layers){for(let i=0;i<layers.length;i++)if(isLayerSame(layers[i],layer))return i;return-1}const layersChanged=[],layersReordered=[],layersRemoved=[],layersAdded=[];for(let i=0;i<previousContext.layers.length;i++){const layer=previousContext.layers[i],nextPosition=getLayerPosition(layer,nextContext.layers),prevPosition=getLayerPosition(layer,previousContext.layers);-1===nextPosition&&layersRemoved.push({layer,position:prevPosition})}for(let i=0;i<nextContext.layers.length;i++){const layer=nextContext.layers[i],prevPosition=getLayerPosition(layer,previousContext.layers);if(-1===prevPosition)layersAdded.push({layer,position:i});else{const prevLayer=previousContext.layers[prevPosition];layerB=prevLayer,("id"in(layerA=layer)&&"id"in layerB?layerA.id==layerB.id&&layerA.version==layerB.version:getLayerHash(layerA,!0)===getLayerHash(layerB,!0))||layersChanged.push({layer,position:i})}}var layerA,layerB;const prevLayersFiltered=previousContext.layers.filter((l=>!layersRemoved.find((({layer})=>l===layer)))),nextLayersFiltered=nextContext.layers.filter((l=>!layersAdded.find((({layer})=>l===layer))));for(let i=0;i<nextLayersFiltered.length;i++){const layer=nextLayersFiltered[i];i!==getLayerPosition(layer,prevLayersFiltered)&&layersReordered.push({layer,newPosition:getLayerPosition(layer,nextContext.layers),previousPosition:getLayerPosition(layer,previousContext.layers)})}let viewChanges=getHash(nextContext.view)!==getHash(previousContext.view)?nextContext.view:void 0;return null!=viewChanges&&(viewChanges=Object.assign({},viewChanges)),Object.assign({layersAdded,layersChanged,layersRemoved,layersReordered},void 0!==viewChanges&&{viewChanges})}__webpack_require__.d(__webpack_exports__,{QS:()=>FeaturesClickEventType,UH:()=>FeaturesHoverEventType,fD:()=>MapClickEventType,mm:()=>computeMapContextDiff,Bg:()=>createViewFromLayer,jc:()=>removeSearchParams});var ol_proj=__webpack_require__("./node_modules/ol/proj.js"),dist=__webpack_require__("./node_modules/@camptocamp/ogc-client/dist/index.js");const LONLAT_CRS_CODES=["EPSG:4326","CRS:84"];var proj4=__webpack_require__("./node_modules/ol/proj/proj4.js"),GeoJSON=__webpack_require__("./node_modules/ol/format/GeoJSON.js"),ol_extent=__webpack_require__("./node_modules/ol/extent.js"),lib=__webpack_require__("./node_modules/proj4/lib/index.js"),__awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const GEOJSON=new GeoJSON.A;function createViewFromLayer(layer){return __awaiter(this,void 0,void 0,(function*(){if("wms"===layer.type)return yield function getWmsLayerExtent(layer){return __awaiter(this,void 0,void 0,(function*(){const endpoint=yield new dist.DE(layer.url).isReady(),{boundingBoxes}=endpoint.getLayerByName(layer.name);if(!Object.keys(boundingBoxes).length)return null;const lonLatCRS=Object.keys(boundingBoxes).find((crs=>LONLAT_CRS_CODES.includes(crs)));if(lonLatCRS)return{extent:boundingBoxes[lonLatCRS]};{const availableEPSGCode=Object.keys(boundingBoxes)[0];(0,proj4.kz)(lib.A);const proj=yield(0,proj4.N1)(availableEPSGCode);return{extent:(0,ol_proj.DI)(boundingBoxes[availableEPSGCode],proj,"EPSG:4326")}}}))}(layer);if("wmts"===layer.type)return yield function getWmtsLayerExtent(layer){var _a;return __awaiter(this,void 0,void 0,(function*(){const endpoint=yield new dist.bf(layer.url).isReady(),layerName=null!==(_a=endpoint.getSingleLayerName())&&void 0!==_a?_a:layer.name,wmtsLayer=endpoint.getLayerByName(layerName);return wmtsLayer.latLonBoundingBox?{extent:wmtsLayer.latLonBoundingBox}:null}))}(layer);if("geojson"===layer.type&&layer.data)return function computeExtentFromGeojson(data){const geojson="string"==typeof data?JSON.parse(data):data,features=GEOJSON.readFeatures(geojson);return{extent:features.reduce(((prev,curr)=>{const geom=curr.getGeometry();return geom?(0,ol_extent.X$)(prev,geom.getExtent()):prev}),[1/0,1/0,-1/0,-1/0])}}(layer.data);if("wfs"===layer.type)return yield function getWfsLayerExtent(layer){return __awaiter(this,void 0,void 0,(function*(){const featureTypeSummary=(yield new dist.ym(layer.url).isReady()).getFeatureTypeSummary(layer.featureType),boundingBox=null==featureTypeSummary?void 0:featureTypeSummary.boundingBox;return boundingBox?{extent:boundingBox}:null}))}(layer);throw new Error(`Unsupported layer type: ${layer.type}`)}))}const FeaturesClickEventType="features-click",FeaturesHoverEventType="features-hover",MapClickEventType="map-click"},"./node_modules/@geospatial-sdk/openlayers/dist/index.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{KP:()=>applyContextDiffToMap,gJ:()=>createMapFromContext,KT:()=>listen});var Style=__webpack_require__("./node_modules/ol/style/Style.js"),Fill=__webpack_require__("./node_modules/ol/style/Fill.js"),Stroke=__webpack_require__("./node_modules/ol/style/Stroke.js"),Circle=__webpack_require__("./node_modules/ol/style/Circle.js"),chroma=__webpack_require__("./node_modules/chroma-js/chroma.js"),chroma_default=__webpack_require__.n(chroma);function createGeometryStyles(options){const{color,isFocused}=options,zIndex=isFocused?10:void 0;return{polygon:new Style.Ay({fill:new Fill.A({color:computeTransparentFillColor(color)}),stroke:new Stroke.A({color:"white",width:2}),zIndex}),point:new Style.Ay({image:new Circle.A({fill:new Fill.A({color}),stroke:new Stroke.A({color:"white",width:isFocused?3:2}),radius:isFocused?8:7}),zIndex}),line:[new Style.Ay({stroke:new Stroke.A({color:"white",width:isFocused?8:6}),zIndex}),new Style.Ay({stroke:new Stroke.A({color,width:isFocused?3:2}),zIndex})]}}function createStyleFunction(styleByGeometryType){return feature=>{var _a;switch(null===(_a=null==feature?void 0:feature.getGeometry())||void 0===_a?void 0:_a.getType()){case"LinearRing":case"LineString":case"MultiLineString":return styleByGeometryType.line;case"Point":case"MultiPoint":default:return styleByGeometryType.point;case"Circle":case"Polygon":case"MultiPolygon":return styleByGeometryType.polygon}}}function computeTransparentFillColor(color,alpha=.25){return chroma_default()(color).alpha(alpha).css()}const defaultStyle=createStyleFunction(createGeometryStyles({color:"blue"}));createStyleFunction(createGeometryStyles({color:"red",isFocused:!0}));var dist=__webpack_require__("./node_modules/@geospatial-sdk/core/dist/index.js"),ol_Object=__webpack_require__("./node_modules/ol/Object.js"),Collection=__webpack_require__("./node_modules/ol/Collection.js"),CollectionEventType=__webpack_require__("./node_modules/ol/CollectionEventType.js"),Disposable=__webpack_require__("./node_modules/ol/Disposable.js"),functions=__webpack_require__("./node_modules/ol/functions.js"),util=__webpack_require__("./node_modules/ol/util.js"),ol_transform=__webpack_require__("./node_modules/ol/transform.js"),ol_extent=__webpack_require__("./node_modules/ol/extent.js"),ol_color=__webpack_require__("./node_modules/ol/color.js");class IconImageCache{constructor(){this.cache_={},this.cacheSize_=0,this.maxCacheSize_=32}clear(){this.cache_={},this.cacheSize_=0}canExpireCache(){return this.cacheSize_>this.maxCacheSize_}expire(){if(this.canExpireCache()){let i=0;for(const key in this.cache_){const iconImage=this.cache_[key];3&i++||iconImage.hasListener()||(delete this.cache_[key],--this.cacheSize_)}}}get(src,crossOrigin,color){const key=getKey(src,crossOrigin,color);return key in this.cache_?this.cache_[key]:null}set(src,crossOrigin,color,iconImage){const key=getKey(src,crossOrigin,color);this.cache_[key]=iconImage,++this.cacheSize_}setSize(maxCacheSize){this.maxCacheSize_=maxCacheSize,this.expire()}}function getKey(src,crossOrigin,color){return crossOrigin+":"+src+":"+(color?(0,ol_color.oJ)(color):"null")}const shared=new IconImageCache,Property_OPACITY="opacity",Property_VISIBLE="visible",Property_EXTENT="extent",Property_Z_INDEX="zIndex",Property_MAX_RESOLUTION="maxResolution",Property_MIN_RESOLUTION="minResolution",Property_MAX_ZOOM="maxZoom",Property_MIN_ZOOM="minZoom",Property_SOURCE="source",Property_MAP="map";var asserts=__webpack_require__("./node_modules/ol/asserts.js"),math=__webpack_require__("./node_modules/ol/math.js");class BaseLayer extends ol_Object.A{constructor(options){super(),this.on,this.once,this.un,this.background_=options.background;const properties=Object.assign({},options);"object"==typeof options.properties&&(delete properties.properties,Object.assign(properties,options.properties)),properties[Property_OPACITY]=void 0!==options.opacity?options.opacity:1,(0,asserts.v)("number"==typeof properties[Property_OPACITY],"Layer opacity must be a number"),properties[Property_VISIBLE]=void 0===options.visible||options.visible,properties[Property_Z_INDEX]=options.zIndex,properties[Property_MAX_RESOLUTION]=void 0!==options.maxResolution?options.maxResolution:1/0,properties[Property_MIN_RESOLUTION]=void 0!==options.minResolution?options.minResolution:0,properties[Property_MIN_ZOOM]=void 0!==options.minZoom?options.minZoom:-1/0,properties[Property_MAX_ZOOM]=void 0!==options.maxZoom?options.maxZoom:1/0,this.className_=void 0!==properties.className?properties.className:"ol-layer",delete properties.className,this.setProperties(properties),this.state_=null}getBackground(){return this.background_}getClassName(){return this.className_}getLayerState(managed){const state=this.state_||{layer:this,managed:void 0===managed||managed},zIndex=this.getZIndex();return state.opacity=(0,math.qE)(Math.round(100*this.getOpacity())/100,0,1),state.visible=this.getVisible(),state.extent=this.getExtent(),state.zIndex=void 0!==zIndex||state.managed?zIndex:1/0,state.maxResolution=this.getMaxResolution(),state.minResolution=Math.max(this.getMinResolution(),0),state.minZoom=this.getMinZoom(),state.maxZoom=this.getMaxZoom(),this.state_=state,state}getLayersArray(array){return(0,util.b0)()}getLayerStatesArray(states){return(0,util.b0)()}getExtent(){return this.get(Property_EXTENT)}getMaxResolution(){return this.get(Property_MAX_RESOLUTION)}getMinResolution(){return this.get(Property_MIN_RESOLUTION)}getMinZoom(){return this.get(Property_MIN_ZOOM)}getMaxZoom(){return this.get(Property_MAX_ZOOM)}getOpacity(){return this.get(Property_OPACITY)}getSourceState(){return(0,util.b0)()}getVisible(){return this.get(Property_VISIBLE)}getZIndex(){return this.get(Property_Z_INDEX)}setBackground(background){this.background_=background,this.changed()}setExtent(extent){this.set(Property_EXTENT,extent)}setMaxResolution(maxResolution){this.set(Property_MAX_RESOLUTION,maxResolution)}setMinResolution(minResolution){this.set(Property_MIN_RESOLUTION,minResolution)}setMaxZoom(maxZoom){this.set(Property_MAX_ZOOM,maxZoom)}setMinZoom(minZoom){this.set(Property_MIN_ZOOM,minZoom)}setOpacity(opacity){(0,asserts.v)("number"==typeof opacity,"Layer opacity must be a number"),this.set(Property_OPACITY,opacity)}setVisible(visible){this.set(Property_VISIBLE,visible)}setZIndex(zindex){this.set(Property_Z_INDEX,zindex)}disposeInternal(){this.state_&&(this.state_.layer=null,this.state_=null),super.disposeInternal()}}const Base=BaseLayer;var EventType=__webpack_require__("./node_modules/ol/events/EventType.js");const render_EventType_PRERENDER="prerender",render_EventType_POSTRENDER="postrender",render_EventType_PRECOMPOSE="precompose",render_EventType_POSTCOMPOSE="postcompose",render_EventType_RENDERCOMPLETE="rendercomplete",ViewHint_ANIMATING=0,ViewHint_INTERACTING=1,ViewProperty={CENTER:"center",RESOLUTION:"resolution",ROTATION:"rotation"};var common=__webpack_require__("./node_modules/ol/tilegrid/common.js"),ol_proj=__webpack_require__("./node_modules/ol/proj.js"),ol_coordinate=__webpack_require__("./node_modules/ol/coordinate.js");function createExtent(extent,onlyCenter,smooth){return function(center,resolution,size,isMoving,centerShift){if(!center)return;if(!resolution&&!onlyCenter)return center;const viewWidth=onlyCenter?0:size[0]*resolution,viewHeight=onlyCenter?0:size[1]*resolution,shiftX=centerShift?centerShift[0]:0,shiftY=centerShift?centerShift[1]:0;let minX=extent[0]+viewWidth/2+shiftX,maxX=extent[2]-viewWidth/2+shiftX,minY=extent[1]+viewHeight/2+shiftY,maxY=extent[3]-viewHeight/2+shiftY;minX>maxX&&(minX=(maxX+minX)/2,maxX=minX),minY>maxY&&(minY=(maxY+minY)/2,maxY=minY);let x=(0,math.qE)(center[0],minX,maxX),y=(0,math.qE)(center[1],minY,maxY);if(isMoving&&smooth&&resolution){const ratio=30*resolution;x+=-ratio*Math.log(1+Math.max(0,minX-center[0])/ratio)+ratio*Math.log(1+Math.max(0,center[0]-maxX)/ratio),y+=-ratio*Math.log(1+Math.max(0,minY-center[1])/ratio)+ratio*Math.log(1+Math.max(0,center[1]-maxY)/ratio)}return[x,y]}}function none(center){return center}var array=__webpack_require__("./node_modules/ol/array.js");function getViewportClampedResolution(resolution,maxExtent,viewportSize,showFullExtent){const xResolution=(0,ol_extent.RG)(maxExtent)/viewportSize[0],yResolution=(0,ol_extent.Oq)(maxExtent)/viewportSize[1];return showFullExtent?Math.min(resolution,Math.max(xResolution,yResolution)):Math.min(resolution,Math.min(xResolution,yResolution))}function getSmoothClampedResolution(resolution,maxResolution,minResolution){let result=Math.min(resolution,maxResolution);return result*=Math.log(1+50*Math.max(0,resolution/maxResolution-1))/50+1,minResolution&&(result=Math.max(result,minResolution),result/=Math.log(1+50*Math.max(0,minResolution/resolution-1))/50+1),(0,math.qE)(result,minResolution/2,2*maxResolution)}function createMinMaxResolution(maxResolution,minResolution,smooth,maxExtent,showFullExtent){return smooth=void 0===smooth||smooth,function(resolution,direction,size,isMoving){if(void 0!==resolution){const cappedMaxRes=maxExtent?getViewportClampedResolution(maxResolution,maxExtent,size,showFullExtent):maxResolution;return smooth&&isMoving?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):(0,math.qE)(resolution,minResolution,cappedMaxRes)}}}var rotationconstraint=__webpack_require__("./node_modules/ol/rotationconstraint.js"),easing=__webpack_require__("./node_modules/ol/easing.js"),Polygon=__webpack_require__("./node_modules/ol/geom/Polygon.js");class View_View extends ol_Object.A{constructor(options){super(),this.on,this.once,this.un,options=Object.assign({},options),this.hints_=[0,0],this.animations_=[],this.updateAnimationKey_,this.projection_=(0,ol_proj.Av)(options.projection,"EPSG:3857"),this.viewportSize_=[100,100],this.targetCenter_=null,this.targetResolution_,this.targetRotation_,this.nextCenter_=null,this.nextResolution_,this.nextRotation_,this.cancelAnchor_=void 0,options.projection&&(0,ol_proj.RJ)(),options.center&&(options.center=(0,ol_proj.Ad)(options.center,this.projection_)),options.extent&&(options.extent=(0,ol_proj.SD)(options.extent,this.projection_)),this.applyOptions_(options)}applyOptions_(options){const properties=Object.assign({},options);for(const key in ViewProperty)delete properties[key];this.setProperties(properties,!0);const resolutionConstraintInfo=function createResolutionConstraint(options){let resolutionConstraint,maxResolution,minResolution;const defaultMaxZoom=28,defaultZoomFactor=2;let minZoom=void 0!==options.minZoom?options.minZoom:0,maxZoom=void 0!==options.maxZoom?options.maxZoom:defaultMaxZoom;const zoomFactor=void 0!==options.zoomFactor?options.zoomFactor:defaultZoomFactor,multiWorld=void 0!==options.multiWorld&&options.multiWorld,smooth=void 0===options.smoothResolutionConstraint||options.smoothResolutionConstraint,showFullExtent=void 0!==options.showFullExtent&&options.showFullExtent,projection=(0,ol_proj.Av)(options.projection,"EPSG:3857"),projExtent=projection.getExtent();let constrainOnlyCenter=options.constrainOnlyCenter,extent=options.extent;multiWorld||extent||!projection.isGlobal()||(constrainOnlyCenter=!1,extent=projExtent);if(void 0!==options.resolutions){const resolutions=options.resolutions;maxResolution=resolutions[minZoom],minResolution=void 0!==resolutions[maxZoom]?resolutions[maxZoom]:resolutions[resolutions.length-1],resolutionConstraint=options.constrainResolution?function createSnapToResolutions(resolutions,smooth,maxExtent,showFullExtent){return smooth=void 0===smooth||smooth,function(resolution,direction,size,isMoving){if(void 0!==resolution){const maxResolution=resolutions[0],minResolution=resolutions[resolutions.length-1],cappedMaxRes=maxExtent?getViewportClampedResolution(maxResolution,maxExtent,size,showFullExtent):maxResolution;if(isMoving)return smooth?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):(0,math.qE)(resolution,minResolution,cappedMaxRes);const capped=Math.min(cappedMaxRes,resolution),z=Math.floor((0,array.FT)(resolutions,capped,direction));return resolutions[z]>cappedMaxRes&&z<resolutions.length-1?resolutions[z+1]:resolutions[z]}}}(resolutions,smooth,!constrainOnlyCenter&&extent,showFullExtent):createMinMaxResolution(maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent,showFullExtent)}else{const defaultMaxResolution=(projExtent?Math.max((0,ol_extent.RG)(projExtent),(0,ol_extent.Oq)(projExtent)):360*ol_proj.Ig.degrees/projection.getMetersPerUnit())/common.R/Math.pow(defaultZoomFactor,0),defaultMinResolution=defaultMaxResolution/Math.pow(defaultZoomFactor,defaultMaxZoom-0);maxResolution=options.maxResolution,void 0!==maxResolution?minZoom=0:maxResolution=defaultMaxResolution/Math.pow(zoomFactor,minZoom),minResolution=options.minResolution,void 0===minResolution&&(minResolution=void 0!==options.maxZoom?void 0!==options.maxResolution?maxResolution/Math.pow(zoomFactor,maxZoom):defaultMaxResolution/Math.pow(zoomFactor,maxZoom):defaultMinResolution),maxZoom=minZoom+Math.floor(Math.log(maxResolution/minResolution)/Math.log(zoomFactor)),minResolution=maxResolution/Math.pow(zoomFactor,maxZoom-minZoom),resolutionConstraint=options.constrainResolution?function createSnapToPower(power,maxResolution,minResolution,smooth,maxExtent,showFullExtent){return smooth=void 0===smooth||smooth,minResolution=void 0!==minResolution?minResolution:0,function(resolution,direction,size,isMoving){if(void 0!==resolution){const cappedMaxRes=maxExtent?getViewportClampedResolution(maxResolution,maxExtent,size,showFullExtent):maxResolution;if(isMoving)return smooth?getSmoothClampedResolution(resolution,cappedMaxRes,minResolution):(0,math.qE)(resolution,minResolution,cappedMaxRes);const tolerance=1e-9,minZoomLevel=Math.ceil(Math.log(maxResolution/cappedMaxRes)/Math.log(power)-tolerance),offset=-direction*(.5-tolerance)+.5,capped=Math.min(cappedMaxRes,resolution),cappedZoomLevel=Math.floor(Math.log(maxResolution/capped)/Math.log(power)+offset),zoomLevel=Math.max(minZoomLevel,cappedZoomLevel),newResolution=maxResolution/Math.pow(power,zoomLevel);return(0,math.qE)(newResolution,minResolution,cappedMaxRes)}}}(zoomFactor,maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent,showFullExtent):createMinMaxResolution(maxResolution,minResolution,smooth,!constrainOnlyCenter&&extent,showFullExtent)}return{constraint:resolutionConstraint,maxResolution,minResolution,minZoom,zoomFactor}}(options);this.maxResolution_=resolutionConstraintInfo.maxResolution,this.minResolution_=resolutionConstraintInfo.minResolution,this.zoomFactor_=resolutionConstraintInfo.zoomFactor,this.resolutions_=options.resolutions,this.padding_=options.padding,this.minZoom_=resolutionConstraintInfo.minZoom;const centerConstraint=function createCenterConstraint(options){if(void 0!==options.extent){const smooth=void 0===options.smoothExtentConstraint||options.smoothExtentConstraint;return createExtent(options.extent,options.constrainOnlyCenter,smooth)}const projection=(0,ol_proj.Av)(options.projection,"EPSG:3857");if(!0!==options.multiWorld&&projection.isGlobal()){const extent=projection.getExtent().slice();return extent[0]=-1/0,extent[2]=1/0,createExtent(extent,!1,!1)}return none}(options),resolutionConstraint=resolutionConstraintInfo.constraint,rotationConstraint=function createRotationConstraint(options){const enableRotation=void 0===options.enableRotation||options.enableRotation;if(enableRotation){const constrainRotation=options.constrainRotation;return void 0===constrainRotation||!0===constrainRotation?(0,rotationconstraint.cq)():!1===constrainRotation?rotationconstraint.dv:"number"==typeof constrainRotation?(0,rotationconstraint.a$)(constrainRotation):rotationconstraint.dv}return rotationconstraint.b8}(options);this.constraints_={center:centerConstraint,resolution:resolutionConstraint,rotation:rotationConstraint},this.setRotation(void 0!==options.rotation?options.rotation:0),this.setCenterInternal(void 0!==options.center?options.center:null),void 0!==options.resolution?this.setResolution(options.resolution):void 0!==options.zoom&&this.setZoom(options.zoom)}get padding(){return this.padding_}set padding(padding){let oldPadding=this.padding_;this.padding_=padding;const center=this.getCenterInternal();if(center){const newPadding=padding||[0,0,0,0];oldPadding=oldPadding||[0,0,0,0];const resolution=this.getResolution(),offsetX=resolution/2*(newPadding[3]-oldPadding[3]+oldPadding[1]-newPadding[1]),offsetY=resolution/2*(newPadding[0]-oldPadding[0]+oldPadding[2]-newPadding[2]);this.setCenterInternal([center[0]+offsetX,center[1]-offsetY])}}getUpdatedOptions_(newOptions){const options=this.getProperties();return void 0!==options.resolution?options.resolution=this.getResolution():options.zoom=this.getZoom(),options.center=this.getCenterInternal(),options.rotation=this.getRotation(),Object.assign({},options,newOptions)}animate(var_args){this.isDef()&&!this.getAnimating()&&this.resolveConstraints(0);const args=new Array(arguments.length);for(let i=0;i<args.length;++i){let options=arguments[i];options.center&&(options=Object.assign({},options),options.center=(0,ol_proj.Ad)(options.center,this.getProjection())),options.anchor&&(options=Object.assign({},options),options.anchor=(0,ol_proj.Ad)(options.anchor,this.getProjection())),args[i]=options}this.animateInternal.apply(this,args)}animateInternal(var_args){let callback,animationCount=arguments.length;animationCount>1&&"function"==typeof arguments[animationCount-1]&&(callback=arguments[animationCount-1],--animationCount);let i=0;for(;i<animationCount&&!this.isDef();++i){const state=arguments[i];state.center&&this.setCenterInternal(state.center),void 0!==state.zoom?this.setZoom(state.zoom):state.resolution&&this.setResolution(state.resolution),void 0!==state.rotation&&this.setRotation(state.rotation)}if(i===animationCount)return void(callback&&animationCallback(callback,!0));let start=Date.now(),center=this.targetCenter_.slice(),resolution=this.targetResolution_,rotation=this.targetRotation_;const series=[];for(;i<animationCount;++i){const options=arguments[i],animation={start,complete:!1,anchor:options.anchor,duration:void 0!==options.duration?options.duration:1e3,easing:options.easing||easing.T9,callback};if(options.center&&(animation.sourceCenter=center,animation.targetCenter=options.center.slice(),center=animation.targetCenter),void 0!==options.zoom?(animation.sourceResolution=resolution,animation.targetResolution=this.getResolutionForZoom(options.zoom),resolution=animation.targetResolution):options.resolution&&(animation.sourceResolution=resolution,animation.targetResolution=options.resolution,resolution=animation.targetResolution),void 0!==options.rotation){animation.sourceRotation=rotation;const delta=(0,math.xP)(options.rotation-rotation+Math.PI,2*Math.PI)-Math.PI;animation.targetRotation=rotation+delta,rotation=animation.targetRotation}isNoopAnimation(animation)?animation.complete=!0:start+=animation.duration,series.push(animation)}this.animations_.push(series),this.setHint(ViewHint_ANIMATING,1),this.updateAnimations_()}getAnimating(){return this.hints_[ViewHint_ANIMATING]>0}getInteracting(){return this.hints_[ViewHint_INTERACTING]>0}cancelAnimations(){let anchor;this.setHint(ViewHint_ANIMATING,-this.hints_[ViewHint_ANIMATING]);for(let i=0,ii=this.animations_.length;i<ii;++i){const series=this.animations_[i];if(series[0].callback&&animationCallback(series[0].callback,!1),!anchor)for(let j=0,jj=series.length;j<jj;++j){const animation=series[j];if(!animation.complete){anchor=animation.anchor;break}}}this.animations_.length=0,this.cancelAnchor_=anchor,this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN}updateAnimations_(){if(void 0!==this.updateAnimationKey_&&(cancelAnimationFrame(this.updateAnimationKey_),this.updateAnimationKey_=void 0),!this.getAnimating())return;const now=Date.now();let more=!1;for(let i=this.animations_.length-1;i>=0;--i){const series=this.animations_[i];let seriesComplete=!0;for(let j=0,jj=series.length;j<jj;++j){const animation=series[j];if(animation.complete)continue;const elapsed=now-animation.start;let fraction=animation.duration>0?elapsed/animation.duration:1;fraction>=1?(animation.complete=!0,fraction=1):seriesComplete=!1;const progress=animation.easing(fraction);if(animation.sourceCenter){const x0=animation.sourceCenter[0],y0=animation.sourceCenter[1],x1=animation.targetCenter[0],y1=animation.targetCenter[1];this.nextCenter_=animation.targetCenter;const x=x0+progress*(x1-x0),y=y0+progress*(y1-y0);this.targetCenter_=[x,y]}if(animation.sourceResolution&&animation.targetResolution){const resolution=1===progress?animation.targetResolution:animation.sourceResolution+progress*(animation.targetResolution-animation.sourceResolution);if(animation.anchor){const size=this.getViewportSize_(this.getRotation()),constrainedResolution=this.constraints_.resolution(resolution,0,size,!0);this.targetCenter_=this.calculateCenterZoom(constrainedResolution,animation.anchor)}this.nextResolution_=animation.targetResolution,this.targetResolution_=resolution,this.applyTargetState_(!0)}if(void 0!==animation.sourceRotation&&void 0!==animation.targetRotation){const rotation=1===progress?(0,math.xP)(animation.targetRotation+Math.PI,2*Math.PI)-Math.PI:animation.sourceRotation+progress*(animation.targetRotation-animation.sourceRotation);if(animation.anchor){const constrainedRotation=this.constraints_.rotation(rotation,!0);this.targetCenter_=this.calculateCenterRotate(constrainedRotation,animation.anchor)}this.nextRotation_=animation.targetRotation,this.targetRotation_=rotation}if(this.applyTargetState_(!0),more=!0,!animation.complete)break}if(seriesComplete){this.animations_[i]=null,this.setHint(ViewHint_ANIMATING,-1),this.nextCenter_=null,this.nextResolution_=NaN,this.nextRotation_=NaN;const callback=series[0].callback;callback&&animationCallback(callback,!0)}}this.animations_=this.animations_.filter(Boolean),more&&void 0===this.updateAnimationKey_&&(this.updateAnimationKey_=requestAnimationFrame(this.updateAnimations_.bind(this)))}calculateCenterRotate(rotation,anchor){let center;const currentCenter=this.getCenterInternal();return void 0!==currentCenter&&(center=[currentCenter[0]-anchor[0],currentCenter[1]-anchor[1]],(0,ol_coordinate.e$)(center,rotation-this.getRotation()),(0,ol_coordinate.WQ)(center,anchor)),center}calculateCenterZoom(resolution,anchor){let center;const currentCenter=this.getCenterInternal(),currentResolution=this.getResolution();if(void 0!==currentCenter&&void 0!==currentResolution){center=[anchor[0]-resolution*(anchor[0]-currentCenter[0])/currentResolution,anchor[1]-resolution*(anchor[1]-currentCenter[1])/currentResolution]}return center}getViewportSize_(rotation){const size=this.viewportSize_;if(rotation){const w=size[0],h=size[1];return[Math.abs(w*Math.cos(rotation))+Math.abs(h*Math.sin(rotation)),Math.abs(w*Math.sin(rotation))+Math.abs(h*Math.cos(rotation))]}return size}setViewportSize(size){this.viewportSize_=Array.isArray(size)?size.slice():[100,100],this.getAnimating()||this.resolveConstraints(0)}getCenter(){const center=this.getCenterInternal();return center?(0,ol_proj.te)(center,this.getProjection()):center}getCenterInternal(){return this.get(ViewProperty.CENTER)}getConstraints(){return this.constraints_}getConstrainResolution(){return this.get("constrainResolution")}getHints(hints){return void 0!==hints?(hints[0]=this.hints_[0],hints[1]=this.hints_[1],hints):this.hints_.slice()}calculateExtent(size){const extent=this.calculateExtentInternal(size);return(0,ol_proj.JR)(extent,this.getProjection())}calculateExtentInternal(size){size=size||this.getViewportSizeMinusPadding_();const center=this.getCenterInternal();(0,asserts.v)(center,"The view center is not defined");const resolution=this.getResolution();(0,asserts.v)(void 0!==resolution,"The view resolution is not defined");const rotation=this.getRotation();return(0,asserts.v)(void 0!==rotation,"The view rotation is not defined"),(0,ol_extent.Bg)(center,resolution,rotation,size)}getMaxResolution(){return this.maxResolution_}getMinResolution(){return this.minResolution_}getMaxZoom(){return this.getZoomForResolution(this.minResolution_)}setMaxZoom(zoom){this.applyOptions_(this.getUpdatedOptions_({maxZoom:zoom}))}getMinZoom(){return this.getZoomForResolution(this.maxResolution_)}setMinZoom(zoom){this.applyOptions_(this.getUpdatedOptions_({minZoom:zoom}))}setConstrainResolution(enabled){this.applyOptions_(this.getUpdatedOptions_({constrainResolution:enabled}))}getProjection(){return this.projection_}getResolution(){return this.get(ViewProperty.RESOLUTION)}getResolutions(){return this.resolutions_}getResolutionForExtent(extent,size){return this.getResolutionForExtentInternal((0,ol_proj.SD)(extent,this.getProjection()),size)}getResolutionForExtentInternal(extent,size){size=size||this.getViewportSizeMinusPadding_();const xResolution=(0,ol_extent.RG)(extent)/size[0],yResolution=(0,ol_extent.Oq)(extent)/size[1];return Math.max(xResolution,yResolution)}getResolutionForValueFunction(power){power=power||2;const maxResolution=this.getConstrainedResolution(this.maxResolution_),minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/Math.log(power);return function(value){return maxResolution/Math.pow(power,value*max)}}getRotation(){return this.get(ViewProperty.ROTATION)}getValueForResolutionFunction(power){const logPower=Math.log(power||2),maxResolution=this.getConstrainedResolution(this.maxResolution_),minResolution=this.minResolution_,max=Math.log(maxResolution/minResolution)/logPower;return function(resolution){return Math.log(maxResolution/resolution)/logPower/max}}getViewportSizeMinusPadding_(rotation){let size=this.getViewportSize_(rotation);const padding=this.padding_;return padding&&(size=[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]),size}getState(){const projection=this.getProjection(),resolution=this.getResolution(),rotation=this.getRotation();let center=this.getCenterInternal();const padding=this.padding_;if(padding){const reducedSize=this.getViewportSizeMinusPadding_();center=calculateCenterOn(center,this.getViewportSize_(),[reducedSize[0]/2+padding[3],reducedSize[1]/2+padding[0]],resolution,rotation)}return{center:center.slice(0),projection:void 0!==projection?projection:null,resolution,nextCenter:this.nextCenter_,nextResolution:this.nextResolution_,nextRotation:this.nextRotation_,rotation,zoom:this.getZoom()}}getViewStateAndExtent(){return{viewState:this.getState(),extent:this.calculateExtent()}}getZoom(){let zoom;const resolution=this.getResolution();return void 0!==resolution&&(zoom=this.getZoomForResolution(resolution)),zoom}getZoomForResolution(resolution){let max,zoomFactor,offset=this.minZoom_||0;if(this.resolutions_){const nearest=(0,array.FT)(this.resolutions_,resolution,1);offset=nearest,max=this.resolutions_[nearest],zoomFactor=nearest==this.resolutions_.length-1?2:max/this.resolutions_[nearest+1]}else max=this.maxResolution_,zoomFactor=this.zoomFactor_;return offset+Math.log(max/resolution)/Math.log(zoomFactor)}getResolutionForZoom(zoom){if(this.resolutions_){if(this.resolutions_.length<=1)return 0;const baseLevel=(0,math.qE)(Math.floor(zoom),0,this.resolutions_.length-2),zoomFactor=this.resolutions_[baseLevel]/this.resolutions_[baseLevel+1];return this.resolutions_[baseLevel]/Math.pow(zoomFactor,(0,math.qE)(zoom-baseLevel,0,1))}return this.maxResolution_/Math.pow(this.zoomFactor_,zoom-this.minZoom_)}fit(geometryOrExtent,options){let geometry;if((0,asserts.v)(Array.isArray(geometryOrExtent)||"function"==typeof geometryOrExtent.getSimplifiedGeometry,"Invalid extent or geometry provided as `geometry`"),Array.isArray(geometryOrExtent)){(0,asserts.v)(!(0,ol_extent.Im)(geometryOrExtent),"Cannot fit empty extent provided as `geometry`");const extent=(0,ol_proj.SD)(geometryOrExtent,this.getProjection());geometry=(0,Polygon.VY)(extent)}else if("Circle"===geometryOrExtent.getType()){const extent=(0,ol_proj.SD)(geometryOrExtent.getExtent(),this.getProjection());geometry=(0,Polygon.VY)(extent),geometry.rotate(this.getRotation(),(0,ol_extent.q1)(extent))}else{const userProjection=(0,ol_proj.Tf)();geometry=userProjection?geometryOrExtent.clone().transform(userProjection,this.getProjection()):geometryOrExtent}this.fitInternal(geometry,options)}rotatedExtentForGeometry(geometry){const rotation=this.getRotation(),cosAngle=Math.cos(rotation),sinAngle=Math.sin(-rotation),coords=geometry.getFlatCoordinates(),stride=geometry.getStride();let minRotX=1/0,minRotY=1/0,maxRotX=-1/0,maxRotY=-1/0;for(let i=0,ii=coords.length;i<ii;i+=stride){const rotX=coords[i]*cosAngle-coords[i+1]*sinAngle,rotY=coords[i]*sinAngle+coords[i+1]*cosAngle;minRotX=Math.min(minRotX,rotX),minRotY=Math.min(minRotY,rotY),maxRotX=Math.max(maxRotX,rotX),maxRotY=Math.max(maxRotY,rotY)}return[minRotX,minRotY,maxRotX,maxRotY]}fitInternal(geometry,options){let size=(options=options||{}).size;size||(size=this.getViewportSizeMinusPadding_());const padding=void 0!==options.padding?options.padding:[0,0,0,0],nearest=void 0!==options.nearest&&options.nearest;let minResolution;minResolution=void 0!==options.minResolution?options.minResolution:void 0!==options.maxZoom?this.getResolutionForZoom(options.maxZoom):0;const rotatedExtent=this.rotatedExtentForGeometry(geometry);let resolution=this.getResolutionForExtentInternal(rotatedExtent,[size[0]-padding[1]-padding[3],size[1]-padding[0]-padding[2]]);resolution=isNaN(resolution)?minResolution:Math.max(resolution,minResolution),resolution=this.getConstrainedResolution(resolution,nearest?0:1);const rotation=this.getRotation(),sinAngle=Math.sin(rotation),cosAngle=Math.cos(rotation),centerRot=(0,ol_extent.q1)(rotatedExtent);centerRot[0]+=(padding[1]-padding[3])/2*resolution,centerRot[1]+=(padding[0]-padding[2])/2*resolution;const centerX=centerRot[0]*cosAngle-centerRot[1]*sinAngle,centerY=centerRot[1]*cosAngle+centerRot[0]*sinAngle,center=this.getConstrainedCenter([centerX,centerY],resolution),callback=options.callback?options.callback:functions.tV;void 0!==options.duration?this.animateInternal({resolution,center,duration:options.duration,easing:options.easing},callback):(this.targetResolution_=resolution,this.targetCenter_=center,this.applyTargetState_(!1,!0),animationCallback(callback,!0))}centerOn(coordinate,size,position){this.centerOnInternal((0,ol_proj.Ad)(coordinate,this.getProjection()),size,position)}centerOnInternal(coordinate,size,position){this.setCenterInternal(calculateCenterOn(coordinate,size,position,this.getResolution(),this.getRotation()))}calculateCenterShift(center,resolution,rotation,size){let centerShift;const padding=this.padding_;if(padding&&center){const reducedSize=this.getViewportSizeMinusPadding_(-rotation),shiftedCenter=calculateCenterOn(center,size,[reducedSize[0]/2+padding[3],reducedSize[1]/2+padding[0]],resolution,rotation);centerShift=[center[0]-shiftedCenter[0],center[1]-shiftedCenter[1]]}return centerShift}isDef(){return!!this.getCenterInternal()&&void 0!==this.getResolution()}adjustCenter(deltaCoordinates){const center=(0,ol_proj.te)(this.targetCenter_,this.getProjection());this.setCenter([center[0]+deltaCoordinates[0],center[1]+deltaCoordinates[1]])}adjustCenterInternal(deltaCoordinates){const center=this.targetCenter_;this.setCenterInternal([center[0]+deltaCoordinates[0],center[1]+deltaCoordinates[1]])}adjustResolution(ratio,anchor){anchor=anchor&&(0,ol_proj.Ad)(anchor,this.getProjection()),this.adjustResolutionInternal(ratio,anchor)}adjustResolutionInternal(ratio,anchor){const isMoving=this.getAnimating()||this.getInteracting(),size=this.getViewportSize_(this.getRotation()),newResolution=this.constraints_.resolution(this.targetResolution_*ratio,0,size,isMoving);anchor&&(this.targetCenter_=this.calculateCenterZoom(newResolution,anchor)),this.targetResolution_*=ratio,this.applyTargetState_()}adjustZoom(delta,anchor){this.adjustResolution(Math.pow(this.zoomFactor_,-delta),anchor)}adjustRotation(delta,anchor){anchor&&(anchor=(0,ol_proj.Ad)(anchor,this.getProjection())),this.adjustRotationInternal(delta,anchor)}adjustRotationInternal(delta,anchor){const isMoving=this.getAnimating()||this.getInteracting(),newRotation=this.constraints_.rotation(this.targetRotation_+delta,isMoving);anchor&&(this.targetCenter_=this.calculateCenterRotate(newRotation,anchor)),this.targetRotation_+=delta,this.applyTargetState_()}setCenter(center){this.setCenterInternal(center?(0,ol_proj.Ad)(center,this.getProjection()):center)}setCenterInternal(center){this.targetCenter_=center,this.applyTargetState_()}setHint(hint,delta){return this.hints_[hint]+=delta,this.changed(),this.hints_[hint]}setResolution(resolution){this.targetResolution_=resolution,this.applyTargetState_()}setRotation(rotation){this.targetRotation_=rotation,this.applyTargetState_()}setZoom(zoom){this.setResolution(this.getResolutionForZoom(zoom))}applyTargetState_(doNotCancelAnims,forceMoving){const isMoving=this.getAnimating()||this.getInteracting()||forceMoving,newRotation=this.constraints_.rotation(this.targetRotation_,isMoving),size=this.getViewportSize_(newRotation),newResolution=this.constraints_.resolution(this.targetResolution_,0,size,isMoving),newCenter=this.constraints_.center(this.targetCenter_,newResolution,size,isMoving,this.calculateCenterShift(this.targetCenter_,newResolution,newRotation,size));this.get(ViewProperty.ROTATION)!==newRotation&&this.set(ViewProperty.ROTATION,newRotation),this.get(ViewProperty.RESOLUTION)!==newResolution&&(this.set(ViewProperty.RESOLUTION,newResolution),this.set("zoom",this.getZoom(),!0)),newCenter&&this.get(ViewProperty.CENTER)&&(0,ol_coordinate.aI)(this.get(ViewProperty.CENTER),newCenter)||this.set(ViewProperty.CENTER,newCenter),this.getAnimating()&&!doNotCancelAnims&&this.cancelAnimations(),this.cancelAnchor_=void 0}resolveConstraints(duration,resolutionDirection,anchor){duration=void 0!==duration?duration:200;const direction=resolutionDirection||0,newRotation=this.constraints_.rotation(this.targetRotation_),size=this.getViewportSize_(newRotation),newResolution=this.constraints_.resolution(this.targetResolution_,direction,size),newCenter=this.constraints_.center(this.targetCenter_,newResolution,size,!1,this.calculateCenterShift(this.targetCenter_,newResolution,newRotation,size));if(0===duration&&!this.cancelAnchor_)return this.targetResolution_=newResolution,this.targetRotation_=newRotation,this.targetCenter_=newCenter,void this.applyTargetState_();anchor=anchor||(0===duration?this.cancelAnchor_:void 0),this.cancelAnchor_=void 0,this.getResolution()===newResolution&&this.getRotation()===newRotation&&this.getCenterInternal()&&(0,ol_coordinate.aI)(this.getCenterInternal(),newCenter)||(this.getAnimating()&&this.cancelAnimations(),this.animateInternal({rotation:newRotation,center:newCenter,resolution:newResolution,duration,easing:easing.vT,anchor}))}beginInteraction(){this.resolveConstraints(0),this.setHint(ViewHint_INTERACTING,1)}endInteraction(duration,resolutionDirection,anchor){anchor=anchor&&(0,ol_proj.Ad)(anchor,this.getProjection()),this.endInteractionInternal(duration,resolutionDirection,anchor)}endInteractionInternal(duration,resolutionDirection,anchor){this.getInteracting()&&(this.setHint(ViewHint_INTERACTING,-1),this.resolveConstraints(duration,resolutionDirection,anchor))}getConstrainedCenter(targetCenter,targetResolution){const size=this.getViewportSize_(this.getRotation());return this.constraints_.center(targetCenter,targetResolution||this.getResolution(),size)}getConstrainedZoom(targetZoom,direction){const targetRes=this.getResolutionForZoom(targetZoom);return this.getZoomForResolution(this.getConstrainedResolution(targetRes,direction))}getConstrainedResolution(targetResolution,direction){direction=direction||0;const size=this.getViewportSize_(this.getRotation());return this.constraints_.resolution(targetResolution,direction,size)}}function animationCallback(callback,returnValue){setTimeout((function(){callback(returnValue)}),0)}function isNoopAnimation(animation){return!(animation.sourceCenter&&animation.targetCenter&&!(0,ol_coordinate.aI)(animation.sourceCenter,animation.targetCenter))&&(animation.sourceResolution===animation.targetResolution&&animation.sourceRotation===animation.targetRotation)}function calculateCenterOn(coordinate,size,position,resolution,rotation){const cosAngle=Math.cos(-rotation);let sinAngle=Math.sin(-rotation),rotX=coordinate[0]*cosAngle-coordinate[1]*sinAngle,rotY=coordinate[1]*cosAngle+coordinate[0]*sinAngle;rotX+=(size[0]/2-position[0])*resolution,rotY+=(position[1]-size[1]/2)*resolution,sinAngle=-sinAngle;return[rotX*cosAngle-rotY*sinAngle,rotY*cosAngle+rotX*sinAngle]}const ol_View=View_View;var events=__webpack_require__("./node_modules/ol/events.js");function inView(layerState,viewState){if(!layerState.visible)return!1;const resolution=viewState.resolution;if(resolution<layerState.minResolution||resolution>=layerState.maxResolution)return!1;const zoom=viewState.zoom;return zoom>layerState.minZoom&&zoom<=layerState.maxZoom}const layer_Layer=class Layer extends Base{constructor(options){const baseOptions=Object.assign({},options);delete baseOptions.source,super(baseOptions),this.on,this.once,this.un,this.mapPrecomposeKey_=null,this.mapRenderKey_=null,this.sourceChangeKey_=null,this.renderer_=null,this.sourceReady_=!1,this.rendered=!1,options.render&&(this.render=options.render),options.map&&this.setMap(options.map),this.addChangeListener(Property_SOURCE,this.handleSourcePropertyChange_);const source=options.source?options.source:null;this.setSource(source)}getLayersArray(array){return(array=array||[]).push(this),array}getLayerStatesArray(states){return(states=states||[]).push(this.getLayerState()),states}getSource(){return this.get(Property_SOURCE)||null}getRenderSource(){return this.getSource()}getSourceState(){const source=this.getSource();return source?source.getState():"undefined"}handleSourceChange_(){this.changed(),this.sourceReady_||"ready"!==this.getSource().getState()||(this.sourceReady_=!0,this.dispatchEvent("sourceready"))}handleSourcePropertyChange_(){this.sourceChangeKey_&&((0,events.JH)(this.sourceChangeKey_),this.sourceChangeKey_=null),this.sourceReady_=!1;const source=this.getSource();source&&(this.sourceChangeKey_=(0,events.KT)(source,EventType.A.CHANGE,this.handleSourceChange_,this),"ready"===source.getState()&&(this.sourceReady_=!0,setTimeout((()=>{this.dispatchEvent("sourceready")}),0))),this.changed()}getFeatures(pixel){return this.renderer_?this.renderer_.getFeatures(pixel):Promise.resolve([])}getData(pixel){return this.renderer_&&this.rendered?this.renderer_.getData(pixel):null}isVisible(view){let frameState;const map=this.getMapInternal();let layerState;!view&&map&&(view=map.getView()),frameState=view instanceof ol_View?{viewState:view.getState(),extent:view.calculateExtent()}:view,!frameState.layerStatesArray&&map&&(frameState.layerStatesArray=map.getLayerGroup().getLayerStatesArray()),layerState=frameState.layerStatesArray?frameState.layerStatesArray.find((layerState=>layerState.layer===this)):this.getLayerState();const layerExtent=this.getExtent();return inView(layerState,frameState.viewState)&&(!layerExtent||(0,ol_extent.HY)(layerExtent,frameState.extent))}getAttributions(view){if(!this.isVisible(view))return[];let getAttributions;const source=this.getSource();if(source&&(getAttributions=source.getAttributions()),!getAttributions)return[];let attributions=getAttributions(view instanceof ol_View?view.getViewStateAndExtent():view);return Array.isArray(attributions)||(attributions=[attributions]),attributions}render(frameState,target){const layerRenderer=this.getRenderer();return layerRenderer.prepareFrame(frameState)?(this.rendered=!0,layerRenderer.renderFrame(frameState,target)):null}unrender(){this.rendered=!1}setMapInternal(map){map||this.unrender(),this.set(Property_MAP,map)}getMapInternal(){return this.get(Property_MAP)}setMap(map){this.mapPrecomposeKey_&&((0,events.JH)(this.mapPrecomposeKey_),this.mapPrecomposeKey_=null),map||this.changed(),this.mapRenderKey_&&((0,events.JH)(this.mapRenderKey_),this.mapRenderKey_=null),map&&(this.mapPrecomposeKey_=(0,events.KT)(map,render_EventType_PRECOMPOSE,(function(evt){const layerStatesArray=evt.frameState.layerStatesArray,layerState=this.getLayerState(!1);(0,asserts.v)(!layerStatesArray.some((function(arrayLayerState){return arrayLayerState.layer===layerState.layer})),"A layer can only be added to the map once. Use either `layer.setMap()` or `map.addLayer()`, not both."),layerStatesArray.push(layerState)}),this),this.mapRenderKey_=(0,events.KT)(this,EventType.A.CHANGE,map.render,map),this.changed())}setSource(source){this.set(Property_SOURCE,source)}getRenderer(){return this.renderer_||(this.renderer_=this.createRenderer()),this.renderer_}hasRenderer(){return!!this.renderer_}createRenderer(){return null}disposeInternal(){this.renderer_&&(this.renderer_.dispose(),delete this.renderer_),this.setSource(null),super.disposeInternal()}};class MapRenderer extends Disposable.A{constructor(map){super(),this.map_=map}dispatchRenderEvent(type,frameState){(0,util.b0)()}calculateMatrices2D(frameState){const viewState=frameState.viewState,coordinateToPixelTransform=frameState.coordinateToPixelTransform,pixelToCoordinateTransform=frameState.pixelToCoordinateTransform;(0,ol_transform.Zz)(coordinateToPixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/viewState.resolution,-1/viewState.resolution,-viewState.rotation,-viewState.center[0],-viewState.center[1]),(0,ol_transform.T9)(pixelToCoordinateTransform,coordinateToPixelTransform)}forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,checkWrapped,callback,thisArg,layerFilter,thisArg2){let result;const viewState=frameState.viewState;function forEachFeatureAtCoordinate(managed,feature,layer,geometry){return callback.call(thisArg,feature,managed?layer:null,geometry)}const projection=viewState.projection,translatedCoordinate=(0,ol_coordinate.Li)(coordinate.slice(),projection),offsets=[[0,0]];if(projection.canWrapX()&&checkWrapped){const projectionExtent=projection.getExtent(),worldWidth=(0,ol_extent.RG)(projectionExtent);offsets.push([-worldWidth,0],[worldWidth,0])}const layerStates=frameState.layerStatesArray,numLayers=layerStates.length,matches=[],tmpCoord=[];for(let i=0;i<offsets.length;i++)for(let j=numLayers-1;j>=0;--j){const layerState=layerStates[j],layer=layerState.layer;if(layer.hasRenderer()&&inView(layerState,viewState)&&layerFilter.call(thisArg2,layer)){const layerRenderer=layer.getRenderer(),source=layer.getSource();if(layerRenderer&&source){const coordinates=source.getWrapX()?translatedCoordinate:coordinate,callback=forEachFeatureAtCoordinate.bind(null,layerState.managed);tmpCoord[0]=coordinates[0]+offsets[i][0],tmpCoord[1]=coordinates[1]+offsets[i][1],result=layerRenderer.forEachFeatureAtCoordinate(tmpCoord,frameState,hitTolerance,callback,matches)}if(result)return result}}if(0===matches.length)return;const order=1/matches.length;return matches.forEach(((m,i)=>m.distanceSq+=i*order)),matches.sort(((a,b)=>a.distanceSq-b.distanceSq)),matches.some((m=>result=m.callback(m.feature,m.layer,m.geometry))),result}hasFeatureAtCoordinate(coordinate,frameState,hitTolerance,checkWrapped,layerFilter,thisArg){return void 0!==this.forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,checkWrapped,functions.rT,this,layerFilter,thisArg)}getMap(){return this.map_}renderFrame(frameState){(0,util.b0)()}flushDeclutterItems(frameState){}scheduleExpireIconCache(frameState){shared.canExpireCache()&&frameState.postRenderFunctions.push(expireIconCache)}}function expireIconCache(map,frameState){shared.expire()}const renderer_Map=MapRenderer;var ObjectEventType=__webpack_require__("./node_modules/ol/ObjectEventType.js"),Event=__webpack_require__("./node_modules/ol/events/Event.js");class RenderEvent extends Event.Ay{constructor(type,inversePixelTransform,frameState,context){super(type),this.inversePixelTransform=inversePixelTransform,this.frameState=frameState,this.context=context}}const render_Event=RenderEvent;var css=__webpack_require__("./node_modules/ol/css.js"),render_canvas=__webpack_require__("./node_modules/ol/render/canvas.js"),dom=__webpack_require__("./node_modules/ol/dom.js");const Composite=class CompositeMapRenderer extends renderer_Map{constructor(map){super(map),this.fontChangeListenerKey_=(0,events.KT)(render_canvas.yY,ObjectEventType.A.PROPERTYCHANGE,map.redrawText.bind(map)),this.element_=document.createElement("div");const style=this.element_.style;style.position="absolute",style.width="100%",style.height="100%",style.zIndex="0",this.element_.className=css.XI+" ol-layers";const container=map.getViewport();container.insertBefore(this.element_,container.firstChild||null),this.children_=[],this.renderedVisible_=!0,this.declutterLayers_=[]}dispatchRenderEvent(type,frameState){const map=this.getMap();if(map.hasListener(type)){const event=new render_Event(type,void 0,frameState);map.dispatchEvent(event)}}disposeInternal(){(0,events.JH)(this.fontChangeListenerKey_),this.element_.parentNode.removeChild(this.element_),super.disposeInternal()}renderFrame(frameState){if(!frameState)return void(this.renderedVisible_&&(this.element_.style.display="none",this.renderedVisible_=!1));this.calculateMatrices2D(frameState),this.dispatchRenderEvent(render_EventType_PRECOMPOSE,frameState);const layerStatesArray=frameState.layerStatesArray.sort((function(a,b){return a.zIndex-b.zIndex})),viewState=frameState.viewState;this.children_.length=0;const declutterLayers=this.declutterLayers_;declutterLayers.length=0;let previousElement=null;for(let i=0,ii=layerStatesArray.length;i<ii;++i){const layerState=layerStatesArray[i];frameState.layerIndex=i;const layer=layerState.layer,sourceState=layer.getSourceState();if(!inView(layerState,viewState)||"ready"!=sourceState&&"undefined"!=sourceState){layer.unrender();continue}const element=layer.render(frameState,previousElement);element&&(element!==previousElement&&(this.children_.push(element),previousElement=element),"getDeclutter"in layer&&declutterLayers.push(layer))}this.flushDeclutterItems(frameState),(0,dom.WM)(this.element_,this.children_),this.dispatchRenderEvent(render_EventType_POSTCOMPOSE,frameState),this.renderedVisible_||(this.element_.style.display="",this.renderedVisible_=!0),this.scheduleExpireIconCache(frameState)}flushDeclutterItems(frameState){const layers=this.declutterLayers_;for(let i=layers.length-1;i>=0;--i)layers[i].renderDeclutter(frameState);layers.length=0}};var obj=__webpack_require__("./node_modules/ol/obj.js");class GroupEvent extends Event.Ay{constructor(type,layer){super(type),this.layer=layer}}const Group_Property_LAYERS="layers";class LayerGroup extends Base{constructor(options){options=options||{};const baseOptions=Object.assign({},options);delete baseOptions.layers;let layers=options.layers;super(baseOptions),this.on,this.once,this.un,this.layersListenerKeys_=[],this.listenerKeys_={},this.addChangeListener(Group_Property_LAYERS,this.handleLayersChanged_),layers?Array.isArray(layers)?layers=new Collection.A(layers.slice(),{unique:!0}):(0,asserts.v)("function"==typeof layers.getArray,"Expected `layers` to be an array or a `Collection`"):layers=new Collection.A(void 0,{unique:!0}),this.setLayers(layers)}handleLayerChange_(){this.changed()}handleLayersChanged_(){this.layersListenerKeys_.forEach(events.JH),this.layersListenerKeys_.length=0;const layers=this.getLayers();this.layersListenerKeys_.push((0,events.KT)(layers,CollectionEventType.A.ADD,this.handleLayersAdd_,this),(0,events.KT)(layers,CollectionEventType.A.REMOVE,this.handleLayersRemove_,this));for(const id in this.listenerKeys_)this.listenerKeys_[id].forEach(events.JH);(0,obj.I)(this.listenerKeys_);const layersArray=layers.getArray();for(let i=0,ii=layersArray.length;i<ii;i++){const layer=layersArray[i];this.registerLayerListeners_(layer),this.dispatchEvent(new GroupEvent("addlayer",layer))}this.changed()}registerLayerListeners_(layer){const listenerKeys=[(0,events.KT)(layer,ObjectEventType.A.PROPERTYCHANGE,this.handleLayerChange_,this),(0,events.KT)(layer,EventType.A.CHANGE,this.handleLayerChange_,this)];layer instanceof LayerGroup&&listenerKeys.push((0,events.KT)(layer,"addlayer",this.handleLayerGroupAdd_,this),(0,events.KT)(layer,"removelayer",this.handleLayerGroupRemove_,this)),this.listenerKeys_[(0,util.v6)(layer)]=listenerKeys}handleLayerGroupAdd_(event){this.dispatchEvent(new GroupEvent("addlayer",event.layer))}handleLayerGroupRemove_(event){this.dispatchEvent(new GroupEvent("removelayer",event.layer))}handleLayersAdd_(collectionEvent){const layer=collectionEvent.element;this.registerLayerListeners_(layer),this.dispatchEvent(new GroupEvent("addlayer",layer)),this.changed()}handleLayersRemove_(collectionEvent){const layer=collectionEvent.element,key=(0,util.v6)(layer);this.listenerKeys_[key].forEach(events.JH),delete this.listenerKeys_[key],this.dispatchEvent(new GroupEvent("removelayer",layer)),this.changed()}getLayers(){return this.get(Group_Property_LAYERS)}setLayers(layers){const collection=this.getLayers();if(collection){const currentLayers=collection.getArray();for(let i=0,ii=currentLayers.length;i<ii;++i)this.dispatchEvent(new GroupEvent("removelayer",currentLayers[i]))}this.set(Group_Property_LAYERS,layers)}getLayersArray(array){return array=void 0!==array?array:[],this.getLayers().forEach((function(layer){layer.getLayersArray(array)})),array}getLayerStatesArray(dest){const states=void 0!==dest?dest:[],pos=states.length;this.getLayers().forEach((function(layer){layer.getLayerStatesArray(states)}));const ownLayerState=this.getLayerState();let defaultZIndex=ownLayerState.zIndex;dest||void 0!==ownLayerState.zIndex||(defaultZIndex=0);for(let i=pos,ii=states.length;i<ii;i++){const layerState=states[i];layerState.opacity*=ownLayerState.opacity,layerState.visible=layerState.visible&&ownLayerState.visible,layerState.maxResolution=Math.min(layerState.maxResolution,ownLayerState.maxResolution),layerState.minResolution=Math.max(layerState.minResolution,ownLayerState.minResolution),layerState.minZoom=Math.max(layerState.minZoom,ownLayerState.minZoom),layerState.maxZoom=Math.min(layerState.maxZoom,ownLayerState.maxZoom),void 0!==ownLayerState.extent&&(void 0!==layerState.extent?layerState.extent=(0,ol_extent._N)(layerState.extent,ownLayerState.extent):layerState.extent=ownLayerState.extent),void 0===layerState.zIndex&&(layerState.zIndex=defaultZIndex)}return states}getSourceState(){return"ready"}}const Group=LayerGroup;class MapEvent extends Event.Ay{constructor(type,map,frameState){super(type),this.map=map,this.frameState=void 0!==frameState?frameState:null}}const ol_MapEvent=MapEvent;const ol_MapBrowserEvent=class MapBrowserEvent extends ol_MapEvent{constructor(type,map,originalEvent,dragging,frameState,activePointers){super(type,map,frameState),this.originalEvent=originalEvent,this.pixel_=null,this.coordinate_=null,this.dragging=void 0!==dragging&&dragging,this.activePointers=activePointers}get pixel(){return this.pixel_||(this.pixel_=this.map.getEventPixel(this.originalEvent)),this.pixel_}set pixel(pixel){this.pixel_=pixel}get coordinate(){return this.coordinate_||(this.coordinate_=this.map.getCoordinateFromPixel(this.pixel)),this.coordinate_}set coordinate(coordinate){this.coordinate_=coordinate}preventDefault(){super.preventDefault(),"preventDefault"in this.originalEvent&&this.originalEvent.preventDefault()}stopPropagation(){super.stopPropagation(),"stopPropagation"in this.originalEvent&&this.originalEvent.stopPropagation()}};var MapBrowserEventType=__webpack_require__("./node_modules/ol/MapBrowserEventType.js");const pointer_EventType_POINTERMOVE="pointermove",pointer_EventType_POINTERDOWN="pointerdown";var Target=__webpack_require__("./node_modules/ol/events/Target.js"),has=__webpack_require__("./node_modules/ol/has.js");class MapBrowserEventHandler extends Target.A{constructor(map,moveTolerance){super(map),this.map_=map,this.clickTimeoutId_,this.emulateClicks_=!1,this.dragging_=!1,this.dragListenerKeys_=[],this.moveTolerance_=void 0===moveTolerance?1:moveTolerance,this.down_=null;const element=this.map_.getViewport();this.activePointers_=[],this.trackedTouches_={},this.element_=element,this.pointerdownListenerKey_=(0,events.KT)(element,pointer_EventType_POINTERDOWN,this.handlePointerDown_,this),this.originalPointerMoveEvent_,this.relayedListenerKey_=(0,events.KT)(element,pointer_EventType_POINTERMOVE,this.relayMoveEvent_,this),this.boundHandleTouchMove_=this.handleTouchMove_.bind(this),this.element_.addEventListener(EventType.A.TOUCHMOVE,this.boundHandleTouchMove_,!!has.FT&&{passive:!1})}emulateClick_(pointerEvent){let newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.CLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent),void 0!==this.clickTimeoutId_?(clearTimeout(this.clickTimeoutId_),this.clickTimeoutId_=void 0,newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.DBLCLICK,this.map_,pointerEvent),this.dispatchEvent(newEvent)):this.clickTimeoutId_=setTimeout((()=>{this.clickTimeoutId_=void 0;const newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.SINGLECLICK,this.map_,pointerEvent);this.dispatchEvent(newEvent)}),250)}updateActivePointers_(pointerEvent){const event=pointerEvent,id=event.pointerId;if(event.type==MapBrowserEventType.A.POINTERUP||event.type==MapBrowserEventType.A.POINTERCANCEL){delete this.trackedTouches_[id];for(const pointerId in this.trackedTouches_)if(this.trackedTouches_[pointerId].target!==event.target){delete this.trackedTouches_[pointerId];break}}else event.type!=MapBrowserEventType.A.POINTERDOWN&&event.type!=MapBrowserEventType.A.POINTERMOVE||(this.trackedTouches_[id]=event);this.activePointers_=Object.values(this.trackedTouches_)}handlePointerUp_(pointerEvent){this.updateActivePointers_(pointerEvent);const newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.POINTERUP,this.map_,pointerEvent,void 0,void 0,this.activePointers_);this.dispatchEvent(newEvent),this.emulateClicks_&&!newEvent.defaultPrevented&&!this.dragging_&&this.isMouseActionButton_(pointerEvent)&&this.emulateClick_(this.down_),0===this.activePointers_.length&&(this.dragListenerKeys_.forEach(events.JH),this.dragListenerKeys_.length=0,this.dragging_=!1,this.down_=null)}isMouseActionButton_(pointerEvent){return 0===pointerEvent.button}handlePointerDown_(pointerEvent){this.emulateClicks_=0===this.activePointers_.length,this.updateActivePointers_(pointerEvent);const newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.POINTERDOWN,this.map_,pointerEvent,void 0,void 0,this.activePointers_);if(this.dispatchEvent(newEvent),this.down_=new PointerEvent(pointerEvent.type,pointerEvent),Object.defineProperty(this.down_,"target",{writable:!1,value:pointerEvent.target}),0===this.dragListenerKeys_.length){const doc=this.map_.getOwnerDocument();this.dragListenerKeys_.push((0,events.KT)(doc,MapBrowserEventType.A.POINTERMOVE,this.handlePointerMove_,this),(0,events.KT)(doc,MapBrowserEventType.A.POINTERUP,this.handlePointerUp_,this),(0,events.KT)(this.element_,MapBrowserEventType.A.POINTERCANCEL,this.handlePointerUp_,this)),this.element_.getRootNode&&this.element_.getRootNode()!==doc&&this.dragListenerKeys_.push((0,events.KT)(this.element_.getRootNode(),MapBrowserEventType.A.POINTERUP,this.handlePointerUp_,this))}}handlePointerMove_(pointerEvent){if(this.isMoving_(pointerEvent)){this.updateActivePointers_(pointerEvent),this.dragging_=!0;const newEvent=new ol_MapBrowserEvent(MapBrowserEventType.A.POINTERDRAG,this.map_,pointerEvent,this.dragging_,void 0,this.activePointers_);this.dispatchEvent(newEvent)}}relayMoveEvent_(pointerEvent){this.originalPointerMoveEvent_=pointerEvent;const dragging=!(!this.down_||!this.isMoving_(pointerEvent));this.dispatchEvent(new ol_MapBrowserEvent(MapBrowserEventType.A.POINTERMOVE,this.map_,pointerEvent,dragging))}handleTouchMove_(event){const originalEvent=this.originalPointerMoveEvent_;originalEvent&&!originalEvent.defaultPrevented||"boolean"==typeof event.cancelable&&!0!==event.cancelable||event.preventDefault()}isMoving_(pointerEvent){return this.dragging_||Math.abs(pointerEvent.clientX-this.down_.clientX)>this.moveTolerance_||Math.abs(pointerEvent.clientY-this.down_.clientY)>this.moveTolerance_}disposeInternal(){this.relayedListenerKey_&&((0,events.JH)(this.relayedListenerKey_),this.relayedListenerKey_=null),this.element_.removeEventListener(EventType.A.TOUCHMOVE,this.boundHandleTouchMove_),this.pointerdownListenerKey_&&((0,events.JH)(this.pointerdownListenerKey_),this.pointerdownListenerKey_=null),this.dragListenerKeys_.forEach(events.JH),this.dragListenerKeys_.length=0,this.element_=null,super.disposeInternal()}}const ol_MapBrowserEventHandler=MapBrowserEventHandler,MapEventType_POSTRENDER="postrender",MapEventType_MOVESTART="movestart",MapEventType_MOVEEND="moveend",MapEventType_LOADSTART="loadstart",MapEventType_LOADEND="loadend",MapProperty_LAYERGROUP="layergroup",MapProperty_SIZE="size",MapProperty_TARGET="target",MapProperty_VIEW="view",DROP=1/0;const structs_PriorityQueue=class PriorityQueue{constructor(priorityFunction,keyFunction){this.priorityFunction_=priorityFunction,this.keyFunction_=keyFunction,this.elements_=[],this.priorities_=[],this.queuedElements_={}}clear(){this.elements_.length=0,this.priorities_.length=0,(0,obj.I)(this.queuedElements_)}dequeue(){const elements=this.elements_,priorities=this.priorities_,element=elements[0];1==elements.length?(elements.length=0,priorities.length=0):(elements[0]=elements.pop(),priorities[0]=priorities.pop(),this.siftUp_(0));const elementKey=this.keyFunction_(element);return delete this.queuedElements_[elementKey],element}enqueue(element){(0,asserts.v)(!(this.keyFunction_(element)in this.queuedElements_),"Tried to enqueue an `element` that was already added to the queue");const priority=this.priorityFunction_(element);return priority!=DROP&&(this.elements_.push(element),this.priorities_.push(priority),this.queuedElements_[this.keyFunction_(element)]=!0,this.siftDown_(0,this.elements_.length-1),!0)}getCount(){return this.elements_.length}getLeftChildIndex_(index){return 2*index+1}getRightChildIndex_(index){return 2*index+2}getParentIndex_(index){return index-1>>1}heapify_(){let i;for(i=(this.elements_.length>>1)-1;i>=0;i--)this.siftUp_(i)}isEmpty(){return 0===this.elements_.length}isKeyQueued(key){return key in this.queuedElements_}isQueued(element){return this.isKeyQueued(this.keyFunction_(element))}siftUp_(index){const elements=this.elements_,priorities=this.priorities_,count=elements.length,element=elements[index],priority=priorities[index],startIndex=index;for(;index<count>>1;){const lIndex=this.getLeftChildIndex_(index),rIndex=this.getRightChildIndex_(index),smallerChildIndex=rIndex<count&&priorities[rIndex]<priorities[lIndex]?rIndex:lIndex;elements[index]=elements[smallerChildIndex],priorities[index]=priorities[smallerChildIndex],index=smallerChildIndex}elements[index]=element,priorities[index]=priority,this.siftDown_(startIndex,index)}siftDown_(startIndex,index){const elements=this.elements_,priorities=this.priorities_,element=elements[index],priority=priorities[index];for(;index>startIndex;){const parentIndex=this.getParentIndex_(index);if(!(priorities[parentIndex]>priority))break;elements[index]=elements[parentIndex],priorities[index]=priorities[parentIndex],index=parentIndex}elements[index]=element,priorities[index]=priority}reprioritize(){const priorityFunction=this.priorityFunction_,elements=this.elements_,priorities=this.priorities_;let index=0;const n=elements.length;let element,i,priority;for(i=0;i<n;++i)element=elements[i],priority=priorityFunction(element),priority==DROP?delete this.queuedElements_[this.keyFunction_(element)]:(priorities[index]=priority,elements[index++]=element);elements.length=index,priorities.length=index,this.heapify_()}},TileState_IDLE=0,TileState_LOADING=1,TileState_LOADED=2,TileState_ERROR=3,TileState_EMPTY=4;const ol_TileQueue=class TileQueue extends structs_PriorityQueue{constructor(tilePriorityFunction,tileChangeCallback){super((function(element){return tilePriorityFunction.apply(null,element)}),(function(element){return element[0].getKey()})),this.boundHandleTileChange_=this.handleTileChange.bind(this),this.tileChangeCallback_=tileChangeCallback,this.tilesLoading_=0,this.tilesLoadingKeys_={}}enqueue(element){const added=super.enqueue(element);if(added){element[0].addEventListener(EventType.A.CHANGE,this.boundHandleTileChange_)}return added}getTilesLoading(){return this.tilesLoading_}handleTileChange(event){const tile=event.target,state=tile.getState();if(state===TileState_LOADED||state===TileState_ERROR||state===TileState_EMPTY){state!==TileState_ERROR&&tile.removeEventListener(EventType.A.CHANGE,this.boundHandleTileChange_);const tileKey=tile.getKey();tileKey in this.tilesLoadingKeys_&&(delete this.tilesLoadingKeys_[tileKey],--this.tilesLoading_),this.tileChangeCallback_()}}loadMoreTiles(maxTotalLoading,maxNewLoads){let state,tile,tileKey,newLoads=0;for(;this.tilesLoading_<maxTotalLoading&&newLoads<maxNewLoads&&this.getCount()>0;)tile=this.dequeue()[0],tileKey=tile.getKey(),state=tile.getState(),state!==TileState_IDLE||tileKey in this.tilesLoadingKeys_||(this.tilesLoadingKeys_[tileKey]=!0,++this.tilesLoading_,++newLoads,tile.load())}};class Control extends ol_Object.A{constructor(options){super();const element=options.element;!element||options.target||element.style.pointerEvents||(element.style.pointerEvents="auto"),this.element=element||null,this.target_=null,this.map_=null,this.listenerKeys=[],options.render&&(this.render=options.render),options.target&&this.setTarget(options.target)}disposeInternal(){(0,dom.bf)(this.element),super.disposeInternal()}getMap(){return this.map_}setMap(map){this.map_&&(0,dom.bf)(this.element);for(let i=0,ii=this.listenerKeys.length;i<ii;++i)(0,events.JH)(this.listenerKeys[i]);if(this.listenerKeys.length=0,this.map_=map,map){(this.target_?this.target_:map.getOverlayContainerStopEvent()).appendChild(this.element),this.render!==functions.tV&&this.listenerKeys.push((0,events.KT)(map,MapEventType_POSTRENDER,this.render,this)),map.render()}}render(mapEvent){}setTarget(target){this.target_="string"==typeof target?document.getElementById(target):target}}const control_Control=Control;const control_Attribution=class Attribution extends control_Control{constructor(options){options=options||{},super({element:document.createElement("div"),render:options.render,target:options.target}),this.ulElement_=document.createElement("ul"),this.collapsed_=void 0===options.collapsed||options.collapsed,this.userCollapsed_=this.collapsed_,this.overrideCollapsible_=void 0!==options.collapsible,this.collapsible_=void 0===options.collapsible||options.collapsible,this.collapsible_||(this.collapsed_=!1);const className=void 0!==options.className?options.className:"ol-attribution",tipLabel=void 0!==options.tipLabel?options.tipLabel:"Attributions",expandClassName=void 0!==options.expandClassName?options.expandClassName:className+"-expand",collapseLabel=void 0!==options.collapseLabel?options.collapseLabel:"",collapseClassName=void 0!==options.collapseClassName?options.collapseClassName:className+"-collapse";"string"==typeof collapseLabel?(this.collapseLabel_=document.createElement("span"),this.collapseLabel_.textContent=collapseLabel,this.collapseLabel_.className=collapseClassName):this.collapseLabel_=collapseLabel;const label=void 0!==options.label?options.label:"i";"string"==typeof label?(this.label_=document.createElement("span"),this.label_.textContent=label,this.label_.className=expandClassName):this.label_=label;const activeLabel=this.collapsible_&&!this.collapsed_?this.collapseLabel_:this.label_;this.toggleButton_=document.createElement("button"),this.toggleButton_.setAttribute("type","button"),this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_)),this.toggleButton_.title=tipLabel,this.toggleButton_.appendChild(activeLabel),this.toggleButton_.addEventListener(EventType.A.CLICK,this.handleClick_.bind(this),!1);const cssClasses=className+" "+css.XI+" "+css.$N+(this.collapsed_&&this.collapsible_?" "+css.nT:"")+(this.collapsible_?"":" ol-uncollapsible"),element=this.element;element.className=cssClasses,element.appendChild(this.toggleButton_),element.appendChild(this.ulElement_),this.renderedAttributions_=[],this.renderedVisible_=!0}collectSourceAttributions_(frameState){const visibleAttributions=Array.from(new Set(this.getMap().getAllLayers().flatMap((layer=>layer.getAttributions(frameState))))),collapsible=!this.getMap().getAllLayers().some((layer=>layer.getSource()&&!1===layer.getSource().getAttributionsCollapsible()));return this.overrideCollapsible_||this.setCollapsible(collapsible),visibleAttributions}updateElement_(frameState){if(!frameState)return void(this.renderedVisible_&&(this.element.style.display="none",this.renderedVisible_=!1));const attributions=this.collectSourceAttributions_(frameState),visible=attributions.length>0;if(this.renderedVisible_!=visible&&(this.element.style.display=visible?"":"none",this.renderedVisible_=visible),!(0,array.aI)(attributions,this.renderedAttributions_)){(0,dom.gS)(this.ulElement_);for(let i=0,ii=attributions.length;i<ii;++i){const element=document.createElement("li");element.innerHTML=attributions[i],this.ulElement_.appendChild(element)}this.renderedAttributions_=attributions}}handleClick_(event){event.preventDefault(),this.handleToggle_(),this.userCollapsed_=this.collapsed_}handleToggle_(){this.element.classList.toggle(css.nT),this.collapsed_?(0,dom.fo)(this.collapseLabel_,this.label_):(0,dom.fo)(this.label_,this.collapseLabel_),this.collapsed_=!this.collapsed_,this.toggleButton_.setAttribute("aria-expanded",String(!this.collapsed_))}getCollapsible(){return this.collapsible_}setCollapsible(collapsible){this.collapsible_!==collapsible&&(this.collapsible_=collapsible,this.element.classList.toggle("ol-uncollapsible"),this.userCollapsed_&&this.handleToggle_())}setCollapsed(collapsed){this.userCollapsed_=collapsed,this.collapsible_&&this.collapsed_!==collapsed&&this.handleToggle_()}getCollapsed(){return this.collapsed_}render(mapEvent){this.updateElement_(mapEvent.frameState)}};const control_Rotate=class Rotate extends control_Control{constructor(options){options=options||{},super({element:document.createElement("div"),render:options.render,target:options.target});const className=void 0!==options.className?options.className:"ol-rotate",label=void 0!==options.label?options.label:"",compassClassName=void 0!==options.compassClassName?options.compassClassName:"ol-compass";this.label_=null,"string"==typeof label?(this.label_=document.createElement("span"),this.label_.className=compassClassName,this.label_.textContent=label):(this.label_=label,this.label_.classList.add(compassClassName));const tipLabel=options.tipLabel?options.tipLabel:"Reset rotation",button=document.createElement("button");button.className=className+"-reset",button.setAttribute("type","button"),button.title=tipLabel,button.appendChild(this.label_),button.addEventListener(EventType.A.CLICK,this.handleClick_.bind(this),!1);const cssClasses=className+" "+css.XI+" "+css.$N,element=this.element;element.className=cssClasses,element.appendChild(button),this.callResetNorth_=options.resetNorth?options.resetNorth:void 0,this.duration_=void 0!==options.duration?options.duration:250,this.autoHide_=void 0===options.autoHide||options.autoHide,this.rotation_=void 0,this.autoHide_&&this.element.classList.add(css.Si)}handleClick_(event){event.preventDefault(),void 0!==this.callResetNorth_?this.callResetNorth_():this.resetNorth_()}resetNorth_(){const view=this.getMap().getView();if(!view)return;const rotation=view.getRotation();void 0!==rotation&&(this.duration_>0&&rotation%(2*Math.PI)!=0?view.animate({rotation:0,duration:this.duration_,easing:easing.vT}):view.setRotation(0))}render(mapEvent){const frameState=mapEvent.frameState;if(!frameState)return;const rotation=frameState.viewState.rotation;if(rotation!=this.rotation_){const transform="rotate("+rotation+"rad)";if(this.autoHide_){const contains=this.element.classList.contains(css.Si);contains||0!==rotation?contains&&0!==rotation&&this.element.classList.remove(css.Si):this.element.classList.add(css.Si)}this.label_.style.transform=transform}this.rotation_=rotation}};const control_Zoom=class Zoom extends control_Control{constructor(options){options=options||{},super({element:document.createElement("div"),target:options.target});const className=void 0!==options.className?options.className:"ol-zoom",delta=void 0!==options.delta?options.delta:1,zoomInClassName=void 0!==options.zoomInClassName?options.zoomInClassName:className+"-in",zoomOutClassName=void 0!==options.zoomOutClassName?options.zoomOutClassName:className+"-out",zoomInLabel=void 0!==options.zoomInLabel?options.zoomInLabel:"+",zoomOutLabel=void 0!==options.zoomOutLabel?options.zoomOutLabel:"",zoomInTipLabel=void 0!==options.zoomInTipLabel?options.zoomInTipLabel:"Zoom in",zoomOutTipLabel=void 0!==options.zoomOutTipLabel?options.zoomOutTipLabel:"Zoom out",inElement=document.createElement("button");inElement.className=zoomInClassName,inElement.setAttribute("type","button"),inElement.title=zoomInTipLabel,inElement.appendChild("string"==typeof zoomInLabel?document.createTextNode(zoomInLabel):zoomInLabel),inElement.addEventListener(EventType.A.CLICK,this.handleClick_.bind(this,delta),!1);const outElement=document.createElement("button");outElement.className=zoomOutClassName,outElement.setAttribute("type","button"),outElement.title=zoomOutTipLabel,outElement.appendChild("string"==typeof zoomOutLabel?document.createTextNode(zoomOutLabel):zoomOutLabel),outElement.addEventListener(EventType.A.CLICK,this.handleClick_.bind(this,-delta),!1);const cssClasses=className+" "+css.XI+" "+css.$N,element=this.element;element.className=cssClasses,element.appendChild(inElement),element.appendChild(outElement),this.duration_=void 0!==options.duration?options.duration:250}handleClick_(delta,event){event.preventDefault(),this.zoomByDelta_(delta)}zoomByDelta_(delta){const view=this.getMap().getView();if(!view)return;const currentZoom=view.getZoom();if(void 0!==currentZoom){const newZoom=view.getConstrainedZoom(currentZoom+delta);this.duration_>0?(view.getAnimating()&&view.cancelAnimations(),view.animate({zoom:newZoom,duration:this.duration_,easing:easing.vT})):view.setZoom(newZoom)}}};var interaction_defaults=__webpack_require__("./node_modules/ol/interaction/defaults.js"),ol_size=__webpack_require__("./node_modules/ol/size.js"),ol_console=__webpack_require__("./node_modules/ol/console.js");function removeLayerMapProperty(layer){layer instanceof layer_Layer?layer.setMapInternal(null):layer instanceof Group&&layer.getLayers().forEach(removeLayerMapProperty)}function setLayerMapProperty(layer,map){if(layer instanceof layer_Layer)layer.setMapInternal(map);else if(layer instanceof Group){const layers=layer.getLayers().getArray();for(let i=0,ii=layers.length;i<ii;++i)setLayerMapProperty(layers[i],map)}}class Map_Map extends ol_Object.A{constructor(options){super(),options=options||{},this.on,this.once,this.un;const optionsInternal=function createOptionsInternal(options){let keyboardEventTarget=null;void 0!==options.keyboardEventTarget&&(keyboardEventTarget="string"==typeof options.keyboardEventTarget?document.getElementById(options.keyboardEventTarget):options.keyboardEventTarget);const values={},layerGroup=options.layers&&"function"==typeof options.layers.getLayers?options.layers:new Group({layers:options.layers});let controls,interactions,overlays;values[MapProperty_LAYERGROUP]=layerGroup,values[MapProperty_TARGET]=options.target,values[MapProperty_VIEW]=options.view instanceof ol_View?options.view:new ol_View,void 0!==options.controls&&(Array.isArray(options.controls)?controls=new Collection.A(options.controls.slice()):((0,asserts.v)("function"==typeof options.controls.getArray,"Expected `controls` to be an array or an `ol/Collection.js`"),controls=options.controls));void 0!==options.interactions&&(Array.isArray(options.interactions)?interactions=new Collection.A(options.interactions.slice()):((0,asserts.v)("function"==typeof options.interactions.getArray,"Expected `interactions` to be an array or an `ol/Collection.js`"),interactions=options.interactions));void 0!==options.overlays?Array.isArray(options.overlays)?overlays=new Collection.A(options.overlays.slice()):((0,asserts.v)("function"==typeof options.overlays.getArray,"Expected `overlays` to be an array or an `ol/Collection.js`"),overlays=options.overlays):overlays=new Collection.A;return{controls,interactions,keyboardEventTarget,overlays,values}}(options);this.renderComplete_,this.loaded_=!0,this.boundHandleBrowserEvent_=this.handleBrowserEvent.bind(this),this.maxTilesLoading_=void 0!==options.maxTilesLoading?options.maxTilesLoading:16,this.pixelRatio_=void 0!==options.pixelRatio?options.pixelRatio:has.cr,this.postRenderTimeoutHandle_,this.animationDelayKey_,this.animationDelay_=this.animationDelay_.bind(this),this.coordinateToPixelTransform_=(0,ol_transform.vt)(),this.pixelToCoordinateTransform_=(0,ol_transform.vt)(),this.frameIndex_=0,this.frameState_=null,this.previousExtent_=null,this.viewPropertyListenerKey_=null,this.viewChangeListenerKey_=null,this.layerGroupPropertyListenerKeys_=null,this.viewport_=document.createElement("div"),this.viewport_.className="ol-viewport"+("ontouchstart"in window?" ol-touch":""),this.viewport_.style.position="relative",this.viewport_.style.overflow="hidden",this.viewport_.style.width="100%",this.viewport_.style.height="100%",this.overlayContainer_=document.createElement("div"),this.overlayContainer_.style.position="absolute",this.overlayContainer_.style.zIndex="0",this.overlayContainer_.style.width="100%",this.overlayContainer_.style.height="100%",this.overlayContainer_.style.pointerEvents="none",this.overlayContainer_.className="ol-overlaycontainer",this.viewport_.appendChild(this.overlayContainer_),this.overlayContainerStopEvent_=document.createElement("div"),this.overlayContainerStopEvent_.style.position="absolute",this.overlayContainerStopEvent_.style.zIndex="0",this.overlayContainerStopEvent_.style.width="100%",this.overlayContainerStopEvent_.style.height="100%",this.overlayContainerStopEvent_.style.pointerEvents="none",this.overlayContainerStopEvent_.className="ol-overlaycontainer-stopevent",this.viewport_.appendChild(this.overlayContainerStopEvent_),this.mapBrowserEventHandler_=null,this.moveTolerance_=options.moveTolerance,this.keyboardEventTarget_=optionsInternal.keyboardEventTarget,this.targetChangeHandlerKeys_=null,this.targetElement_=null,this.resizeObserver_=new ResizeObserver((()=>this.updateSize())),this.controls=optionsInternal.controls||function defaults(options){options=options||{};const controls=new Collection.A;return(void 0===options.zoom||options.zoom)&&controls.push(new control_Zoom(options.zoomOptions)),(void 0===options.rotate||options.rotate)&&controls.push(new control_Rotate(options.rotateOptions)),(void 0===options.attribution||options.attribution)&&controls.push(new control_Attribution(options.attributionOptions)),controls}(),this.interactions=optionsInternal.interactions||(0,interaction_defaults.N)({onFocusOnly:!0}),this.overlays_=optionsInternal.overlays,this.overlayIdIndex_={},this.renderer_=null,this.postRenderFunctions_=[],this.tileQueue_=new ol_TileQueue(this.getTilePriority.bind(this),this.handleTileChange_.bind(this)),this.addChangeListener(MapProperty_LAYERGROUP,this.handleLayerGroupChanged_),this.addChangeListener(MapProperty_VIEW,this.handleViewChanged_),this.addChangeListener(MapProperty_SIZE,this.handleSizeChanged_),this.addChangeListener(MapProperty_TARGET,this.handleTargetChanged_),this.setProperties(optionsInternal.values);const map=this;!options.view||options.view instanceof ol_View||options.view.then((function(viewOptions){map.setView(new ol_View(viewOptions))})),this.controls.addEventListener(CollectionEventType.A.ADD,(event=>{event.element.setMap(this)})),this.controls.addEventListener(CollectionEventType.A.REMOVE,(event=>{event.element.setMap(null)})),this.interactions.addEventListener(CollectionEventType.A.ADD,(event=>{event.element.setMap(this)})),this.interactions.addEventListener(CollectionEventType.A.REMOVE,(event=>{event.element.setMap(null)})),this.overlays_.addEventListener(CollectionEventType.A.ADD,(event=>{this.addOverlayInternal_(event.element)})),this.overlays_.addEventListener(CollectionEventType.A.REMOVE,(event=>{const id=event.element.getId();void 0!==id&&delete this.overlayIdIndex_[id.toString()],event.element.setMap(null)})),this.controls.forEach((control=>{control.setMap(this)})),this.interactions.forEach((interaction=>{interaction.setMap(this)})),this.overlays_.forEach(this.addOverlayInternal_.bind(this))}addControl(control){this.getControls().push(control)}addInteraction(interaction){this.getInteractions().push(interaction)}addLayer(layer){this.getLayerGroup().getLayers().push(layer)}handleLayerAdd_(event){setLayerMapProperty(event.layer,this)}addOverlay(overlay){this.getOverlays().push(overlay)}addOverlayInternal_(overlay){const id=overlay.getId();void 0!==id&&(this.overlayIdIndex_[id.toString()]=overlay),overlay.setMap(this)}disposeInternal(){this.controls.clear(),this.interactions.clear(),this.overlays_.clear(),this.resizeObserver_.disconnect(),this.setTarget(null),super.disposeInternal()}forEachFeatureAtPixel(pixel,callback,options){if(!this.frameState_||!this.renderer_)return;const coordinate=this.getCoordinateFromPixelInternal(pixel),hitTolerance=void 0!==(options=void 0!==options?options:{}).hitTolerance?options.hitTolerance:0,layerFilter=void 0!==options.layerFilter?options.layerFilter:functions.rT,checkWrapped=!1!==options.checkWrapped;return this.renderer_.forEachFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,checkWrapped,callback,null,layerFilter,null)}getFeaturesAtPixel(pixel,options){const features=[];return this.forEachFeatureAtPixel(pixel,(function(feature){features.push(feature)}),options),features}getAllLayers(){const layers=[];return function addLayersFrom(layerGroup){layerGroup.forEach((function(layer){layer instanceof Group?addLayersFrom(layer.getLayers()):layers.push(layer)}))}(this.getLayers()),layers}hasFeatureAtPixel(pixel,options){if(!this.frameState_||!this.renderer_)return!1;const coordinate=this.getCoordinateFromPixelInternal(pixel),layerFilter=void 0!==(options=void 0!==options?options:{}).layerFilter?options.layerFilter:functions.rT,hitTolerance=void 0!==options.hitTolerance?options.hitTolerance:0,checkWrapped=!1!==options.checkWrapped;return this.renderer_.hasFeatureAtCoordinate(coordinate,this.frameState_,hitTolerance,checkWrapped,layerFilter,null)}getEventCoordinate(event){return this.getCoordinateFromPixel(this.getEventPixel(event))}getEventCoordinateInternal(event){return this.getCoordinateFromPixelInternal(this.getEventPixel(event))}getEventPixel(event){const viewportPosition=this.viewport_.getBoundingClientRect(),viewportSize=this.getSize(),scaleX=viewportPosition.width/viewportSize[0],scaleY=viewportPosition.height/viewportSize[1],eventPosition="changedTouches"in event?event.changedTouches[0]:event;return[(eventPosition.clientX-viewportPosition.left)/scaleX,(eventPosition.clientY-viewportPosition.top)/scaleY]}getTarget(){return this.get(MapProperty_TARGET)}getTargetElement(){return this.targetElement_}getCoordinateFromPixel(pixel){return(0,ol_proj.te)(this.getCoordinateFromPixelInternal(pixel),this.getView().getProjection())}getCoordinateFromPixelInternal(pixel){const frameState=this.frameState_;return frameState?(0,ol_transform.Bb)(frameState.pixelToCoordinateTransform,pixel.slice()):null}getControls(){return this.controls}getOverlays(){return this.overlays_}getOverlayById(id){const overlay=this.overlayIdIndex_[id.toString()];return void 0!==overlay?overlay:null}getInteractions(){return this.interactions}getLayerGroup(){return this.get(MapProperty_LAYERGROUP)}setLayers(layers){const group=this.getLayerGroup();if(layers instanceof Collection.A)return void group.setLayers(layers);const collection=group.getLayers();collection.clear(),collection.extend(layers)}getLayers(){return this.getLayerGroup().getLayers()}getLoadingOrNotReady(){const layerStatesArray=this.getLayerGroup().getLayerStatesArray();for(let i=0,ii=layerStatesArray.length;i<ii;++i){const state=layerStatesArray[i];if(!state.visible)continue;const renderer=state.layer.getRenderer();if(renderer&&!renderer.ready)return!0;const source=state.layer.getSource();if(source&&source.loading)return!0}return!1}getPixelFromCoordinate(coordinate){const viewCoordinate=(0,ol_proj.Ad)(coordinate,this.getView().getProjection());return this.getPixelFromCoordinateInternal(viewCoordinate)}getPixelFromCoordinateInternal(coordinate){const frameState=this.frameState_;return frameState?(0,ol_transform.Bb)(frameState.coordinateToPixelTransform,coordinate.slice(0,2)):null}getRenderer(){return this.renderer_}getSize(){return this.get(MapProperty_SIZE)}getView(){return this.get(MapProperty_VIEW)}getViewport(){return this.viewport_}getOverlayContainer(){return this.overlayContainer_}getOverlayContainerStopEvent(){return this.overlayContainerStopEvent_}getOwnerDocument(){const targetElement=this.getTargetElement();return targetElement?targetElement.ownerDocument:document}getTilePriority(tile,tileSourceKey,tileCenter,tileResolution){return function getTilePriority(frameState,tile,tileSourceKey,tileCenter,tileResolution){if(!frameState||!(tileSourceKey in frameState.wantedTiles))return DROP;if(!frameState.wantedTiles[tileSourceKey][tile.getKey()])return DROP;const center=frameState.viewState.center,deltaX=tileCenter[0]-center[0],deltaY=tileCenter[1]-center[1];return 65536*Math.log(tileResolution)+Math.sqrt(deltaX*deltaX+deltaY*deltaY)/tileResolution}(this.frameState_,tile,tileSourceKey,tileCenter,tileResolution)}handleBrowserEvent(browserEvent,type){type=type||browserEvent.type;const mapBrowserEvent=new ol_MapBrowserEvent(type,this,browserEvent);this.handleMapBrowserEvent(mapBrowserEvent)}handleMapBrowserEvent(mapBrowserEvent){if(!this.frameState_)return;const originalEvent=mapBrowserEvent.originalEvent,eventType=originalEvent.type;if(eventType===pointer_EventType_POINTERDOWN||eventType===EventType.A.WHEEL||eventType===EventType.A.KEYDOWN){const doc=this.getOwnerDocument(),rootNode=this.viewport_.getRootNode?this.viewport_.getRootNode():doc,target=originalEvent.target;if(this.overlayContainerStopEvent_.contains(target)||!(rootNode===doc?doc.documentElement:rootNode).contains(target))return}if(mapBrowserEvent.frameState=this.frameState_,!1!==this.dispatchEvent(mapBrowserEvent)){const interactionsArray=this.getInteractions().getArray().slice();for(let i=interactionsArray.length-1;i>=0;i--){const interaction=interactionsArray[i];if(interaction.getMap()!==this||!interaction.getActive()||!this.getTargetElement())continue;if(!interaction.handleEvent(mapBrowserEvent)||mapBrowserEvent.propagationStopped)break}}}handlePostRender(){const frameState=this.frameState_,tileQueue=this.tileQueue_;if(!tileQueue.isEmpty()){let maxTotalLoading=this.maxTilesLoading_,maxNewLoads=maxTotalLoading;if(frameState){const hints=frameState.viewHints;if(hints[ViewHint_ANIMATING]||hints[ViewHint_INTERACTING]){const lowOnFrameBudget=Date.now()-frameState.time>8;maxTotalLoading=lowOnFrameBudget?0:8,maxNewLoads=lowOnFrameBudget?0:2}}tileQueue.getTilesLoading()<maxTotalLoading&&(tileQueue.reprioritize(),tileQueue.loadMoreTiles(maxTotalLoading,maxNewLoads))}frameState&&this.renderer_&&!frameState.animate&&(!0===this.renderComplete_?(this.hasListener(render_EventType_RENDERCOMPLETE)&&this.renderer_.dispatchRenderEvent(render_EventType_RENDERCOMPLETE,frameState),!1===this.loaded_&&(this.loaded_=!0,this.dispatchEvent(new ol_MapEvent(MapEventType_LOADEND,this,frameState)))):!0===this.loaded_&&(this.loaded_=!1,this.dispatchEvent(new ol_MapEvent(MapEventType_LOADSTART,this,frameState))));const postRenderFunctions=this.postRenderFunctions_;for(let i=0,ii=postRenderFunctions.length;i<ii;++i)postRenderFunctions[i](this,frameState);postRenderFunctions.length=0}handleSizeChanged_(){this.getView()&&!this.getView().getAnimating()&&this.getView().resolveConstraints(0),this.render()}handleTargetChanged_(){if(this.mapBrowserEventHandler_){for(let i=0,ii=this.targetChangeHandlerKeys_.length;i<ii;++i)(0,events.JH)(this.targetChangeHandlerKeys_[i]);this.targetChangeHandlerKeys_=null,this.viewport_.removeEventListener(EventType.A.CONTEXTMENU,this.boundHandleBrowserEvent_),this.viewport_.removeEventListener(EventType.A.WHEEL,this.boundHandleBrowserEvent_),this.mapBrowserEventHandler_.dispose(),this.mapBrowserEventHandler_=null,(0,dom.bf)(this.viewport_)}if(this.targetElement_){this.resizeObserver_.unobserve(this.targetElement_);const rootNode=this.targetElement_.getRootNode();rootNode instanceof ShadowRoot&&this.resizeObserver_.unobserve(rootNode.host),this.setSize(void 0)}const target=this.getTarget(),targetElement="string"==typeof target?document.getElementById(target):target;if(this.targetElement_=targetElement,targetElement){targetElement.appendChild(this.viewport_),this.renderer_||(this.renderer_=new Composite(this)),this.mapBrowserEventHandler_=new ol_MapBrowserEventHandler(this,this.moveTolerance_);for(const key in MapBrowserEventType.A)this.mapBrowserEventHandler_.addEventListener(MapBrowserEventType.A[key],this.handleMapBrowserEvent.bind(this));this.viewport_.addEventListener(EventType.A.CONTEXTMENU,this.boundHandleBrowserEvent_,!1),this.viewport_.addEventListener(EventType.A.WHEEL,this.boundHandleBrowserEvent_,!!has.FT&&{passive:!1});const keyboardEventTarget=this.keyboardEventTarget_?this.keyboardEventTarget_:targetElement;this.targetChangeHandlerKeys_=[(0,events.KT)(keyboardEventTarget,EventType.A.KEYDOWN,this.handleBrowserEvent,this),(0,events.KT)(keyboardEventTarget,EventType.A.KEYPRESS,this.handleBrowserEvent,this)];const rootNode=targetElement.getRootNode();rootNode instanceof ShadowRoot&&this.resizeObserver_.observe(rootNode.host),this.resizeObserver_.observe(targetElement)}else this.renderer_&&(clearTimeout(this.postRenderTimeoutHandle_),this.postRenderTimeoutHandle_=void 0,this.postRenderFunctions_.length=0,this.renderer_.dispose(),this.renderer_=null),this.animationDelayKey_&&(cancelAnimationFrame(this.animationDelayKey_),this.animationDelayKey_=void 0);this.updateSize()}handleTileChange_(){this.render()}handleViewPropertyChanged_(){this.render()}handleViewChanged_(){this.viewPropertyListenerKey_&&((0,events.JH)(this.viewPropertyListenerKey_),this.viewPropertyListenerKey_=null),this.viewChangeListenerKey_&&((0,events.JH)(this.viewChangeListenerKey_),this.viewChangeListenerKey_=null);const view=this.getView();view&&(this.updateViewportSize_(this.getSize()),this.viewPropertyListenerKey_=(0,events.KT)(view,ObjectEventType.A.PROPERTYCHANGE,this.handleViewPropertyChanged_,this),this.viewChangeListenerKey_=(0,events.KT)(view,EventType.A.CHANGE,this.handleViewPropertyChanged_,this),view.resolveConstraints(0)),this.render()}handleLayerGroupChanged_(){this.layerGroupPropertyListenerKeys_&&(this.layerGroupPropertyListenerKeys_.forEach(events.JH),this.layerGroupPropertyListenerKeys_=null);const layerGroup=this.getLayerGroup();layerGroup&&(this.handleLayerAdd_(new GroupEvent("addlayer",layerGroup)),this.layerGroupPropertyListenerKeys_=[(0,events.KT)(layerGroup,ObjectEventType.A.PROPERTYCHANGE,this.render,this),(0,events.KT)(layerGroup,EventType.A.CHANGE,this.render,this),(0,events.KT)(layerGroup,"addlayer",this.handleLayerAdd_,this),(0,events.KT)(layerGroup,"removelayer",this.handleLayerRemove_,this)]),this.render()}isRendered(){return!!this.frameState_}animationDelay_(){this.animationDelayKey_=void 0,this.renderFrame_(Date.now())}renderSync(){this.animationDelayKey_&&cancelAnimationFrame(this.animationDelayKey_),this.animationDelay_()}redrawText(){const layerStates=this.getLayerGroup().getLayerStatesArray();for(let i=0,ii=layerStates.length;i<ii;++i){const layer=layerStates[i].layer;layer.hasRenderer()&&layer.getRenderer().handleFontsChanged()}}render(){this.renderer_&&void 0===this.animationDelayKey_&&(this.animationDelayKey_=requestAnimationFrame(this.animationDelay_))}flushDeclutterItems(){const frameState=this.frameState_;frameState&&this.renderer_.flushDeclutterItems(frameState)}removeControl(control){return this.getControls().remove(control)}removeInteraction(interaction){return this.getInteractions().remove(interaction)}removeLayer(layer){return this.getLayerGroup().getLayers().remove(layer)}handleLayerRemove_(event){removeLayerMapProperty(event.layer)}removeOverlay(overlay){return this.getOverlays().remove(overlay)}renderFrame_(time){const size=this.getSize(),view=this.getView(),previousFrameState=this.frameState_;let frameState=null;if(void 0!==size&&(0,ol_size.Ie)(size)&&view&&view.isDef()){const viewHints=view.getHints(this.frameState_?this.frameState_.viewHints:void 0),viewState=view.getState();if(frameState={animate:!1,coordinateToPixelTransform:this.coordinateToPixelTransform_,declutterTree:null,extent:(0,ol_extent.Bg)(viewState.center,viewState.resolution,viewState.rotation,size),index:this.frameIndex_++,layerIndex:0,layerStatesArray:this.getLayerGroup().getLayerStatesArray(),pixelRatio:this.pixelRatio_,pixelToCoordinateTransform:this.pixelToCoordinateTransform_,postRenderFunctions:[],size,tileQueue:this.tileQueue_,time,usedTiles:{},viewState,viewHints,wantedTiles:{},mapId:(0,util.v6)(this),renderTargets:{}},viewState.nextCenter&&viewState.nextResolution){const rotation=isNaN(viewState.nextRotation)?viewState.rotation:viewState.nextRotation;frameState.nextExtent=(0,ol_extent.Bg)(viewState.nextCenter,viewState.nextResolution,rotation,size)}}if(this.frameState_=frameState,this.renderer_.renderFrame(frameState),frameState){if(frameState.animate&&this.render(),Array.prototype.push.apply(this.postRenderFunctions_,frameState.postRenderFunctions),previousFrameState){(!this.previousExtent_||!(0,ol_extent.Im)(this.previousExtent_)&&!(0,ol_extent.aI)(frameState.extent,this.previousExtent_))&&(this.dispatchEvent(new ol_MapEvent(MapEventType_MOVESTART,this,previousFrameState)),this.previousExtent_=(0,ol_extent.aZ)(this.previousExtent_))}this.previousExtent_&&!frameState.viewHints[ViewHint_ANIMATING]&&!frameState.viewHints[ViewHint_INTERACTING]&&!(0,ol_extent.aI)(frameState.extent,this.previousExtent_)&&(this.dispatchEvent(new ol_MapEvent(MapEventType_MOVEEND,this,frameState)),(0,ol_extent.o8)(frameState.extent,this.previousExtent_))}this.dispatchEvent(new ol_MapEvent(MapEventType_POSTRENDER,this,frameState)),this.renderComplete_=this.hasListener(MapEventType_LOADSTART)||this.hasListener(MapEventType_LOADEND)||this.hasListener(render_EventType_RENDERCOMPLETE)?!this.tileQueue_.getTilesLoading()&&!this.tileQueue_.getCount()&&!this.getLoadingOrNotReady():void 0,this.postRenderTimeoutHandle_||(this.postRenderTimeoutHandle_=setTimeout((()=>{this.postRenderTimeoutHandle_=void 0,this.handlePostRender()}),0))}setLayerGroup(layerGroup){const oldLayerGroup=this.getLayerGroup();oldLayerGroup&&this.handleLayerRemove_(new GroupEvent("removelayer",oldLayerGroup)),this.set(MapProperty_LAYERGROUP,layerGroup)}setSize(size){this.set(MapProperty_SIZE,size)}setTarget(target){this.set(MapProperty_TARGET,target)}setView(view){if(!view||view instanceof ol_View)return void this.set(MapProperty_VIEW,view);this.set(MapProperty_VIEW,new ol_View);const map=this;view.then((function(viewOptions){map.setView(new ol_View(viewOptions))}))}updateSize(){const targetElement=this.getTargetElement();let size;if(targetElement){const computedStyle=getComputedStyle(targetElement),width=targetElement.offsetWidth-parseFloat(computedStyle.borderLeftWidth)-parseFloat(computedStyle.paddingLeft)-parseFloat(computedStyle.paddingRight)-parseFloat(computedStyle.borderRightWidth),height=targetElement.offsetHeight-parseFloat(computedStyle.borderTopWidth)-parseFloat(computedStyle.paddingTop)-parseFloat(computedStyle.paddingBottom)-parseFloat(computedStyle.borderBottomWidth);isNaN(width)||isNaN(height)||(size=[width,height],!(0,ol_size.Ie)(size)&&(targetElement.offsetWidth||targetElement.offsetHeight||targetElement.getClientRects().length)&&(0,ol_console.R8)("No map visible because the map container's width or height are 0."))}const oldSize=this.getSize();!size||oldSize&&(0,array.aI)(size,oldSize)||(this.setSize(size),this.updateViewportSize_(size))}updateViewportSize_(size){const view=this.getView();view&&view.setViewportSize(size)}}const ol_Map=Map_Map,TileProperty_PRELOAD="preload",TileProperty_USE_INTERIM_TILES_ON_ERROR="useInterimTilesOnError";const BaseTile=class BaseTileLayer extends layer_Layer{constructor(options){options=options||{};const baseOptions=Object.assign({},options);delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,super(baseOptions),this.on,this.once,this.un,this.setPreload(void 0!==options.preload?options.preload:0),this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError)}getPreload(){return this.get(TileProperty_PRELOAD)}setPreload(preload){this.set(TileProperty_PRELOAD,preload)}getUseInterimTilesOnError(){return this.get(TileProperty_USE_INTERIM_TILES_ON_ERROR)}setUseInterimTilesOnError(useInterimTilesOnError){this.set(TileProperty_USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)}getData(pixel){return super.getData(pixel)}};var ImageState=__webpack_require__("./node_modules/ol/ImageState.js"),Observable=__webpack_require__("./node_modules/ol/Observable.js");class LayerRenderer extends Observable.A{constructor(layer){super(),this.ready=!0,this.boundHandleImageChange_=this.handleImageChange_.bind(this),this.layer_=layer,this.declutterExecutorGroup=null}getFeatures(pixel){return(0,util.b0)()}getData(pixel){return null}prepareFrame(frameState){return(0,util.b0)()}renderFrame(frameState,target){return(0,util.b0)()}loadedTileCallback(tiles,zoom,tile){tiles[zoom]||(tiles[zoom]={}),tiles[zoom][tile.tileCoord.toString()]=tile}createLoadedTileFinder(source,projection,tiles){return(zoom,tileRange)=>{const callback=this.loadedTileCallback.bind(this,tiles,zoom);return source.forEachLoadedTile(projection,zoom,tileRange,callback)}}forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback,matches){}getLayer(){return this.layer_}handleFontsChanged(){}handleImageChange_(event){const image=event.target;image.getState()!==ImageState.A.LOADED&&image.getState()!==ImageState.A.ERROR||this.renderIfReadyAndVisible()}loadImage(image){let imageState=image.getState();return imageState!=ImageState.A.LOADED&&imageState!=ImageState.A.ERROR&&image.addEventListener(EventType.A.CHANGE,this.boundHandleImageChange_),imageState==ImageState.A.IDLE&&(image.load(),imageState=image.getState()),imageState==ImageState.A.LOADED}renderIfReadyAndVisible(){const layer=this.getLayer();layer&&layer.getVisible()&&"ready"===layer.getSourceState()&&layer.changed()}disposeInternal(){delete this.layer_,super.disposeInternal()}}const renderer_Layer=LayerRenderer,canvasPool=[];let pixelContext=null;const canvas_Layer=class CanvasLayerRenderer extends renderer_Layer{constructor(layer){super(layer),this.container=null,this.renderedResolution,this.tempTransform=(0,ol_transform.vt)(),this.pixelTransform=(0,ol_transform.vt)(),this.inversePixelTransform=(0,ol_transform.vt)(),this.context=null,this.containerReused=!1,this.pixelContext_=null,this.frameState=null}getImageData(image,col,row){let data;pixelContext||function createPixelContext(){pixelContext=(0,dom.Y)(1,1,void 0,{willReadFrequently:!0})}(),pixelContext.clearRect(0,0,1,1);try{pixelContext.drawImage(image,col,row,1,1,0,0,1,1),data=pixelContext.getImageData(0,0,1,1).data}catch(err){return pixelContext=null,null}return data}getBackground(frameState){let background=this.getLayer().getBackground();return"function"==typeof background&&(background=background(frameState.viewState.resolution)),background||void 0}useContainer(target,transform,backgroundColor){const layerClassName=this.getLayer().getClassName();let container,context;if(target&&target.className===layerClassName&&(!backgroundColor||target&&target.style.backgroundColor&&(0,array.aI)((0,ol_color._j)(target.style.backgroundColor),(0,ol_color._j)(backgroundColor)))){const canvas=target.firstElementChild;canvas instanceof HTMLCanvasElement&&(context=canvas.getContext("2d"))}if(context&&context.canvas.style.transform===transform?(this.container=target,this.context=context,this.containerReused=!0):this.containerReused?(this.container=null,this.context=null,this.containerReused=!1):this.container&&(this.container.style.backgroundColor=null),!this.container){container=document.createElement("div"),container.className=layerClassName;let style=container.style;style.position="absolute",style.width="100%",style.height="100%",context=(0,dom.Y)();const canvas=context.canvas;container.appendChild(canvas),style=canvas.style,style.position="absolute",style.left="0",style.transformOrigin="top left",this.container=container,this.context=context}this.containerReused||!backgroundColor||this.container.style.backgroundColor||(this.container.style.backgroundColor=backgroundColor)}clipUnrotated(context,frameState,extent){const topLeft=(0,ol_extent.Py)(extent),topRight=(0,ol_extent.WU)(extent),bottomRight=(0,ol_extent.k_)(extent),bottomLeft=(0,ol_extent.R)(extent);(0,ol_transform.Bb)(frameState.coordinateToPixelTransform,topLeft),(0,ol_transform.Bb)(frameState.coordinateToPixelTransform,topRight),(0,ol_transform.Bb)(frameState.coordinateToPixelTransform,bottomRight),(0,ol_transform.Bb)(frameState.coordinateToPixelTransform,bottomLeft);const inverted=this.inversePixelTransform;(0,ol_transform.Bb)(inverted,topLeft),(0,ol_transform.Bb)(inverted,topRight),(0,ol_transform.Bb)(inverted,bottomRight),(0,ol_transform.Bb)(inverted,bottomLeft),context.save(),context.beginPath(),context.moveTo(Math.round(topLeft[0]),Math.round(topLeft[1])),context.lineTo(Math.round(topRight[0]),Math.round(topRight[1])),context.lineTo(Math.round(bottomRight[0]),Math.round(bottomRight[1])),context.lineTo(Math.round(bottomLeft[0]),Math.round(bottomLeft[1])),context.clip()}dispatchRenderEvent_(type,context,frameState){const layer=this.getLayer();if(layer.hasListener(type)){const event=new render_Event(type,this.inversePixelTransform,frameState,context);layer.dispatchEvent(event)}}preRender(context,frameState){this.frameState=frameState,this.dispatchRenderEvent_(render_EventType_PRERENDER,context,frameState)}postRender(context,frameState){this.dispatchRenderEvent_(render_EventType_POSTRENDER,context,frameState)}getRenderTransform(center,resolution,rotation,pixelRatio,width,height,offsetX){const dx1=width/2,dy1=height/2,sx=pixelRatio/resolution,sy=-sx,dx2=-center[0]+offsetX,dy2=-center[1];return(0,ol_transform.Zz)(this.tempTransform,dx1,dy1,sx,sy,-rotation,dx2,dy2)}disposeInternal(){delete this.frameState,super.disposeInternal()}};class Tile extends Target.A{constructor(tileCoord,state,options){super(),options=options||{},this.tileCoord=tileCoord,this.state=state,this.interimTile=null,this.key="",this.transition_=void 0===options.transition?250:options.transition,this.transitionStarts_={},this.interpolate=!!options.interpolate}changed(){this.dispatchEvent(EventType.A.CHANGE)}release(){this.state===TileState_ERROR&&this.setState(TileState_EMPTY)}getKey(){return this.key+"/"+this.tileCoord}getInterimTile(){let tile=this.interimTile;if(!tile)return this;do{if(tile.getState()==TileState_LOADED)return this.transition_=0,tile;tile=tile.interimTile}while(tile);return this}refreshInterimChain(){let tile=this.interimTile;if(!tile)return;let prev=this;do{if(tile.getState()==TileState_LOADED){tile.interimTile=null;break}tile.getState()==TileState_LOADING?prev=tile:tile.getState()==TileState_IDLE?prev.interimTile=tile.interimTile:prev=tile,tile=prev.interimTile}while(tile)}getTileCoord(){return this.tileCoord}getState(){return this.state}setState(state){if(this.state!==TileState_ERROR&&this.state>state)throw new Error("Tile load sequence violation");this.state=state,this.changed()}load(){(0,util.b0)()}getAlpha(id,time){if(!this.transition_)return 1;let start=this.transitionStarts_[id];if(start){if(-1===start)return 1}else start=time,this.transitionStarts_[id]=start;const delta=time-start+1e3/60;return delta>=this.transition_?1:(0,easing.a6)(delta/this.transition_)}inTransition(id){return!!this.transition_&&-1!==this.transitionStarts_[id]}endTransition(id){this.transition_&&(this.transitionStarts_[id]=-1)}}const ol_Tile=Tile;class ImageWrapper extends Target.A{constructor(extent,resolution,pixelRatio,stateOrLoader){super(),this.extent=extent,this.pixelRatio_=pixelRatio,this.resolution=resolution,this.state="function"==typeof stateOrLoader?ImageState.A.IDLE:stateOrLoader,this.image_=null,this.loader="function"==typeof stateOrLoader?stateOrLoader:null}changed(){this.dispatchEvent(EventType.A.CHANGE)}getExtent(){return this.extent}getImage(){return this.image_}getPixelRatio(){return this.pixelRatio_}getResolution(){return this.resolution}getState(){return this.state}load(){if(this.state==ImageState.A.IDLE&&this.loader){this.state=ImageState.A.LOADING,this.changed();const resolution=this.getResolution(),requestResolution=Array.isArray(resolution)?resolution[0]:resolution;(0,functions.hq)((()=>this.loader(this.getExtent(),requestResolution,this.getPixelRatio()))).then((image=>{"image"in image&&(this.image_=image.image),"extent"in image&&(this.extent=image.extent),"resolution"in image&&(this.resolution=image.resolution),"pixelRatio"in image&&(this.pixelRatio_=image.pixelRatio),(image instanceof HTMLImageElement||image instanceof ImageBitmap||image instanceof HTMLCanvasElement||image instanceof HTMLVideoElement)&&(this.image_=image),this.state=ImageState.A.LOADED})).catch((error=>{this.state=ImageState.A.ERROR,console.error(error)})).finally((()=>this.changed()))}}setImage(image){this.image_=image}setResolution(resolution){this.resolution=resolution}}function decodeFallback(image,src){return src&&(image.src=src),image.src&&has.DT?new Promise(((resolve,reject)=>image.decode().then((()=>resolve(image))).catch((e=>image.complete&&image.width?resolve(image):reject(e))))):function load(image,src){return new Promise(((resolve,reject)=>{function handleLoad(){unlisten(),resolve(image)}function handleError(){unlisten(),reject(new Error("Image load error"))}function unlisten(){image.removeEventListener("load",handleLoad),image.removeEventListener("error",handleError)}image.addEventListener("load",handleLoad),image.addEventListener("error",handleError),src&&(image.src=src)}))}(image)}function decode(image,src){return src&&(image.src=src),image.src&&has.DT&&has.XM?image.decode().then((()=>createImageBitmap(image))).catch((e=>{if(image.complete&&image.width)return image;throw e})):decodeFallback(image)}const ol_Image=ImageWrapper;const ol_ImageTile=class ImageTile extends ol_Tile{constructor(tileCoord,state,src,crossOrigin,tileLoadFunction,options){super(tileCoord,state,options),this.crossOrigin_=crossOrigin,this.src_=src,this.key=src,this.image_=new Image,null!==crossOrigin&&(this.image_.crossOrigin=crossOrigin),this.unlisten_=null,this.tileLoadFunction_=tileLoadFunction}getImage(){return this.image_}setImage(element){this.image_=element,this.state=TileState_LOADED,this.unlistenImage_(),this.changed()}handleImageError_(){this.state=TileState_ERROR,this.unlistenImage_(),this.image_=function getBlankImage(){const ctx=(0,dom.Y)(1,1);return ctx.fillStyle="rgba(0,0,0,0)",ctx.fillRect(0,0,1,1),ctx.canvas}(),this.changed()}handleImageLoad_(){const image=this.image_;image.naturalWidth&&image.naturalHeight?this.state=TileState_LOADED:this.state=TileState_EMPTY,this.unlistenImage_(),this.changed()}load(){this.state==TileState_ERROR&&(this.state=TileState_IDLE,this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)),this.state==TileState_IDLE&&(this.state=TileState_LOADING,this.changed(),this.tileLoadFunction_(this,this.src_),this.unlisten_=function listenImage(image,loadHandler,errorHandler){const img=image;let listening=!0,decoding=!1,loaded=!1;const listenerKeys=[(0,events.Jz)(img,EventType.A.LOAD,(function(){loaded=!0,decoding||loadHandler()}))];return img.src&&has.DT?(decoding=!0,img.decode().then((function(){listening&&loadHandler()})).catch((function(error){listening&&(loaded?loadHandler():errorHandler())}))):listenerKeys.push((0,events.Jz)(img,EventType.A.ERROR,errorHandler)),function unlisten(){listening=!1,listenerKeys.forEach(events.JH)}}(this.image_,this.handleImageLoad_.bind(this),this.handleImageError_.bind(this)))}unlistenImage_(){this.unlisten_&&(this.unlisten_(),this.unlisten_=null)}};const reproj_Triangulation=class Triangulation{constructor(sourceProj,targetProj,targetExtent,maxSourceExtent,errorThreshold,destinationResolution){this.sourceProj_=sourceProj,this.targetProj_=targetProj;let transformInvCache={};const transformInv=(0,ol_proj.RG)(this.targetProj_,this.sourceProj_);this.transformInv_=function(c){const key=c[0]+"/"+c[1];return transformInvCache[key]||(transformInvCache[key]=transformInv(c)),transformInvCache[key]},this.maxSourceExtent_=maxSourceExtent,this.errorThresholdSquared_=errorThreshold*errorThreshold,this.triangles_=[],this.wrapsXInSource_=!1,this.canWrapXInSource_=this.sourceProj_.canWrapX()&&!!maxSourceExtent&&!!this.sourceProj_.getExtent()&&(0,ol_extent.RG)(maxSourceExtent)>=(0,ol_extent.RG)(this.sourceProj_.getExtent()),this.sourceWorldWidth_=this.sourceProj_.getExtent()?(0,ol_extent.RG)(this.sourceProj_.getExtent()):null,this.targetWorldWidth_=this.targetProj_.getExtent()?(0,ol_extent.RG)(this.targetProj_.getExtent()):null;const destinationTopLeft=(0,ol_extent.Py)(targetExtent),destinationTopRight=(0,ol_extent.WU)(targetExtent),destinationBottomRight=(0,ol_extent.k_)(targetExtent),destinationBottomLeft=(0,ol_extent.R)(targetExtent),sourceTopLeft=this.transformInv_(destinationTopLeft),sourceTopRight=this.transformInv_(destinationTopRight),sourceBottomRight=this.transformInv_(destinationBottomRight),sourceBottomLeft=this.transformInv_(destinationBottomLeft),maxSubdivision=10+(destinationResolution?Math.max(0,Math.ceil(Math.log2((0,ol_extent.UG)(targetExtent)/(destinationResolution*destinationResolution*256*256)))):0);if(this.addQuad_(destinationTopLeft,destinationTopRight,destinationBottomRight,destinationBottomLeft,sourceTopLeft,sourceTopRight,sourceBottomRight,sourceBottomLeft,maxSubdivision),this.wrapsXInSource_){let leftBound=1/0;this.triangles_.forEach((function(triangle,i,arr){leftBound=Math.min(leftBound,triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])})),this.triangles_.forEach((triangle=>{if(Math.max(triangle.source[0][0],triangle.source[1][0],triangle.source[2][0])-leftBound>this.sourceWorldWidth_/2){const newTriangle=[[triangle.source[0][0],triangle.source[0][1]],[triangle.source[1][0],triangle.source[1][1]],[triangle.source[2][0],triangle.source[2][1]]];newTriangle[0][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[0][0]-=this.sourceWorldWidth_),newTriangle[1][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[1][0]-=this.sourceWorldWidth_),newTriangle[2][0]-leftBound>this.sourceWorldWidth_/2&&(newTriangle[2][0]-=this.sourceWorldWidth_);const minX=Math.min(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0]);Math.max(newTriangle[0][0],newTriangle[1][0],newTriangle[2][0])-minX<this.sourceWorldWidth_/2&&(triangle.source=newTriangle)}}))}transformInvCache={}}addTriangle_(a,b,c,aSrc,bSrc,cSrc){this.triangles_.push({source:[aSrc,bSrc,cSrc],target:[a,b,c]})}addQuad_(a,b,c,d,aSrc,bSrc,cSrc,dSrc,maxSubdivision){const sourceQuadExtent=(0,ol_extent.Tr)([aSrc,bSrc,cSrc,dSrc]),sourceCoverageX=this.sourceWorldWidth_?(0,ol_extent.RG)(sourceQuadExtent)/this.sourceWorldWidth_:null,sourceWorldWidth=this.sourceWorldWidth_,wrapsX=this.sourceProj_.canWrapX()&&sourceCoverageX>.5&&sourceCoverageX<1;let needsSubdivision=!1;if(maxSubdivision>0){if(this.targetProj_.isGlobal()&&this.targetWorldWidth_){const targetQuadExtent=(0,ol_extent.Tr)([a,b,c,d]);needsSubdivision=(0,ol_extent.RG)(targetQuadExtent)/this.targetWorldWidth_>.25||needsSubdivision}!wrapsX&&this.sourceProj_.isGlobal()&&sourceCoverageX&&(needsSubdivision=sourceCoverageX>.25||needsSubdivision)}if(!needsSubdivision&&this.maxSourceExtent_&&isFinite(sourceQuadExtent[0])&&isFinite(sourceQuadExtent[1])&&isFinite(sourceQuadExtent[2])&&isFinite(sourceQuadExtent[3])&&!(0,ol_extent.HY)(sourceQuadExtent,this.maxSourceExtent_))return;let isNotFinite=0;if(!(needsSubdivision||isFinite(aSrc[0])&&isFinite(aSrc[1])&&isFinite(bSrc[0])&&isFinite(bSrc[1])&&isFinite(cSrc[0])&&isFinite(cSrc[1])&&isFinite(dSrc[0])&&isFinite(dSrc[1])))if(maxSubdivision>0)needsSubdivision=!0;else if(isNotFinite=(isFinite(aSrc[0])&&isFinite(aSrc[1])?0:8)+(isFinite(bSrc[0])&&isFinite(bSrc[1])?0:4)+(isFinite(cSrc[0])&&isFinite(cSrc[1])?0:2)+(isFinite(dSrc[0])&&isFinite(dSrc[1])?0:1),1!=isNotFinite&&2!=isNotFinite&&4!=isNotFinite&&8!=isNotFinite)return;if(maxSubdivision>0){if(!needsSubdivision){const center=[(a[0]+c[0])/2,(a[1]+c[1])/2],centerSrc=this.transformInv_(center);let dx;if(wrapsX){dx=((0,math.xP)(aSrc[0],sourceWorldWidth)+(0,math.xP)(cSrc[0],sourceWorldWidth))/2-(0,math.xP)(centerSrc[0],sourceWorldWidth)}else dx=(aSrc[0]+cSrc[0])/2-centerSrc[0];const dy=(aSrc[1]+cSrc[1])/2-centerSrc[1];needsSubdivision=dx*dx+dy*dy>this.errorThresholdSquared_}if(needsSubdivision){if(Math.abs(a[0]-c[0])<=Math.abs(a[1]-c[1])){const bc=[(b[0]+c[0])/2,(b[1]+c[1])/2],bcSrc=this.transformInv_(bc),da=[(d[0]+a[0])/2,(d[1]+a[1])/2],daSrc=this.transformInv_(da);this.addQuad_(a,b,bc,da,aSrc,bSrc,bcSrc,daSrc,maxSubdivision-1),this.addQuad_(da,bc,c,d,daSrc,bcSrc,cSrc,dSrc,maxSubdivision-1)}else{const ab=[(a[0]+b[0])/2,(a[1]+b[1])/2],abSrc=this.transformInv_(ab),cd=[(c[0]+d[0])/2,(c[1]+d[1])/2],cdSrc=this.transformInv_(cd);this.addQuad_(a,ab,cd,d,aSrc,abSrc,cdSrc,dSrc,maxSubdivision-1),this.addQuad_(ab,b,c,cd,abSrc,bSrc,cSrc,cdSrc,maxSubdivision-1)}return}}if(wrapsX){if(!this.canWrapXInSource_)return;this.wrapsXInSource_=!0}11&isNotFinite||this.addTriangle_(a,c,d,aSrc,cSrc,dSrc),14&isNotFinite||this.addTriangle_(a,c,b,aSrc,cSrc,bSrc),isNotFinite&&(13&isNotFinite||this.addTriangle_(b,d,a,bSrc,dSrc,aSrc),7&isNotFinite||this.addTriangle_(b,d,c,bSrc,dSrc,cSrc))}calculateSourceExtent(){const extent=(0,ol_extent.S5)();return this.triangles_.forEach((function(triangle,i,arr){const src=triangle.source;(0,ol_extent.$C)(extent,src[0]),(0,ol_extent.$C)(extent,src[1]),(0,ol_extent.$C)(extent,src[2])})),extent}getTriangles(){return this.triangles_}};let brokenDiagonalRendering_;const reproj_canvasPool=[];function drawTestTriangle(ctx,u1,v1,u2,v2){ctx.beginPath(),ctx.moveTo(0,0),ctx.lineTo(u1,v1),ctx.lineTo(u2,v2),ctx.closePath(),ctx.save(),ctx.clip(),ctx.fillRect(0,0,Math.max(u1,u2)+1,Math.max(v1,v2)),ctx.restore()}function verifyBrokenDiagonalRendering(data,offset){return Math.abs(data[4*offset]-210)>2||Math.abs(data[4*offset+3]-191.25)>2}function calculateSourceResolution(sourceProj,targetProj,targetCenter,targetResolution){const sourceCenter=(0,ol_proj.pd)(targetCenter,targetProj,sourceProj);let sourceResolution=(0,ol_proj.hO)(targetProj,targetResolution,targetCenter);const targetMetersPerUnit=targetProj.getMetersPerUnit();void 0!==targetMetersPerUnit&&(sourceResolution*=targetMetersPerUnit);const sourceMetersPerUnit=sourceProj.getMetersPerUnit();void 0!==sourceMetersPerUnit&&(sourceResolution/=sourceMetersPerUnit);const sourceExtent=sourceProj.getExtent();if(!sourceExtent||(0,ol_extent.Ym)(sourceExtent,sourceCenter)){const compensationFactor=(0,ol_proj.hO)(sourceProj,sourceResolution,sourceCenter)/sourceResolution;isFinite(compensationFactor)&&compensationFactor>0&&(sourceResolution/=compensationFactor)}return sourceResolution}function render(width,height,pixelRatio,sourceResolution,sourceExtent,targetResolution,targetExtent,triangulation,sources,gutter,renderEdges,interpolate,drawSingle){const context=(0,dom.Y)(Math.round(pixelRatio*width),Math.round(pixelRatio*height),reproj_canvasPool);if(interpolate||(context.imageSmoothingEnabled=!1),0===sources.length)return context.canvas;function pixelRound(value){return Math.round(value*pixelRatio)/pixelRatio}context.scale(pixelRatio,pixelRatio),context.globalCompositeOperation="lighter";const sourceDataExtent=(0,ol_extent.S5)();let stitchContext;if(sources.forEach((function(src,i,arr){(0,ol_extent.X$)(sourceDataExtent,src.extent)})),!drawSingle||1!==sources.length||0!==gutter){const canvasWidthInUnits=(0,ol_extent.RG)(sourceDataExtent),canvasHeightInUnits=(0,ol_extent.Oq)(sourceDataExtent);stitchContext=(0,dom.Y)(Math.round(pixelRatio*canvasWidthInUnits/sourceResolution),Math.round(pixelRatio*canvasHeightInUnits/sourceResolution),reproj_canvasPool),interpolate||(stitchContext.imageSmoothingEnabled=!1);const stitchScale=pixelRatio/sourceResolution;sources.forEach((function(src,i,arr){const xPos=src.extent[0]-sourceDataExtent[0],yPos=-(src.extent[3]-sourceDataExtent[3]),srcWidth=(0,ol_extent.RG)(src.extent),srcHeight=(0,ol_extent.Oq)(src.extent);src.image.width>0&&src.image.height>0&&stitchContext.drawImage(src.image,gutter,gutter,src.image.width-2*gutter,src.image.height-2*gutter,xPos*stitchScale,yPos*stitchScale,srcWidth*stitchScale,srcHeight*stitchScale)}))}const targetTopLeft=(0,ol_extent.Py)(targetExtent);return triangulation.getTriangles().forEach((function(triangle,i,arr){const source=triangle.source,target=triangle.target;let x0=source[0][0],y0=source[0][1],x1=source[1][0],y1=source[1][1],x2=source[2][0],y2=source[2][1];const u0=pixelRound((target[0][0]-targetTopLeft[0])/targetResolution),v0=pixelRound(-(target[0][1]-targetTopLeft[1])/targetResolution),u1=pixelRound((target[1][0]-targetTopLeft[0])/targetResolution),v1=pixelRound(-(target[1][1]-targetTopLeft[1])/targetResolution),u2=pixelRound((target[2][0]-targetTopLeft[0])/targetResolution),v2=pixelRound(-(target[2][1]-targetTopLeft[1])/targetResolution),sourceNumericalShiftX=x0,sourceNumericalShiftY=y0;x0=0,y0=0,x1-=sourceNumericalShiftX,y1-=sourceNumericalShiftY,x2-=sourceNumericalShiftX,y2-=sourceNumericalShiftY;const augmentedMatrix=[[x1,y1,0,0,u1-u0],[x2,y2,0,0,u2-u0],[0,0,x1,y1,v1-v0],[0,0,x2,y2,v2-v0]],affineCoefs=(0,math.KU)(augmentedMatrix);if(!affineCoefs)return;if(context.save(),context.beginPath(),function isBrokenDiagonalRendering(){if(void 0===brokenDiagonalRendering_){const ctx=(0,dom.Y)(6,6,reproj_canvasPool);ctx.globalCompositeOperation="lighter",ctx.fillStyle="rgba(210, 0, 0, 0.75)",drawTestTriangle(ctx,4,5,4,0),drawTestTriangle(ctx,4,5,0,5);const data=ctx.getImageData(0,0,3,3).data;brokenDiagonalRendering_=verifyBrokenDiagonalRendering(data,0)||verifyBrokenDiagonalRendering(data,4)||verifyBrokenDiagonalRendering(data,8),(0,dom.Yg)(ctx),reproj_canvasPool.push(ctx.canvas)}return brokenDiagonalRendering_}()||!interpolate){context.moveTo(u1,v1);const steps=4,ud=u0-u1,vd=v0-v1;for(let step=0;step<steps;step++)context.lineTo(u1+pixelRound((step+1)*ud/steps),v1+pixelRound(step*vd/(steps-1))),step!=steps-1&&context.lineTo(u1+pixelRound((step+1)*ud/steps),v1+pixelRound((step+1)*vd/(steps-1)));context.lineTo(u2,v2)}else context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2);let image;if(context.clip(),context.transform(affineCoefs[0],affineCoefs[2],affineCoefs[1],affineCoefs[3],u0,v0),context.translate(sourceDataExtent[0]-sourceNumericalShiftX,sourceDataExtent[3]-sourceNumericalShiftY),stitchContext)image=stitchContext.canvas,context.scale(sourceResolution/pixelRatio,-sourceResolution/pixelRatio);else{const source=sources[0],extent=source.extent;image=source.image,context.scale((0,ol_extent.RG)(extent)/image.width,-(0,ol_extent.Oq)(extent)/image.height)}context.drawImage(image,0,0),context.restore()})),stitchContext&&((0,dom.Yg)(stitchContext),reproj_canvasPool.push(stitchContext.canvas)),renderEdges&&(context.save(),context.globalCompositeOperation="source-over",context.strokeStyle="black",context.lineWidth=1,triangulation.getTriangles().forEach((function(triangle,i,arr){const target=triangle.target,u0=(target[0][0]-targetTopLeft[0])/targetResolution,v0=-(target[0][1]-targetTopLeft[1])/targetResolution,u1=(target[1][0]-targetTopLeft[0])/targetResolution,v1=-(target[1][1]-targetTopLeft[1])/targetResolution,u2=(target[2][0]-targetTopLeft[0])/targetResolution,v2=-(target[2][1]-targetTopLeft[1])/targetResolution;context.beginPath(),context.moveTo(u1,v1),context.lineTo(u0,v0),context.lineTo(u2,v2),context.closePath(),context.stroke()})),context.restore()),context.canvas}const reproj_Tile=class ReprojTile extends ol_Tile{constructor(sourceProj,sourceTileGrid,targetProj,targetTileGrid,tileCoord,wrappedTileCoord,pixelRatio,gutter,getTileFunction,errorThreshold,renderEdges,options){super(tileCoord,TileState_IDLE,options),this.renderEdges_=void 0!==renderEdges&&renderEdges,this.pixelRatio_=pixelRatio,this.gutter_=gutter,this.canvas_=null,this.sourceTileGrid_=sourceTileGrid,this.targetTileGrid_=targetTileGrid,this.wrappedTileCoord_=wrappedTileCoord||tileCoord,this.sourceTiles_=[],this.sourcesListenerKeys_=null,this.sourceZ_=0;const targetExtent=targetTileGrid.getTileCoordExtent(this.wrappedTileCoord_),maxTargetExtent=this.targetTileGrid_.getExtent();let maxSourceExtent=this.sourceTileGrid_.getExtent();const limitedTargetExtent=maxTargetExtent?(0,ol_extent._N)(targetExtent,maxTargetExtent):targetExtent;if(0===(0,ol_extent.UG)(limitedTargetExtent))return void(this.state=TileState_EMPTY);const sourceProjExtent=sourceProj.getExtent();sourceProjExtent&&(maxSourceExtent=maxSourceExtent?(0,ol_extent._N)(maxSourceExtent,sourceProjExtent):sourceProjExtent);const targetResolution=targetTileGrid.getResolution(this.wrappedTileCoord_[0]),sourceResolution=function calculateSourceExtentResolution(sourceProj,targetProj,targetExtent,targetResolution){const targetCenter=(0,ol_extent.q1)(targetExtent);let sourceResolution=calculateSourceResolution(sourceProj,targetProj,targetCenter,targetResolution);return(!isFinite(sourceResolution)||sourceResolution<=0)&&(0,ol_extent.sB)(targetExtent,(function(corner){return sourceResolution=calculateSourceResolution(sourceProj,targetProj,corner,targetResolution),isFinite(sourceResolution)&&sourceResolution>0})),sourceResolution}(sourceProj,targetProj,limitedTargetExtent,targetResolution);if(!isFinite(sourceResolution)||sourceResolution<=0)return void(this.state=TileState_EMPTY);const errorThresholdInPixels=void 0!==errorThreshold?errorThreshold:.5;if(this.triangulation_=new reproj_Triangulation(sourceProj,targetProj,limitedTargetExtent,maxSourceExtent,sourceResolution*errorThresholdInPixels,targetResolution),0===this.triangulation_.getTriangles().length)return void(this.state=TileState_EMPTY);this.sourceZ_=sourceTileGrid.getZForResolution(sourceResolution);let sourceExtent=this.triangulation_.calculateSourceExtent();if(maxSourceExtent&&(sourceProj.canWrapX()?(sourceExtent[1]=(0,math.qE)(sourceExtent[1],maxSourceExtent[1],maxSourceExtent[3]),sourceExtent[3]=(0,math.qE)(sourceExtent[3],maxSourceExtent[1],maxSourceExtent[3])):sourceExtent=(0,ol_extent._N)(sourceExtent,maxSourceExtent)),(0,ol_extent.UG)(sourceExtent)){const sourceRange=sourceTileGrid.getTileRangeForExtentAndZ(sourceExtent,this.sourceZ_);for(let srcX=sourceRange.minX;srcX<=sourceRange.maxX;srcX++)for(let srcY=sourceRange.minY;srcY<=sourceRange.maxY;srcY++){const tile=getTileFunction(this.sourceZ_,srcX,srcY,pixelRatio);tile&&this.sourceTiles_.push(tile)}0===this.sourceTiles_.length&&(this.state=TileState_EMPTY)}else this.state=TileState_EMPTY}getImage(){return this.canvas_}reproject_(){const sources=[];if(this.sourceTiles_.forEach((tile=>{tile&&tile.getState()==TileState_LOADED&&sources.push({extent:this.sourceTileGrid_.getTileCoordExtent(tile.tileCoord),image:tile.getImage()})})),this.sourceTiles_.length=0,0===sources.length)this.state=TileState_ERROR;else{const z=this.wrappedTileCoord_[0],size=this.targetTileGrid_.getTileSize(z),width="number"==typeof size?size:size[0],height="number"==typeof size?size:size[1],targetResolution=this.targetTileGrid_.getResolution(z),sourceResolution=this.sourceTileGrid_.getResolution(this.sourceZ_),targetExtent=this.targetTileGrid_.getTileCoordExtent(this.wrappedTileCoord_);this.canvas_=render(width,height,this.pixelRatio_,sourceResolution,this.sourceTileGrid_.getExtent(),targetResolution,targetExtent,this.triangulation_,sources,this.gutter_,this.renderEdges_,this.interpolate),this.state=TileState_LOADED}this.changed()}load(){if(this.state==TileState_IDLE){this.state=TileState_LOADING,this.changed();let leftToLoad=0;this.sourcesListenerKeys_=[],this.sourceTiles_.forEach((tile=>{const state=tile.getState();if(state==TileState_IDLE||state==TileState_LOADING){leftToLoad++;const sourceListenKey=(0,events.KT)(tile,EventType.A.CHANGE,(function(e){const state=tile.getState();state!=TileState_LOADED&&state!=TileState_ERROR&&state!=TileState_EMPTY||((0,events.JH)(sourceListenKey),leftToLoad--,0===leftToLoad&&(this.unlistenSources_(),this.reproject_()))}),this);this.sourcesListenerKeys_.push(sourceListenKey)}})),0===leftToLoad?setTimeout(this.reproject_.bind(this),0):this.sourceTiles_.forEach((function(tile,i,arr){tile.getState()==TileState_IDLE&&tile.load()}))}}unlistenSources_(){this.sourcesListenerKeys_.forEach(events.JH),this.sourcesListenerKeys_=null}release(){this.canvas_&&((0,dom.Yg)(this.canvas_.getContext("2d")),reproj_canvasPool.push(this.canvas_),this.canvas_=null),super.release()}};var TileRange=__webpack_require__("./node_modules/ol/TileRange.js");const canvas_TileLayer=class CanvasTileLayerRenderer extends canvas_Layer{constructor(tileLayer){super(tileLayer),this.extentChanged=!0,this.renderedExtent_=null,this.renderedPixelRatio,this.renderedProjection=null,this.renderedRevision,this.renderedTiles=[],this.newTiles_=!1,this.tmpExtent=(0,ol_extent.S5)(),this.tmpTileRange_=new TileRange.A(0,0,0,0)}isDrawableTile(tile){const tileLayer=this.getLayer(),tileState=tile.getState(),useInterimTilesOnError=tileLayer.getUseInterimTilesOnError();return tileState==TileState_LOADED||tileState==TileState_EMPTY||tileState==TileState_ERROR&&!useInterimTilesOnError}getTile(z,x,y,frameState){const pixelRatio=frameState.pixelRatio,projection=frameState.viewState.projection,tileLayer=this.getLayer();let tile=tileLayer.getSource().getTile(z,x,y,pixelRatio,projection);return tile.getState()==TileState_ERROR&&tileLayer.getUseInterimTilesOnError()&&tileLayer.getPreload()>0&&(this.newTiles_=!0),this.isDrawableTile(tile)||(tile=tile.getInterimTile()),tile}getData(pixel){const frameState=this.frameState;if(!frameState)return null;const layer=this.getLayer(),coordinate=(0,ol_transform.Bb)(frameState.pixelToCoordinateTransform,pixel.slice()),layerExtent=layer.getExtent();if(layerExtent&&!(0,ol_extent.Ym)(layerExtent,coordinate))return null;const pixelRatio=frameState.pixelRatio,projection=frameState.viewState.projection,viewState=frameState.viewState,source=layer.getRenderSource(),tileGrid=source.getTileGridForProjection(viewState.projection),tilePixelRatio=source.getTilePixelRatio(frameState.pixelRatio);for(let z=tileGrid.getZForResolution(viewState.resolution);z>=tileGrid.getMinZoom();--z){const tileCoord=tileGrid.getTileCoordForCoordAndZ(coordinate,z),tile=source.getTile(z,tileCoord[1],tileCoord[2],pixelRatio,projection);if(!(tile instanceof ol_ImageTile||tile instanceof reproj_Tile)||tile instanceof reproj_Tile&&tile.getState()===TileState_EMPTY)return null;if(tile.getState()!==TileState_LOADED)continue;const tileOrigin=tileGrid.getOrigin(z),tileSize=(0,ol_size.xq)(tileGrid.getTileSize(z)),tileResolution=tileGrid.getResolution(z),col=Math.floor(tilePixelRatio*((coordinate[0]-tileOrigin[0])/tileResolution-tileCoord[1]*tileSize[0])),row=Math.floor(tilePixelRatio*((tileOrigin[1]-coordinate[1])/tileResolution-tileCoord[2]*tileSize[1])),gutter=Math.round(tilePixelRatio*source.getGutterForProjection(viewState.projection));return this.getImageData(tile.getImage(),col+gutter,row+gutter)}return null}loadedTileCallback(tiles,zoom,tile){return!!this.isDrawableTile(tile)&&super.loadedTileCallback(tiles,zoom,tile)}prepareFrame(frameState){return!!this.getLayer().getSource()}renderFrame(frameState,target){const layerState=frameState.layerStatesArray[frameState.layerIndex],viewState=frameState.viewState,projection=viewState.projection,viewResolution=viewState.resolution,viewCenter=viewState.center,rotation=viewState.rotation,pixelRatio=frameState.pixelRatio,tileLayer=this.getLayer(),tileSource=tileLayer.getSource(),sourceRevision=tileSource.getRevision(),tileGrid=tileSource.getTileGridForProjection(projection),z=tileGrid.getZForResolution(viewResolution,tileSource.zDirection),tileResolution=tileGrid.getResolution(z);let extent=frameState.extent;const resolution=frameState.viewState.resolution,tilePixelRatio=tileSource.getTilePixelRatio(pixelRatio),width=Math.round((0,ol_extent.RG)(extent)/resolution*pixelRatio),height=Math.round((0,ol_extent.Oq)(extent)/resolution*pixelRatio),layerExtent=layerState.extent&&(0,ol_proj.SD)(layerState.extent,projection);layerExtent&&(extent=(0,ol_extent._N)(extent,(0,ol_proj.SD)(layerState.extent,projection)));const dx=tileResolution*width/2/tilePixelRatio,dy=tileResolution*height/2/tilePixelRatio,canvasExtent=[viewCenter[0]-dx,viewCenter[1]-dy,viewCenter[0]+dx,viewCenter[1]+dy],tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z),tilesToDrawByZ={};tilesToDrawByZ[z]={};const findLoadedTiles=this.createLoadedTileFinder(tileSource,projection,tilesToDrawByZ),tmpExtent=this.tmpExtent,tmpTileRange=this.tmpTileRange_;this.newTiles_=!1;const viewport=rotation?(0,ol_extent.Yw)(viewState.center,resolution,rotation,frameState.size):void 0;for(let x=tileRange.minX;x<=tileRange.maxX;++x)for(let y=tileRange.minY;y<=tileRange.maxY;++y){if(rotation&&!tileGrid.tileCoordIntersectsViewport([z,x,y],viewport))continue;const tile=this.getTile(z,x,y,frameState);if(this.isDrawableTile(tile)){const uid=(0,util.v6)(this);if(tile.getState()==TileState_LOADED){tilesToDrawByZ[z][tile.tileCoord.toString()]=tile;let inTransition=tile.inTransition(uid);inTransition&&1!==layerState.opacity&&(tile.endTransition(uid),inTransition=!1),this.newTiles_||!inTransition&&this.renderedTiles.includes(tile)||(this.newTiles_=!0)}if(1===tile.getAlpha(uid,frameState.time))continue}const childTileRange=tileGrid.getTileCoordChildTileRange(tile.tileCoord,tmpTileRange,tmpExtent);let covered=!1;childTileRange&&(covered=findLoadedTiles(z+1,childTileRange)),covered||tileGrid.forEachTileCoordParentTileRange(tile.tileCoord,findLoadedTiles,tmpTileRange,tmpExtent)}const canvasScale=tileResolution/viewResolution*pixelRatio/tilePixelRatio;(0,ol_transform.Zz)(this.pixelTransform,frameState.size[0]/2,frameState.size[1]/2,1/pixelRatio,1/pixelRatio,rotation,-width/2,-height/2);const canvasTransform=(0,ol_transform.dI)(this.pixelTransform);this.useContainer(target,canvasTransform,this.getBackground(frameState));const context=this.context,canvas=context.canvas;(0,ol_transform.T9)(this.inversePixelTransform,this.pixelTransform),(0,ol_transform.Zz)(this.tempTransform,width/2,height/2,canvasScale,canvasScale,0,-width/2,-height/2),canvas.width!=width||canvas.height!=height?(canvas.width=width,canvas.height=height):this.containerReused||context.clearRect(0,0,width,height),layerExtent&&this.clipUnrotated(context,frameState,layerExtent),tileSource.getInterpolate()||(context.imageSmoothingEnabled=!1),this.preRender(context,frameState),this.renderedTiles.length=0;let clips,clipZs,currentClip,zs=Object.keys(tilesToDrawByZ).map(Number);zs.sort(array.V_),1!==layerState.opacity||this.containerReused&&!tileSource.getOpaque(frameState.viewState.projection)?(clips=[],clipZs=[]):zs=zs.reverse();for(let i=zs.length-1;i>=0;--i){const currentZ=zs[i],currentTilePixelSize=tileSource.getTilePixelSize(currentZ,pixelRatio,projection),currentScale=tileGrid.getResolution(currentZ)/tileResolution,dx=currentTilePixelSize[0]*currentScale*canvasScale,dy=currentTilePixelSize[1]*currentScale*canvasScale,originTileCoord=tileGrid.getTileCoordForCoordAndZ((0,ol_extent.Py)(canvasExtent),currentZ),originTileExtent=tileGrid.getTileCoordExtent(originTileCoord),origin=(0,ol_transform.Bb)(this.tempTransform,[tilePixelRatio*(originTileExtent[0]-canvasExtent[0])/tileResolution,tilePixelRatio*(canvasExtent[3]-originTileExtent[3])/tileResolution]),tileGutter=tilePixelRatio*tileSource.getGutterForProjection(projection),tilesToDraw=tilesToDrawByZ[currentZ];for(const tileCoordKey in tilesToDraw){const tile=tilesToDraw[tileCoordKey],tileCoord=tile.tileCoord,xIndex=originTileCoord[1]-tileCoord[1],nextX=Math.round(origin[0]-(xIndex-1)*dx),yIndex=originTileCoord[2]-tileCoord[2],nextY=Math.round(origin[1]-(yIndex-1)*dy),x=Math.round(origin[0]-xIndex*dx),y=Math.round(origin[1]-yIndex*dy),w=nextX-x,h=nextY-y,transition=z===currentZ,inTransition=transition&&1!==tile.getAlpha((0,util.v6)(this),frameState.time);let contextSaved=!1;if(!inTransition)if(clips){currentClip=[x,y,x+w,y,x+w,y+h,x,y+h];for(let i=0,ii=clips.length;i<ii;++i)if(z!==currentZ&&currentZ<clipZs[i]){const clip=clips[i];(0,ol_extent.HY)([x,y,x+w,y+h],[clip[0],clip[3],clip[4],clip[7]])&&(contextSaved||(context.save(),contextSaved=!0),context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip())}clips.push(currentClip),clipZs.push(currentZ)}else context.clearRect(x,y,w,h);this.drawTileImage(tile,frameState,x,y,w,h,tileGutter,transition),clips&&!inTransition?(contextSaved&&context.restore(),this.renderedTiles.unshift(tile)):this.renderedTiles.push(tile),this.updateUsedTiles(frameState.usedTiles,tileSource,tile)}}return this.renderedRevision=sourceRevision,this.renderedResolution=tileResolution,this.extentChanged=!this.renderedExtent_||!(0,ol_extent.aI)(this.renderedExtent_,canvasExtent),this.renderedExtent_=canvasExtent,this.renderedPixelRatio=pixelRatio,this.renderedProjection=projection,this.manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,z,tileLayer.getPreload()),this.scheduleExpireCache(frameState,tileSource),this.postRender(context,frameState),layerState.extent&&context.restore(),context.imageSmoothingEnabled=!0,canvasTransform!==canvas.style.transform&&(canvas.style.transform=canvasTransform),this.container}drawTileImage(tile,frameState,x,y,w,h,gutter,transition){const image=this.getTileImage(tile);if(!image)return;const uid=(0,util.v6)(this),layerState=frameState.layerStatesArray[frameState.layerIndex],alpha=layerState.opacity*(transition?tile.getAlpha(uid,frameState.time):1),alphaChanged=alpha!==this.context.globalAlpha;alphaChanged&&(this.context.save(),this.context.globalAlpha=alpha),this.context.drawImage(image,gutter,gutter,image.width-2*gutter,image.height-2*gutter,x,y,w,h),alphaChanged&&this.context.restore(),alpha!==layerState.opacity?frameState.animate=!0:transition&&tile.endTransition(uid)}getImage(){const context=this.context;return context?context.canvas:null}getTileImage(tile){return tile.getImage()}scheduleExpireCache(frameState,tileSource){if(tileSource.canExpireCache()){const postRenderFunction=function(tileSource,map,frameState){const tileSourceKey=(0,util.v6)(tileSource);tileSourceKey in frameState.usedTiles&&tileSource.expireCache(frameState.viewState.projection,frameState.usedTiles[tileSourceKey])}.bind(null,tileSource);frameState.postRenderFunctions.push(postRenderFunction)}}updateUsedTiles(usedTiles,tileSource,tile){const tileSourceKey=(0,util.v6)(tileSource);tileSourceKey in usedTiles||(usedTiles[tileSourceKey]={}),usedTiles[tileSourceKey][tile.getKey()]=!0}manageTilePyramid(frameState,tileSource,tileGrid,pixelRatio,projection,extent,currentZ,preload,tileCallback){const tileSourceKey=(0,util.v6)(tileSource);tileSourceKey in frameState.wantedTiles||(frameState.wantedTiles[tileSourceKey]={});const wantedTiles=frameState.wantedTiles[tileSourceKey],tileQueue=frameState.tileQueue,minZoom=tileGrid.getMinZoom(),rotation=frameState.viewState.rotation,viewport=rotation?(0,ol_extent.Yw)(frameState.viewState.center,frameState.viewState.resolution,rotation,frameState.size):void 0;let tile,tileRange,tileResolution,x,y,z,tileCount=0;for(z=minZoom;z<=currentZ;++z)for(tileRange=tileGrid.getTileRangeForExtentAndZ(extent,z,tileRange),tileResolution=tileGrid.getResolution(z),x=tileRange.minX;x<=tileRange.maxX;++x)for(y=tileRange.minY;y<=tileRange.maxY;++y)rotation&&!tileGrid.tileCoordIntersectsViewport([z,x,y],viewport)||(currentZ-z<=preload?(++tileCount,tile=tileSource.getTile(z,x,y,pixelRatio,projection),tile.getState()==TileState_IDLE&&(wantedTiles[tile.getKey()]=!0,tileQueue.isKeyQueued(tile.getKey())||tileQueue.enqueue([tile,tileSourceKey,tileGrid.getTileCoordCenter(tile.tileCoord),tileResolution])),void 0!==tileCallback&&tileCallback(tile)):tileSource.useTile(z,x,y,projection));tileSource.updateCacheSize(tileCount,projection)}};const layer_Tile=class Tile_TileLayer extends BaseTile{constructor(options){super(options)}createRenderer(){return new canvas_TileLayer(this)}};const structs_LRUCache=class LRUCache{constructor(highWaterMark){this.highWaterMark=void 0!==highWaterMark?highWaterMark:2048,this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}canExpireCache(){return this.highWaterMark>0&&this.getCount()>this.highWaterMark}expireCache(keep){for(;this.canExpireCache();)this.pop()}clear(){this.count_=0,this.entries_={},this.oldest_=null,this.newest_=null}containsKey(key){return this.entries_.hasOwnProperty(key)}forEach(f){let entry=this.oldest_;for(;entry;)f(entry.value_,entry.key_,this),entry=entry.newer}get(key,options){const entry=this.entries_[key];return(0,asserts.v)(void 0!==entry,"Tried to get a value for a key that does not exist in the cache"),entry===this.newest_||(entry===this.oldest_?(this.oldest_=this.oldest_.newer,this.oldest_.older=null):(entry.newer.older=entry.older,entry.older.newer=entry.newer),entry.newer=null,entry.older=this.newest_,this.newest_.newer=entry,this.newest_=entry),entry.value_}remove(key){const entry=this.entries_[key];return(0,asserts.v)(void 0!==entry,"Tried to get a value for a key that does not exist in the cache"),entry===this.newest_?(this.newest_=entry.older,this.newest_&&(this.newest_.newer=null)):entry===this.oldest_?(this.oldest_=entry.newer,this.oldest_&&(this.oldest_.older=null)):(entry.newer.older=entry.older,entry.older.newer=entry.newer),delete this.entries_[key],--this.count_,entry.value_}getCount(){return this.count_}getKeys(){const keys=new Array(this.count_);let entry,i=0;for(entry=this.newest_;entry;entry=entry.older)keys[i++]=entry.key_;return keys}getValues(){const values=new Array(this.count_);let entry,i=0;for(entry=this.newest_;entry;entry=entry.older)values[i++]=entry.value_;return values}peekLast(){return this.oldest_.value_}peekLastKey(){return this.oldest_.key_}peekFirstKey(){return this.newest_.key_}peek(key){return this.entries_[key]?.value_}pop(){const entry=this.oldest_;return delete this.entries_[entry.key_],entry.newer&&(entry.newer.older=null),this.oldest_=entry.newer,this.oldest_||(this.newest_=null),--this.count_,entry.value_}replace(key,value){this.get(key),this.entries_[key].value_=value}set(key,value){(0,asserts.v)(!(key in this.entries_),"Tried to set a value for a key that is used already");const entry={key_:key,newer:null,older:this.newest_,value_:value};this.newest_?this.newest_.newer=entry:this.oldest_=entry,this.newest_=entry,this.entries_[key]=entry,++this.count_}setSize(size){this.highWaterMark=size}};var tilecoord=__webpack_require__("./node_modules/ol/tilecoord.js");const ol_TileCache=class TileCache extends structs_LRUCache{clear(){for(;this.getCount()>0;)this.pop().release();super.clear()}expireCache(usedTiles){for(;this.canExpireCache();){if(this.peekLast().getKey()in usedTiles)break;this.pop().release()}}pruneExceptNewestZ(){if(0===this.getCount())return;const key=this.peekFirstKey(),z=(0,tilecoord.K)(key)[0];this.forEach((tile=>{tile.tileCoord[0]!==z&&(this.remove((0,tilecoord.i7)(tile.tileCoord)),tile.release())}))}},TileEventType_TILELOADSTART="tileloadstart",TileEventType_TILELOADEND="tileloadend",TileEventType_TILELOADERROR="tileloaderror";class Source extends ol_Object.A{constructor(options){super(),this.projection=(0,ol_proj.Jt)(options.projection),this.attributions_=adaptAttributions(options.attributions),this.attributionsCollapsible_=void 0===options.attributionsCollapsible||options.attributionsCollapsible,this.loading=!1,this.state_=void 0!==options.state?options.state:"ready",this.wrapX_=void 0!==options.wrapX&&options.wrapX,this.interpolate_=!!options.interpolate,this.viewResolver=null,this.viewRejector=null;const self=this;this.viewPromise_=new Promise((function(resolve,reject){self.viewResolver=resolve,self.viewRejector=reject}))}getAttributions(){return this.attributions_}getAttributionsCollapsible(){return this.attributionsCollapsible_}getProjection(){return this.projection}getResolutions(projection){return null}getView(){return this.viewPromise_}getState(){return this.state_}getWrapX(){return this.wrapX_}getInterpolate(){return this.interpolate_}refresh(){this.changed()}setAttributions(attributions){this.attributions_=adaptAttributions(attributions),this.changed()}setState(state){this.state_=state,this.changed()}}function adaptAttributions(attributionLike){return attributionLike?Array.isArray(attributionLike)?function(frameState){return attributionLike}:"function"==typeof attributionLike?attributionLike:function(frameState){return[attributionLike]}:null}const source_Source=Source;var TileGrid=__webpack_require__("./node_modules/ol/tilegrid/TileGrid.js");function getForProjection(projection){let tileGrid=projection.getDefaultTileGrid();return tileGrid||(tileGrid=function createForProjection(projection,maxZoom,tileSize,corner){const extent=extentFromProjection(projection);return function createForExtent(extent,maxZoom,tileSize,corner){corner=void 0!==corner?corner:"top-left";const resolutions=resolutionsFromExtent(extent,maxZoom,tileSize);return new TileGrid.A({extent,origin:(0,ol_extent.qF)(extent,corner),resolutions,tileSize})}(extent,maxZoom,tileSize,corner)}(projection),projection.setDefaultTileGrid(tileGrid)),tileGrid}function createXYZ(options){const xyzOptions=options||{},extent=xyzOptions.extent||(0,ol_proj.Jt)("EPSG:3857").getExtent(),gridOptions={extent,minZoom:xyzOptions.minZoom,tileSize:xyzOptions.tileSize,resolutions:resolutionsFromExtent(extent,xyzOptions.maxZoom,xyzOptions.tileSize,xyzOptions.maxResolution)};return new TileGrid.A(gridOptions)}function resolutionsFromExtent(extent,maxZoom,tileSize,maxResolution){maxZoom=void 0!==maxZoom?maxZoom:common.L,tileSize=(0,ol_size.xq)(void 0!==tileSize?tileSize:common.R);const height=(0,ol_extent.Oq)(extent),width=(0,ol_extent.RG)(extent);maxResolution=maxResolution>0?maxResolution:Math.max(width/tileSize[0],height/tileSize[1]);const length=maxZoom+1,resolutions=new Array(length);for(let z=0;z<length;++z)resolutions[z]=maxResolution/Math.pow(2,z);return resolutions}function extentFromProjection(projection){let extent=(projection=(0,ol_proj.Jt)(projection)).getExtent();if(!extent){const half=180*ol_proj.Ig.degrees/projection.getMetersPerUnit();extent=(0,ol_extent.N)(-half,-half,half,half)}return extent}class TileSourceEvent extends Event.Ay{constructor(type,tile){super(type),this.tile=tile}}const source_Tile=class TileSource extends source_Source{constructor(options){super({attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,projection:options.projection,state:options.state,wrapX:options.wrapX,interpolate:options.interpolate}),this.on,this.once,this.un,this.opaque_=void 0!==options.opaque&&options.opaque,this.tilePixelRatio_=void 0!==options.tilePixelRatio?options.tilePixelRatio:1,this.tileGrid=void 0!==options.tileGrid?options.tileGrid:null;const tileSize=[256,256];this.tileGrid&&(0,ol_size.xq)(this.tileGrid.getTileSize(this.tileGrid.getMinZoom()),tileSize),this.tileCache=new ol_TileCache(options.cacheSize||0),this.tmpSize=[0,0],this.key_=options.key||"",this.tileOptions={transition:options.transition,interpolate:options.interpolate},this.zDirection=options.zDirection?options.zDirection:0}canExpireCache(){return this.tileCache.canExpireCache()}expireCache(projection,usedTiles){const tileCache=this.getTileCacheForProjection(projection);tileCache&&tileCache.expireCache(usedTiles)}forEachLoadedTile(projection,z,tileRange,callback){const tileCache=this.getTileCacheForProjection(projection);if(!tileCache)return!1;let tile,tileCoordKey,loaded,covered=!0;for(let x=tileRange.minX;x<=tileRange.maxX;++x)for(let y=tileRange.minY;y<=tileRange.maxY;++y)tileCoordKey=(0,tilecoord.dp)(z,x,y),loaded=!1,tileCache.containsKey(tileCoordKey)&&(tile=tileCache.get(tileCoordKey),loaded=tile.getState()===TileState_LOADED,loaded&&(loaded=!1!==callback(tile))),loaded||(covered=!1);return covered}getGutterForProjection(projection){return 0}getKey(){return this.key_}setKey(key){this.key_!==key&&(this.key_=key,this.changed())}getOpaque(projection){return this.opaque_}getResolutions(projection){const tileGrid=projection?this.getTileGridForProjection(projection):this.tileGrid;return tileGrid?tileGrid.getResolutions():null}getTile(z,x,y,pixelRatio,projection){return(0,util.b0)()}getTileGrid(){return this.tileGrid}getTileGridForProjection(projection){return this.tileGrid?this.tileGrid:getForProjection(projection)}getTileCacheForProjection(projection){const sourceProjection=this.getProjection();return(0,asserts.v)(null===sourceProjection||(0,ol_proj.tI)(sourceProjection,projection),"A VectorTile source can only be rendered if it has a projection compatible with the view projection."),this.tileCache}getTilePixelRatio(pixelRatio){return this.tilePixelRatio_}getTilePixelSize(z,pixelRatio,projection){const tileGrid=this.getTileGridForProjection(projection),tilePixelRatio=this.getTilePixelRatio(pixelRatio),tileSize=(0,ol_size.xq)(tileGrid.getTileSize(z),this.tmpSize);return 1==tilePixelRatio?tileSize:(0,ol_size.hs)(tileSize,tilePixelRatio,this.tmpSize)}getTileCoordForTileUrlFunction(tileCoord,projection){projection=void 0!==projection?projection:this.getProjection();const tileGrid=this.getTileGridForProjection(projection);return this.getWrapX()&&projection.isGlobal()&&(tileCoord=function wrapX(tileGrid,tileCoord,projection){const z=tileCoord[0],center=tileGrid.getTileCoordCenter(tileCoord),projectionExtent=extentFromProjection(projection);if(!(0,ol_extent.Ym)(projectionExtent,center)){const worldWidth=(0,ol_extent.RG)(projectionExtent),worldsAway=Math.ceil((projectionExtent[0]-center[0])/worldWidth);return center[0]+=worldWidth*worldsAway,tileGrid.getTileCoordForCoordAndZ(center,z)}return tileCoord}(tileGrid,tileCoord,projection)),(0,tilecoord.N5)(tileCoord,tileGrid)?tileCoord:null}clear(){this.tileCache.clear()}refresh(){this.clear(),super.refresh()}updateCacheSize(tileCount,projection){const tileCache=this.getTileCacheForProjection(projection);tileCount>tileCache.highWaterMark&&(tileCache.highWaterMark=tileCount)}useTile(z,x,y,projection){}};function createFromTemplate(template,tileGrid){const zRegEx=/\{z\}/g,xRegEx=/\{x\}/g,yRegEx=/\{y\}/g,dashYRegEx=/\{-y\}/g;return function(tileCoord,pixelRatio,projection){if(tileCoord)return template.replace(zRegEx,tileCoord[0].toString()).replace(xRegEx,tileCoord[1].toString()).replace(yRegEx,tileCoord[2].toString()).replace(dashYRegEx,(function(){const z=tileCoord[0],range=tileGrid.getFullTileRange(z);if(!range)throw new Error("The {-y} placeholder requires a tile grid with extent");return(range.getHeight()-tileCoord[2]-1).toString()}))}}function createFromTemplates(templates,tileGrid){const len=templates.length,tileUrlFunctions=new Array(len);for(let i=0;i<len;++i)tileUrlFunctions[i]=createFromTemplate(templates[i],tileGrid);return createFromTileUrlFunctions(tileUrlFunctions)}function createFromTileUrlFunctions(tileUrlFunctions){return 1===tileUrlFunctions.length?tileUrlFunctions[0]:function(tileCoord,pixelRatio,projection){if(!tileCoord)return;const h=(0,tilecoord.tW)(tileCoord),index=(0,math.xP)(h,tileUrlFunctions.length);return tileUrlFunctions[index](tileCoord,pixelRatio,projection)}}function expandUrl(url){const urls=[];let match=/\{([a-z])-([a-z])\}/.exec(url);if(match){const startCharCode=match[1].charCodeAt(0),stopCharCode=match[2].charCodeAt(0);let charCode;for(charCode=startCharCode;charCode<=stopCharCode;++charCode)urls.push(url.replace(match[0],String.fromCharCode(charCode)));return urls}if(match=/\{(\d+)-(\d+)\}/.exec(url),match){const stop=parseInt(match[2],10);for(let i=parseInt(match[1],10);i<=stop;i++)urls.push(url.replace(match[0],i.toString()));return urls}return urls.push(url),urls}class UrlTile extends source_Tile{constructor(options){super({attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tilePixelRatio:options.tilePixelRatio,wrapX:options.wrapX,transition:options.transition,interpolate:options.interpolate,key:options.key,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection}),this.generateTileUrlFunction_=this.tileUrlFunction===UrlTile.prototype.tileUrlFunction,this.tileLoadFunction=options.tileLoadFunction,options.tileUrlFunction&&(this.tileUrlFunction=options.tileUrlFunction),this.urls=null,options.urls?this.setUrls(options.urls):options.url&&this.setUrl(options.url),this.tileLoadingKeys_={}}getTileLoadFunction(){return this.tileLoadFunction}getTileUrlFunction(){return Object.getPrototypeOf(this).tileUrlFunction===this.tileUrlFunction?this.tileUrlFunction.bind(this):this.tileUrlFunction}getUrls(){return this.urls}handleTileChange(event){const tile=event.target,uid=(0,util.v6)(tile),tileState=tile.getState();let type;tileState==TileState_LOADING?(this.tileLoadingKeys_[uid]=!0,type=TileEventType_TILELOADSTART):uid in this.tileLoadingKeys_&&(delete this.tileLoadingKeys_[uid],type=tileState==TileState_ERROR?TileEventType_TILELOADERROR:tileState==TileState_LOADED?TileEventType_TILELOADEND:void 0),null!=type&&this.dispatchEvent(new TileSourceEvent(type,tile))}setTileLoadFunction(tileLoadFunction){this.tileCache.clear(),this.tileLoadFunction=tileLoadFunction,this.changed()}setTileUrlFunction(tileUrlFunction,key){this.tileUrlFunction=tileUrlFunction,this.tileCache.pruneExceptNewestZ(),void 0!==key?this.setKey(key):this.changed()}setUrl(url){const urls=expandUrl(url);this.urls=urls,this.setUrls(urls)}setUrls(urls){this.urls=urls;const key=urls.join("\n");this.generateTileUrlFunction_?this.setTileUrlFunction(createFromTemplates(urls,this.tileGrid),key):this.setKey(key)}tileUrlFunction(tileCoord,pixelRatio,projection){}useTile(z,x,y){const tileCoordKey=(0,tilecoord.dp)(z,x,y);this.tileCache.containsKey(tileCoordKey)&&this.tileCache.get(tileCoordKey)}}const source_UrlTile=UrlTile;function defaultTileLoadFunction(imageTile,src){imageTile.getImage().src=src}const source_TileImage=class TileImage extends source_UrlTile{constructor(options){super({attributions:options.attributions,cacheSize:options.cacheSize,opaque:options.opaque,projection:options.projection,state:options.state,tileGrid:options.tileGrid,tileLoadFunction:options.tileLoadFunction?options.tileLoadFunction:defaultTileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:options.wrapX,transition:options.transition,interpolate:void 0===options.interpolate||options.interpolate,key:options.key,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection}),this.crossOrigin=void 0!==options.crossOrigin?options.crossOrigin:null,this.tileClass=void 0!==options.tileClass?options.tileClass:ol_ImageTile,this.tileCacheForProjection={},this.tileGridForProjection={},this.reprojectionErrorThreshold_=options.reprojectionErrorThreshold,this.renderReprojectionEdges_=!1}canExpireCache(){if(this.tileCache.canExpireCache())return!0;for(const key in this.tileCacheForProjection)if(this.tileCacheForProjection[key].canExpireCache())return!0;return!1}expireCache(projection,usedTiles){const usedTileCache=this.getTileCacheForProjection(projection);this.tileCache.expireCache(this.tileCache==usedTileCache?usedTiles:{});for(const id in this.tileCacheForProjection){const tileCache=this.tileCacheForProjection[id];tileCache.expireCache(tileCache==usedTileCache?usedTiles:{})}}getGutterForProjection(projection){return this.getProjection()&&projection&&!(0,ol_proj.tI)(this.getProjection(),projection)?0:this.getGutter()}getGutter(){return 0}getKey(){let key=super.getKey();return this.getInterpolate()||(key+=":disable-interpolation"),key}getOpaque(projection){return!(this.getProjection()&&projection&&!(0,ol_proj.tI)(this.getProjection(),projection))&&super.getOpaque(projection)}getTileGridForProjection(projection){const thisProj=this.getProjection();if(this.tileGrid&&(!thisProj||(0,ol_proj.tI)(thisProj,projection)))return this.tileGrid;const projKey=(0,util.v6)(projection);return projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=getForProjection(projection)),this.tileGridForProjection[projKey]}getTileCacheForProjection(projection){const thisProj=this.getProjection();if(!thisProj||(0,ol_proj.tI)(thisProj,projection))return this.tileCache;const projKey=(0,util.v6)(projection);return projKey in this.tileCacheForProjection||(this.tileCacheForProjection[projKey]=new ol_TileCache(this.tileCache.highWaterMark)),this.tileCacheForProjection[projKey]}createTile_(z,x,y,pixelRatio,projection,key){const tileCoord=[z,x,y],urlTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),tileUrl=urlTileCoord?this.tileUrlFunction(urlTileCoord,pixelRatio,projection):void 0,tile=new this.tileClass(tileCoord,void 0!==tileUrl?TileState_IDLE:TileState_EMPTY,void 0!==tileUrl?tileUrl:"",this.crossOrigin,this.tileLoadFunction,this.tileOptions);return tile.key=key,tile.addEventListener(EventType.A.CHANGE,this.handleTileChange.bind(this)),tile}getTile(z,x,y,pixelRatio,projection){const sourceProjection=this.getProjection();if(!sourceProjection||!projection||(0,ol_proj.tI)(sourceProjection,projection))return this.getTileInternal(z,x,y,pixelRatio,sourceProjection||projection);const cache=this.getTileCacheForProjection(projection),tileCoord=[z,x,y];let tile;const tileCoordKey=(0,tilecoord.i7)(tileCoord);cache.containsKey(tileCoordKey)&&(tile=cache.get(tileCoordKey));const key=this.getKey();if(tile&&tile.key==key)return tile;const sourceTileGrid=this.getTileGridForProjection(sourceProjection),targetTileGrid=this.getTileGridForProjection(projection),wrappedTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection),newTile=new reproj_Tile(sourceProjection,sourceTileGrid,projection,targetTileGrid,tileCoord,wrappedTileCoord,this.getTilePixelRatio(pixelRatio),this.getGutter(),((z,x,y,pixelRatio)=>this.getTileInternal(z,x,y,pixelRatio,sourceProjection)),this.reprojectionErrorThreshold_,this.renderReprojectionEdges_,this.tileOptions);return newTile.key=key,tile?(newTile.interimTile=tile,newTile.refreshInterimChain(),cache.replace(tileCoordKey,newTile)):cache.set(tileCoordKey,newTile),newTile}getTileInternal(z,x,y,pixelRatio,projection){let tile=null;const tileCoordKey=(0,tilecoord.dp)(z,x,y),key=this.getKey();if(this.tileCache.containsKey(tileCoordKey)){if(tile=this.tileCache.get(tileCoordKey),tile.key!=key){const interimTile=tile;tile=this.createTile_(z,x,y,pixelRatio,projection,key),interimTile.getState()==TileState_IDLE?tile.interimTile=interimTile.interimTile:tile.interimTile=interimTile,tile.refreshInterimChain(),this.tileCache.replace(tileCoordKey,tile)}}else tile=this.createTile_(z,x,y,pixelRatio,projection,key),this.tileCache.set(tileCoordKey,tile);return tile}setRenderReprojectionEdges(render){if(this.renderReprojectionEdges_!=render){this.renderReprojectionEdges_=render;for(const id in this.tileCacheForProjection)this.tileCacheForProjection[id].clear();this.changed()}}setTileGridForProjection(projection,tilegrid){const proj=(0,ol_proj.Jt)(projection);if(proj){const projKey=(0,util.v6)(proj);projKey in this.tileGridForProjection||(this.tileGridForProjection[projKey]=tilegrid)}}clear(){super.clear();for(const id in this.tileCacheForProjection)this.tileCacheForProjection[id].clear()}};const source_XYZ=class XYZ extends source_TileImage{constructor(options){const projection=void 0!==(options=options||{}).projection?options.projection:"EPSG:3857",tileGrid=void 0!==options.tileGrid?options.tileGrid:createXYZ({extent:extentFromProjection(projection),maxResolution:options.maxResolution,maxZoom:options.maxZoom,minZoom:options.minZoom,tileSize:options.tileSize});super({attributions:options.attributions,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,interpolate:options.interpolate,opaque:options.opaque,projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileGrid,tileLoadFunction:options.tileLoadFunction,tilePixelRatio:options.tilePixelRatio,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,attributionsCollapsible:options.attributionsCollapsible,zDirection:options.zDirection}),this.gutter_=void 0!==options.gutter?options.gutter:0}getGutter(){return this.gutter_}};function appendParams(uri,params){const keyParams=[];Object.keys(params).forEach((function(k){null!==params[k]&&void 0!==params[k]&&keyParams.push(k+"="+encodeURIComponent(params[k]))}));const qs=keyParams.join("&");return uri=uri.replace(/[?&]$/,""),(uri+=uri.includes("?")?"&":"?")+qs}function compareVersions(v1,v2){const s1=(""+v1).split("."),s2=(""+v2).split(".");for(let i=0;i<Math.max(s1.length,s2.length);i++){const n1=parseInt(s1[i]||"0",10),n2=parseInt(s2[i]||"0",10);if(n1>n2)return 1;if(n2>n1)return-1}return 0}function fromResolutionLike(resolution){return Array.isArray(resolution)?Math.min(...resolution):resolution}const reproj_Image=class ReprojImage extends ol_Image{constructor(sourceProj,targetProj,targetExtent,targetResolution,pixelRatio,getImageFunction,interpolate){let maxSourceExtent=sourceProj.getExtent();maxSourceExtent&&sourceProj.canWrapX()&&(maxSourceExtent=maxSourceExtent.slice(),maxSourceExtent[0]=-1/0,maxSourceExtent[2]=1/0);let maxTargetExtent=targetProj.getExtent();maxTargetExtent&&targetProj.canWrapX()&&(maxTargetExtent=maxTargetExtent.slice(),maxTargetExtent[0]=-1/0,maxTargetExtent[2]=1/0);const limitedTargetExtent=maxTargetExtent?(0,ol_extent._N)(targetExtent,maxTargetExtent):targetExtent,sourceResolution=calculateSourceResolution(sourceProj,targetProj,(0,ol_extent.q1)(limitedTargetExtent),targetResolution),triangulation=new reproj_Triangulation(sourceProj,targetProj,limitedTargetExtent,maxSourceExtent,.5*sourceResolution,targetResolution),sourceExtent=triangulation.calculateSourceExtent(),sourceImage=(0,ol_extent.Im)(sourceExtent)?null:getImageFunction(sourceExtent,sourceResolution,pixelRatio),state=sourceImage?ImageState.A.IDLE:ImageState.A.EMPTY,sourcePixelRatio=sourceImage?sourceImage.getPixelRatio():1;super(targetExtent,targetResolution,sourcePixelRatio,state),this.targetProj_=targetProj,this.maxSourceExtent_=maxSourceExtent,this.triangulation_=triangulation,this.targetResolution_=targetResolution,this.targetExtent_=targetExtent,this.sourceImage_=sourceImage,this.sourcePixelRatio_=sourcePixelRatio,this.interpolate_=interpolate,this.canvas_=null,this.sourceListenerKey_=null}disposeInternal(){this.state==ImageState.A.LOADING&&this.unlistenSource_(),super.disposeInternal()}getImage(){return this.canvas_}getProjection(){return this.targetProj_}reproject_(){const sourceState=this.sourceImage_.getState();if(sourceState==ImageState.A.LOADED){const width=(0,ol_extent.RG)(this.targetExtent_)/this.targetResolution_,height=(0,ol_extent.Oq)(this.targetExtent_)/this.targetResolution_;this.canvas_=render(width,height,this.sourcePixelRatio_,fromResolutionLike(this.sourceImage_.getResolution()),this.maxSourceExtent_,this.targetResolution_,this.targetExtent_,this.triangulation_,[{extent:this.sourceImage_.getExtent(),image:this.sourceImage_.getImage()}],0,void 0,this.interpolate_,!0)}this.state=sourceState,this.changed()}load(){if(this.state==ImageState.A.IDLE){this.state=ImageState.A.LOADING,this.changed();const sourceState=this.sourceImage_.getState();sourceState==ImageState.A.LOADED||sourceState==ImageState.A.ERROR?this.reproject_():(this.sourceListenerKey_=(0,events.KT)(this.sourceImage_,EventType.A.CHANGE,(function(e){const sourceState=this.sourceImage_.getState();sourceState!=ImageState.A.LOADED&&sourceState!=ImageState.A.ERROR||(this.unlistenSource_(),this.reproject_())}),this),this.sourceImage_.load())}}unlistenSource_(){(0,events.JH)(this.sourceListenerKey_),this.sourceListenerKey_=null}},ImageSourceEventType_IMAGELOADSTART="imageloadstart",ImageSourceEventType_IMAGELOADEND="imageloadend",ImageSourceEventType_IMAGELOADERROR="imageloaderror";class ImageSourceEvent extends Event.Ay{constructor(type,image){super(type),this.image=image}}function defaultImageLoadFunction(image,src){image.getImage().src=src}function getRequestExtent(extent,resolution,pixelRatio,ratio){const imageResolution=resolution/pixelRatio,center=(0,ol_extent.q1)(extent),viewWidth=(0,math.mk)((0,ol_extent.RG)(extent)/imageResolution,4),viewHeight=(0,math.mk)((0,ol_extent.Oq)(extent)/imageResolution,4),requestWidth=viewWidth+2*(0,math.mk)((ratio-1)*viewWidth/2,4),requestHeight=viewHeight+2*(0,math.mk)((ratio-1)*viewHeight/2,4);return(0,ol_extent.Bg)(center,imageResolution,0,[requestWidth,requestHeight])}const source_Image=class ImageSource extends source_Source{constructor(options){super({attributions:options.attributions,projection:options.projection,state:options.state,interpolate:void 0===options.interpolate||options.interpolate}),this.on,this.once,this.un,this.loader=options.loader||null,this.resolutions_=void 0!==options.resolutions?options.resolutions:null,this.reprojectedImage_=null,this.reprojectedRevision_=0,this.image=null,this.wantedExtent_,this.wantedResolution_,this.static_=!!options.loader&&0===options.loader.length,this.wantedProjection_=null}getResolutions(){return this.resolutions_}setResolutions(resolutions){this.resolutions_=resolutions}findNearestResolution(resolution){const resolutions=this.getResolutions();if(resolutions){resolution=resolutions[(0,array.FT)(resolutions,resolution,0)]}return resolution}getImage(extent,resolution,pixelRatio,projection){const sourceProjection=this.getProjection();if(!sourceProjection||!projection||(0,ol_proj.tI)(sourceProjection,projection))return sourceProjection&&(projection=sourceProjection),this.getImageInternal(extent,resolution,pixelRatio,projection);if(this.reprojectedImage_){if(this.reprojectedRevision_==this.getRevision()&&(0,ol_proj.tI)(this.reprojectedImage_.getProjection(),projection)&&this.reprojectedImage_.getResolution()==resolution&&(0,ol_extent.aI)(this.reprojectedImage_.getExtent(),extent))return this.reprojectedImage_;this.reprojectedImage_.dispose(),this.reprojectedImage_=null}return this.reprojectedImage_=new reproj_Image(sourceProjection,projection,extent,resolution,pixelRatio,((extent,resolution,pixelRatio)=>this.getImageInternal(extent,resolution,pixelRatio,sourceProjection)),this.getInterpolate()),this.reprojectedRevision_=this.getRevision(),this.reprojectedImage_}getImageInternal(extent,resolution,pixelRatio,projection){if(this.loader){const requestExtent=getRequestExtent(extent,resolution,pixelRatio,1),requestResolution=this.findNearestResolution(resolution);if(this.image&&(this.static_||this.wantedProjection_===projection&&(this.wantedExtent_&&(0,ol_extent.ms)(this.wantedExtent_,requestExtent)||(0,ol_extent.ms)(this.image.getExtent(),requestExtent))&&(this.wantedResolution_&&fromResolutionLike(this.wantedResolution_)===requestResolution||fromResolutionLike(this.image.getResolution())===requestResolution)))return this.image;this.wantedProjection_=projection,this.wantedExtent_=requestExtent,this.wantedResolution_=requestResolution,this.image=new ol_Image(requestExtent,requestResolution,pixelRatio,this.loader),this.image.addEventListener(EventType.A.CHANGE,this.handleImageChange.bind(this))}return this.image}handleImageChange(event){const image=event.target;let type;switch(image.getState()){case ImageState.A.LOADING:this.loading=!0,type=ImageSourceEventType_IMAGELOADSTART;break;case ImageState.A.LOADED:this.loading=!1,type=ImageSourceEventType_IMAGELOADEND;break;case ImageState.A.ERROR:this.loading=!1,type=ImageSourceEventType_IMAGELOADERROR;break;default:return}this.hasListener(type)&&this.dispatchEvent(new ImageSourceEvent(type,image))}},GETFEATUREINFO_IMAGE_SIZE=[101,101];function getRequestUrl(baseUrl,extent,size,projection,params){params.WIDTH=size[0],params.HEIGHT=size[1];const axisOrientation=projection.getAxisOrientation();let bbox;const v13=compareVersions(params.VERSION,"1.3")>=0;return params[v13?"CRS":"SRS"]=projection.getCode(),bbox=v13&&"ne"==axisOrientation.substr(0,2)?[extent[1],extent[0],extent[3],extent[2]]:extent,params.BBOX=bbox.join(","),appendParams(baseUrl,params)}function getImageSrc(extent,resolution,pixelRatio,projection,url,params,serverType){params=Object.assign({REQUEST:"GetMap"},params);const imageResolution=resolution/pixelRatio,imageSize=[(0,math.LI)((0,ol_extent.RG)(extent)/imageResolution,4),(0,math.LI)((0,ol_extent.Oq)(extent)/imageResolution,4)];if(1!=pixelRatio)switch(serverType){case"geoserver":const dpi=90*pixelRatio+.5|0;"FORMAT_OPTIONS"in params?params.FORMAT_OPTIONS+=";dpi:"+dpi:params.FORMAT_OPTIONS="dpi:"+dpi;break;case"mapserver":params.MAP_RESOLUTION=90*pixelRatio;break;case"carmentaserver":case"qgis":params.DPI=90*pixelRatio;break;default:throw new Error("Unknown `serverType` configured")}return getRequestUrl(url,extent,imageSize,projection,params)}function getRequestParams(params,request){return Object.assign({REQUEST:request,SERVICE:"WMS",VERSION:"1.3.0",FORMAT:"image/png",STYLES:"",TRANSPARENT:!0},params)}const source_TileWMS=class TileWMS extends source_TileImage{constructor(options){options=options||{};const params=Object.assign({},options.params),transparent=!("TRANSPARENT"in params)||params.TRANSPARENT;super({attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,interpolate:options.interpolate,opaque:!transparent,projection:options.projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileClass:options.tileClass,tileGrid:options.tileGrid,tileLoadFunction:options.tileLoadFunction,url:options.url,urls:options.urls,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,zDirection:options.zDirection}),this.gutter_=void 0!==options.gutter?options.gutter:0,this.params_=params,this.v13_=!0,this.serverType_=options.serverType,this.hidpi_=void 0===options.hidpi||options.hidpi,this.tmpExtent_=(0,ol_extent.S5)(),this.updateV13_(),this.setKey(this.getKeyForParams_())}getFeatureInfoUrl(coordinate,resolution,projection,params){const projectionObj=(0,ol_proj.Jt)(projection),sourceProjectionObj=this.getProjection()||projectionObj;let tileGrid=this.getTileGrid();tileGrid||(tileGrid=this.getTileGridForProjection(sourceProjectionObj));const sourceProjCoord=(0,ol_proj.pd)(coordinate,projectionObj,sourceProjectionObj),sourceResolution=calculateSourceResolution(sourceProjectionObj,projectionObj,coordinate,resolution),z=tileGrid.getZForResolution(sourceResolution,this.zDirection),tileResolution=tileGrid.getResolution(z),tileCoord=tileGrid.getTileCoordForCoordAndZ(sourceProjCoord,z);if(tileGrid.getResolutions().length<=tileCoord[0])return;let tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent_);const gutter=this.gutter_;0!==gutter&&(tileExtent=(0,ol_extent.r)(tileExtent,tileResolution*gutter,tileExtent));const baseParams={QUERY_LAYERS:this.params_.LAYERS};Object.assign(baseParams,getRequestParams(this.params_,"GetFeatureInfo"),params);const x=Math.floor((sourceProjCoord[0]-tileExtent[0])/tileResolution),y=Math.floor((tileExtent[3]-sourceProjCoord[1])/tileResolution);return baseParams[this.v13_?"I":"X"]=x,baseParams[this.v13_?"J":"Y"]=y,this.getRequestUrl_(tileCoord,tileExtent,1,sourceProjectionObj||projectionObj,baseParams)}getLegendUrl(resolution,params){if(void 0===this.urls[0])return;const baseParams={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===params||void 0===params.LAYER){const layers=this.params_.LAYERS;if(!(!Array.isArray(layers)||1===layers.length))return;baseParams.LAYER=layers}if(void 0!==resolution){const mpu=this.getProjection()?this.getProjection().getMetersPerUnit():1,pixelSize=28e-5;baseParams.SCALE=resolution*mpu/pixelSize}return Object.assign(baseParams,params),appendParams(this.urls[0],baseParams)}getGutter(){return this.gutter_}getParams(){return this.params_}getRequestUrl_(tileCoord,tileExtent,pixelRatio,projection,params){const urls=this.urls;if(!urls)return;let url;if(1==urls.length)url=urls[0];else{url=urls[(0,math.xP)((0,tilecoord.tW)(tileCoord),urls.length)]}return getImageSrc(tileExtent,(this.tileGrid||this.getTileGridForProjection(projection)).getResolution(tileCoord[0]),pixelRatio,projection,url,params,this.serverType_)}getTilePixelRatio(pixelRatio){return this.hidpi_&&void 0!==this.serverType_?pixelRatio:1}getKeyForParams_(){let i=0;const res=[];for(const key in this.params_)res[i++]=key+"-"+this.params_[key];return res.join("/")}updateParams(params){Object.assign(this.params_,params),this.updateV13_(),this.setKey(this.getKeyForParams_())}updateV13_(){const version=this.params_.VERSION||"1.3.0";this.v13_=compareVersions(version,"1.3")>=0}tileUrlFunction(tileCoord,pixelRatio,projection){let tileGrid=this.getTileGrid();if(tileGrid||(tileGrid=this.getTileGridForProjection(projection)),tileGrid.getResolutions().length<=tileCoord[0])return;1==pixelRatio||this.hidpi_&&void 0!==this.serverType_||(pixelRatio=1);const tileResolution=tileGrid.getResolution(tileCoord[0]);let tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent_);const gutter=this.gutter_;0!==gutter&&(tileExtent=(0,ol_extent.r)(tileExtent,tileResolution*gutter,tileExtent));const baseParams=Object.assign({},getRequestParams(this.params_,"GetMap"));return this.getRequestUrl_(tileCoord,tileExtent,pixelRatio,projection,baseParams)}};var rbush_min=__webpack_require__("./node_modules/rbush/rbush.min.js"),rbush_min_default=__webpack_require__.n(rbush_min),style_Image=__webpack_require__("./node_modules/ol/style/Image.js");let taintedTestContext=null;class IconImage extends Target.A{constructor(image,src,crossOrigin,imageState,color){super(),this.hitDetectionImage_=null,this.image_=image,this.crossOrigin_=crossOrigin,this.canvas_={},this.color_=color,this.imageState_=void 0===imageState?ImageState.A.IDLE:imageState,this.size_=image&&image.width&&image.height?[image.width,image.height]:null,this.src_=src,this.tainted_}initializeImage_(){this.image_=new Image,null!==this.crossOrigin_&&(this.image_.crossOrigin=this.crossOrigin_)}isTainted_(){if(void 0===this.tainted_&&this.imageState_===ImageState.A.LOADED){taintedTestContext||(taintedTestContext=(0,dom.Y)(1,1,void 0,{willReadFrequently:!0})),taintedTestContext.drawImage(this.image_,0,0);try{taintedTestContext.getImageData(0,0,1,1),this.tainted_=!1}catch(e){taintedTestContext=null,this.tainted_=!0}}return!0===this.tainted_}dispatchChangeEvent_(){this.dispatchEvent(EventType.A.CHANGE)}handleImageError_(){this.imageState_=ImageState.A.ERROR,this.dispatchChangeEvent_()}handleImageLoad_(){this.imageState_=ImageState.A.LOADED,this.size_=[this.image_.width,this.image_.height],this.dispatchChangeEvent_()}getImage(pixelRatio){return this.image_||this.initializeImage_(),this.replaceColor_(pixelRatio),this.canvas_[pixelRatio]?this.canvas_[pixelRatio]:this.image_}getPixelRatio(pixelRatio){return this.replaceColor_(pixelRatio),this.canvas_[pixelRatio]?pixelRatio:1}getImageState(){return this.imageState_}getHitDetectionImage(){if(this.image_||this.initializeImage_(),!this.hitDetectionImage_)if(this.isTainted_()){const width=this.size_[0],height=this.size_[1],context=(0,dom.Y)(width,height);context.fillRect(0,0,width,height),this.hitDetectionImage_=context.canvas}else this.hitDetectionImage_=this.image_;return this.hitDetectionImage_}getSize(){return this.size_}getSrc(){return this.src_}load(){if(this.imageState_===ImageState.A.IDLE){this.image_||this.initializeImage_(),this.imageState_=ImageState.A.LOADING;try{void 0!==this.src_&&(this.image_.src=this.src_)}catch(e){this.handleImageError_()}this.image_ instanceof HTMLImageElement&&decodeFallback(this.image_,this.src_).then((image=>{this.image_=image,this.handleImageLoad_()})).catch(this.handleImageError_.bind(this))}}replaceColor_(pixelRatio){if(!this.color_||this.canvas_[pixelRatio]||this.imageState_!==ImageState.A.LOADED)return;const image=this.image_,canvas=document.createElement("canvas");canvas.width=Math.ceil(image.width*pixelRatio),canvas.height=Math.ceil(image.height*pixelRatio);const ctx=canvas.getContext("2d");ctx.scale(pixelRatio,pixelRatio),ctx.drawImage(image,0,0),ctx.globalCompositeOperation="multiply",ctx.fillStyle=(0,ol_color.oJ)(this.color_),ctx.fillRect(0,0,canvas.width/pixelRatio,canvas.height/pixelRatio),ctx.globalCompositeOperation="destination-in",ctx.drawImage(image,0,0),this.canvas_[pixelRatio]=canvas}}function calculateScale(width,height,wantedWidth,wantedHeight){return void 0!==wantedWidth&&void 0!==wantedHeight?[wantedWidth/width,wantedHeight/height]:void 0!==wantedWidth?wantedWidth/width:void 0!==wantedHeight?wantedHeight/height:1}class Icon extends style_Image.A{constructor(options){const opacity=void 0!==(options=options||{}).opacity?options.opacity:1,rotation=void 0!==options.rotation?options.rotation:0,scale=void 0!==options.scale?options.scale:1,rotateWithView=void 0!==options.rotateWithView&&options.rotateWithView;super({opacity,rotation,scale,displacement:void 0!==options.displacement?options.displacement:[0,0],rotateWithView,declutterMode:options.declutterMode}),this.anchor_=void 0!==options.anchor?options.anchor:[.5,.5],this.normalizedAnchor_=null,this.anchorOrigin_=void 0!==options.anchorOrigin?options.anchorOrigin:"top-left",this.anchorXUnits_=void 0!==options.anchorXUnits?options.anchorXUnits:"fraction",this.anchorYUnits_=void 0!==options.anchorYUnits?options.anchorYUnits:"fraction",this.crossOrigin_=void 0!==options.crossOrigin?options.crossOrigin:null;const image=void 0!==options.img?options.img:null;let imageState,cacheKey=options.src;if((0,asserts.v)(!(void 0!==cacheKey&&image),"`image` and `src` cannot be provided at the same time"),void 0!==cacheKey&&0!==cacheKey.length||!image||(cacheKey=image.src||(0,util.v6)(image)),(0,asserts.v)(void 0!==cacheKey&&cacheKey.length>0,"A defined and non-empty `src` or `image` must be provided"),(0,asserts.v)(!((void 0!==options.width||void 0!==options.height)&&void 0!==options.scale),"`width` or `height` cannot be provided together with `scale`"),void 0!==options.src?imageState=ImageState.A.IDLE:void 0!==image&&(imageState=image instanceof HTMLImageElement?image.complete?image.src?ImageState.A.LOADED:ImageState.A.IDLE:ImageState.A.LOADING:ImageState.A.LOADED),this.color_=void 0!==options.color?(0,ol_color._j)(options.color):null,this.iconImage_=function get(image,cacheKey,crossOrigin,imageState,color){let iconImage=void 0===cacheKey?void 0:shared.get(cacheKey,crossOrigin,color);return iconImage||(iconImage=new IconImage(image,image instanceof HTMLImageElement?image.src||void 0:cacheKey,crossOrigin,imageState,color),shared.set(cacheKey,crossOrigin,color,iconImage)),iconImage}(image,cacheKey,this.crossOrigin_,imageState,this.color_),this.offset_=void 0!==options.offset?options.offset:[0,0],this.offsetOrigin_=void 0!==options.offsetOrigin?options.offsetOrigin:"top-left",this.origin_=null,this.size_=void 0!==options.size?options.size:null,void 0!==options.width||void 0!==options.height){let width,height;if(options.size)[width,height]=options.size;else{const image=this.getImage(1);if(image.width&&image.height)width=image.width,height=image.height;else if(image instanceof HTMLImageElement){this.initialOptions_=options;const onload=()=>{if(this.unlistenImageChange(onload),!this.initialOptions_)return;const imageSize=this.iconImage_.getSize();this.setScale(calculateScale(imageSize[0],imageSize[1],options.width,options.height))};return void this.listenImageChange(onload)}}void 0!==width&&this.setScale(calculateScale(width,height,options.width,options.height))}}clone(){let scale,width,height;return this.initialOptions_?(width=this.initialOptions_.width,height=this.initialOptions_.height):(scale=this.getScale(),scale=Array.isArray(scale)?scale.slice():scale),new Icon({anchor:this.anchor_.slice(),anchorOrigin:this.anchorOrigin_,anchorXUnits:this.anchorXUnits_,anchorYUnits:this.anchorYUnits_,color:this.color_&&this.color_.slice?this.color_.slice():this.color_||void 0,crossOrigin:this.crossOrigin_,offset:this.offset_.slice(),offsetOrigin:this.offsetOrigin_,opacity:this.getOpacity(),rotateWithView:this.getRotateWithView(),rotation:this.getRotation(),scale,width,height,size:null!==this.size_?this.size_.slice():void 0,src:this.getSrc(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getAnchor(){let anchor=this.normalizedAnchor_;if(!anchor){anchor=this.anchor_;const size=this.getSize();if("fraction"==this.anchorXUnits_||"fraction"==this.anchorYUnits_){if(!size)return null;anchor=this.anchor_.slice(),"fraction"==this.anchorXUnits_&&(anchor[0]*=size[0]),"fraction"==this.anchorYUnits_&&(anchor[1]*=size[1])}if("top-left"!=this.anchorOrigin_){if(!size)return null;anchor===this.anchor_&&(anchor=this.anchor_.slice()),"top-right"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(anchor[0]=-anchor[0]+size[0]),"bottom-left"!=this.anchorOrigin_&&"bottom-right"!=this.anchorOrigin_||(anchor[1]=-anchor[1]+size[1])}this.normalizedAnchor_=anchor}const displacement=this.getDisplacement(),scale=this.getScaleArray();return[anchor[0]-displacement[0]/scale[0],anchor[1]+displacement[1]/scale[1]]}setAnchor(anchor){this.anchor_=anchor,this.normalizedAnchor_=null}getColor(){return this.color_}getImage(pixelRatio){return this.iconImage_.getImage(pixelRatio)}getPixelRatio(pixelRatio){return this.iconImage_.getPixelRatio(pixelRatio)}getImageSize(){return this.iconImage_.getSize()}getImageState(){return this.iconImage_.getImageState()}getHitDetectionImage(){return this.iconImage_.getHitDetectionImage()}getOrigin(){if(this.origin_)return this.origin_;let offset=this.offset_;if("top-left"!=this.offsetOrigin_){const size=this.getSize(),iconImageSize=this.iconImage_.getSize();if(!size||!iconImageSize)return null;offset=offset.slice(),"top-right"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(offset[0]=iconImageSize[0]-size[0]-offset[0]),"bottom-left"!=this.offsetOrigin_&&"bottom-right"!=this.offsetOrigin_||(offset[1]=iconImageSize[1]-size[1]-offset[1])}return this.origin_=offset,this.origin_}getSrc(){return this.iconImage_.getSrc()}getSize(){return this.size_?this.size_:this.iconImage_.getSize()}getWidth(){const scale=this.getScaleArray();return this.size_?this.size_[0]*scale[0]:this.iconImage_.getImageState()==ImageState.A.LOADED?this.iconImage_.getSize()[0]*scale[0]:void 0}getHeight(){const scale=this.getScaleArray();return this.size_?this.size_[1]*scale[1]:this.iconImage_.getImageState()==ImageState.A.LOADED?this.iconImage_.getSize()[1]*scale[1]:void 0}setScale(scale){delete this.initialOptions_,super.setScale(scale)}listenImageChange(listener){this.iconImage_.addEventListener(EventType.A.CHANGE,listener)}load(){this.iconImage_.load()}unlistenImageChange(listener){this.iconImage_.removeEventListener(EventType.A.CHANGE,listener)}}const style_Icon=Icon;var RegularShape=__webpack_require__("./node_modules/ol/style/RegularShape.js");class Text{constructor(options){options=options||{},this.font_=options.font,this.rotation_=options.rotation,this.rotateWithView_=options.rotateWithView,this.scale_=options.scale,this.scaleArray_=(0,ol_size.xq)(void 0!==options.scale?options.scale:1),this.text_=options.text,this.textAlign_=options.textAlign,this.justify_=options.justify,this.repeat_=options.repeat,this.textBaseline_=options.textBaseline,this.fill_=void 0!==options.fill?options.fill:new Fill.A({color:"#333"}),this.maxAngle_=void 0!==options.maxAngle?options.maxAngle:Math.PI/4,this.placement_=void 0!==options.placement?options.placement:"point",this.overflow_=!!options.overflow,this.stroke_=void 0!==options.stroke?options.stroke:null,this.offsetX_=void 0!==options.offsetX?options.offsetX:0,this.offsetY_=void 0!==options.offsetY?options.offsetY:0,this.backgroundFill_=options.backgroundFill?options.backgroundFill:null,this.backgroundStroke_=options.backgroundStroke?options.backgroundStroke:null,this.padding_=void 0===options.padding?null:options.padding}clone(){const scale=this.getScale();return new Text({font:this.getFont(),placement:this.getPlacement(),repeat:this.getRepeat(),maxAngle:this.getMaxAngle(),overflow:this.getOverflow(),rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(scale)?scale.slice():scale,text:this.getText(),textAlign:this.getTextAlign(),justify:this.getJustify(),textBaseline:this.getTextBaseline(),fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,offsetX:this.getOffsetX(),offsetY:this.getOffsetY(),backgroundFill:this.getBackgroundFill()?this.getBackgroundFill().clone():void 0,backgroundStroke:this.getBackgroundStroke()?this.getBackgroundStroke().clone():void 0,padding:this.getPadding()||void 0})}getOverflow(){return this.overflow_}getFont(){return this.font_}getMaxAngle(){return this.maxAngle_}getPlacement(){return this.placement_}getRepeat(){return this.repeat_}getOffsetX(){return this.offsetX_}getOffsetY(){return this.offsetY_}getFill(){return this.fill_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getStroke(){return this.stroke_}getText(){return this.text_}getTextAlign(){return this.textAlign_}getJustify(){return this.justify_}getTextBaseline(){return this.textBaseline_}getBackgroundFill(){return this.backgroundFill_}getBackgroundStroke(){return this.backgroundStroke_}getPadding(){return this.padding_}setOverflow(overflow){this.overflow_=overflow}setFont(font){this.font_=font}setMaxAngle(maxAngle){this.maxAngle_=maxAngle}setOffsetX(offsetX){this.offsetX_=offsetX}setOffsetY(offsetY){this.offsetY_=offsetY}setPlacement(placement){this.placement_=placement}setRepeat(repeat){this.repeat_=repeat}setRotateWithView(rotateWithView){this.rotateWithView_=rotateWithView}setFill(fill){this.fill_=fill}setRotation(rotation){this.rotation_=rotation}setScale(scale){this.scale_=scale,this.scaleArray_=(0,ol_size.xq)(void 0!==scale?scale:1)}setStroke(stroke){this.stroke_=stroke}setText(text){this.text_=text}setTextAlign(textAlign){this.textAlign_=textAlign}setJustify(justify){this.justify_=justify}setTextBaseline(textBaseline){this.textBaseline_=textBaseline}setBackgroundFill(fill){this.backgroundFill_=fill}setBackgroundStroke(stroke){this.backgroundStroke_=stroke}setPadding(padding){this.padding_=padding}}const style_Text=Text;let numTypes=0;const BooleanType=1<<numTypes++,NumberType=1<<numTypes++,StringType=1<<numTypes++,ColorType=1<<numTypes++,NumberArrayType=1<<numTypes++,AnyType=Math.pow(2,5)-1,typeNames={[BooleanType]:"boolean",[NumberType]:"number",[StringType]:"string",[ColorType]:"color",[NumberArrayType]:"number[]"},namedTypes=Object.keys(typeNames).map(Number).sort(array.V_);function typeName(type){const names=[];for(const namedType of namedTypes)(type&(specific=namedType))===specific&&names.push(typeNames[namedType]);var specific;return 0===names.length?"untyped":names.length<3?names.join(" or "):names.slice(0,-1).join(", ")+", or "+names[names.length-1]}function overlapsType(oneType,otherType){return!!(oneType&otherType)}function isType(type,expected){return type===expected}class LiteralExpression{constructor(type,value){this.type=type,this.value=value}}class CallExpression{constructor(type,operator,...args){this.type=type,this.operator=operator,this.args=args}}function newParsingContext(){return{variables:new Set,properties:new Set,featureId:!1,style:{}}}function parse(encoded,context,typeHint){switch(typeof encoded){case"boolean":return new LiteralExpression(BooleanType,encoded);case"number":return new LiteralExpression(NumberType,encoded);case"string":{let type=StringType;return(0,ol_color.$C)(encoded)&&(type|=ColorType),isType(type&typeHint,0)||(type&=typeHint),new LiteralExpression(type,encoded)}}if(!Array.isArray(encoded))throw new Error("Expression must be an array or a primitive value");if(0===encoded.length)throw new Error("Empty expression");if("string"==typeof encoded[0])return function parseCallExpression(encoded,context,typeHint){const operator=encoded[0],parser=parsers[operator];if(!parser)throw new Error(`Unknown operator: ${operator}`);return parser(encoded,context,typeHint)}(encoded,context,typeHint);for(const item of encoded)if("number"!=typeof item)throw new Error("Expected an array of numbers");let type=NumberArrayType;return 3!==encoded.length&&4!==encoded.length||(type|=ColorType),typeHint&&(type&=typeHint),new LiteralExpression(type,encoded)}const Ops_Get="get",Ops_Var="var",Ops_Concat="concat",Ops_GeometryType="geometry-type",Ops_Any="any",Ops_All="all",Ops_Not="!",Ops_Resolution="resolution",Ops_Zoom="zoom",Ops_Time="time",Ops_Equal="==",Ops_NotEqual="!=",Ops_GreaterThan=">",Ops_GreaterThanOrEqualTo=">=",Ops_LessThan="<",Ops_LessThanOrEqualTo="<=",Ops_Multiply="*",Ops_Divide="/",Ops_Add="+",Ops_Subtract="-",Ops_Clamp="clamp",Ops_Mod="%",Ops_Pow="^",Ops_Abs="abs",Ops_Floor="floor",Ops_Ceil="ceil",Ops_Round="round",Ops_Sin="sin",Ops_Cos="cos",Ops_Atan="atan",Ops_Sqrt="sqrt",Ops_Match="match",Ops_Between="between",Ops_Interpolate="interpolate",Ops_Case="case",Ops_In="in",Ops_Number="number",Ops_String="string",Ops_Array="array",Ops_Color="color",Ops_Id="id",Ops_Band="band",Ops_Palette="palette",parsers={[Ops_Get]:createParser((([_,typeHint])=>void 0!==typeHint?function getTypeFromHint(typeHint){switch(typeHint){case"string":return StringType;case"color":return ColorType;case"number":return NumberType;case"boolean":return BooleanType;case"number[]":return NumberArrayType;default:throw new Error(`Unrecognized type hint: ${typeHint}`)}}(typeHint.value):AnyType),withArgsCount(1,2),(function withGetArgs(encoded,context){const arg=parse(encoded[1],context);if(!(arg instanceof LiteralExpression))throw new Error("Expected a literal argument for get operation");if("string"!=typeof arg.value)throw new Error("Expected a string argument for get operation");if(context.properties.add(arg.value),3===encoded.length){return[arg,parse(encoded[2],context)]}return[arg]})),[Ops_Var]:createParser((([firstArg])=>firstArg.type),withArgsCount(1,1),(function withVarArgs(encoded,context,parsedArgs,typeHint){const varName=encoded[1];if("string"!=typeof varName)throw new Error("Expected a string argument for var operation");if(context.variables.add(varName),!("variables"in context.style)||void 0===context.style.variables[varName])return[new LiteralExpression(AnyType,varName)];const arg=parse(context.style.variables[varName],context);if(arg.value=varName,typeHint&&!overlapsType(typeHint,arg.type))throw new Error(`The variable ${varName} has type ${typeName(arg.type)} but the following type was expected: ${typeName(typeHint)}`);return[arg]})),[Ops_Id]:createParser(NumberType|StringType,withNoArgs,(function usesFeatureId(encoded,context){context.featureId=!0})),[Ops_Concat]:createParser(StringType,withArgsCount(2,1/0),parseArgsOfType(AnyType)),[Ops_GeometryType]:createParser(StringType,withNoArgs),[Ops_Resolution]:createParser(NumberType,withNoArgs),[Ops_Zoom]:createParser(NumberType,withNoArgs),[Ops_Time]:createParser(NumberType,withNoArgs),[Ops_Any]:createParser(BooleanType,withArgsCount(2,1/0),parseArgsOfType(BooleanType)),[Ops_All]:createParser(BooleanType,withArgsCount(2,1/0),parseArgsOfType(BooleanType)),[Ops_Not]:createParser(BooleanType,withArgsCount(1,1),parseArgsOfType(BooleanType)),[Ops_Equal]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_NotEqual]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_GreaterThan]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_GreaterThanOrEqualTo]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_LessThan]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_LessThanOrEqualTo]:createParser(BooleanType,withArgsCount(2,2),parseArgsOfType(AnyType),narrowArgsType),[Ops_Multiply]:createParser((parsedArgs=>{let outputType=NumberType|ColorType;for(let i=0;i<parsedArgs.length;i++)outputType&=parsedArgs[i].type;return outputType}),withArgsCount(2,1/0),parseArgsOfType(NumberType|ColorType),narrowArgsType),[Ops_Divide]:createParser(NumberType,withArgsCount(2,2),parseArgsOfType(NumberType)),[Ops_Add]:createParser(NumberType,withArgsCount(2,1/0),parseArgsOfType(NumberType)),[Ops_Subtract]:createParser(NumberType,withArgsCount(2,2),parseArgsOfType(NumberType)),[Ops_Clamp]:createParser(NumberType,withArgsCount(3,3),parseArgsOfType(NumberType)),[Ops_Mod]:createParser(NumberType,withArgsCount(2,2),parseArgsOfType(NumberType)),[Ops_Pow]:createParser(NumberType,withArgsCount(2,2),parseArgsOfType(NumberType)),[Ops_Abs]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Floor]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Ceil]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Round]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Sin]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Cos]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Atan]:createParser(NumberType,withArgsCount(1,2),parseArgsOfType(NumberType)),[Ops_Sqrt]:createParser(NumberType,withArgsCount(1,1),parseArgsOfType(NumberType)),[Ops_Match]:createParser((parsedArgs=>{let type=AnyType;for(let i=2;i<parsedArgs.length;i+=2)type&=parsedArgs[i].type;return type&=parsedArgs[parsedArgs.length-1].type,type}),withArgsCount(4,1/0),withEvenArgs,(function parseMatchArgs(encoded,context,parsedArgs,typeHint){const argsCount=encoded.length-1;let inputType=parse(encoded[1],context).type;const fallback=parse(encoded[encoded.length-1],context);let outputType=void 0!==typeHint?typeHint&fallback.type:fallback.type;const args=new Array(argsCount-2);for(let i=0;i<argsCount-2;i+=2){const match=parse(encoded[i+2],context),output=parse(encoded[i+3],context);inputType&=match.type,outputType&=output.type,args[i]=match,args[i+1]=output}const expectedInputType=StringType|NumberType|BooleanType;if(!overlapsType(expectedInputType,inputType))throw new Error(`Expected an input of type ${typeName(expectedInputType)} for the interpolate operation, got ${typeName(inputType)} instead`);if(isType(outputType,0))throw new Error("Could not find a common output type for the following match operation: "+JSON.stringify(encoded));for(let i=0;i<argsCount-2;i+=2){const match=parse(encoded[i+2],context,inputType),output=parse(encoded[i+3],context,outputType);args[i]=match,args[i+1]=output}return[parse(encoded[1],context,inputType),...args,parse(encoded[encoded.length-1],context,outputType)]})),[Ops_Between]:createParser(BooleanType,withArgsCount(3,3),parseArgsOfType(NumberType)),[Ops_Interpolate]:createParser((parsedArgs=>{let type=ColorType|NumberType;for(let i=3;i<parsedArgs.length;i+=2)type&=parsedArgs[i].type;return type}),withArgsCount(6,1/0),withEvenArgs,(function parseInterpolateArgs(encoded,context,parsedArgs,typeHint){const interpolationType=encoded[1];let interpolation;switch(interpolationType[0]){case"linear":interpolation=1;break;case"exponential":if(interpolation=interpolationType[1],"number"!=typeof interpolation)throw new Error(`Expected a number base for exponential interpolation, got ${JSON.stringify(interpolation)} instead`);break;default:interpolation=null}if(!interpolation)throw new Error(`Invalid interpolation type: ${JSON.stringify(interpolationType)}`);interpolation=parse(interpolation,context);let input=parse(encoded[2],context);if(!overlapsType(NumberType,input.type))throw new Error(`Expected an input of type number for the interpolate operation, got ${typeName(input.type)} instead`);input=parse(encoded[2],context,NumberType);const args=new Array(encoded.length-3);for(let i=0;i<args.length;i+=2){let stop=parse(encoded[i+3],context);if(!overlapsType(NumberType,stop.type))throw new Error(`Expected all stop input values in the interpolate operation to be of type number, got ${typeName(stop.type)} at position ${i+2} instead`);let output=parse(encoded[i+4],context);if(!overlapsType(NumberType|ColorType,output.type))throw new Error(`Expected all stop output values in the interpolate operation to be a number or color, got ${typeName(output.type)} at position ${i+3} instead`);stop=parse(encoded[i+3],context,NumberType),output=parse(encoded[i+4],context,NumberType|ColorType),args[i]=stop,args[i+1]=output}return[interpolation,input,...args]})),[Ops_Case]:createParser((parsedArgs=>{let type=AnyType;for(let i=1;i<parsedArgs.length;i+=2)type&=parsedArgs[i].type;return type&=parsedArgs[parsedArgs.length-1].type,type}),withArgsCount(3,1/0),(function withOddArgs(encoded,context){const operation=encoded[0],argCount=encoded.length-1;if(argCount%2==0)throw new Error(`An odd amount of arguments was expected for operation ${operation}, got ${JSON.stringify(argCount)} instead`)}),(function parseCaseArgs(encoded,context,parsedArgs,typeHint){const fallback=parse(encoded[encoded.length-1],context);let outputType=void 0!==typeHint?typeHint&fallback.type:fallback.type;const args=new Array(encoded.length-1);for(let i=0;i<args.length-1;i+=2){const condition=parse(encoded[i+1],context),output=parse(encoded[i+2],context);if(!overlapsType(BooleanType,condition.type))throw new Error(`Expected all conditions in the case operation to be of type boolean, got ${typeName(condition.type)} at position ${i} instead`);outputType&=output.type,args[i]=condition,args[i+1]=output}if(isType(outputType,0))throw new Error("Could not find a common output type for the following case operation: "+JSON.stringify(encoded));for(let i=0;i<args.length-1;i+=2)args[i+1]=parse(encoded[i+2],context,outputType);return args[args.length-1]=parse(encoded[encoded.length-1],context,outputType),args})),[Ops_In]:createParser(BooleanType,withArgsCount(2,2),(function parseInArgs(encoded,context){let haystack=encoded[2];if(!Array.isArray(haystack))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');if("string"==typeof haystack[0]){if("literal"!==haystack[0])throw new Error('For the "in" operator, a string array should be wrapped in a "literal" operator to disambiguate from expressions.');if(!Array.isArray(haystack[1]))throw new Error('The "in" operator was provided a literal value which was not an array as second argument.');haystack=haystack[1]}let needleType=StringType|NumberType;const args=new Array(haystack.length);for(let i=0;i<args.length;i++){const arg=parse(haystack[i],context);needleType&=arg.type,args[i]=arg}if(isType(needleType,0))throw new Error("Could not find a common type for the following in operation: "+JSON.stringify(encoded));return[parse(encoded[1],context,needleType),...args]})),[Ops_Number]:createParser(NumberType,withArgsCount(1,1/0),parseArgsOfType(AnyType)),[Ops_String]:createParser(StringType,withArgsCount(1,1/0),parseArgsOfType(AnyType)),[Ops_Array]:createParser((parsedArgs=>3===parsedArgs.length||4===parsedArgs.length?NumberArrayType|ColorType:NumberArrayType),withArgsCount(1,1/0),parseArgsOfType(NumberType)),[Ops_Color]:createParser(ColorType,withArgsCount(3,4),parseArgsOfType(NumberType)),[Ops_Band]:createParser(NumberType,withArgsCount(1,3),parseArgsOfType(NumberType)),[Ops_Palette]:createParser(ColorType,withArgsCount(2,2),(function parsePaletteArgs(encoded,context){const index=parse(encoded[1],context,NumberType);if(index.type!==NumberType)throw new Error(`The first argument of palette must be an number, got ${typeName(index.type)} instead`);const colors=encoded[2];if(!Array.isArray(colors))throw new Error("The second argument of palette must be an array");const parsedColors=new Array(colors.length);for(let i=0;i<parsedColors.length;i++){const color=parse(colors[i],context,ColorType);if(!(color instanceof LiteralExpression))throw new Error(`The palette color at index ${i} must be a literal value`);if(!overlapsType(color.type,ColorType))throw new Error(`The palette color at index ${i} should be of type color, got ${typeName(color.type)} instead`);parsedColors[i]=color}return[index,...parsedColors]}))};function withNoArgs(encoded,context){const operation=encoded[0];if(1!==encoded.length)throw new Error(`Expected no arguments for ${operation} operation`);return[]}function withArgsCount(minArgs,maxArgs){return function(encoded,context){const operation=encoded[0],argCount=encoded.length-1;if(minArgs===maxArgs){if(argCount!==minArgs){throw new Error(`Expected ${minArgs} argument${1===minArgs?"":"s"} for ${operation}, got ${argCount}`)}}else if(argCount<minArgs||argCount>maxArgs){throw new Error(`Expected ${maxArgs===1/0?`${minArgs} or more`:`${minArgs} to ${maxArgs}`} arguments for ${operation}, got ${argCount}`)}}}function parseArgsOfType(argType){return function(encoded,context){const operation=encoded[0],argCount=encoded.length-1,args=new Array(argCount);for(let i=0;i<argCount;++i){const expression=parse(encoded[i+1],context);if(!overlapsType(argType,expression.type)){const gotType=typeName(argType),expectedType=typeName(expression.type);throw new Error(`Unexpected type for argument ${i} of ${operation} operation, got ${gotType} but expected ${expectedType}`)}expression.type&=argType,args[i]=expression}return args}}function narrowArgsType(encoded,context,parsedArgs){const operation=encoded[0],argCount=encoded.length-1;let sameType=AnyType;for(let i=0;i<parsedArgs.length;++i)sameType&=parsedArgs[i].type;if(0===sameType)throw new Error(`No common type could be found for arguments of ${operation} operation`);const args=new Array(argCount);for(let i=0;i<argCount;++i)args[i]=parse(encoded[i+1],context,sameType);return args}function withEvenArgs(encoded,context){const operation=encoded[0],argCount=encoded.length-1;if(argCount%2==1)throw new Error(`An even amount of arguments was expected for operation ${operation}, got ${JSON.stringify(argCount)} instead`)}function createParser(returnType,...argValidators){return function(encoded,context,typeHint){const operator=encoded[0];let parsedArgs=[];for(let i=0;i<argValidators.length;i++)parsedArgs=argValidators[i](encoded,context,parsedArgs,typeHint)||parsedArgs;let actualType="function"==typeof returnType?returnType(parsedArgs):returnType;if(void 0!==typeHint){if(!overlapsType(actualType,typeHint))throw new Error(`The following expression was expected to return ${typeName(typeHint)}, but returns ${typeName(actualType)} instead: ${JSON.stringify(encoded)}`);actualType&=typeHint}if(0===actualType)throw new Error(`No matching type was found for the following expression: ${JSON.stringify(encoded)}`);return new CallExpression(actualType,operator,...parsedArgs)}}function buildExpression(encoded,type,context){const expression=parse(encoded,context);if(!overlapsType(type,expression.type)){const expected=typeName(type),actual=typeName(expression.type);throw new Error(`Expected expression to be of type ${expected}, got ${actual}`)}return compileExpression(expression,context)}function compileExpression(expression,context){if(expression instanceof LiteralExpression){if(expression.type===ColorType&&"string"==typeof expression.value){const colorValue=(0,ol_color.sH)(expression.value);return function(){return colorValue}}return function(){return expression.value}}const operator=expression.operator;switch(operator){case Ops_Number:case Ops_String:return function compileAssertionExpression(expression,context){const type=expression.operator,length=expression.args.length,args=new Array(length);for(let i=0;i<length;++i)args[i]=compileExpression(expression.args[i],context);switch(type){case Ops_Number:case Ops_String:return context=>{for(let i=0;i<length;++i){const value=args[i](context);if(typeof value===type)return value}throw new Error(`Expected one of the values to be a ${type}`)};default:throw new Error(`Unsupported assertion operator ${type}`)}}(expression,context);case Ops_Get:case Ops_Var:return function compileAccessorExpression(expression,context){const nameExpression=expression.args[0],name=nameExpression.value;switch(expression.operator){case Ops_Get:return context=>context.properties[name];case Ops_Var:return context=>context.variables[name];default:throw new Error(`Unsupported accessor operator ${expression.operator}`)}}(expression);case Ops_Id:return expression=>expression.featureId;case Ops_Concat:{const args=expression.args.map((e=>compileExpression(e,context)));return context=>"".concat(...args.map((arg=>arg(context).toString())))}case Ops_Resolution:return context=>context.resolution;case Ops_Any:case Ops_All:case Ops_Not:return function compileLogicalExpression(expression,context){const op=expression.operator,length=expression.args.length,args=new Array(length);for(let i=0;i<length;++i)args[i]=compileExpression(expression.args[i],context);switch(op){case Ops_Any:return context=>{for(let i=0;i<length;++i)if(args[i](context))return!0;return!1};case Ops_All:return context=>{for(let i=0;i<length;++i)if(!args[i](context))return!1;return!0};case Ops_Not:return context=>!args[0](context);default:throw new Error(`Unsupported logical operator ${op}`)}}(expression,context);case Ops_Equal:case Ops_NotEqual:case Ops_LessThan:case Ops_LessThanOrEqualTo:case Ops_GreaterThan:case Ops_GreaterThanOrEqualTo:return function compileComparisonExpression(expression,context){const op=expression.operator,left=compileExpression(expression.args[0],context),right=compileExpression(expression.args[1],context);switch(op){case Ops_Equal:return context=>left(context)===right(context);case Ops_NotEqual:return context=>left(context)!==right(context);case Ops_LessThan:return context=>left(context)<right(context);case Ops_LessThanOrEqualTo:return context=>left(context)<=right(context);case Ops_GreaterThan:return context=>left(context)>right(context);case Ops_GreaterThanOrEqualTo:return context=>left(context)>=right(context);default:throw new Error(`Unsupported comparison operator ${op}`)}}(expression,context);case Ops_Multiply:case Ops_Divide:case Ops_Add:case Ops_Subtract:case Ops_Clamp:case Ops_Mod:case Ops_Pow:case Ops_Abs:case Ops_Floor:case Ops_Ceil:case Ops_Round:case Ops_Sin:case Ops_Cos:case Ops_Atan:case Ops_Sqrt:return function compileNumericExpression(expression,context){const op=expression.operator,length=expression.args.length,args=new Array(length);for(let i=0;i<length;++i)args[i]=compileExpression(expression.args[i],context);switch(op){case Ops_Multiply:return context=>{let value=1;for(let i=0;i<length;++i)value*=args[i](context);return value};case Ops_Divide:return context=>args[0](context)/args[1](context);case Ops_Add:return context=>{let value=0;for(let i=0;i<length;++i)value+=args[i](context);return value};case Ops_Subtract:return context=>args[0](context)-args[1](context);case Ops_Clamp:return context=>{const value=args[0](context),min=args[1](context);if(value<min)return min;const max=args[2](context);return value>max?max:value};case Ops_Mod:return context=>args[0](context)%args[1](context);case Ops_Pow:return context=>Math.pow(args[0](context),args[1](context));case Ops_Abs:return context=>Math.abs(args[0](context));case Ops_Floor:return context=>Math.floor(args[0](context));case Ops_Ceil:return context=>Math.ceil(args[0](context));case Ops_Round:return context=>Math.round(args[0](context));case Ops_Sin:return context=>Math.sin(args[0](context));case Ops_Cos:return context=>Math.cos(args[0](context));case Ops_Atan:return 2===length?context=>Math.atan2(args[0](context),args[1](context)):context=>Math.atan(args[0](context));case Ops_Sqrt:return context=>Math.sqrt(args[0](context));default:throw new Error(`Unsupported numeric operator ${op}`)}}(expression,context);case Ops_Match:return function compileMatchExpression(expression,context){const length=expression.args.length,args=new Array(length);for(let i=0;i<length;++i)args[i]=compileExpression(expression.args[i],context);return context=>{const value=args[0](context);for(let i=1;i<length;i+=2)if(value===args[i](context))return args[i+1](context);return args[length-1](context)}}(expression,context);case Ops_Interpolate:return function compileInterpolateExpression(expression,context){const length=expression.args.length,args=new Array(length);for(let i=0;i<length;++i)args[i]=compileExpression(expression.args[i],context);return context=>{const base=args[0](context),value=args[1](context);let previousInput,previousOutput;for(let i=2;i<length;i+=2){const input=args[i](context);let output=args[i+1](context);const isColor=Array.isArray(output);if(isColor&&(output=(0,ol_color.fu)(output)),input>=value)return 2===i?output:isColor?interpolateColor(base,value,previousInput,previousOutput,input,output):interpolateNumber(base,value,previousInput,previousOutput,input,output);previousInput=input,previousOutput=output}return previousOutput}}(expression,context);default:throw new Error(`Unsupported operator ${operator}`)}}function interpolateNumber(base,value,input1,output1,input2,output2){const delta=input2-input1;if(0===delta)return output1;const along=value-input1;return output1+(1===base?along/delta:(Math.pow(base,along)-1)/(Math.pow(base,delta)-1))*(output2-output1)}function interpolateColor(base,value,input1,rgba1,input2,rgba2){if(0===input2-input1)return rgba1;const lcha1=(0,ol_color.eE)(rgba1),lcha2=(0,ol_color.eE)(rgba2);let deltaHue=lcha2[2]-lcha1[2];deltaHue>180?deltaHue-=360:deltaHue<-180&&(deltaHue+=360);const lcha=[interpolateNumber(base,value,input1,lcha1[0],input2,lcha2[0]),interpolateNumber(base,value,input1,lcha1[1],input2,lcha2[1]),lcha1[2]+interpolateNumber(base,value,input1,0,input2,deltaHue),interpolateNumber(base,value,input1,rgba1[3],input2,rgba2[3])];return(0,ol_color.S8)((0,ol_color.cD)(lcha))}function always(context){return!0}function rulesToStyleFunction(rules){const parsingContext=newParsingContext(),evaluator=function buildRuleSet(rules,context){const length=rules.length,compiledRules=new Array(length);for(let i=0;i<length;++i){const rule=rules[i],filter="filter"in rule?buildExpression(rule.filter,BooleanType,context):always;let styles;if(Array.isArray(rule.style)){const styleLength=rule.style.length;styles=new Array(styleLength);for(let j=0;j<styleLength;++j)styles[j]=buildStyle(rule.style[j],context)}else styles=[buildStyle(rule.style,context)];compiledRules[i]={filter,styles}}return function(context){const styles=[];let someMatched=!1;for(let i=0;i<length;++i){if((0,compiledRules[i].filter)(context)&&(!rules[i].else||!someMatched)){someMatched=!0;for(const styleEvaluator of compiledRules[i].styles){const style=styleEvaluator(context);style&&styles.push(style)}}}return styles}}(rules,parsingContext),evaluationContext={variables:{},properties:{},resolution:NaN,featureId:null};return function(feature,resolution){if(evaluationContext.properties=feature.getPropertiesInternal(),evaluationContext.resolution=resolution,parsingContext.featureId){const id=feature.getId();evaluationContext.featureId=void 0!==id?id:null}return evaluator(evaluationContext)}}function flatStylesToStyleFunction(flatStyles){const parsingContext=newParsingContext(),length=flatStyles.length,evaluators=new Array(length);for(let i=0;i<length;++i)evaluators[i]=buildStyle(flatStyles[i],parsingContext);const evaluationContext={variables:{},properties:{},resolution:NaN,featureId:null},styles=new Array(length);return function(feature,resolution){if(evaluationContext.properties=feature.getPropertiesInternal(),evaluationContext.resolution=resolution,parsingContext.featureId){const id=feature.getId();evaluationContext.featureId=void 0!==id?id:null}let nonNullCount=0;for(let i=0;i<length;++i){const style=evaluators[i](evaluationContext);style&&(styles[nonNullCount]=style,nonNullCount+=1)}return styles.length=nonNullCount,styles}}function buildStyle(flatStyle,context){const evaluateFill=buildFill(flatStyle,"",context),evaluateStroke=buildStroke(flatStyle,"",context),evaluateText=function buildText(flatStyle,context){const prefix="text-",evaluateValue=stringEvaluator(flatStyle,prefix+"value",context);if(!evaluateValue)return null;const evaluateFill=buildFill(flatStyle,prefix,context),evaluateBackgroundFill=buildFill(flatStyle,prefix+"background-",context),evaluateStroke=buildStroke(flatStyle,prefix,context),evaluateBackgroundStroke=buildStroke(flatStyle,prefix+"background-",context),evaluateFont=stringEvaluator(flatStyle,prefix+"font",context),evaluateMaxAngle=numberEvaluator(flatStyle,prefix+"max-angle",context),evaluateOffsetX=numberEvaluator(flatStyle,prefix+"offset-x",context),evaluateOffsetY=numberEvaluator(flatStyle,prefix+"offset-y",context),evaluateOverflow=booleanEvaluator(flatStyle,prefix+"overflow",context),evaluatePlacement=stringEvaluator(flatStyle,prefix+"placement",context),evaluateRepeat=numberEvaluator(flatStyle,prefix+"repeat",context),evaluateScale=sizeLikeEvaluator(flatStyle,prefix+"scale",context),evaluateRotateWithView=booleanEvaluator(flatStyle,prefix+"rotate-with-view",context),evaluateRotation=numberEvaluator(flatStyle,prefix+"rotation",context),evaluateAlign=stringEvaluator(flatStyle,prefix+"align",context),evaluateJustify=stringEvaluator(flatStyle,prefix+"justify",context),evaluateBaseline=stringEvaluator(flatStyle,prefix+"baseline",context),evaluatePadding=numberArrayEvaluator(flatStyle,prefix+"padding",context),text=new style_Text({});return function(context){if(text.setText(evaluateValue(context)),evaluateFill&&text.setFill(evaluateFill(context)),evaluateBackgroundFill&&text.setBackgroundFill(evaluateBackgroundFill(context)),evaluateStroke&&text.setStroke(evaluateStroke(context)),evaluateBackgroundStroke&&text.setBackgroundStroke(evaluateBackgroundStroke(context)),evaluateFont&&text.setFont(evaluateFont(context)),evaluateMaxAngle&&text.setMaxAngle(evaluateMaxAngle(context)),evaluateOffsetX&&text.setOffsetX(evaluateOffsetX(context)),evaluateOffsetY&&text.setOffsetY(evaluateOffsetY(context)),evaluateOverflow&&text.setOverflow(evaluateOverflow(context)),evaluatePlacement){const placement=evaluatePlacement(context);if("point"!==placement&&"line"!==placement)throw new Error("Expected point or line for text-placement");text.setPlacement(placement)}if(evaluateRepeat&&text.setRepeat(evaluateRepeat(context)),evaluateScale&&text.setScale(evaluateScale(context)),evaluateRotateWithView&&text.setRotateWithView(evaluateRotateWithView(context)),evaluateRotation&&text.setRotation(evaluateRotation(context)),evaluateAlign){const textAlign=evaluateAlign(context);if("left"!==textAlign&&"center"!==textAlign&&"right"!==textAlign&&"end"!==textAlign&&"start"!==textAlign)throw new Error("Expected left, right, center, start, or end for text-align");text.setTextAlign(textAlign)}if(evaluateJustify){const justify=evaluateJustify(context);if("left"!==justify&&"right"!==justify&&"center"!==justify)throw new Error("Expected left, right, or center for text-justify");text.setJustify(justify)}if(evaluateBaseline){const textBaseline=evaluateBaseline(context);if("bottom"!==textBaseline&&"top"!==textBaseline&&"middle"!==textBaseline&&"alphabetic"!==textBaseline&&"hanging"!==textBaseline)throw new Error("Expected bottom, top, middle, alphabetic, or hanging for text-baseline");text.setTextBaseline(textBaseline)}return evaluatePadding&&text.setPadding(evaluatePadding(context)),text}}(flatStyle,context),evaluateImage=function buildImage(flatStyle,context){if("icon-src"in flatStyle)return function buildIcon(flatStyle,context){const prefix="icon-",srcName=prefix+"src",src=requireString(flatStyle[srcName],srcName),evaluateAnchor=coordinateEvaluator(flatStyle,prefix+"anchor",context),evaluateScale=sizeLikeEvaluator(flatStyle,prefix+"scale",context),evaluateOpacity=numberEvaluator(flatStyle,prefix+"opacity",context),evaluateDisplacement=coordinateEvaluator(flatStyle,prefix+"displacement",context),evaluateRotation=numberEvaluator(flatStyle,prefix+"rotation",context),evaluateRotateWithView=booleanEvaluator(flatStyle,prefix+"rotate-with-view",context),anchorOrigin=optionalIconOrigin(flatStyle,prefix+"anchor-origin"),anchorXUnits=optionalIconAnchorUnits(flatStyle,prefix+"anchor-x-units"),anchorYUnits=optionalIconAnchorUnits(flatStyle,prefix+"anchor-y-units"),color=function optionalColorLike(flatStyle,property){const encoded=flatStyle[property];if(void 0===encoded)return;return requireColorLike(encoded,property)}(flatStyle,prefix+"color"),crossOrigin=function optionalString(flatStyle,property){const encoded=flatStyle[property];if(void 0===encoded)return;if("string"!=typeof encoded)throw new Error(`Expected a string for ${property}`);return encoded}(flatStyle,prefix+"cross-origin"),offset=function optionalNumberArray(flatStyle,property){const encoded=flatStyle[property];if(void 0===encoded)return;return requireNumberArray(encoded,property)}(flatStyle,prefix+"offset"),offsetOrigin=optionalIconOrigin(flatStyle,prefix+"offset-origin"),width=optionalNumber(flatStyle,prefix+"width"),height=optionalNumber(flatStyle,prefix+"height"),size=function optionalSize(flatStyle,property){const encoded=flatStyle[property];if(void 0===encoded)return;if("number"==typeof encoded)return(0,ol_size.xq)(encoded);if(!Array.isArray(encoded))throw new Error(`Expected a number or size array for ${property}`);if(2!==encoded.length||"number"!=typeof encoded[0]||"number"!=typeof encoded[1])throw new Error(`Expected a number or size array for ${property}`);return encoded}(flatStyle,prefix+"size"),declutterMode=optionalDeclutterMode(flatStyle,prefix+"declutter"),icon=new style_Icon({src,anchorOrigin,anchorXUnits,anchorYUnits,color,crossOrigin,offset,offsetOrigin,height,width,size,declutterMode});return function(context){return evaluateOpacity&&icon.setOpacity(evaluateOpacity(context)),evaluateDisplacement&&icon.setDisplacement(evaluateDisplacement(context)),evaluateRotation&&icon.setRotation(evaluateRotation(context)),evaluateRotateWithView&&icon.setRotateWithView(evaluateRotateWithView(context)),evaluateScale&&icon.setScale(evaluateScale(context)),evaluateAnchor&&icon.setAnchor(evaluateAnchor(context)),icon}}(flatStyle,context);if("shape-points"in flatStyle)return function buildShape(flatStyle,context){const prefix="shape-",pointsName=prefix+"points",points=requireNumber(flatStyle[pointsName],pointsName),evaluateFill=buildFill(flatStyle,prefix,context),evaluateStroke=buildStroke(flatStyle,prefix,context),evaluateScale=sizeLikeEvaluator(flatStyle,prefix+"scale",context),evaluateDisplacement=coordinateEvaluator(flatStyle,prefix+"displacement",context),evaluateRotation=numberEvaluator(flatStyle,prefix+"rotation",context),evaluateRotateWithView=booleanEvaluator(flatStyle,prefix+"rotate-with-view",context),radius=optionalNumber(flatStyle,prefix+"radius"),radius1=optionalNumber(flatStyle,prefix+"radius1"),radius2=optionalNumber(flatStyle,prefix+"radius2"),angle=optionalNumber(flatStyle,prefix+"angle"),declutterMode=optionalDeclutterMode(flatStyle,prefix+"declutter-mode"),shape=new RegularShape.A({points,radius,radius1,radius2,angle,declutterMode});return function(context){return evaluateFill&&shape.setFill(evaluateFill(context)),evaluateStroke&&shape.setStroke(evaluateStroke(context)),evaluateDisplacement&&shape.setDisplacement(evaluateDisplacement(context)),evaluateRotation&&shape.setRotation(evaluateRotation(context)),evaluateRotateWithView&&shape.setRotateWithView(evaluateRotateWithView(context)),evaluateScale&&shape.setScale(evaluateScale(context)),shape}}(flatStyle,context);if("circle-radius"in flatStyle)return function buildCircle(flatStyle,context){const prefix="circle-",evaluateFill=buildFill(flatStyle,prefix,context),evaluateStroke=buildStroke(flatStyle,prefix,context),evaluateRadius=numberEvaluator(flatStyle,prefix+"radius",context),evaluateScale=sizeLikeEvaluator(flatStyle,prefix+"scale",context),evaluateDisplacement=coordinateEvaluator(flatStyle,prefix+"displacement",context),evaluateRotation=numberEvaluator(flatStyle,prefix+"rotation",context),evaluateRotateWithView=booleanEvaluator(flatStyle,prefix+"rotate-with-view",context),declutterMode=optionalDeclutterMode(flatStyle,prefix+"declutter-mode"),circle=new Circle.A({radius:5,declutterMode});return function(context){return evaluateRadius&&circle.setRadius(evaluateRadius(context)),evaluateFill&&circle.setFill(evaluateFill(context)),evaluateStroke&&circle.setStroke(evaluateStroke(context)),evaluateDisplacement&&circle.setDisplacement(evaluateDisplacement(context)),evaluateRotation&&circle.setRotation(evaluateRotation(context)),evaluateRotateWithView&&circle.setRotateWithView(evaluateRotateWithView(context)),evaluateScale&&circle.setScale(evaluateScale(context)),circle}}(flatStyle,context);return null}(flatStyle,context),evaluateZIndex=numberEvaluator(flatStyle,"z-index",context);if(!(evaluateFill||evaluateStroke||evaluateText||evaluateImage||(0,obj.p)(flatStyle)))throw new Error("No fill, stroke, point, or text symbolizer properties in style: "+JSON.stringify(flatStyle));const style=new Style.Ay;return function(context){let empty=!0;if(evaluateFill){const fill=evaluateFill(context);fill&&(empty=!1),style.setFill(fill)}if(evaluateStroke){const stroke=evaluateStroke(context);stroke&&(empty=!1),style.setStroke(stroke)}if(evaluateText){const text=evaluateText(context);text&&(empty=!1),style.setText(text)}if(evaluateImage){const image=evaluateImage(context);image&&(empty=!1),style.setImage(image)}return evaluateZIndex&&style.setZIndex(evaluateZIndex(context)),empty?null:style}}function buildFill(flatStyle,prefix,context){const evaluateColor=colorLikeEvaluator(flatStyle,prefix+"fill-color",context);if(!evaluateColor)return null;const fill=new Fill.A;return function(context){const color=evaluateColor(context);return"none"===color?null:(fill.setColor(color),fill)}}function buildStroke(flatStyle,prefix,context){const evaluateWidth=numberEvaluator(flatStyle,prefix+"stroke-width",context),evaluateColor=colorLikeEvaluator(flatStyle,prefix+"stroke-color",context);if(!evaluateWidth&&!evaluateColor)return null;const evaluateLineCap=stringEvaluator(flatStyle,prefix+"stroke-line-cap",context),evaluateLineJoin=stringEvaluator(flatStyle,prefix+"stroke-line-join",context),evaluateLineDash=numberArrayEvaluator(flatStyle,prefix+"stroke-line-dash",context),evaluateLineDashOffset=numberEvaluator(flatStyle,prefix+"stroke-line-dash-offset",context),evaluateMiterLimit=numberEvaluator(flatStyle,prefix+"stroke-miter-limit",context),stroke=new Stroke.A;return function(context){if(evaluateColor){const color=evaluateColor(context);if("none"===color)return null;stroke.setColor(color)}if(evaluateWidth&&stroke.setWidth(evaluateWidth(context)),evaluateLineCap){const lineCap=evaluateLineCap(context);if("butt"!==lineCap&&"round"!==lineCap&&"square"!==lineCap)throw new Error("Expected butt, round, or square line cap");stroke.setLineCap(lineCap)}if(evaluateLineJoin){const lineJoin=evaluateLineJoin(context);if("bevel"!==lineJoin&&"round"!==lineJoin&&"miter"!==lineJoin)throw new Error("Expected bevel, round, or miter line join");stroke.setLineJoin(lineJoin)}return evaluateLineDash&&stroke.setLineDash(evaluateLineDash(context)),evaluateLineDashOffset&&stroke.setLineDashOffset(evaluateLineDashOffset(context)),evaluateMiterLimit&&stroke.setMiterLimit(evaluateMiterLimit(context)),stroke}}function numberEvaluator(flatStyle,name,context){if(!(name in flatStyle))return;const evaluator=buildExpression(flatStyle[name],NumberType,context);return function(context){return requireNumber(evaluator(context),name)}}function stringEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],StringType,context);return function(context){return requireString(evaluator(context),name)}}function booleanEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],BooleanType,context);return function(context){const value=evaluator(context);if("boolean"!=typeof value)throw new Error(`Expected a boolean for ${name}`);return value}}function colorLikeEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],ColorType|StringType,context);return function(context){return requireColorLike(evaluator(context),name)}}function numberArrayEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],NumberArrayType,context);return function(context){return requireNumberArray(evaluator(context),name)}}function coordinateEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],NumberArrayType,context);return function(context){const array=requireNumberArray(evaluator(context),name);if(2!==array.length)throw new Error(`Expected two numbers for ${name}`);return array}}function sizeLikeEvaluator(flatStyle,name,context){if(!(name in flatStyle))return null;const evaluator=buildExpression(flatStyle[name],NumberArrayType|NumberType,context);return function(context){return function requireSizeLike(value,property){if("number"==typeof value)return value;const size=requireNumberArray(value,property);if(2!==size.length)throw new Error(`Expected an array of two numbers for ${property}`);return size}(evaluator(context),name)}}function optionalNumber(flatStyle,property){const value=flatStyle[property];if(void 0!==value){if("number"!=typeof value)throw new Error(`Expected a number for ${property}`);return value}}function optionalIconOrigin(flatStyle,property){const encoded=flatStyle[property];if(void 0!==encoded){if("bottom-left"!==encoded&&"bottom-right"!==encoded&&"top-left"!==encoded&&"top-right"!==encoded)throw new Error(`Expected bottom-left, bottom-right, top-left, or top-right for ${property}`);return encoded}}function optionalIconAnchorUnits(flatStyle,property){const encoded=flatStyle[property];if(void 0!==encoded){if("pixels"!==encoded&&"fraction"!==encoded)throw new Error(`Expected pixels or fraction for ${property}`);return encoded}}function optionalDeclutterMode(flatStyle,property){const encoded=flatStyle[property];if(void 0!==encoded){if("string"!=typeof encoded)throw new Error(`Expected a string for ${property}`);if("declutter"!==encoded&&"obstacle"!==encoded&&"none"!==encoded)throw new Error(`Expected declutter, obstacle, or none for ${property}`);return encoded}}function requireNumberArray(value,property){if(!Array.isArray(value))throw new Error(`Expected an array for ${property}`);const length=value.length;for(let i=0;i<length;++i)if("number"!=typeof value[i])throw new Error(`Expected an array of numbers for ${property}`);return value}function requireString(value,property){if("string"!=typeof value)throw new Error(`Expected a string for ${property}`);return value}function requireNumber(value,property){if("number"!=typeof value)throw new Error(`Expected a number for ${property}`);return value}function requireColorLike(value,property){if("string"==typeof value)return value;const array=requireNumberArray(value,property),length=array.length;if(length<3||length>4)throw new Error(`Expected a color with 3 or 4 values for ${property}`);return array}const BaseVector_Property_RENDER_ORDER="renderOrder";const BaseVector=class BaseVectorLayer extends layer_Layer{constructor(options){options=options||{};const baseOptions=Object.assign({},options);delete baseOptions.style,delete baseOptions.renderBuffer,delete baseOptions.updateWhileAnimating,delete baseOptions.updateWhileInteracting,super(baseOptions),this.declutter_=void 0!==options.declutter&&options.declutter,this.renderBuffer_=void 0!==options.renderBuffer?options.renderBuffer:100,this.style_=null,this.styleFunction_=void 0,this.setStyle(options.style),this.updateWhileAnimating_=void 0!==options.updateWhileAnimating&&options.updateWhileAnimating,this.updateWhileInteracting_=void 0!==options.updateWhileInteracting&&options.updateWhileInteracting}getDeclutter(){return this.declutter_}getFeatures(pixel){return super.getFeatures(pixel)}getRenderBuffer(){return this.renderBuffer_}getRenderOrder(){return this.get(BaseVector_Property_RENDER_ORDER)}getStyle(){return this.style_}getStyleFunction(){return this.styleFunction_}getUpdateWhileAnimating(){return this.updateWhileAnimating_}getUpdateWhileInteracting(){return this.updateWhileInteracting_}renderDeclutter(frameState){frameState.declutterTree||(frameState.declutterTree=new(rbush_min_default())(9)),this.getRenderer().renderDeclutter(frameState)}setRenderOrder(renderOrder){this.set(BaseVector_Property_RENDER_ORDER,renderOrder)}setStyle(style){this.style_=function toStyleLike(style){if(void 0===style)return Style.d1;if(!style)return null;if("function"==typeof style)return style;if(style instanceof Style.Ay)return style;if(!Array.isArray(style))return flatStylesToStyleFunction([style]);if(0===style.length)return[];const length=style.length,first=style[0];if(first instanceof Style.Ay){const styles=new Array(length);for(let i=0;i<length;++i){const candidate=style[i];if(!(candidate instanceof Style.Ay))throw new Error("Expected a list of style instances");styles[i]=candidate}return styles}if("style"in first){const rules=new Array(length);for(let i=0;i<length;++i){const candidate=style[i];if(!("style"in candidate))throw new Error("Expected a list of rules with a style property");rules[i]=candidate}return rulesToStyleFunction(rules)}const flatStyles=style;return flatStylesToStyleFunction(flatStyles)}(style),this.styleFunction_=null===style?void 0:(0,Style.mC)(this.style_),this.changed()}},Instruction={BEGIN_GEOMETRY:0,BEGIN_PATH:1,CIRCLE:2,CLOSE_PATH:3,CUSTOM:4,DRAW_CHARS:5,DRAW_IMAGE:6,END_GEOMETRY:7,FILL:8,MOVE_TO_LINE_TO:9,SET_FILL_STYLE:10,SET_STROKE_STYLE:11,STROKE:12},fillInstruction=[Instruction.FILL],strokeInstruction=[Instruction.STROKE],beginPathInstruction=[Instruction.BEGIN_PATH],closePathInstruction=[Instruction.CLOSE_PATH],canvas_Instruction=Instruction;var Relationship=__webpack_require__("./node_modules/ol/extent/Relationship.js");const render_VectorContext=class VectorContext{drawCustom(geometry,feature,renderer,hitDetectionRenderer){}drawGeometry(geometry){}setStyle(style){}drawCircle(circleGeometry,feature){}drawFeature(feature,style){}drawGeometryCollection(geometryCollectionGeometry,feature){}drawLineString(lineStringGeometry,feature){}drawMultiLineString(multiLineStringGeometry,feature){}drawMultiPoint(multiPointGeometry,feature){}drawMultiPolygon(multiPolygonGeometry,feature){}drawPoint(pointGeometry,feature){}drawPolygon(polygonGeometry,feature){}drawText(geometry,feature){}setFillStrokeStyle(fillStyle,strokeStyle){}setImageStyle(imageStyle,declutterImageWithText){}setTextStyle(textStyle,declutterImageWithText){}};var colorlike=__webpack_require__("./node_modules/ol/colorlike.js"),inflate=__webpack_require__("./node_modules/ol/geom/flat/inflate.js");const Builder=class CanvasBuilder extends render_VectorContext{constructor(tolerance,maxExtent,resolution,pixelRatio){super(),this.tolerance=tolerance,this.maxExtent=maxExtent,this.pixelRatio=pixelRatio,this.maxLineWidth=0,this.resolution=resolution,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_=null,this.bufferedMaxExtent_=null,this.instructions=[],this.coordinates=[],this.tmpCoordinate_=[],this.hitDetectionInstructions=[],this.state={}}applyPixelRatio(dashArray){const pixelRatio=this.pixelRatio;return 1==pixelRatio?dashArray:dashArray.map((function(dash){return dash*pixelRatio}))}appendFlatPointCoordinates(flatCoordinates,stride){const extent=this.getBufferedMaxExtent(),tmpCoord=this.tmpCoordinate_,coordinates=this.coordinates;let myEnd=coordinates.length;for(let i=0,ii=flatCoordinates.length;i<ii;i+=stride)tmpCoord[0]=flatCoordinates[i],tmpCoord[1]=flatCoordinates[i+1],(0,ol_extent.Ym)(extent,tmpCoord)&&(coordinates[myEnd++]=tmpCoord[0],coordinates[myEnd++]=tmpCoord[1]);return myEnd}appendFlatLineCoordinates(flatCoordinates,offset,end,stride,closed,skipFirst){const coordinates=this.coordinates;let myEnd=coordinates.length;const extent=this.getBufferedMaxExtent();skipFirst&&(offset+=stride);let lastXCoord=flatCoordinates[offset],lastYCoord=flatCoordinates[offset+1];const nextCoord=this.tmpCoordinate_;let i,lastRel,nextRel,skipped=!0;for(i=offset+stride;i<end;i+=stride)nextCoord[0]=flatCoordinates[i],nextCoord[1]=flatCoordinates[i+1],nextRel=(0,ol_extent.vz)(extent,nextCoord),nextRel!==lastRel?(skipped&&(coordinates[myEnd++]=lastXCoord,coordinates[myEnd++]=lastYCoord,skipped=!1),coordinates[myEnd++]=nextCoord[0],coordinates[myEnd++]=nextCoord[1]):nextRel===Relationship.A.INTERSECTING?(coordinates[myEnd++]=nextCoord[0],coordinates[myEnd++]=nextCoord[1],skipped=!1):skipped=!0,lastXCoord=nextCoord[0],lastYCoord=nextCoord[1],lastRel=nextRel;return(closed&&skipped||i===offset+stride)&&(coordinates[myEnd++]=lastXCoord,coordinates[myEnd++]=lastYCoord),myEnd}drawCustomCoordinates_(flatCoordinates,offset,ends,stride,builderEnds){for(let i=0,ii=ends.length;i<ii;++i){const end=ends[i],builderEnd=this.appendFlatLineCoordinates(flatCoordinates,offset,end,stride,!1,!1);builderEnds.push(builderEnd),offset=end}return offset}drawCustom(geometry,feature,renderer,hitDetectionRenderer){this.beginGeometry(geometry,feature);const type=geometry.getType(),stride=geometry.getStride(),builderBegin=this.coordinates.length;let flatCoordinates,builderEnd,builderEnds,builderEndss,offset;switch(type){case"MultiPolygon":flatCoordinates=geometry.getOrientedFlatCoordinates(),builderEndss=[];const endss=geometry.getEndss();offset=0;for(let i=0,ii=endss.length;i<ii;++i){const myEnds=[];offset=this.drawCustomCoordinates_(flatCoordinates,offset,endss[i],stride,myEnds),builderEndss.push(myEnds)}this.instructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEndss,geometry,renderer,inflate.Dz]),this.hitDetectionInstructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEndss,geometry,hitDetectionRenderer||renderer,inflate.Dz]);break;case"Polygon":case"MultiLineString":builderEnds=[],flatCoordinates="Polygon"==type?geometry.getOrientedFlatCoordinates():geometry.getFlatCoordinates(),offset=this.drawCustomCoordinates_(flatCoordinates,0,geometry.getEnds(),stride,builderEnds),this.instructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnds,geometry,renderer,inflate.cD]),this.hitDetectionInstructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnds,geometry,hitDetectionRenderer||renderer,inflate.cD]);break;case"LineString":case"Circle":flatCoordinates=geometry.getFlatCoordinates(),builderEnd=this.appendFlatLineCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1),this.instructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,renderer,inflate.n2]),this.hitDetectionInstructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,hitDetectionRenderer||renderer,inflate.n2]);break;case"MultiPoint":flatCoordinates=geometry.getFlatCoordinates(),builderEnd=this.appendFlatPointCoordinates(flatCoordinates,stride),builderEnd>builderBegin&&(this.instructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,renderer,inflate.n2]),this.hitDetectionInstructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,hitDetectionRenderer||renderer,inflate.n2]));break;case"Point":flatCoordinates=geometry.getFlatCoordinates(),this.coordinates.push(flatCoordinates[0],flatCoordinates[1]),builderEnd=this.coordinates.length,this.instructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,renderer]),this.hitDetectionInstructions.push([canvas_Instruction.CUSTOM,builderBegin,builderEnd,geometry,hitDetectionRenderer||renderer])}this.endGeometry(feature)}beginGeometry(geometry,feature){this.beginGeometryInstruction1_=[canvas_Instruction.BEGIN_GEOMETRY,feature,0,geometry],this.instructions.push(this.beginGeometryInstruction1_),this.beginGeometryInstruction2_=[canvas_Instruction.BEGIN_GEOMETRY,feature,0,geometry],this.hitDetectionInstructions.push(this.beginGeometryInstruction2_)}finish(){return{instructions:this.instructions,hitDetectionInstructions:this.hitDetectionInstructions,coordinates:this.coordinates}}reverseHitDetectionInstructions(){const hitDetectionInstructions=this.hitDetectionInstructions;let i;hitDetectionInstructions.reverse();const n=hitDetectionInstructions.length;let instruction,type,begin=-1;for(i=0;i<n;++i)instruction=hitDetectionInstructions[i],type=instruction[0],type==canvas_Instruction.END_GEOMETRY?begin=i:type==canvas_Instruction.BEGIN_GEOMETRY&&(instruction[2]=i,(0,array.gI)(this.hitDetectionInstructions,begin,i),begin=-1)}setFillStrokeStyle(fillStyle,strokeStyle){const state=this.state;if(fillStyle){const fillStyleColor=fillStyle.getColor();state.fillStyle=(0,colorlike.F)(fillStyleColor||render_canvas.qY)}else state.fillStyle=void 0;if(strokeStyle){const strokeStyleColor=strokeStyle.getColor();state.strokeStyle=(0,colorlike.F)(strokeStyleColor||render_canvas.NT);const strokeStyleLineCap=strokeStyle.getLineCap();state.lineCap=void 0!==strokeStyleLineCap?strokeStyleLineCap:render_canvas._m;const strokeStyleLineDash=strokeStyle.getLineDash();state.lineDash=strokeStyleLineDash?strokeStyleLineDash.slice():render_canvas.Oq;const strokeStyleLineDashOffset=strokeStyle.getLineDashOffset();state.lineDashOffset=strokeStyleLineDashOffset||render_canvas.vk;const strokeStyleLineJoin=strokeStyle.getLineJoin();state.lineJoin=void 0!==strokeStyleLineJoin?strokeStyleLineJoin:render_canvas._K;const strokeStyleWidth=strokeStyle.getWidth();state.lineWidth=void 0!==strokeStyleWidth?strokeStyleWidth:render_canvas.aq;const strokeStyleMiterLimit=strokeStyle.getMiterLimit();state.miterLimit=void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:render_canvas.eL,state.lineWidth>this.maxLineWidth&&(this.maxLineWidth=state.lineWidth,this.bufferedMaxExtent_=null)}else state.strokeStyle=void 0,state.lineCap=void 0,state.lineDash=null,state.lineDashOffset=void 0,state.lineJoin=void 0,state.lineWidth=void 0,state.miterLimit=void 0}createFill(state){const fillStyle=state.fillStyle,fillInstruction=[canvas_Instruction.SET_FILL_STYLE,fillStyle];return"string"!=typeof fillStyle&&fillInstruction.push(!0),fillInstruction}applyStroke(state){this.instructions.push(this.createStroke(state))}createStroke(state){return[canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth*this.pixelRatio,state.lineCap,state.lineJoin,state.miterLimit,this.applyPixelRatio(state.lineDash),state.lineDashOffset*this.pixelRatio]}updateFillStyle(state,createFill){const fillStyle=state.fillStyle;"string"==typeof fillStyle&&state.currentFillStyle==fillStyle||(void 0!==fillStyle&&this.instructions.push(createFill.call(this,state)),state.currentFillStyle=fillStyle)}updateStrokeStyle(state,applyStroke){const strokeStyle=state.strokeStyle,lineCap=state.lineCap,lineDash=state.lineDash,lineDashOffset=state.lineDashOffset,lineJoin=state.lineJoin,lineWidth=state.lineWidth,miterLimit=state.miterLimit;(state.currentStrokeStyle!=strokeStyle||state.currentLineCap!=lineCap||lineDash!=state.currentLineDash&&!(0,array.aI)(state.currentLineDash,lineDash)||state.currentLineDashOffset!=lineDashOffset||state.currentLineJoin!=lineJoin||state.currentLineWidth!=lineWidth||state.currentMiterLimit!=miterLimit)&&(void 0!==strokeStyle&&applyStroke.call(this,state),state.currentStrokeStyle=strokeStyle,state.currentLineCap=lineCap,state.currentLineDash=lineDash,state.currentLineDashOffset=lineDashOffset,state.currentLineJoin=lineJoin,state.currentLineWidth=lineWidth,state.currentMiterLimit=miterLimit)}endGeometry(feature){this.beginGeometryInstruction1_[2]=this.instructions.length,this.beginGeometryInstruction1_=null,this.beginGeometryInstruction2_[2]=this.hitDetectionInstructions.length,this.beginGeometryInstruction2_=null;const endGeometryInstruction=[canvas_Instruction.END_GEOMETRY,feature];this.instructions.push(endGeometryInstruction),this.hitDetectionInstructions.push(endGeometryInstruction)}getBufferedMaxExtent(){if(!this.bufferedMaxExtent_&&(this.bufferedMaxExtent_=(0,ol_extent.o8)(this.maxExtent),this.maxLineWidth>0)){const width=this.resolution*(this.maxLineWidth+1)/2;(0,ol_extent.r)(this.bufferedMaxExtent_,width,this.bufferedMaxExtent_)}return this.bufferedMaxExtent_}};const ImageBuilder=class CanvasImageBuilder extends Builder{constructor(tolerance,maxExtent,resolution,pixelRatio){super(tolerance,maxExtent,resolution,pixelRatio),this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.anchorX_=void 0,this.anchorY_=void 0,this.height_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.scale_=void 0,this.width_=void 0,this.declutterMode_=void 0,this.declutterImageWithText_=void 0}drawPoint(pointGeometry,feature){if(!this.image_)return;this.beginGeometry(pointGeometry,feature);const flatCoordinates=pointGeometry.getFlatCoordinates(),stride=pointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.appendFlatPointCoordinates(flatCoordinates,stride);this.instructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(feature)}drawMultiPoint(multiPointGeometry,feature){if(!this.image_)return;this.beginGeometry(multiPointGeometry,feature);const flatCoordinates=multiPointGeometry.getFlatCoordinates(),stride=multiPointGeometry.getStride(),myBegin=this.coordinates.length,myEnd=this.appendFlatPointCoordinates(flatCoordinates,stride);this.instructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.image_,this.anchorX_*this.imagePixelRatio_,this.anchorY_*this.imagePixelRatio_,Math.ceil(this.height_*this.imagePixelRatio_),this.opacity_,this.originX_*this.imagePixelRatio_,this.originY_*this.imagePixelRatio_,this.rotateWithView_,this.rotation_,[this.scale_[0]*this.pixelRatio/this.imagePixelRatio_,this.scale_[1]*this.pixelRatio/this.imagePixelRatio_],Math.ceil(this.width_*this.imagePixelRatio_),this.declutterMode_,this.declutterImageWithText_]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,myBegin,myEnd,this.hitDetectionImage_,this.anchorX_,this.anchorY_,this.height_,1,this.originX_,this.originY_,this.rotateWithView_,this.rotation_,this.scale_,this.width_,this.declutterMode_,this.declutterImageWithText_]),this.endGeometry(feature)}finish(){return this.reverseHitDetectionInstructions(),this.anchorX_=void 0,this.anchorY_=void 0,this.hitDetectionImage_=null,this.image_=null,this.imagePixelRatio_=void 0,this.height_=void 0,this.scale_=void 0,this.opacity_=void 0,this.originX_=void 0,this.originY_=void 0,this.rotateWithView_=void 0,this.rotation_=void 0,this.width_=void 0,super.finish()}setImageStyle(imageStyle,sharedData){const anchor=imageStyle.getAnchor(),size=imageStyle.getSize(),origin=imageStyle.getOrigin();this.imagePixelRatio_=imageStyle.getPixelRatio(this.pixelRatio),this.anchorX_=anchor[0],this.anchorY_=anchor[1],this.hitDetectionImage_=imageStyle.getHitDetectionImage(),this.image_=imageStyle.getImage(this.pixelRatio),this.height_=size[1],this.opacity_=imageStyle.getOpacity(),this.originX_=origin[0],this.originY_=origin[1],this.rotateWithView_=imageStyle.getRotateWithView(),this.rotation_=imageStyle.getRotation(),this.scale_=imageStyle.getScaleArray(),this.width_=size[0],this.declutterMode_=imageStyle.getDeclutterMode(),this.declutterImageWithText_=sharedData}};const LineStringBuilder=class CanvasLineStringBuilder extends Builder{constructor(tolerance,maxExtent,resolution,pixelRatio){super(tolerance,maxExtent,resolution,pixelRatio)}drawFlatCoordinates_(flatCoordinates,offset,end,stride){const myBegin=this.coordinates.length,myEnd=this.appendFlatLineCoordinates(flatCoordinates,offset,end,stride,!1,!1),moveToLineToInstruction=[canvas_Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];return this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),end}drawLineString(lineStringGeometry,feature){const state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0===strokeStyle||void 0===lineWidth)return;this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(lineStringGeometry,feature),this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,render_canvas.Oq,render_canvas.vk],beginPathInstruction);const flatCoordinates=lineStringGeometry.getFlatCoordinates(),stride=lineStringGeometry.getStride();this.drawFlatCoordinates_(flatCoordinates,0,flatCoordinates.length,stride),this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(feature)}drawMultiLineString(multiLineStringGeometry,feature){const state=this.state,strokeStyle=state.strokeStyle,lineWidth=state.lineWidth;if(void 0===strokeStyle||void 0===lineWidth)return;this.updateStrokeStyle(state,this.applyStroke),this.beginGeometry(multiLineStringGeometry,feature),this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,render_canvas.Oq,render_canvas.vk],beginPathInstruction);const ends=multiLineStringGeometry.getEnds(),flatCoordinates=multiLineStringGeometry.getFlatCoordinates(),stride=multiLineStringGeometry.getStride();let offset=0;for(let i=0,ii=ends.length;i<ii;++i)offset=this.drawFlatCoordinates_(flatCoordinates,offset,ends[i],stride);this.hitDetectionInstructions.push(strokeInstruction),this.endGeometry(feature)}finish(){const state=this.state;return null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&this.instructions.push(strokeInstruction),this.reverseHitDetectionInstructions(),this.state=null,super.finish()}applyStroke(state){null!=state.lastStroke&&state.lastStroke!=this.coordinates.length&&(this.instructions.push(strokeInstruction),state.lastStroke=this.coordinates.length),state.lastStroke=0,super.applyStroke(state),this.instructions.push(beginPathInstruction)}};var simplify=__webpack_require__("./node_modules/ol/geom/flat/simplify.js");const PolygonBuilder=class CanvasPolygonBuilder extends Builder{constructor(tolerance,maxExtent,resolution,pixelRatio){super(tolerance,maxExtent,resolution,pixelRatio)}drawFlatCoordinatess_(flatCoordinates,offset,ends,stride){const state=this.state,fill=void 0!==state.fillStyle,stroke=void 0!==state.strokeStyle,numEnds=ends.length;this.instructions.push(beginPathInstruction),this.hitDetectionInstructions.push(beginPathInstruction);for(let i=0;i<numEnds;++i){const end=ends[i],myBegin=this.coordinates.length,myEnd=this.appendFlatLineCoordinates(flatCoordinates,offset,end,stride,!0,!stroke),moveToLineToInstruction=[canvas_Instruction.MOVE_TO_LINE_TO,myBegin,myEnd];this.instructions.push(moveToLineToInstruction),this.hitDetectionInstructions.push(moveToLineToInstruction),stroke&&(this.instructions.push(closePathInstruction),this.hitDetectionInstructions.push(closePathInstruction)),offset=end}return fill&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),stroke&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),offset}drawCircle(circleGeometry,feature){const state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0===fillStyle&&void 0===strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(circleGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,render_canvas.qY]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,render_canvas.Oq,render_canvas.vk]);const flatCoordinates=circleGeometry.getFlatCoordinates(),stride=circleGeometry.getStride(),myBegin=this.coordinates.length;this.appendFlatLineCoordinates(flatCoordinates,0,flatCoordinates.length,stride,!1,!1);const circleInstruction=[canvas_Instruction.CIRCLE,myBegin];this.instructions.push(beginPathInstruction,circleInstruction),this.hitDetectionInstructions.push(beginPathInstruction,circleInstruction),void 0!==state.fillStyle&&(this.instructions.push(fillInstruction),this.hitDetectionInstructions.push(fillInstruction)),void 0!==state.strokeStyle&&(this.instructions.push(strokeInstruction),this.hitDetectionInstructions.push(strokeInstruction)),this.endGeometry(feature)}drawPolygon(polygonGeometry,feature){const state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0===fillStyle&&void 0===strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(polygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,render_canvas.qY]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,render_canvas.Oq,render_canvas.vk]);const ends=polygonGeometry.getEnds(),flatCoordinates=polygonGeometry.getOrientedFlatCoordinates(),stride=polygonGeometry.getStride();this.drawFlatCoordinatess_(flatCoordinates,0,ends,stride),this.endGeometry(feature)}drawMultiPolygon(multiPolygonGeometry,feature){const state=this.state,fillStyle=state.fillStyle,strokeStyle=state.strokeStyle;if(void 0===fillStyle&&void 0===strokeStyle)return;this.setFillStrokeStyles_(),this.beginGeometry(multiPolygonGeometry,feature),void 0!==state.fillStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_FILL_STYLE,render_canvas.qY]),void 0!==state.strokeStyle&&this.hitDetectionInstructions.push([canvas_Instruction.SET_STROKE_STYLE,state.strokeStyle,state.lineWidth,state.lineCap,state.lineJoin,state.miterLimit,render_canvas.Oq,render_canvas.vk]);const endss=multiPolygonGeometry.getEndss(),flatCoordinates=multiPolygonGeometry.getOrientedFlatCoordinates(),stride=multiPolygonGeometry.getStride();let offset=0;for(let i=0,ii=endss.length;i<ii;++i)offset=this.drawFlatCoordinatess_(flatCoordinates,offset,endss[i],stride);this.endGeometry(feature)}finish(){this.reverseHitDetectionInstructions(),this.state=null;const tolerance=this.tolerance;if(0!==tolerance){const coordinates=this.coordinates;for(let i=0,ii=coordinates.length;i<ii;++i)coordinates[i]=(0,simplify.n$)(coordinates[i],tolerance)}return super.finish()}setFillStrokeStyles_(){const state=this.state;void 0!==state.fillStyle&&this.updateFillStyle(state,this.createFill),void 0!==state.strokeStyle&&this.updateStrokeStyle(state,this.applyStroke)}};function lineChunk(chunkLength,flatCoordinates,offset,end,stride){const chunks=[];let cursor=offset,chunkM=0,currentChunk=flatCoordinates.slice(offset,2);for(;chunkM<chunkLength&&cursor+stride<end;){const[x1,y1]=currentChunk.slice(-2),x2=flatCoordinates[cursor+stride],y2=flatCoordinates[cursor+stride+1],segmentLength=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1));if(chunkM+=segmentLength,chunkM>=chunkLength){const m=(chunkLength-chunkM+segmentLength)/segmentLength,x=(0,math.Cc)(x1,x2,m),y=(0,math.Cc)(y1,y2,m);currentChunk.push(x,y),chunks.push(currentChunk),currentChunk=[x,y],chunkM==chunkLength&&(cursor+=stride),chunkM=0}else if(chunkM<chunkLength)currentChunk.push(flatCoordinates[cursor+stride],flatCoordinates[cursor+stride+1]),cursor+=stride;else{const missing=segmentLength-chunkM,x=(0,math.Cc)(x1,x2,missing/segmentLength),y=(0,math.Cc)(y1,y2,missing/segmentLength);currentChunk.push(x,y),chunks.push(currentChunk),currentChunk=[x,y],chunkM=0,cursor+=stride}}return chunkM>0&&chunks.push(currentChunk),chunks}function matchingChunk(maxAngle,flatCoordinates,offset,end,stride){let acos,i,m12,m23,x1,y1,x12,y12,x23,y23,chunkStart=offset,chunkEnd=offset,chunkM=0,m=0,start=offset;for(i=offset;i<end;i+=stride){const x2=flatCoordinates[i],y2=flatCoordinates[i+1];void 0!==x1&&(x23=x2-x1,y23=y2-y1,m23=Math.sqrt(x23*x23+y23*y23),void 0!==x12&&(m+=m12,acos=Math.acos((x12*x23+y12*y23)/(m12*m23)),acos>maxAngle&&(m>chunkM&&(chunkM=m,chunkStart=start,chunkEnd=i),m=0,start=i-stride)),m12=m23,x12=x23,y12=y23),x1=x2,y1=y2}return m+=m23,m>chunkM?[start,i]:[chunkStart,chunkEnd]}const TEXT_ALIGN={left:0,center:.5,right:1,top:0,middle:.5,hanging:.2,alphabetic:.8,ideographic:.8,bottom:1};const TextBuilder=class CanvasTextBuilder extends Builder{constructor(tolerance,maxExtent,resolution,pixelRatio){super(tolerance,maxExtent,resolution,pixelRatio),this.labels_=null,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=void 0,this.textRotation_=0,this.textFillState_=null,this.fillStates={},this.fillStates[render_canvas.qY]={fillStyle:render_canvas.qY},this.textStrokeState_=null,this.strokeStates={},this.textState_={},this.textStates={},this.textKey_="",this.fillKey_="",this.strokeKey_="",this.declutterImageWithText_=void 0}finish(){const instructions=super.finish();return instructions.textStates=this.textStates,instructions.fillStates=this.fillStates,instructions.strokeStates=this.strokeStates,instructions}drawText(geometry,feature){const fillState=this.textFillState_,strokeState=this.textStrokeState_,textState=this.textState_;if(""===this.text_||!textState||!fillState&&!strokeState)return;const coordinates=this.coordinates;let begin=coordinates.length;const geometryType=geometry.getType();let flatCoordinates=null,stride=geometry.getStride();if("line"!==textState.placement||"LineString"!=geometryType&&"MultiLineString"!=geometryType&&"Polygon"!=geometryType&&"MultiPolygon"!=geometryType){let geometryWidths=textState.overflow?null:[];switch(geometryType){case"Point":case"MultiPoint":flatCoordinates=geometry.getFlatCoordinates();break;case"LineString":flatCoordinates=geometry.getFlatMidpoint();break;case"Circle":flatCoordinates=geometry.getCenter();break;case"MultiLineString":flatCoordinates=geometry.getFlatMidpoints(),stride=2;break;case"Polygon":flatCoordinates=geometry.getFlatInteriorPoint(),textState.overflow||geometryWidths.push(flatCoordinates[2]/this.resolution),stride=3;break;case"MultiPolygon":const interiorPoints=geometry.getFlatInteriorPoints();flatCoordinates=[];for(let i=0,ii=interiorPoints.length;i<ii;i+=3)textState.overflow||geometryWidths.push(interiorPoints[i+2]/this.resolution),flatCoordinates.push(interiorPoints[i],interiorPoints[i+1]);if(0===flatCoordinates.length)return;stride=2}const end=this.appendFlatPointCoordinates(flatCoordinates,stride);if(end===begin)return;if(geometryWidths&&(end-begin)/2!=flatCoordinates.length/stride){let beg=begin/2;geometryWidths=geometryWidths.filter(((w,i)=>{const keep=coordinates[2*(beg+i)]===flatCoordinates[i*stride]&&coordinates[2*(beg+i)+1]===flatCoordinates[i*stride+1];return keep||--beg,keep}))}this.saveTextStates_(),(textState.backgroundFill||textState.backgroundStroke)&&(this.setFillStrokeStyle(textState.backgroundFill,textState.backgroundStroke),textState.backgroundFill&&this.updateFillStyle(this.state,this.createFill),textState.backgroundStroke&&(this.updateStrokeStyle(this.state,this.applyStroke),this.hitDetectionInstructions.push(this.createStroke(this.state)))),this.beginGeometry(geometry,feature);let padding=textState.padding;if(padding!=render_canvas.Tq&&(textState.scale[0]<0||textState.scale[1]<0)){let p0=textState.padding[0],p1=textState.padding[1],p2=textState.padding[2],p3=textState.padding[3];textState.scale[0]<0&&(p1=-p1,p3=-p3),textState.scale[1]<0&&(p0=-p0,p2=-p2),padding=[p0,p1,p2,p3]}const pixelRatio=this.pixelRatio;this.instructions.push([canvas_Instruction.DRAW_IMAGE,begin,end,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[1,1],NaN,void 0,this.declutterImageWithText_,padding==render_canvas.Tq?render_canvas.Tq:padding.map((function(p){return p*pixelRatio})),!!textState.backgroundFill,!!textState.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_,this.textOffsetX_,this.textOffsetY_,geometryWidths]);const scale=1/pixelRatio,currentFillStyle=this.state.fillStyle;textState.backgroundFill&&(this.state.fillStyle=render_canvas.qY,this.hitDetectionInstructions.push(this.createFill(this.state))),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_IMAGE,begin,end,null,NaN,NaN,NaN,1,0,0,this.textRotateWithView_,this.textRotation_,[scale,scale],NaN,void 0,this.declutterImageWithText_,padding,!!textState.backgroundFill,!!textState.backgroundStroke,this.text_,this.textKey_,this.strokeKey_,this.fillKey_?render_canvas.qY:this.fillKey_,this.textOffsetX_,this.textOffsetY_,geometryWidths]),textState.backgroundFill&&(this.state.fillStyle=currentFillStyle,this.hitDetectionInstructions.push(this.createFill(this.state))),this.endGeometry(feature)}else{if(!(0,ol_extent.HY)(this.getBufferedMaxExtent(),geometry.getExtent()))return;let ends;if(flatCoordinates=geometry.getFlatCoordinates(),"LineString"==geometryType)ends=[flatCoordinates.length];else if("MultiLineString"==geometryType)ends=geometry.getEnds();else if("Polygon"==geometryType)ends=geometry.getEnds().slice(0,1);else if("MultiPolygon"==geometryType){const endss=geometry.getEndss();ends=[];for(let i=0,ii=endss.length;i<ii;++i)ends.push(endss[i][0])}this.beginGeometry(geometry,feature);const repeat=textState.repeat,textAlign=repeat?void 0:textState.textAlign;let flatOffset=0;for(let o=0,oo=ends.length;o<oo;++o){let chunks;chunks=repeat?lineChunk(repeat*this.resolution,flatCoordinates,flatOffset,ends[o],stride):[flatCoordinates.slice(flatOffset,ends[o])];for(let c=0,cc=chunks.length;c<cc;++c){const chunk=chunks[c];let chunkBegin=0,chunkEnd=chunk.length;if(null==textAlign){const range=matchingChunk(textState.maxAngle,chunk,0,chunk.length,2);chunkBegin=range[0],chunkEnd=range[1]}for(let i=chunkBegin;i<chunkEnd;i+=stride)coordinates.push(chunk[i],chunk[i+1]);const end=coordinates.length;flatOffset=ends[o],this.drawChars_(begin,end),begin=end}}this.endGeometry(feature)}}saveTextStates_(){const strokeState=this.textStrokeState_,textState=this.textState_,fillState=this.textFillState_,strokeKey=this.strokeKey_;strokeState&&(strokeKey in this.strokeStates||(this.strokeStates[strokeKey]={strokeStyle:strokeState.strokeStyle,lineCap:strokeState.lineCap,lineDashOffset:strokeState.lineDashOffset,lineWidth:strokeState.lineWidth,lineJoin:strokeState.lineJoin,miterLimit:strokeState.miterLimit,lineDash:strokeState.lineDash}));const textKey=this.textKey_;textKey in this.textStates||(this.textStates[textKey]={font:textState.font,textAlign:textState.textAlign||render_canvas.MY,justify:textState.justify,textBaseline:textState.textBaseline||render_canvas.M8,scale:textState.scale});const fillKey=this.fillKey_;fillState&&(fillKey in this.fillStates||(this.fillStates[fillKey]={fillStyle:fillState.fillStyle}))}drawChars_(begin,end){const strokeState=this.textStrokeState_,textState=this.textState_,strokeKey=this.strokeKey_,textKey=this.textKey_,fillKey=this.fillKey_;this.saveTextStates_();const pixelRatio=this.pixelRatio,baseline=TEXT_ALIGN[textState.textBaseline],offsetY=this.textOffsetY_*pixelRatio,text=this.text_,strokeWidth=strokeState?strokeState.lineWidth*Math.abs(textState.scale[0])/2:0;this.instructions.push([canvas_Instruction.DRAW_CHARS,begin,end,baseline,textState.overflow,fillKey,textState.maxAngle,pixelRatio,offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1]),this.hitDetectionInstructions.push([canvas_Instruction.DRAW_CHARS,begin,end,baseline,textState.overflow,fillKey?render_canvas.qY:fillKey,textState.maxAngle,pixelRatio,offsetY,strokeKey,strokeWidth*pixelRatio,text,textKey,1/pixelRatio])}setTextStyle(textStyle,sharedData){let textState,fillState,strokeState;if(textStyle){const textFillStyle=textStyle.getFill();textFillStyle?(fillState=this.textFillState_,fillState||(fillState={},this.textFillState_=fillState),fillState.fillStyle=(0,colorlike.F)(textFillStyle.getColor()||render_canvas.qY)):(fillState=null,this.textFillState_=fillState);const textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){strokeState=this.textStrokeState_,strokeState||(strokeState={},this.textStrokeState_=strokeState);const lineDash=textStrokeStyle.getLineDash(),lineDashOffset=textStrokeStyle.getLineDashOffset(),lineWidth=textStrokeStyle.getWidth(),miterLimit=textStrokeStyle.getMiterLimit();strokeState.lineCap=textStrokeStyle.getLineCap()||render_canvas._m,strokeState.lineDash=lineDash?lineDash.slice():render_canvas.Oq,strokeState.lineDashOffset=void 0===lineDashOffset?render_canvas.vk:lineDashOffset,strokeState.lineJoin=textStrokeStyle.getLineJoin()||render_canvas._K,strokeState.lineWidth=void 0===lineWidth?render_canvas.aq:lineWidth,strokeState.miterLimit=void 0===miterLimit?render_canvas.eL:miterLimit,strokeState.strokeStyle=(0,colorlike.F)(textStrokeStyle.getColor()||render_canvas.NT)}else strokeState=null,this.textStrokeState_=strokeState;textState=this.textState_;const font=textStyle.getFont()||render_canvas.ZV;(0,render_canvas.fZ)(font);const textScale=textStyle.getScaleArray();textState.overflow=textStyle.getOverflow(),textState.font=font,textState.maxAngle=textStyle.getMaxAngle(),textState.placement=textStyle.getPlacement(),textState.textAlign=textStyle.getTextAlign(),textState.repeat=textStyle.getRepeat(),textState.justify=textStyle.getJustify(),textState.textBaseline=textStyle.getTextBaseline()||render_canvas.M8,textState.backgroundFill=textStyle.getBackgroundFill(),textState.backgroundStroke=textStyle.getBackgroundStroke(),textState.padding=textStyle.getPadding()||render_canvas.Tq,textState.scale=void 0===textScale?[1,1]:textScale;const textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation();this.text_=textStyle.getText()||"",this.textOffsetX_=void 0===textOffsetX?0:textOffsetX,this.textOffsetY_=void 0===textOffsetY?0:textOffsetY,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0===textRotation?0:textRotation,this.strokeKey_=strokeState?("string"==typeof strokeState.strokeStyle?strokeState.strokeStyle:(0,util.v6)(strokeState.strokeStyle))+strokeState.lineCap+strokeState.lineDashOffset+"|"+strokeState.lineWidth+strokeState.lineJoin+strokeState.miterLimit+"["+strokeState.lineDash.join()+"]":"",this.textKey_=textState.font+textState.scale+(textState.textAlign||"?")+(textState.repeat||"?")+(textState.justify||"?")+(textState.textBaseline||"?"),this.fillKey_=fillState?"string"==typeof fillState.fillStyle?fillState.fillStyle:"|"+(0,util.v6)(fillState.fillStyle):""}else this.text_="";this.declutterImageWithText_=sharedData}},BATCH_CONSTRUCTORS={Circle:PolygonBuilder,Default:Builder,Image:ImageBuilder,LineString:LineStringBuilder,Polygon:PolygonBuilder,Text:TextBuilder};const canvas_BuilderGroup=class BuilderGroup{constructor(tolerance,maxExtent,resolution,pixelRatio){this.tolerance_=tolerance,this.maxExtent_=maxExtent,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.buildersByZIndex_={}}finish(){const builderInstructions={};for(const zKey in this.buildersByZIndex_){builderInstructions[zKey]=builderInstructions[zKey]||{};const builders=this.buildersByZIndex_[zKey];for(const builderKey in builders){const builderInstruction=builders[builderKey].finish();builderInstructions[zKey][builderKey]=builderInstruction}}return builderInstructions}getBuilder(zIndex,builderType){const zIndexKey=void 0!==zIndex?zIndex.toString():"0";let replays=this.buildersByZIndex_[zIndexKey];void 0===replays&&(replays={},this.buildersByZIndex_[zIndexKey]=replays);let replay=replays[builderType];if(void 0===replay){replay=new(0,BATCH_CONSTRUCTORS[builderType])(this.tolerance_,this.maxExtent_,this.resolution_,this.pixelRatio_),replays[builderType]=replay}return replay}};var flat_transform=__webpack_require__("./node_modules/ol/geom/flat/transform.js");function drawTextOnPath(flatCoordinates,offset,end,stride,text,startM,maxAngle,scale,measureAndCacheTextWidth,font,cache,rotation){let x2=flatCoordinates[offset],y2=flatCoordinates[offset+1],x1=0,y1=0,segmentLength=0,segmentM=0;function advance(){x1=x2,y1=y2,x2=flatCoordinates[offset+=stride],y2=flatCoordinates[offset+1],segmentM+=segmentLength,segmentLength=Math.sqrt((x2-x1)*(x2-x1)+(y2-y1)*(y2-y1))}do{advance()}while(offset<end-stride&&segmentM+segmentLength<startM);let interpolate=0===segmentLength?0:(startM-segmentM)/segmentLength;const beginX=(0,math.Cc)(x1,x2,interpolate),beginY=(0,math.Cc)(y1,y2,interpolate),startOffset=offset-stride,startLength=segmentM,endM=startM+scale*measureAndCacheTextWidth(font,text,cache);for(;offset<end-stride&&segmentM+segmentLength<endM;)advance();interpolate=0===segmentLength?0:(endM-segmentM)/segmentLength;const endX=(0,math.Cc)(x1,x2,interpolate),endY=(0,math.Cc)(y1,y2,interpolate);let reverse;if(rotation){const flat=[beginX,beginY,endX,endY];(0,flat_transform.e$)(flat,0,4,2,rotation,flat,flat),reverse=flat[0]>flat[2]}else reverse=beginX>endX;const PI=Math.PI,result=[],singleSegment=startOffset+stride===offset;let previousAngle;if(segmentLength=0,segmentM=startLength,x2=flatCoordinates[offset=startOffset],y2=flatCoordinates[offset+1],singleSegment){advance(),previousAngle=Math.atan2(y2-y1,x2-x1),reverse&&(previousAngle+=previousAngle>0?-PI:PI);const x=(endX+beginX)/2,y=(endY+beginY)/2;return result[0]=[x,y,(endM-startM)/2,previousAngle,text],result}for(let i=0,ii=(text=text.replace(/\n/g," ")).length;i<ii;){advance();let angle=Math.atan2(y2-y1,x2-x1);if(reverse&&(angle+=angle>0?-PI:PI),void 0!==previousAngle){let delta=angle-previousAngle;if(delta+=delta>PI?-2*PI:delta<-PI?2*PI:0,Math.abs(delta)>maxAngle)return null}previousAngle=angle;const iStart=i;let charLength=0;for(;i<ii;++i){const len=scale*measureAndCacheTextWidth(font,text[reverse?ii-i-1:i],cache);if(offset+stride<end&&segmentM+segmentLength<startM+charLength+len/2)break;charLength+=len}if(i===iStart)continue;const chars=reverse?text.substring(ii-iStart,ii-i):text.substring(iStart,i);interpolate=0===segmentLength?0:(startM+charLength/2-segmentM)/segmentLength;const x=(0,math.Cc)(x1,x2,interpolate),y=(0,math.Cc)(y1,y2,interpolate);result.push([x,y,charLength/2,angle,chars]),startM+=charLength}return result}var flat_length=__webpack_require__("./node_modules/ol/geom/flat/length.js");const tmpExtent=(0,ol_extent.S5)(),p1=[],p2=[],p3=[],p4=[];function getDeclutterBox(replayImageOrLabelArgs){return replayImageOrLabelArgs[3].declutterBox}const rtlRegEx=new RegExp("["+String.fromCharCode(1425)+"-"+String.fromCharCode(2303)+String.fromCharCode(64285)+"-"+String.fromCharCode(65023)+String.fromCharCode(65136)+"-"+String.fromCharCode(65276)+String.fromCharCode(67584)+"-"+String.fromCharCode(69631)+String.fromCharCode(124928)+"-"+String.fromCharCode(126975)+"]");function horizontalTextAlign(text,align){return"start"===align?align=rtlRegEx.test(text)?"right":"left":"end"===align&&(align=rtlRegEx.test(text)?"left":"right"),TEXT_ALIGN[align]}function createTextChunks(acc,line,i){return i>0&&acc.push("\n",""),acc.push(line,""),acc}const canvas_Executor=class Executor{constructor(resolution,pixelRatio,overlaps,instructions){this.overlaps=overlaps,this.pixelRatio=pixelRatio,this.resolution=resolution,this.alignFill_,this.instructions=instructions.instructions,this.coordinates=instructions.coordinates,this.coordinateCache_={},this.renderedTransform_=(0,ol_transform.vt)(),this.hitDetectionInstructions=instructions.hitDetectionInstructions,this.pixelCoordinates_=null,this.viewRotation_=0,this.fillStates=instructions.fillStates||{},this.strokeStates=instructions.strokeStates||{},this.textStates=instructions.textStates||{},this.widths_={},this.labels_={}}createLabel(text,textKey,fillKey,strokeKey){const key=text+textKey+fillKey+strokeKey;if(this.labels_[key])return this.labels_[key];const strokeState=strokeKey?this.strokeStates[strokeKey]:null,fillState=fillKey?this.fillStates[fillKey]:null,textState=this.textStates[textKey],pixelRatio=this.pixelRatio,scale=[textState.scale[0]*pixelRatio,textState.scale[1]*pixelRatio],textIsArray=Array.isArray(text),align=textState.justify?TEXT_ALIGN[textState.justify]:horizontalTextAlign(Array.isArray(text)?text[0]:text,textState.textAlign||render_canvas.MY),strokeWidth=strokeKey&&strokeState.lineWidth?strokeState.lineWidth:0,chunks=textIsArray?text:text.split("\n").reduce(createTextChunks,[]),{width,height,widths,heights,lineWidths}=(0,render_canvas.jT)(textState,chunks),renderWidth=width+strokeWidth,contextInstructions=[],w=(renderWidth+2)*scale[0],h=(height+strokeWidth)*scale[1],label={width:w<0?Math.floor(w):Math.ceil(w),height:h<0?Math.floor(h):Math.ceil(h),contextInstructions};1==scale[0]&&1==scale[1]||contextInstructions.push("scale",scale),strokeKey&&(contextInstructions.push("strokeStyle",strokeState.strokeStyle),contextInstructions.push("lineWidth",strokeWidth),contextInstructions.push("lineCap",strokeState.lineCap),contextInstructions.push("lineJoin",strokeState.lineJoin),contextInstructions.push("miterLimit",strokeState.miterLimit),contextInstructions.push("setLineDash",[strokeState.lineDash]),contextInstructions.push("lineDashOffset",strokeState.lineDashOffset)),fillKey&&contextInstructions.push("fillStyle",fillState.fillStyle),contextInstructions.push("textBaseline","middle"),contextInstructions.push("textAlign","center");const leftRight=.5-align;let x=align*renderWidth+leftRight*strokeWidth;const strokeInstructions=[],fillInstructions=[];let previousFont,lineHeight=0,lineOffset=0,widthHeightIndex=0,lineWidthIndex=0;for(let i=0,ii=chunks.length;i<ii;i+=2){const text=chunks[i];if("\n"===text){lineOffset+=lineHeight,lineHeight=0,x=align*renderWidth+leftRight*strokeWidth,++lineWidthIndex;continue}const font=chunks[i+1]||textState.font;font!==previousFont&&(strokeKey&&strokeInstructions.push("font",font),fillKey&&fillInstructions.push("font",font),previousFont=font),lineHeight=Math.max(lineHeight,heights[widthHeightIndex]);const fillStrokeArgs=[text,x+leftRight*widths[widthHeightIndex]+align*(widths[widthHeightIndex]-lineWidths[lineWidthIndex]),.5*(strokeWidth+lineHeight)+lineOffset];x+=widths[widthHeightIndex],strokeKey&&strokeInstructions.push("strokeText",fillStrokeArgs),fillKey&&fillInstructions.push("fillText",fillStrokeArgs),++widthHeightIndex}return Array.prototype.push.apply(contextInstructions,strokeInstructions),Array.prototype.push.apply(contextInstructions,fillInstructions),this.labels_[key]=label,label}replayTextBackground_(context,p1,p2,p3,p4,fillInstruction,strokeInstruction){context.beginPath(),context.moveTo.apply(context,p1),context.lineTo.apply(context,p2),context.lineTo.apply(context,p3),context.lineTo.apply(context,p4),context.lineTo.apply(context,p1),fillInstruction&&(this.alignFill_=fillInstruction[2],this.fill_(context)),strokeInstruction&&(this.setStrokeStyle_(context,strokeInstruction),context.stroke())}calculateImageOrLabelDimensions_(sheetWidth,sheetHeight,centerX,centerY,width,height,anchorX,anchorY,originX,originY,rotation,scale,snapToPixel,padding,fillStroke,feature){let x=centerX-(anchorX*=scale[0]),y=centerY-(anchorY*=scale[1]);const w=width+originX>sheetWidth?sheetWidth-originX:width,h=height+originY>sheetHeight?sheetHeight-originY:height,boxW=padding[3]+w*scale[0]+padding[1],boxH=padding[0]+h*scale[1]+padding[2],boxX=x-padding[3],boxY=y-padding[0];let transform;return(fillStroke||0!==rotation)&&(p1[0]=boxX,p4[0]=boxX,p1[1]=boxY,p2[1]=boxY,p2[0]=boxX+boxW,p3[0]=p2[0],p3[1]=boxY+boxH,p4[1]=p3[1]),0!==rotation?(transform=(0,ol_transform.Zz)((0,ol_transform.vt)(),centerX,centerY,1,1,rotation,-centerX,-centerY),(0,ol_transform.Bb)(transform,p1),(0,ol_transform.Bb)(transform,p2),(0,ol_transform.Bb)(transform,p3),(0,ol_transform.Bb)(transform,p4),(0,ol_extent.N)(Math.min(p1[0],p2[0],p3[0],p4[0]),Math.min(p1[1],p2[1],p3[1],p4[1]),Math.max(p1[0],p2[0],p3[0],p4[0]),Math.max(p1[1],p2[1],p3[1],p4[1]),tmpExtent)):(0,ol_extent.N)(Math.min(boxX,boxX+boxW),Math.min(boxY,boxY+boxH),Math.max(boxX,boxX+boxW),Math.max(boxY,boxY+boxH),tmpExtent),snapToPixel&&(x=Math.round(x),y=Math.round(y)),{drawImageX:x,drawImageY:y,drawImageW:w,drawImageH:h,originX,originY,declutterBox:{minX:tmpExtent[0],minY:tmpExtent[1],maxX:tmpExtent[2],maxY:tmpExtent[3],value:feature},canvasTransform:transform,scale}}replayImageOrLabel_(context,contextScale,imageOrLabel,dimensions,opacity,fillInstruction,strokeInstruction){const fillStroke=!(!fillInstruction&&!strokeInstruction),box=dimensions.declutterBox,canvas=context.canvas,strokePadding=strokeInstruction?strokeInstruction[2]*dimensions.scale[0]/2:0;return box.minX-strokePadding<=canvas.width/contextScale&&box.maxX+strokePadding>=0&&box.minY-strokePadding<=canvas.height/contextScale&&box.maxY+strokePadding>=0&&(fillStroke&&this.replayTextBackground_(context,p1,p2,p3,p4,fillInstruction,strokeInstruction),(0,render_canvas.Jw)(context,dimensions.canvasTransform,opacity,imageOrLabel,dimensions.originX,dimensions.originY,dimensions.drawImageW,dimensions.drawImageH,dimensions.drawImageX,dimensions.drawImageY,dimensions.scale)),!0}fill_(context){if(this.alignFill_){const origin=(0,ol_transform.Bb)(this.renderedTransform_,[0,0]),repeatSize=512*this.pixelRatio;context.save(),context.translate(origin[0]%repeatSize,origin[1]%repeatSize),context.rotate(this.viewRotation_)}context.fill(),this.alignFill_&&context.restore()}setStrokeStyle_(context,instruction){context.strokeStyle=instruction[1],context.lineWidth=instruction[2],context.lineCap=instruction[3],context.lineJoin=instruction[4],context.miterLimit=instruction[5],context.lineDashOffset=instruction[7],context.setLineDash(instruction[6])}drawLabelWithPointPlacement_(text,textKey,strokeKey,fillKey){const textState=this.textStates[textKey],label=this.createLabel(text,textKey,fillKey,strokeKey),strokeState=this.strokeStates[strokeKey],pixelRatio=this.pixelRatio,align=horizontalTextAlign(Array.isArray(text)?text[0]:text,textState.textAlign||render_canvas.MY),baseline=TEXT_ALIGN[textState.textBaseline||render_canvas.M8],strokeWidth=strokeState&&strokeState.lineWidth?strokeState.lineWidth:0;return{label,anchorX:align*(label.width/pixelRatio-2*textState.scale[0])+2*(.5-align)*strokeWidth,anchorY:baseline*label.height/pixelRatio+2*(.5-baseline)*strokeWidth}}execute_(context,contextScale,transform,instructions,snapToPixel,featureCallback,hitExtent,declutterTree){let pixelCoordinates;this.pixelCoordinates_&&(0,array.aI)(transform,this.renderedTransform_)?pixelCoordinates=this.pixelCoordinates_:(this.pixelCoordinates_||(this.pixelCoordinates_=[]),pixelCoordinates=(0,flat_transform.Rc)(this.coordinates,0,this.coordinates.length,2,transform,this.pixelCoordinates_),(0,ol_transform.k3)(this.renderedTransform_,transform));let i=0;const ii=instructions.length;let dd,anchorX,anchorY,prevX,prevY,roundX,roundY,image,text,textKey,strokeKey,fillKey,d=0,pendingFill=0,pendingStroke=0,lastFillInstruction=null,lastStrokeInstruction=null;const coordinateCache=this.coordinateCache_,viewRotation=this.viewRotation_,viewRotationFromTransform=Math.round(1e12*Math.atan2(-transform[1],transform[0]))/1e12,state={context,pixelRatio:this.pixelRatio,resolution:this.resolution,rotation:viewRotation},batchSize=this.instructions!=instructions||this.overlaps?0:200;let feature,x,y,currentGeometry;for(;i<ii;){const instruction=instructions[i];switch(instruction[0]){case canvas_Instruction.BEGIN_GEOMETRY:feature=instruction[1],currentGeometry=instruction[3],feature.getGeometry()?void 0===hitExtent||(0,ol_extent.HY)(hitExtent,currentGeometry.getExtent())?++i:i=instruction[2]+1:i=instruction[2];break;case canvas_Instruction.BEGIN_PATH:pendingFill>batchSize&&(this.fill_(context),pendingFill=0),pendingStroke>batchSize&&(context.stroke(),pendingStroke=0),pendingFill||pendingStroke||(context.beginPath(),prevX=NaN,prevY=NaN),++i;break;case canvas_Instruction.CIRCLE:d=instruction[1];const x1=pixelCoordinates[d],y1=pixelCoordinates[d+1],dx=pixelCoordinates[d+2]-x1,dy=pixelCoordinates[d+3]-y1,r=Math.sqrt(dx*dx+dy*dy);context.moveTo(x1+r,y1),context.arc(x1,y1,r,0,2*Math.PI,!0),++i;break;case canvas_Instruction.CLOSE_PATH:context.closePath(),++i;break;case canvas_Instruction.CUSTOM:d=instruction[1],dd=instruction[2];const geometry=instruction[3],renderer=instruction[4],fn=6==instruction.length?instruction[5]:void 0;state.geometry=geometry,state.feature=feature,i in coordinateCache||(coordinateCache[i]=[]);const coords=coordinateCache[i];fn?fn(pixelCoordinates,d,dd,2,coords):(coords[0]=pixelCoordinates[d],coords[1]=pixelCoordinates[d+1],coords.length=2),renderer(coords,state),++i;break;case canvas_Instruction.DRAW_IMAGE:d=instruction[1],dd=instruction[2],image=instruction[3],anchorX=instruction[4],anchorY=instruction[5];let height=instruction[6];const opacity=instruction[7],originX=instruction[8],originY=instruction[9],rotateWithView=instruction[10];let rotation=instruction[11];const scale=instruction[12];let width=instruction[13];const declutterMode=instruction[14],declutterImageWithText=instruction[15];if(!image&&instruction.length>=20){text=instruction[19],textKey=instruction[20],strokeKey=instruction[21],fillKey=instruction[22];const labelWithAnchor=this.drawLabelWithPointPlacement_(text,textKey,strokeKey,fillKey);image=labelWithAnchor.label,instruction[3]=image;const textOffsetX=instruction[23];anchorX=(labelWithAnchor.anchorX-textOffsetX)*this.pixelRatio,instruction[4]=anchorX;const textOffsetY=instruction[24];anchorY=(labelWithAnchor.anchorY-textOffsetY)*this.pixelRatio,instruction[5]=anchorY,height=image.height,instruction[6]=height,width=image.width,instruction[13]=width}let geometryWidths,padding,backgroundFill,backgroundStroke;instruction.length>25&&(geometryWidths=instruction[25]),instruction.length>17?(padding=instruction[16],backgroundFill=instruction[17],backgroundStroke=instruction[18]):(padding=render_canvas.Tq,backgroundFill=!1,backgroundStroke=!1),rotateWithView&&viewRotationFromTransform?rotation+=viewRotation:rotateWithView||viewRotationFromTransform||(rotation-=viewRotation);let widthIndex=0;for(;d<dd;d+=2){if(geometryWidths&&geometryWidths[widthIndex++]<width/this.pixelRatio)continue;const dimensions=this.calculateImageOrLabelDimensions_(image.width,image.height,pixelCoordinates[d],pixelCoordinates[d+1],width,height,anchorX,anchorY,originX,originY,rotation,scale,snapToPixel,padding,backgroundFill||backgroundStroke,feature),args=[context,contextScale,image,dimensions,opacity,backgroundFill?lastFillInstruction:null,backgroundStroke?lastStrokeInstruction:null];if(declutterTree){if("none"===declutterMode)continue;if("obstacle"===declutterMode){declutterTree.insert(dimensions.declutterBox);continue}{let imageArgs,imageDeclutterBox;if(declutterImageWithText){const index=dd-d;if(!declutterImageWithText[index]){declutterImageWithText[index]=args;continue}if(imageArgs=declutterImageWithText[index],delete declutterImageWithText[index],imageDeclutterBox=getDeclutterBox(imageArgs),declutterTree.collides(imageDeclutterBox))continue}if(declutterTree.collides(dimensions.declutterBox))continue;imageArgs&&(declutterTree.insert(imageDeclutterBox),this.replayImageOrLabel_.apply(this,imageArgs)),declutterTree.insert(dimensions.declutterBox)}}this.replayImageOrLabel_.apply(this,args)}++i;break;case canvas_Instruction.DRAW_CHARS:const begin=instruction[1],end=instruction[2],baseline=instruction[3],overflow=instruction[4];fillKey=instruction[5];const maxAngle=instruction[6],measurePixelRatio=instruction[7],offsetY=instruction[8];strokeKey=instruction[9];const strokeWidth=instruction[10];text=instruction[11],textKey=instruction[12];const pixelRatioScale=[instruction[13],instruction[13]],textState=this.textStates[textKey],font=textState.font,textScale=[textState.scale[0]*measurePixelRatio,textState.scale[1]*measurePixelRatio];let cachedWidths;font in this.widths_?cachedWidths=this.widths_[font]:(cachedWidths={},this.widths_[font]=cachedWidths);const pathLength=(0,flat_length.k)(pixelCoordinates,begin,end,2),textLength=Math.abs(textScale[0])*(0,render_canvas.TA)(font,text,cachedWidths);if(overflow||textLength<=pathLength){const parts=drawTextOnPath(pixelCoordinates,begin,end,2,text,(pathLength-textLength)*horizontalTextAlign(text,this.textStates[textKey].textAlign),maxAngle,Math.abs(textScale[0]),render_canvas.TA,font,cachedWidths,viewRotationFromTransform?0:this.viewRotation_);drawChars:if(parts){const replayImageOrLabelArgs=[];let c,cc,chars,label,part;if(strokeKey)for(c=0,cc=parts.length;c<cc;++c){part=parts[c],chars=part[4],label=this.createLabel(chars,textKey,"",strokeKey),anchorX=part[2]+(textScale[0]<0?-strokeWidth:strokeWidth),anchorY=baseline*label.height+2*(.5-baseline)*strokeWidth*textScale[1]/textScale[0]-offsetY;const dimensions=this.calculateImageOrLabelDimensions_(label.width,label.height,part[0],part[1],label.width,label.height,anchorX,anchorY,0,0,part[3],pixelRatioScale,!1,render_canvas.Tq,!1,feature);if(declutterTree&&declutterTree.collides(dimensions.declutterBox))break drawChars;replayImageOrLabelArgs.push([context,contextScale,label,dimensions,1,null,null])}if(fillKey)for(c=0,cc=parts.length;c<cc;++c){part=parts[c],chars=part[4],label=this.createLabel(chars,textKey,fillKey,""),anchorX=part[2],anchorY=baseline*label.height-offsetY;const dimensions=this.calculateImageOrLabelDimensions_(label.width,label.height,part[0],part[1],label.width,label.height,anchorX,anchorY,0,0,part[3],pixelRatioScale,!1,render_canvas.Tq,!1,feature);if(declutterTree&&declutterTree.collides(dimensions.declutterBox))break drawChars;replayImageOrLabelArgs.push([context,contextScale,label,dimensions,1,null,null])}declutterTree&&declutterTree.load(replayImageOrLabelArgs.map(getDeclutterBox));for(let i=0,ii=replayImageOrLabelArgs.length;i<ii;++i)this.replayImageOrLabel_.apply(this,replayImageOrLabelArgs[i])}}++i;break;case canvas_Instruction.END_GEOMETRY:if(void 0!==featureCallback){feature=instruction[1];const result=featureCallback(feature,currentGeometry);if(result)return result}++i;break;case canvas_Instruction.FILL:batchSize?pendingFill++:this.fill_(context),++i;break;case canvas_Instruction.MOVE_TO_LINE_TO:for(d=instruction[1],dd=instruction[2],x=pixelCoordinates[d],y=pixelCoordinates[d+1],roundX=x+.5|0,roundY=y+.5|0,roundX===prevX&&roundY===prevY||(context.moveTo(x,y),prevX=roundX,prevY=roundY),d+=2;d<dd;d+=2)x=pixelCoordinates[d],y=pixelCoordinates[d+1],roundX=x+.5|0,roundY=y+.5|0,d!=dd-2&&roundX===prevX&&roundY===prevY||(context.lineTo(x,y),prevX=roundX,prevY=roundY);++i;break;case canvas_Instruction.SET_FILL_STYLE:lastFillInstruction=instruction,this.alignFill_=instruction[2],pendingFill&&(this.fill_(context),pendingFill=0,pendingStroke&&(context.stroke(),pendingStroke=0)),context.fillStyle=instruction[1],++i;break;case canvas_Instruction.SET_STROKE_STYLE:lastStrokeInstruction=instruction,pendingStroke&&(context.stroke(),pendingStroke=0),this.setStrokeStyle_(context,instruction),++i;break;case canvas_Instruction.STROKE:batchSize?pendingStroke++:context.stroke(),++i;break;default:++i}}pendingFill&&this.fill_(context),pendingStroke&&context.stroke()}execute(context,contextScale,transform,viewRotation,snapToPixel,declutterTree){this.viewRotation_=viewRotation,this.execute_(context,contextScale,transform,this.instructions,snapToPixel,void 0,void 0,declutterTree)}executeHitDetection(context,transform,viewRotation,featureCallback,hitExtent){return this.viewRotation_=viewRotation,this.execute_(context,1,transform,this.hitDetectionInstructions,!0,featureCallback,hitExtent)}},ORDER=["Polygon","Circle","LineString","Image","Text","Default"];const circlePixelIndexArrayCache={};const canvas_ExecutorGroup=class ExecutorGroup{constructor(maxExtent,resolution,pixelRatio,overlaps,allInstructions,renderBuffer){this.maxExtent_=maxExtent,this.overlaps_=overlaps,this.pixelRatio_=pixelRatio,this.resolution_=resolution,this.renderBuffer_=renderBuffer,this.executorsByZIndex_={},this.hitDetectionContext_=null,this.hitDetectionTransform_=(0,ol_transform.vt)(),this.createExecutors_(allInstructions)}clip(context,transform){const flatClipCoords=this.getClipCoords(transform);context.beginPath(),context.moveTo(flatClipCoords[0],flatClipCoords[1]),context.lineTo(flatClipCoords[2],flatClipCoords[3]),context.lineTo(flatClipCoords[4],flatClipCoords[5]),context.lineTo(flatClipCoords[6],flatClipCoords[7]),context.clip()}createExecutors_(allInstructions){for(const zIndex in allInstructions){let executors=this.executorsByZIndex_[zIndex];void 0===executors&&(executors={},this.executorsByZIndex_[zIndex]=executors);const instructionByZindex=allInstructions[zIndex];for(const builderType in instructionByZindex){const instructions=instructionByZindex[builderType];executors[builderType]=new canvas_Executor(this.resolution_,this.pixelRatio_,this.overlaps_,instructions)}}}hasExecutors(executors){for(const zIndex in this.executorsByZIndex_){const candidates=this.executorsByZIndex_[zIndex];for(let i=0,ii=executors.length;i<ii;++i)if(executors[i]in candidates)return!0}return!1}forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,callback,declutteredFeatures){const contextSize=2*(hitTolerance=Math.round(hitTolerance))+1,transform=(0,ol_transform.Zz)(this.hitDetectionTransform_,hitTolerance+.5,hitTolerance+.5,1/resolution,-1/resolution,-rotation,-coordinate[0],-coordinate[1]),newContext=!this.hitDetectionContext_;newContext&&(this.hitDetectionContext_=(0,dom.Y)(contextSize,contextSize,void 0,{willReadFrequently:!0}));const context=this.hitDetectionContext_;let hitExtent;context.canvas.width!==contextSize||context.canvas.height!==contextSize?(context.canvas.width=contextSize,context.canvas.height=contextSize):newContext||context.clearRect(0,0,contextSize,contextSize),void 0!==this.renderBuffer_&&(hitExtent=(0,ol_extent.S5)(),(0,ol_extent.$C)(hitExtent,coordinate),(0,ol_extent.r)(hitExtent,resolution*(this.renderBuffer_+hitTolerance),hitExtent));const indexes=function getPixelIndexArray(radius){if(void 0!==circlePixelIndexArrayCache[radius])return circlePixelIndexArrayCache[radius];const size=2*radius+1,maxDistanceSq=radius*radius,distances=new Array(maxDistanceSq+1);for(let i=0;i<=radius;++i)for(let j=0;j<=radius;++j){const distanceSq=i*i+j*j;if(distanceSq>maxDistanceSq)break;let distance=distances[distanceSq];distance||(distance=[],distances[distanceSq]=distance),distance.push(4*((radius+i)*size+(radius+j))+3),i>0&&distance.push(4*((radius-i)*size+(radius+j))+3),j>0&&(distance.push(4*((radius+i)*size+(radius-j))+3),i>0&&distance.push(4*((radius-i)*size+(radius-j))+3))}const pixelIndex=[];for(let i=0,ii=distances.length;i<ii;++i)distances[i]&&pixelIndex.push(...distances[i]);return circlePixelIndexArrayCache[radius]=pixelIndex,pixelIndex}(hitTolerance);let builderType;function featureCallback(feature,geometry){const imageData=context.getImageData(0,0,contextSize,contextSize).data;for(let i=0,ii=indexes.length;i<ii;i++)if(imageData[indexes[i]]>0){if(!declutteredFeatures||"Image"!==builderType&&"Text"!==builderType||declutteredFeatures.includes(feature)){const idx=(indexes[i]-3)/4,x=hitTolerance-idx%contextSize,y=hitTolerance-(idx/contextSize|0),result=callback(feature,geometry,x*x+y*y);if(result)return result}context.clearRect(0,0,contextSize,contextSize);break}}const zs=Object.keys(this.executorsByZIndex_).map(Number);let i,j,executors,executor,result;for(zs.sort(array.V_),i=zs.length-1;i>=0;--i){const zIndexKey=zs[i].toString();for(executors=this.executorsByZIndex_[zIndexKey],j=ORDER.length-1;j>=0;--j)if(builderType=ORDER[j],executor=executors[builderType],void 0!==executor&&(result=executor.executeHitDetection(context,transform,rotation,featureCallback,hitExtent),result))return result}}getClipCoords(transform){const maxExtent=this.maxExtent_;if(!maxExtent)return null;const minX=maxExtent[0],minY=maxExtent[1],maxX=maxExtent[2],maxY=maxExtent[3],flatClipCoords=[minX,minY,minX,maxY,maxX,maxY,maxX,minY];return(0,flat_transform.Rc)(flatClipCoords,0,8,2,transform,flatClipCoords),flatClipCoords}isEmpty(){return(0,obj.p)(this.executorsByZIndex_)}execute(context,contextScale,transform,viewRotation,snapToPixel,builderTypes,declutterTree){const zs=Object.keys(this.executorsByZIndex_).map(Number);let i,ii,j,jj,replays,replay;for(zs.sort(array.V_),this.maxExtent_&&(context.save(),this.clip(context,transform)),builderTypes=builderTypes||ORDER,declutterTree&&zs.reverse(),i=0,ii=zs.length;i<ii;++i){const zIndexKey=zs[i].toString();for(replays=this.executorsByZIndex_[zIndexKey],j=0,jj=builderTypes.length;j<jj;++j){replay=replays[builderTypes[j]],void 0!==replay&&replay.execute(context,contextScale,transform,viewRotation,snapToPixel,declutterTree)}}this.maxExtent_&&context.restore()}};var SimpleGeometry=__webpack_require__("./node_modules/ol/geom/SimpleGeometry.js");const Immediate=class CanvasImmediateRenderer extends render_VectorContext{constructor(context,pixelRatio,extent,transform,viewRotation,squaredTolerance,userTransform){super(),this.context_=context,this.pixelRatio_=pixelRatio,this.extent_=extent,this.transform_=transform,this.transformRotation_=transform?(0,math.Mg)(Math.atan2(transform[1],transform[0]),10):0,this.viewRotation_=viewRotation,this.squaredTolerance_=squaredTolerance,this.userTransform_=userTransform,this.contextFillState_=null,this.contextStrokeState_=null,this.contextTextState_=null,this.fillState_=null,this.strokeState_=null,this.image_=null,this.imageAnchorX_=0,this.imageAnchorY_=0,this.imageHeight_=0,this.imageOpacity_=0,this.imageOriginX_=0,this.imageOriginY_=0,this.imageRotateWithView_=!1,this.imageRotation_=0,this.imageScale_=[0,0],this.imageWidth_=0,this.text_="",this.textOffsetX_=0,this.textOffsetY_=0,this.textRotateWithView_=!1,this.textRotation_=0,this.textScale_=[0,0],this.textFillState_=null,this.textStrokeState_=null,this.textState_=null,this.pixelCoordinates_=[],this.tmpLocalTransform_=(0,ol_transform.vt)()}drawImages_(flatCoordinates,offset,end,stride){if(!this.image_)return;const pixelCoordinates=(0,flat_transform.Rc)(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_),context=this.context_,localTransform=this.tmpLocalTransform_,alpha=context.globalAlpha;1!=this.imageOpacity_&&(context.globalAlpha=alpha*this.imageOpacity_);let rotation=this.imageRotation_;0===this.transformRotation_&&(rotation-=this.viewRotation_),this.imageRotateWithView_&&(rotation+=this.viewRotation_);for(let i=0,ii=pixelCoordinates.length;i<ii;i+=2){const x=pixelCoordinates[i]-this.imageAnchorX_,y=pixelCoordinates[i+1]-this.imageAnchorY_;if(0!==rotation||1!=this.imageScale_[0]||1!=this.imageScale_[1]){const centerX=x+this.imageAnchorX_,centerY=y+this.imageAnchorY_;(0,ol_transform.Zz)(localTransform,centerX,centerY,1,1,rotation,-centerX,-centerY),context.save(),context.transform.apply(context,localTransform),context.translate(centerX,centerY),context.scale(this.imageScale_[0],this.imageScale_[1]),context.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,-this.imageAnchorX_,-this.imageAnchorY_,this.imageWidth_,this.imageHeight_),context.restore()}else context.drawImage(this.image_,this.imageOriginX_,this.imageOriginY_,this.imageWidth_,this.imageHeight_,x,y,this.imageWidth_,this.imageHeight_)}1!=this.imageOpacity_&&(context.globalAlpha=alpha)}drawText_(flatCoordinates,offset,end,stride){if(!this.textState_||""===this.text_)return;this.textFillState_&&this.setContextFillState_(this.textFillState_),this.textStrokeState_&&this.setContextStrokeState_(this.textStrokeState_),this.setContextTextState_(this.textState_);const pixelCoordinates=(0,flat_transform.Rc)(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_),context=this.context_;let rotation=this.textRotation_;for(0===this.transformRotation_&&(rotation-=this.viewRotation_),this.textRotateWithView_&&(rotation+=this.viewRotation_);offset<end;offset+=stride){const x=pixelCoordinates[offset]+this.textOffsetX_,y=pixelCoordinates[offset+1]+this.textOffsetY_;0!==rotation||1!=this.textScale_[0]||1!=this.textScale_[1]?(context.save(),context.translate(x-this.textOffsetX_,y-this.textOffsetY_),context.rotate(rotation),context.translate(this.textOffsetX_,this.textOffsetY_),context.scale(this.textScale_[0],this.textScale_[1]),this.textStrokeState_&&context.strokeText(this.text_,0,0),this.textFillState_&&context.fillText(this.text_,0,0),context.restore()):(this.textStrokeState_&&context.strokeText(this.text_,x,y),this.textFillState_&&context.fillText(this.text_,x,y))}}moveToLineTo_(flatCoordinates,offset,end,stride,close){const context=this.context_,pixelCoordinates=(0,flat_transform.Rc)(flatCoordinates,offset,end,stride,this.transform_,this.pixelCoordinates_);context.moveTo(pixelCoordinates[0],pixelCoordinates[1]);let length=pixelCoordinates.length;close&&(length-=2);for(let i=2;i<length;i+=2)context.lineTo(pixelCoordinates[i],pixelCoordinates[i+1]);return close&&context.closePath(),end}drawRings_(flatCoordinates,offset,ends,stride){for(let i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!0);return offset}drawCircle(geometry){if(this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ol_extent.HY)(this.extent_,geometry.getExtent())){if(this.fillState_||this.strokeState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const pixelCoordinates=(0,SimpleGeometry.v7)(geometry,this.transform_,this.pixelCoordinates_),dx=pixelCoordinates[2]-pixelCoordinates[0],dy=pixelCoordinates[3]-pixelCoordinates[1],radius=Math.sqrt(dx*dx+dy*dy),context=this.context_;context.beginPath(),context.arc(pixelCoordinates[0],pixelCoordinates[1],radius,0,2*Math.PI),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}""!==this.text_&&this.drawText_(geometry.getCenter(),0,2,2)}}setStyle(style){this.setFillStrokeStyle(style.getFill(),style.getStroke()),this.setImageStyle(style.getImage()),this.setTextStyle(style.getText())}setTransform(transform){this.transform_=transform}drawGeometry(geometry){switch(geometry.getType()){case"Point":this.drawPoint(geometry);break;case"LineString":this.drawLineString(geometry);break;case"Polygon":this.drawPolygon(geometry);break;case"MultiPoint":this.drawMultiPoint(geometry);break;case"MultiLineString":this.drawMultiLineString(geometry);break;case"MultiPolygon":this.drawMultiPolygon(geometry);break;case"GeometryCollection":this.drawGeometryCollection(geometry);break;case"Circle":this.drawCircle(geometry)}}drawFeature(feature,style){const geometry=style.getGeometryFunction()(feature);geometry&&(this.setStyle(style),this.drawGeometry(geometry))}drawGeometryCollection(geometry){const geometries=geometry.getGeometriesArray();for(let i=0,ii=geometries.length;i<ii;++i)this.drawGeometry(geometries[i])}drawPoint(geometry){this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)}drawMultiPoint(geometry){this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const flatCoordinates=geometry.getFlatCoordinates(),stride=geometry.getStride();this.image_&&this.drawImages_(flatCoordinates,0,flatCoordinates.length,stride),""!==this.text_&&this.drawText_(flatCoordinates,0,flatCoordinates.length,stride)}drawLineString(geometry){if(this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ol_extent.HY)(this.extent_,geometry.getExtent())){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const context=this.context_,flatCoordinates=geometry.getFlatCoordinates();context.beginPath(),this.moveToLineTo_(flatCoordinates,0,flatCoordinates.length,geometry.getStride(),!1),context.stroke()}if(""!==this.text_){const flatMidpoint=geometry.getFlatMidpoint();this.drawText_(flatMidpoint,0,2,2)}}}drawMultiLineString(geometry){this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_));const geometryExtent=geometry.getExtent();if((0,ol_extent.HY)(this.extent_,geometryExtent)){if(this.strokeState_){this.setContextStrokeState_(this.strokeState_);const context=this.context_,flatCoordinates=geometry.getFlatCoordinates();let offset=0;const ends=geometry.getEnds(),stride=geometry.getStride();context.beginPath();for(let i=0,ii=ends.length;i<ii;++i)offset=this.moveToLineTo_(flatCoordinates,offset,ends[i],stride,!1);context.stroke()}if(""!==this.text_){const flatMidpoints=geometry.getFlatMidpoints();this.drawText_(flatMidpoints,0,flatMidpoints.length,2)}}}drawPolygon(geometry){if(this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ol_extent.HY)(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const context=this.context_;context.beginPath(),this.drawRings_(geometry.getOrientedFlatCoordinates(),0,geometry.getEnds(),geometry.getStride()),this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){const flatInteriorPoint=geometry.getFlatInteriorPoint();this.drawText_(flatInteriorPoint,0,2,2)}}}drawMultiPolygon(geometry){if(this.squaredTolerance_&&(geometry=geometry.simplifyTransformed(this.squaredTolerance_,this.userTransform_)),(0,ol_extent.HY)(this.extent_,geometry.getExtent())){if(this.strokeState_||this.fillState_){this.fillState_&&this.setContextFillState_(this.fillState_),this.strokeState_&&this.setContextStrokeState_(this.strokeState_);const context=this.context_,flatCoordinates=geometry.getOrientedFlatCoordinates();let offset=0;const endss=geometry.getEndss(),stride=geometry.getStride();context.beginPath();for(let i=0,ii=endss.length;i<ii;++i){const ends=endss[i];offset=this.drawRings_(flatCoordinates,offset,ends,stride)}this.fillState_&&context.fill(),this.strokeState_&&context.stroke()}if(""!==this.text_){const flatInteriorPoints=geometry.getFlatInteriorPoints();this.drawText_(flatInteriorPoints,0,flatInteriorPoints.length,2)}}}setContextFillState_(fillState){const context=this.context_,contextFillState=this.contextFillState_;contextFillState?contextFillState.fillStyle!=fillState.fillStyle&&(contextFillState.fillStyle=fillState.fillStyle,context.fillStyle=fillState.fillStyle):(context.fillStyle=fillState.fillStyle,this.contextFillState_={fillStyle:fillState.fillStyle})}setContextStrokeState_(strokeState){const context=this.context_,contextStrokeState=this.contextStrokeState_;contextStrokeState?(contextStrokeState.lineCap!=strokeState.lineCap&&(contextStrokeState.lineCap=strokeState.lineCap,context.lineCap=strokeState.lineCap),(0,array.aI)(contextStrokeState.lineDash,strokeState.lineDash)||context.setLineDash(contextStrokeState.lineDash=strokeState.lineDash),contextStrokeState.lineDashOffset!=strokeState.lineDashOffset&&(contextStrokeState.lineDashOffset=strokeState.lineDashOffset,context.lineDashOffset=strokeState.lineDashOffset),contextStrokeState.lineJoin!=strokeState.lineJoin&&(contextStrokeState.lineJoin=strokeState.lineJoin,context.lineJoin=strokeState.lineJoin),contextStrokeState.lineWidth!=strokeState.lineWidth&&(contextStrokeState.lineWidth=strokeState.lineWidth,context.lineWidth=strokeState.lineWidth),contextStrokeState.miterLimit!=strokeState.miterLimit&&(contextStrokeState.miterLimit=strokeState.miterLimit,context.miterLimit=strokeState.miterLimit),contextStrokeState.strokeStyle!=strokeState.strokeStyle&&(contextStrokeState.strokeStyle=strokeState.strokeStyle,context.strokeStyle=strokeState.strokeStyle)):(context.lineCap=strokeState.lineCap,context.setLineDash(strokeState.lineDash),context.lineDashOffset=strokeState.lineDashOffset,context.lineJoin=strokeState.lineJoin,context.lineWidth=strokeState.lineWidth,context.miterLimit=strokeState.miterLimit,context.strokeStyle=strokeState.strokeStyle,this.contextStrokeState_={lineCap:strokeState.lineCap,lineDash:strokeState.lineDash,lineDashOffset:strokeState.lineDashOffset,lineJoin:strokeState.lineJoin,lineWidth:strokeState.lineWidth,miterLimit:strokeState.miterLimit,strokeStyle:strokeState.strokeStyle})}setContextTextState_(textState){const context=this.context_,contextTextState=this.contextTextState_,textAlign=textState.textAlign?textState.textAlign:render_canvas.MY;contextTextState?(contextTextState.font!=textState.font&&(contextTextState.font=textState.font,context.font=textState.font),contextTextState.textAlign!=textAlign&&(contextTextState.textAlign=textAlign,context.textAlign=textAlign),contextTextState.textBaseline!=textState.textBaseline&&(contextTextState.textBaseline=textState.textBaseline,context.textBaseline=textState.textBaseline)):(context.font=textState.font,context.textAlign=textAlign,context.textBaseline=textState.textBaseline,this.contextTextState_={font:textState.font,textAlign,textBaseline:textState.textBaseline})}setFillStrokeStyle(fillStyle,strokeStyle){if(fillStyle){const fillStyleColor=fillStyle.getColor();this.fillState_={fillStyle:(0,colorlike.F)(fillStyleColor||render_canvas.qY)}}else this.fillState_=null;if(strokeStyle){const strokeStyleColor=strokeStyle.getColor(),strokeStyleLineCap=strokeStyle.getLineCap(),strokeStyleLineDash=strokeStyle.getLineDash(),strokeStyleLineDashOffset=strokeStyle.getLineDashOffset(),strokeStyleLineJoin=strokeStyle.getLineJoin(),strokeStyleWidth=strokeStyle.getWidth(),strokeStyleMiterLimit=strokeStyle.getMiterLimit(),lineDash=strokeStyleLineDash||render_canvas.Oq;this.strokeState_={lineCap:void 0!==strokeStyleLineCap?strokeStyleLineCap:render_canvas._m,lineDash:1===this.pixelRatio_?lineDash:lineDash.map((n=>n*this.pixelRatio_)),lineDashOffset:(strokeStyleLineDashOffset||render_canvas.vk)*this.pixelRatio_,lineJoin:void 0!==strokeStyleLineJoin?strokeStyleLineJoin:render_canvas._K,lineWidth:(void 0!==strokeStyleWidth?strokeStyleWidth:render_canvas.aq)*this.pixelRatio_,miterLimit:void 0!==strokeStyleMiterLimit?strokeStyleMiterLimit:render_canvas.eL,strokeStyle:(0,colorlike.F)(strokeStyleColor||render_canvas.NT)}}else this.strokeState_=null}setImageStyle(imageStyle){let imageSize;if(!imageStyle||!(imageSize=imageStyle.getSize()))return void(this.image_=null);const imagePixelRatio=imageStyle.getPixelRatio(this.pixelRatio_),imageAnchor=imageStyle.getAnchor(),imageOrigin=imageStyle.getOrigin();this.image_=imageStyle.getImage(this.pixelRatio_),this.imageAnchorX_=imageAnchor[0]*imagePixelRatio,this.imageAnchorY_=imageAnchor[1]*imagePixelRatio,this.imageHeight_=imageSize[1]*imagePixelRatio,this.imageOpacity_=imageStyle.getOpacity(),this.imageOriginX_=imageOrigin[0],this.imageOriginY_=imageOrigin[1],this.imageRotateWithView_=imageStyle.getRotateWithView(),this.imageRotation_=imageStyle.getRotation();const imageScale=imageStyle.getScaleArray();this.imageScale_=[imageScale[0]*this.pixelRatio_/imagePixelRatio,imageScale[1]*this.pixelRatio_/imagePixelRatio],this.imageWidth_=imageSize[0]*imagePixelRatio}setTextStyle(textStyle){if(textStyle){const textFillStyle=textStyle.getFill();if(textFillStyle){const textFillStyleColor=textFillStyle.getColor();this.textFillState_={fillStyle:(0,colorlike.F)(textFillStyleColor||render_canvas.qY)}}else this.textFillState_=null;const textStrokeStyle=textStyle.getStroke();if(textStrokeStyle){const textStrokeStyleColor=textStrokeStyle.getColor(),textStrokeStyleLineCap=textStrokeStyle.getLineCap(),textStrokeStyleLineDash=textStrokeStyle.getLineDash(),textStrokeStyleLineDashOffset=textStrokeStyle.getLineDashOffset(),textStrokeStyleLineJoin=textStrokeStyle.getLineJoin(),textStrokeStyleWidth=textStrokeStyle.getWidth(),textStrokeStyleMiterLimit=textStrokeStyle.getMiterLimit();this.textStrokeState_={lineCap:void 0!==textStrokeStyleLineCap?textStrokeStyleLineCap:render_canvas._m,lineDash:textStrokeStyleLineDash||render_canvas.Oq,lineDashOffset:textStrokeStyleLineDashOffset||render_canvas.vk,lineJoin:void 0!==textStrokeStyleLineJoin?textStrokeStyleLineJoin:render_canvas._K,lineWidth:void 0!==textStrokeStyleWidth?textStrokeStyleWidth:render_canvas.aq,miterLimit:void 0!==textStrokeStyleMiterLimit?textStrokeStyleMiterLimit:render_canvas.eL,strokeStyle:(0,colorlike.F)(textStrokeStyleColor||render_canvas.NT)}}else this.textStrokeState_=null;const textFont=textStyle.getFont(),textOffsetX=textStyle.getOffsetX(),textOffsetY=textStyle.getOffsetY(),textRotateWithView=textStyle.getRotateWithView(),textRotation=textStyle.getRotation(),textScale=textStyle.getScaleArray(),textText=textStyle.getText(),textTextAlign=textStyle.getTextAlign(),textTextBaseline=textStyle.getTextBaseline();this.textState_={font:void 0!==textFont?textFont:render_canvas.ZV,textAlign:void 0!==textTextAlign?textTextAlign:render_canvas.MY,textBaseline:void 0!==textTextBaseline?textTextBaseline:render_canvas.M8},this.text_=void 0!==textText?Array.isArray(textText)?textText.reduce(((acc,t,i)=>acc+(i%2?" ":t)),""):textText:"",this.textOffsetX_=void 0!==textOffsetX?this.pixelRatio_*textOffsetX:0,this.textOffsetY_=void 0!==textOffsetY?this.pixelRatio_*textOffsetY:0,this.textRotateWithView_=void 0!==textRotateWithView&&textRotateWithView,this.textRotation_=void 0!==textRotation?textRotation:0,this.textScale_=[this.pixelRatio_*textScale[0],this.pixelRatio_*textScale[1]]}else this.text_=""}};function createHitDetectionImageData(size,transforms,features,styleFunction,extent,resolution,rotation){const width=.5*size[0],height=.5*size[1],context=(0,dom.Y)(width,height);context.imageSmoothingEnabled=!1;const canvas=context.canvas,renderer=new Immediate(context,.5,extent,null,rotation),featureCount=features.length,indexFactor=Math.floor(16777215/featureCount),featuresByZIndex={};for(let i=1;i<=featureCount;++i){const feature=features[i-1],featureStyleFunction=feature.getStyleFunction()||styleFunction;if(!featureStyleFunction)continue;let styles=featureStyleFunction(feature,resolution);if(!styles)continue;Array.isArray(styles)||(styles=[styles]);const color=(i*indexFactor).toString(16).padStart(7,"#00000");for(let j=0,jj=styles.length;j<jj;++j){const originalStyle=styles[j],geometry=originalStyle.getGeometryFunction()(feature);if(!geometry||!(0,ol_extent.HY)(extent,geometry.getExtent()))continue;const style=originalStyle.clone(),fill=style.getFill();fill&&fill.setColor(color);const stroke=style.getStroke();stroke&&(stroke.setColor(color),stroke.setLineDash(null)),style.setText(void 0);const image=originalStyle.getImage();if(image){const imgSize=image.getImageSize();if(!imgSize)continue;const imgContext=(0,dom.Y)(imgSize[0],imgSize[1],void 0,{alpha:!1}),img=imgContext.canvas;imgContext.fillStyle=color,imgContext.fillRect(0,0,img.width,img.height),style.setImage(new style_Icon({img,anchor:image.getAnchor(),anchorXUnits:"pixels",anchorYUnits:"pixels",offset:image.getOrigin(),opacity:1,size:image.getSize(),scale:image.getScale(),rotation:image.getRotation(),rotateWithView:image.getRotateWithView()}))}const zIndex=style.getZIndex()||0;let byGeometryType=featuresByZIndex[zIndex];byGeometryType||(byGeometryType={},featuresByZIndex[zIndex]=byGeometryType,byGeometryType.Polygon=[],byGeometryType.Circle=[],byGeometryType.LineString=[],byGeometryType.Point=[]);const type=geometry.getType();if("GeometryCollection"===type){const geometries=geometry.getGeometriesArrayRecursive();for(let i=0,ii=geometries.length;i<ii;++i){const geometry=geometries[i];byGeometryType[geometry.getType().replace("Multi","")].push(geometry,style)}}else byGeometryType[type.replace("Multi","")].push(geometry,style)}}const zIndexKeys=Object.keys(featuresByZIndex).map(Number).sort(array.V_);for(let i=0,ii=zIndexKeys.length;i<ii;++i){const byGeometryType=featuresByZIndex[zIndexKeys[i]];for(const type in byGeometryType){const geomAndStyle=byGeometryType[type];for(let j=0,jj=geomAndStyle.length;j<jj;j+=2){renderer.setStyle(geomAndStyle[j+1]);for(let k=0,kk=transforms.length;k<kk;++k)renderer.setTransform(transforms[k]),renderer.drawGeometry(geomAndStyle[j])}}}return context.getImageData(0,0,canvas.width,canvas.height)}function hitDetect(pixel,features,imageData){const resultFeatures=[];if(imageData){const x=Math.floor(.5*Math.round(pixel[0])),y=Math.floor(.5*Math.round(pixel[1])),index=4*((0,math.qE)(x,0,imageData.width-1)+(0,math.qE)(y,0,imageData.height-1)*imageData.width),r=imageData.data[index],g=imageData.data[index+1],i=imageData.data[index+2]+256*(g+256*r),indexFactor=Math.floor(16777215/features.length);i&&i%indexFactor==0&&resultFeatures.push(features[i/indexFactor-1])}return resultFeatures}const GEOMETRY_RENDERERS={Point:function renderPointGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const imageStyle=style.getImage(),textStyle=style.getText();let declutterImageWithText;if(imageStyle){if(imageStyle.getImageState()!=ImageState.A.LOADED)return;let imageBuilderGroup=builderGroup;if(declutterBuilderGroup){const declutterMode=imageStyle.getDeclutterMode();if("none"!==declutterMode)if(imageBuilderGroup=declutterBuilderGroup,"obstacle"===declutterMode){const imageReplay=builderGroup.getBuilder(style.getZIndex(),"Image");imageReplay.setImageStyle(imageStyle,declutterImageWithText),imageReplay.drawPoint(geometry,feature)}else textStyle&&textStyle.getText()&&(declutterImageWithText={})}const imageReplay=imageBuilderGroup.getBuilder(style.getZIndex(),"Image");imageReplay.setImageStyle(imageStyle,declutterImageWithText),imageReplay.drawPoint(geometry,feature)}if(textStyle&&textStyle.getText()){let textBuilderGroup=builderGroup;declutterBuilderGroup&&(textBuilderGroup=declutterBuilderGroup);const textReplay=textBuilderGroup.getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle,declutterImageWithText),textReplay.drawText(geometry,feature)}},LineString:function renderLineStringGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const strokeStyle=style.getStroke();if(strokeStyle){const lineStringReplay=builderGroup.getBuilder(style.getZIndex(),"LineString");lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawLineString(geometry,feature)}const textStyle=style.getText();if(textStyle&&textStyle.getText()){const textReplay=(declutterBuilderGroup||builderGroup).getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle),textReplay.drawText(geometry,feature)}},Polygon:function renderPolygonGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){const polygonReplay=builderGroup.getBuilder(style.getZIndex(),"Polygon");polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawPolygon(geometry,feature)}const textStyle=style.getText();if(textStyle&&textStyle.getText()){const textReplay=(declutterBuilderGroup||builderGroup).getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle),textReplay.drawText(geometry,feature)}},MultiPoint:function renderMultiPointGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const imageStyle=style.getImage(),textStyle=style.getText();let declutterImageWithText;if(imageStyle){if(imageStyle.getImageState()!=ImageState.A.LOADED)return;let imageBuilderGroup=builderGroup;if(declutterBuilderGroup){const declutterMode=imageStyle.getDeclutterMode();if("none"!==declutterMode)if(imageBuilderGroup=declutterBuilderGroup,"obstacle"===declutterMode){const imageReplay=builderGroup.getBuilder(style.getZIndex(),"Image");imageReplay.setImageStyle(imageStyle,declutterImageWithText),imageReplay.drawMultiPoint(geometry,feature)}else textStyle&&textStyle.getText()&&(declutterImageWithText={})}const imageReplay=imageBuilderGroup.getBuilder(style.getZIndex(),"Image");imageReplay.setImageStyle(imageStyle,declutterImageWithText),imageReplay.drawMultiPoint(geometry,feature)}if(textStyle&&textStyle.getText()){let textBuilderGroup=builderGroup;declutterBuilderGroup&&(textBuilderGroup=declutterBuilderGroup);const textReplay=textBuilderGroup.getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle,declutterImageWithText),textReplay.drawText(geometry,feature)}},MultiLineString:function renderMultiLineStringGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const strokeStyle=style.getStroke();if(strokeStyle){const lineStringReplay=builderGroup.getBuilder(style.getZIndex(),"LineString");lineStringReplay.setFillStrokeStyle(null,strokeStyle),lineStringReplay.drawMultiLineString(geometry,feature)}const textStyle=style.getText();if(textStyle&&textStyle.getText()){const textReplay=(declutterBuilderGroup||builderGroup).getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle),textReplay.drawText(geometry,feature)}},MultiPolygon:function renderMultiPolygonGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const fillStyle=style.getFill(),strokeStyle=style.getStroke();if(strokeStyle||fillStyle){const polygonReplay=builderGroup.getBuilder(style.getZIndex(),"Polygon");polygonReplay.setFillStrokeStyle(fillStyle,strokeStyle),polygonReplay.drawMultiPolygon(geometry,feature)}const textStyle=style.getText();if(textStyle&&textStyle.getText()){const textReplay=(declutterBuilderGroup||builderGroup).getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle),textReplay.drawText(geometry,feature)}},GeometryCollection:function renderGeometryCollectionGeometry(replayGroup,geometry,style,feature,declutterBuilderGroup){const geometries=geometry.getGeometriesArray();let i,ii;for(i=0,ii=geometries.length;i<ii;++i){(0,GEOMETRY_RENDERERS[geometries[i].getType()])(replayGroup,geometries[i],style,feature,declutterBuilderGroup)}},Circle:function renderCircleGeometry(builderGroup,geometry,style,feature,declutterBuilderGroup){const fillStyle=style.getFill(),strokeStyle=style.getStroke();if(fillStyle||strokeStyle){const circleReplay=builderGroup.getBuilder(style.getZIndex(),"Circle");circleReplay.setFillStrokeStyle(fillStyle,strokeStyle),circleReplay.drawCircle(geometry,feature)}const textStyle=style.getText();if(textStyle&&textStyle.getText()){const textReplay=(declutterBuilderGroup||builderGroup).getBuilder(style.getZIndex(),"Text");textReplay.setTextStyle(textStyle),textReplay.drawText(geometry,feature)}}};function defaultOrder(feature1,feature2){return parseInt((0,util.v6)(feature1),10)-parseInt((0,util.v6)(feature2),10)}function getSquaredTolerance(resolution,pixelRatio){const tolerance=getTolerance(resolution,pixelRatio);return tolerance*tolerance}function getTolerance(resolution,pixelRatio){return.5*resolution/pixelRatio}function renderFeature(replayGroup,feature,style,squaredTolerance,listener,transform,declutterBuilderGroup){let loading=!1;const imageStyle=style.getImage();if(imageStyle){const imageState=imageStyle.getImageState();imageState==ImageState.A.LOADED||imageState==ImageState.A.ERROR?imageStyle.unlistenImageChange(listener):(imageState==ImageState.A.IDLE&&imageStyle.load(),imageStyle.listenImageChange(listener),loading=!0)}return function renderFeatureInternal(replayGroup,feature,style,squaredTolerance,transform,declutterBuilderGroup){const geometry=style.getGeometryFunction()(feature);if(!geometry)return;const simplifiedGeometry=geometry.simplifyTransformed(squaredTolerance,transform),renderer=style.getRenderer();if(renderer)renderGeometry(replayGroup,simplifiedGeometry,style,feature);else{(0,GEOMETRY_RENDERERS[simplifiedGeometry.getType()])(replayGroup,simplifiedGeometry,style,feature,declutterBuilderGroup)}}(replayGroup,feature,style,squaredTolerance,transform,declutterBuilderGroup),loading}function renderGeometry(replayGroup,geometry,style,feature){if("GeometryCollection"==geometry.getType()){const geometries=geometry.getGeometries();for(let i=0,ii=geometries.length;i<ii;++i)renderGeometry(replayGroup,geometries[i],style,feature);return}replayGroup.getBuilder(style.getZIndex(),"Default").drawCustom(geometry,feature,style.getRenderer(),style.getHitDetectionRenderer())}const canvas_VectorLayer=class CanvasVectorLayerRenderer extends canvas_Layer{constructor(vectorLayer){super(vectorLayer),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.animatingOrInteracting_,this.hitDetectionImageData_=null,this.renderedFeatures_=null,this.renderedRevision_=-1,this.renderedResolution_=NaN,this.renderedExtent_=(0,ol_extent.S5)(),this.wrappedRenderedExtent_=(0,ol_extent.S5)(),this.renderedRotation_,this.renderedCenter_=null,this.renderedProjection_=null,this.renderedRenderOrder_=null,this.replayGroup_=null,this.replayGroupChanged=!0,this.declutterExecutorGroup=null,this.clipping=!0,this.compositionContext_=null,this.opacity_=1}renderWorlds(executorGroup,frameState,declutterTree){const extent=frameState.extent,viewState=frameState.viewState,center=viewState.center,resolution=viewState.resolution,projection=viewState.projection,rotation=viewState.rotation,projectionExtent=projection.getExtent(),vectorSource=this.getLayer().getSource(),pixelRatio=frameState.pixelRatio,viewHints=frameState.viewHints,snapToPixel=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]),context=this.compositionContext_,width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio),multiWorld=vectorSource.getWrapX()&&projection.canWrapX(),worldWidth=multiWorld?(0,ol_extent.RG)(projectionExtent):null,endWorld=multiWorld?Math.ceil((extent[2]-projectionExtent[2])/worldWidth)+1:1;let world=multiWorld?Math.floor((extent[0]-projectionExtent[0])/worldWidth):0;do{const transform=this.getRenderTransform(center,resolution,rotation,pixelRatio,width,height,world*worldWidth);executorGroup.execute(context,1,transform,rotation,snapToPixel,void 0,declutterTree)}while(++world<endWorld)}setupCompositionContext_(){if(1!==this.opacity_){const compositionContext=(0,dom.Y)(this.context.canvas.width,this.context.canvas.height,canvasPool);this.compositionContext_=compositionContext}else this.compositionContext_=this.context}releaseCompositionContext_(){if(1!==this.opacity_){const alpha=this.context.globalAlpha;this.context.globalAlpha=this.opacity_,this.context.drawImage(this.compositionContext_.canvas,0,0),this.context.globalAlpha=alpha,(0,dom.Yg)(this.compositionContext_),canvasPool.push(this.compositionContext_.canvas),this.compositionContext_=null}}renderDeclutter(frameState){this.declutterExecutorGroup&&(this.setupCompositionContext_(),this.renderWorlds(this.declutterExecutorGroup,frameState,frameState.declutterTree),this.releaseCompositionContext_())}renderFrame(frameState,target){const pixelRatio=frameState.pixelRatio,layerState=frameState.layerStatesArray[frameState.layerIndex];(0,ol_transform.rQ)(this.pixelTransform,1/pixelRatio,1/pixelRatio),(0,ol_transform.T9)(this.inversePixelTransform,this.pixelTransform);const canvasTransform=(0,ol_transform.dI)(this.pixelTransform);this.useContainer(target,canvasTransform,this.getBackground(frameState));const context=this.context,canvas=context.canvas,replayGroup=this.replayGroup_,declutterExecutorGroup=this.declutterExecutorGroup;let render=replayGroup&&!replayGroup.isEmpty()||declutterExecutorGroup&&!declutterExecutorGroup.isEmpty();if(!render){if(!(this.getLayer().hasListener(render_EventType_PRERENDER)||this.getLayer().hasListener(render_EventType_POSTRENDER)))return null}const width=Math.round(frameState.size[0]*pixelRatio),height=Math.round(frameState.size[1]*pixelRatio);canvas.width!=width||canvas.height!=height?(canvas.width=width,canvas.height=height,canvas.style.transform!==canvasTransform&&(canvas.style.transform=canvasTransform)):this.containerReused||context.clearRect(0,0,width,height),this.preRender(context,frameState);const viewState=frameState.viewState,projection=viewState.projection;this.opacity_=layerState.opacity,this.setupCompositionContext_();let clipped=!1;if(render&&layerState.extent&&this.clipping){const layerExtent=(0,ol_proj.SD)(layerState.extent,projection);render=(0,ol_extent.HY)(layerExtent,frameState.extent),clipped=render&&!(0,ol_extent.ms)(layerExtent,frameState.extent),clipped&&this.clipUnrotated(this.compositionContext_,frameState,layerExtent)}return render&&this.renderWorlds(replayGroup,frameState),clipped&&this.compositionContext_.restore(),this.releaseCompositionContext_(),this.postRender(context,frameState),this.renderedRotation_!==viewState.rotation&&(this.renderedRotation_=viewState.rotation,this.hitDetectionImageData_=null),this.container}getFeatures(pixel){return new Promise((resolve=>{if(!this.hitDetectionImageData_&&!this.animatingOrInteracting_){const size=[this.context.canvas.width,this.context.canvas.height];(0,ol_transform.Bb)(this.pixelTransform,size);const center=this.renderedCenter_,resolution=this.renderedResolution_,rotation=this.renderedRotation_,projection=this.renderedProjection_,extent=this.wrappedRenderedExtent_,layer=this.getLayer(),transforms=[],width=.5*size[0],height=.5*size[1];transforms.push(this.getRenderTransform(center,resolution,rotation,.5,width,height,0).slice());const source=layer.getSource(),projectionExtent=projection.getExtent();if(source.getWrapX()&&projection.canWrapX()&&!(0,ol_extent.ms)(projectionExtent,extent)){let startX=extent[0];const worldWidth=(0,ol_extent.RG)(projectionExtent);let offsetX,world=0;for(;startX<projectionExtent[0];)--world,offsetX=worldWidth*world,transforms.push(this.getRenderTransform(center,resolution,rotation,.5,width,height,offsetX).slice()),startX+=worldWidth;for(world=0,startX=extent[2];startX>projectionExtent[2];)++world,offsetX=worldWidth*world,transforms.push(this.getRenderTransform(center,resolution,rotation,.5,width,height,offsetX).slice()),startX-=worldWidth}this.hitDetectionImageData_=createHitDetectionImageData(size,transforms,this.renderedFeatures_,layer.getStyleFunction(),extent,resolution,rotation)}resolve(hitDetect(pixel,this.renderedFeatures_,this.hitDetectionImageData_))}))}forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback,matches){if(!this.replayGroup_)return;const resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation,layer=this.getLayer(),features={},featureCallback=function(feature,geometry,distanceSq){const key=(0,util.v6)(feature),match=features[key];if(match){if(!0!==match&&distanceSq<match.distanceSq){if(0===distanceSq)return features[key]=!0,matches.splice(matches.lastIndexOf(match),1),callback(feature,layer,geometry);match.geometry=geometry,match.distanceSq=distanceSq}}else{if(0===distanceSq)return features[key]=!0,callback(feature,layer,geometry);matches.push(features[key]={feature,layer,geometry,distanceSq,callback})}};let result;const executorGroups=[this.replayGroup_];return this.declutterExecutorGroup&&executorGroups.push(this.declutterExecutorGroup),executorGroups.some((executorGroup=>result=executorGroup.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,featureCallback,executorGroup===this.declutterExecutorGroup&&frameState.declutterTree?frameState.declutterTree.all().map((item=>item.value)):null))),result}handleFontsChanged(){const layer=this.getLayer();layer.getVisible()&&this.replayGroup_&&layer.changed()}handleStyleImageChange_(event){this.renderIfReadyAndVisible()}prepareFrame(frameState){const vectorLayer=this.getLayer(),vectorSource=vectorLayer.getSource();if(!vectorSource)return!1;const animating=frameState.viewHints[ViewHint_ANIMATING],interacting=frameState.viewHints[ViewHint_INTERACTING],updateWhileAnimating=vectorLayer.getUpdateWhileAnimating(),updateWhileInteracting=vectorLayer.getUpdateWhileInteracting();if(this.ready&&!updateWhileAnimating&&animating||!updateWhileInteracting&&interacting)return this.animatingOrInteracting_=!0,!0;this.animatingOrInteracting_=!1;const frameStateExtent=frameState.extent,viewState=frameState.viewState,projection=viewState.projection,resolution=viewState.resolution,pixelRatio=frameState.pixelRatio,vectorLayerRevision=vectorLayer.getRevision(),vectorLayerRenderBuffer=vectorLayer.getRenderBuffer();let vectorLayerRenderOrder=vectorLayer.getRenderOrder();void 0===vectorLayerRenderOrder&&(vectorLayerRenderOrder=defaultOrder);const center=viewState.center.slice(),extent=(0,ol_extent.r)(frameStateExtent,vectorLayerRenderBuffer*resolution),renderedExtent=extent.slice(),loadExtents=[extent.slice()],projectionExtent=projection.getExtent();if(vectorSource.getWrapX()&&projection.canWrapX()&&!(0,ol_extent.ms)(projectionExtent,frameState.extent)){const worldWidth=(0,ol_extent.RG)(projectionExtent),gutter=Math.max((0,ol_extent.RG)(extent)/2,worldWidth);extent[0]=projectionExtent[0]-gutter,extent[2]=projectionExtent[2]+gutter,(0,ol_coordinate.Li)(center,projection);const loadExtent=(0,ol_extent.Li)(loadExtents[0],projection);loadExtent[0]<projectionExtent[0]&&loadExtent[2]<projectionExtent[2]?loadExtents.push([loadExtent[0]+worldWidth,loadExtent[1],loadExtent[2]+worldWidth,loadExtent[3]]):loadExtent[0]>projectionExtent[0]&&loadExtent[2]>projectionExtent[2]&&loadExtents.push([loadExtent[0]-worldWidth,loadExtent[1],loadExtent[2]-worldWidth,loadExtent[3]])}if(this.ready&&this.renderedResolution_==resolution&&this.renderedRevision_==vectorLayerRevision&&this.renderedRenderOrder_==vectorLayerRenderOrder&&(0,ol_extent.ms)(this.wrappedRenderedExtent_,extent))return(0,array.aI)(this.renderedExtent_,renderedExtent)||(this.hitDetectionImageData_=null,this.renderedExtent_=renderedExtent),this.renderedCenter_=center,this.replayGroupChanged=!1,!0;this.replayGroup_=null;const replayGroup=new canvas_BuilderGroup(getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio);let declutterBuilderGroup;this.getLayer().getDeclutter()&&(declutterBuilderGroup=new canvas_BuilderGroup(getTolerance(resolution,pixelRatio),extent,resolution,pixelRatio));const userProjection=(0,ol_proj.Tf)();let userTransform;if(userProjection){for(let i=0,ii=loadExtents.length;i<ii;++i){const extent=loadExtents[i],userExtent=(0,ol_proj.JR)(extent,projection);vectorSource.loadFeatures(userExtent,(0,ol_proj.vN)(resolution,projection),userProjection)}userTransform=(0,ol_proj.FO)(userProjection,projection)}else for(let i=0,ii=loadExtents.length;i<ii;++i)vectorSource.loadFeatures(loadExtents[i],resolution,projection);const squaredTolerance=getSquaredTolerance(resolution,pixelRatio);let ready=!0;const render=feature=>{let styles;const styleFunction=feature.getStyleFunction()||vectorLayer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){const dirty=this.renderFeature(feature,squaredTolerance,styles,replayGroup,userTransform,declutterBuilderGroup);ready=ready&&!dirty}},userExtent=(0,ol_proj.JR)(extent,projection),features=vectorSource.getFeaturesInExtent(userExtent);vectorLayerRenderOrder&&features.sort(vectorLayerRenderOrder);for(let i=0,ii=features.length;i<ii;++i)render(features[i]);this.renderedFeatures_=features,this.ready=ready;const replayGroupInstructions=replayGroup.finish(),executorGroup=new canvas_ExecutorGroup(extent,resolution,pixelRatio,vectorSource.getOverlaps(),replayGroupInstructions,vectorLayer.getRenderBuffer());return declutterBuilderGroup&&(this.declutterExecutorGroup=new canvas_ExecutorGroup(extent,resolution,pixelRatio,vectorSource.getOverlaps(),declutterBuilderGroup.finish(),vectorLayer.getRenderBuffer())),this.renderedResolution_=resolution,this.renderedRevision_=vectorLayerRevision,this.renderedRenderOrder_=vectorLayerRenderOrder,this.renderedExtent_=renderedExtent,this.wrappedRenderedExtent_=extent,this.renderedCenter_=center,this.renderedProjection_=projection,this.replayGroup_=executorGroup,this.hitDetectionImageData_=null,this.replayGroupChanged=!0,!0}renderFeature(feature,squaredTolerance,styles,builderGroup,transform,declutterBuilderGroup){if(!styles)return!1;let loading=!1;if(Array.isArray(styles))for(let i=0,ii=styles.length;i<ii;++i)loading=renderFeature(builderGroup,feature,styles[i],squaredTolerance,this.boundHandleStyleImageChange_,transform,declutterBuilderGroup)||loading;else loading=renderFeature(builderGroup,feature,styles,squaredTolerance,this.boundHandleStyleImageChange_,transform,declutterBuilderGroup);return loading}};const Vector=class Vector_VectorLayer extends BaseVector{constructor(options){super(options)}createRenderer(){return new canvas_VectorLayer(this)}};const structs_RBush=class RBush{constructor(maxEntries){this.rbush_=new(rbush_min_default())(maxEntries),this.items_={}}insert(extent,value){const item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value};this.rbush_.insert(item),this.items_[(0,util.v6)(value)]=item}load(extents,values){const items=new Array(values.length);for(let i=0,l=values.length;i<l;i++){const extent=extents[i],value=values[i],item={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3],value};items[i]=item,this.items_[(0,util.v6)(value)]=item}this.rbush_.load(items)}remove(value){const uid=(0,util.v6)(value),item=this.items_[uid];return delete this.items_[uid],null!==this.rbush_.remove(item)}update(extent,value){const item=this.items_[(0,util.v6)(value)],bbox=[item.minX,item.minY,item.maxX,item.maxY];(0,ol_extent.aI)(bbox,extent)||(this.remove(value),this.insert(extent,value))}getAll(){return this.rbush_.all().map((function(item){return item.value}))}getInExtent(extent){const bbox={minX:extent[0],minY:extent[1],maxX:extent[2],maxY:extent[3]};return this.rbush_.search(bbox).map((function(item){return item.value}))}forEach(callback){return this.forEach_(this.getAll(),callback)}forEachInExtent(extent,callback){return this.forEach_(this.getInExtent(extent),callback)}forEach_(values,callback){let result;for(let i=0,l=values.length;i<l;i++)if(result=callback(values[i]),result)return result;return result}isEmpty(){return(0,obj.p)(this.items_)}clear(){this.rbush_.clear(),this.items_={}}getExtent(extent){const data=this.rbush_.toJSON();return(0,ol_extent.N)(data.minX,data.minY,data.maxX,data.maxY,extent)}concat(rbush){this.rbush_.load(rbush.rbush_.all());for(const i in rbush.items_)this.items_[i]=rbush.items_[i]}};var Feature=__webpack_require__("./node_modules/ol/render/Feature.js");const VectorEventType_ADDFEATURE="addfeature",VectorEventType_CHANGEFEATURE="changefeature",VectorEventType_CLEAR="clear",VectorEventType_REMOVEFEATURE="removefeature",VectorEventType_FEATURESLOADSTART="featuresloadstart",VectorEventType_FEATURESLOADEND="featuresloadend",VectorEventType_FEATURESLOADERROR="featuresloaderror";function loadingstrategy_all(extent,resolution){return[[-1/0,-1/0,1/0,1/0]]}function bbox(extent,resolution){return[extent]}let withCredentials=!1;function loadFeaturesXhr(url,format,extent,resolution,projection,success,failure){const xhr=new XMLHttpRequest;xhr.open("GET","function"==typeof url?url(extent,resolution,projection):url,!0),"arraybuffer"==format.getType()&&(xhr.responseType="arraybuffer"),xhr.withCredentials=withCredentials,xhr.onload=function(event){if(!xhr.status||xhr.status>=200&&xhr.status<300){const type=format.getType();let source;"json"==type?source=JSON.parse(xhr.responseText):"text"==type?source=xhr.responseText:"xml"==type?(source=xhr.responseXML,source||(source=(new DOMParser).parseFromString(xhr.responseText,"application/xml"))):"arraybuffer"==type&&(source=xhr.response),source?success(format.readFeatures(source,{extent,featureProjection:projection}),format.readProjection(source)):failure()}else failure()},xhr.onerror=failure,xhr.send()}function xhr(url,format){return function(extent,resolution,projection,success,failure){const source=this;loadFeaturesXhr(url,format,extent,resolution,projection,(function(features,dataProjection){source.addFeatures(features),void 0!==success&&success(features)}),failure||functions.tV)}}class VectorSourceEvent extends Event.Ay{constructor(type,feature,features){super(type),this.feature=feature,this.features=features}}const source_Vector=class Vector_VectorSource extends source_Source{constructor(options){super({attributions:(options=options||{}).attributions,interpolate:!0,projection:void 0,state:"ready",wrapX:void 0===options.wrapX||options.wrapX}),this.on,this.once,this.un,this.loader_=functions.tV,this.format_=options.format,this.overlaps_=void 0===options.overlaps||options.overlaps,this.url_=options.url,void 0!==options.loader?this.loader_=options.loader:void 0!==this.url_&&((0,asserts.v)(this.format_,"`format` must be set when `url` is set"),this.loader_=xhr(this.url_,this.format_)),this.strategy_=void 0!==options.strategy?options.strategy:loadingstrategy_all;const useSpatialIndex=void 0===options.useSpatialIndex||options.useSpatialIndex;let collection,features;this.featuresRtree_=useSpatialIndex?new structs_RBush:null,this.loadedExtentsRtree_=new structs_RBush,this.loadingExtentsCount_=0,this.nullGeometryFeatures_={},this.idIndex_={},this.uidIndex_={},this.featureChangeKeys_={},this.featuresCollection_=null,Array.isArray(options.features)?features=options.features:options.features&&(collection=options.features,features=collection.getArray()),useSpatialIndex||void 0!==collection||(collection=new Collection.A(features)),void 0!==features&&this.addFeaturesInternal(features),void 0!==collection&&this.bindFeaturesCollection_(collection)}addFeature(feature){this.addFeatureInternal(feature),this.changed()}addFeatureInternal(feature){const featureKey=(0,util.v6)(feature);if(!this.addToIndex_(featureKey,feature))return void(this.featuresCollection_&&this.featuresCollection_.remove(feature));this.setupChangeEvents_(featureKey,feature);const geometry=feature.getGeometry();if(geometry){const extent=geometry.getExtent();this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)}else this.nullGeometryFeatures_[featureKey]=feature;this.dispatchEvent(new VectorSourceEvent(VectorEventType_ADDFEATURE,feature))}setupChangeEvents_(featureKey,feature){feature instanceof Feature.Ay||(this.featureChangeKeys_[featureKey]=[(0,events.KT)(feature,EventType.A.CHANGE,this.handleFeatureChange_,this),(0,events.KT)(feature,ObjectEventType.A.PROPERTYCHANGE,this.handleFeatureChange_,this)])}addToIndex_(featureKey,feature){let valid=!0;if(void 0!==feature.getId()){const id=String(feature.getId());if(id in this.idIndex_)if(feature instanceof Feature.Ay){const indexedFeature=this.idIndex_[id];indexedFeature instanceof Feature.Ay?Array.isArray(indexedFeature)?indexedFeature.push(feature):this.idIndex_[id]=[indexedFeature,feature]:valid=!1}else valid=!1;else this.idIndex_[id]=feature}return valid&&((0,asserts.v)(!(featureKey in this.uidIndex_),"The passed `feature` was already added to the source"),this.uidIndex_[featureKey]=feature),valid}addFeatures(features){this.addFeaturesInternal(features),this.changed()}addFeaturesInternal(features){const extents=[],newFeatures=[],geometryFeatures=[];for(let i=0,length=features.length;i<length;i++){const feature=features[i],featureKey=(0,util.v6)(feature);this.addToIndex_(featureKey,feature)&&newFeatures.push(feature)}for(let i=0,length=newFeatures.length;i<length;i++){const feature=newFeatures[i],featureKey=(0,util.v6)(feature);this.setupChangeEvents_(featureKey,feature);const geometry=feature.getGeometry();if(geometry){const extent=geometry.getExtent();extents.push(extent),geometryFeatures.push(feature)}else this.nullGeometryFeatures_[featureKey]=feature}if(this.featuresRtree_&&this.featuresRtree_.load(extents,geometryFeatures),this.hasListener(VectorEventType_ADDFEATURE))for(let i=0,length=newFeatures.length;i<length;i++)this.dispatchEvent(new VectorSourceEvent(VectorEventType_ADDFEATURE,newFeatures[i]))}bindFeaturesCollection_(collection){let modifyingCollection=!1;this.addEventListener(VectorEventType_ADDFEATURE,(function(evt){modifyingCollection||(modifyingCollection=!0,collection.push(evt.feature),modifyingCollection=!1)})),this.addEventListener(VectorEventType_REMOVEFEATURE,(function(evt){modifyingCollection||(modifyingCollection=!0,collection.remove(evt.feature),modifyingCollection=!1)})),collection.addEventListener(CollectionEventType.A.ADD,(evt=>{modifyingCollection||(modifyingCollection=!0,this.addFeature(evt.element),modifyingCollection=!1)})),collection.addEventListener(CollectionEventType.A.REMOVE,(evt=>{modifyingCollection||(modifyingCollection=!0,this.removeFeature(evt.element),modifyingCollection=!1)})),this.featuresCollection_=collection}clear(fast){if(fast){for(const featureId in this.featureChangeKeys_){this.featureChangeKeys_[featureId].forEach(events.JH)}this.featuresCollection_||(this.featureChangeKeys_={},this.idIndex_={},this.uidIndex_={})}else if(this.featuresRtree_){const removeAndIgnoreReturn=feature=>{this.removeFeatureInternal(feature)};this.featuresRtree_.forEach(removeAndIgnoreReturn);for(const id in this.nullGeometryFeatures_)this.removeFeatureInternal(this.nullGeometryFeatures_[id])}this.featuresCollection_&&this.featuresCollection_.clear(),this.featuresRtree_&&this.featuresRtree_.clear(),this.nullGeometryFeatures_={};const clearEvent=new VectorSourceEvent(VectorEventType_CLEAR);this.dispatchEvent(clearEvent),this.changed()}forEachFeature(callback){if(this.featuresRtree_)return this.featuresRtree_.forEach(callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)}forEachFeatureAtCoordinateDirect(coordinate,callback){const extent=[coordinate[0],coordinate[1],coordinate[0],coordinate[1]];return this.forEachFeatureInExtent(extent,(function(feature){const geometry=feature.getGeometry();if(geometry instanceof Feature.Ay||geometry.intersectsCoordinate(coordinate))return callback(feature)}))}forEachFeatureInExtent(extent,callback){if(this.featuresRtree_)return this.featuresRtree_.forEachInExtent(extent,callback);this.featuresCollection_&&this.featuresCollection_.forEach(callback)}forEachFeatureIntersectingExtent(extent,callback){return this.forEachFeatureInExtent(extent,(function(feature){const geometry=feature.getGeometry();if(geometry instanceof Feature.Ay||geometry.intersectsExtent(extent)){const result=callback(feature);if(result)return result}}))}getFeaturesCollection(){return this.featuresCollection_}getFeatures(){let features;return this.featuresCollection_?features=this.featuresCollection_.getArray().slice(0):this.featuresRtree_&&(features=this.featuresRtree_.getAll(),(0,obj.p)(this.nullGeometryFeatures_)||(0,array.X$)(features,Object.values(this.nullGeometryFeatures_))),features}getFeaturesAtCoordinate(coordinate){const features=[];return this.forEachFeatureAtCoordinateDirect(coordinate,(function(feature){features.push(feature)})),features}getFeaturesInExtent(extent,projection){if(this.featuresRtree_){if(!(projection&&projection.canWrapX()&&this.getWrapX()))return this.featuresRtree_.getInExtent(extent);const extents=(0,ol_extent.QJ)(extent,projection);return[].concat(...extents.map((anExtent=>this.featuresRtree_.getInExtent(anExtent))))}return this.featuresCollection_?this.featuresCollection_.getArray().slice(0):[]}getClosestFeatureToCoordinate(coordinate,filter){const x=coordinate[0],y=coordinate[1];let closestFeature=null;const closestPoint=[NaN,NaN];let minSquaredDistance=1/0;const extent=[-1/0,-1/0,1/0,1/0];return filter=filter||functions.rT,this.featuresRtree_.forEachInExtent(extent,(function(feature){if(filter(feature)){const geometry=feature.getGeometry(),previousMinSquaredDistance=minSquaredDistance;if(minSquaredDistance=geometry instanceof Feature.Ay?0:geometry.closestPointXY(x,y,closestPoint,minSquaredDistance),minSquaredDistance<previousMinSquaredDistance){closestFeature=feature;const minDistance=Math.sqrt(minSquaredDistance);extent[0]=x-minDistance,extent[1]=y-minDistance,extent[2]=x+minDistance,extent[3]=y+minDistance}}})),closestFeature}getExtent(extent){return this.featuresRtree_.getExtent(extent)}getFeatureById(id){const feature=this.idIndex_[id.toString()];return void 0!==feature?feature:null}getFeatureByUid(uid){const feature=this.uidIndex_[uid];return void 0!==feature?feature:null}getFormat(){return this.format_}getOverlaps(){return this.overlaps_}getUrl(){return this.url_}handleFeatureChange_(event){const feature=event.target,featureKey=(0,util.v6)(feature),geometry=feature.getGeometry();if(geometry){const extent=geometry.getExtent();featureKey in this.nullGeometryFeatures_?(delete this.nullGeometryFeatures_[featureKey],this.featuresRtree_&&this.featuresRtree_.insert(extent,feature)):this.featuresRtree_&&this.featuresRtree_.update(extent,feature)}else featureKey in this.nullGeometryFeatures_||(this.featuresRtree_&&this.featuresRtree_.remove(feature),this.nullGeometryFeatures_[featureKey]=feature);const id=feature.getId();if(void 0!==id){const sid=id.toString();this.idIndex_[sid]!==feature&&(this.removeFromIdIndex_(feature),this.idIndex_[sid]=feature)}else this.removeFromIdIndex_(feature),this.uidIndex_[featureKey]=feature;this.changed(),this.dispatchEvent(new VectorSourceEvent(VectorEventType_CHANGEFEATURE,feature))}hasFeature(feature){const id=feature.getId();return void 0!==id?id in this.idIndex_:(0,util.v6)(feature)in this.uidIndex_}isEmpty(){return this.featuresRtree_?this.featuresRtree_.isEmpty()&&(0,obj.p)(this.nullGeometryFeatures_):!this.featuresCollection_||0===this.featuresCollection_.getLength()}loadFeatures(extent,resolution,projection){const loadedExtentsRtree=this.loadedExtentsRtree_,extentsToLoad=this.strategy_(extent,resolution,projection);for(let i=0,ii=extentsToLoad.length;i<ii;++i){const extentToLoad=extentsToLoad[i];loadedExtentsRtree.forEachInExtent(extentToLoad,(function(object){return(0,ol_extent.ms)(object.extent,extentToLoad)}))||(++this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType_FEATURESLOADSTART)),this.loader_.call(this,extentToLoad,resolution,projection,(features=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType_FEATURESLOADEND,void 0,features))}),(()=>{--this.loadingExtentsCount_,this.dispatchEvent(new VectorSourceEvent(VectorEventType_FEATURESLOADERROR))})),loadedExtentsRtree.insert(extentToLoad,{extent:extentToLoad.slice()}))}this.loading=!(this.loader_.length<4)&&this.loadingExtentsCount_>0}refresh(){this.clear(!0),this.loadedExtentsRtree_.clear(),super.refresh()}removeLoadedExtent(extent){const loadedExtentsRtree=this.loadedExtentsRtree_;let obj;loadedExtentsRtree.forEachInExtent(extent,(function(object){if((0,ol_extent.aI)(object.extent,extent))return obj=object,!0})),obj&&loadedExtentsRtree.remove(obj)}removeFeature(feature){if(!feature)return;const featureKey=(0,util.v6)(feature);featureKey in this.nullGeometryFeatures_?delete this.nullGeometryFeatures_[featureKey]:this.featuresRtree_&&this.featuresRtree_.remove(feature);this.removeFeatureInternal(feature)&&this.changed()}removeFeatureInternal(feature){const featureKey=(0,util.v6)(feature),featureChangeKeys=this.featureChangeKeys_[featureKey];if(!featureChangeKeys)return;featureChangeKeys.forEach(events.JH),delete this.featureChangeKeys_[featureKey];const id=feature.getId();return void 0!==id&&delete this.idIndex_[id.toString()],delete this.uidIndex_[featureKey],this.dispatchEvent(new VectorSourceEvent(VectorEventType_REMOVEFEATURE,feature)),feature}removeFromIdIndex_(feature){let removed=!1;for(const id in this.idIndex_){const indexedFeature=this.idIndex_[id];if(feature instanceof Feature.Ay&&Array.isArray(indexedFeature)&&indexedFeature.includes(feature))indexedFeature.splice(indexedFeature.indexOf(feature),1);else if(this.idIndex_[id]===feature){delete this.idIndex_[id],removed=!0;break}}return removed}setLoader(loader){this.loader_=loader}setUrl(url){(0,asserts.v)(this.format_,"`format` must be set when `url` is set"),this.url_=url,this.setLoader(xhr(url,this.format_))}};var GeoJSON=__webpack_require__("./node_modules/ol/format/GeoJSON.js");const IMAGE_REPLAYS={image:["Polygon","Circle","LineString","Image","Text"],hybrid:["Polygon","LineString"],vector:[]},VECTOR_REPLAYS={hybrid:["Image","Text","Default"],vector:["Polygon","Circle","LineString","Image","Text","Default"]};const canvas_VectorTileLayer=class CanvasVectorTileLayerRenderer extends canvas_TileLayer{constructor(layer){super(layer),this.boundHandleStyleImageChange_=this.handleStyleImageChange_.bind(this),this.renderedLayerRevision_,this.renderedPixelToCoordinateTransform_=null,this.renderedRotation_,this.tmpTransform_=(0,ol_transform.vt)()}prepareTile(tile,pixelRatio,projection){let render;const state=tile.getState();return state!==TileState_LOADED&&state!==TileState_ERROR||(this.updateExecutorGroup_(tile,pixelRatio,projection),this.tileImageNeedsRender_(tile)&&(render=!0)),render}getTile(z,x,y,frameState){const pixelRatio=frameState.pixelRatio,viewState=frameState.viewState,resolution=viewState.resolution,projection=viewState.projection,layer=this.getLayer(),tile=layer.getSource().getTile(z,x,y,pixelRatio,projection),viewHints=frameState.viewHints,hifi=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]);!hifi&&tile.wantedResolution||(tile.wantedResolution=resolution);return this.prepareTile(tile,pixelRatio,projection)&&(hifi||Date.now()-frameState.time<8)&&"vector"!==layer.getRenderMode()&&this.renderTileImage_(tile,frameState),super.getTile(z,x,y,frameState)}isDrawableTile(tile){const layer=this.getLayer();return super.isDrawableTile(tile)&&("vector"===layer.getRenderMode()?(0,util.v6)(layer)in tile.executorGroups:tile.hasContext(layer))}getTileImage(tile){return tile.getImage(this.getLayer())}prepareFrame(frameState){const layerRevision=this.getLayer().getRevision();return this.renderedLayerRevision_!==layerRevision&&(this.renderedLayerRevision_=layerRevision,this.renderedTiles.length=0),super.prepareFrame(frameState)}updateExecutorGroup_(tile,pixelRatio,projection){const layer=this.getLayer(),revision=layer.getRevision(),renderOrder=layer.getRenderOrder()||null,resolution=tile.wantedResolution,builderState=tile.getReplayState(layer);if(!builderState.dirty&&builderState.renderedResolution===resolution&&builderState.renderedRevision==revision&&builderState.renderedRenderOrder==renderOrder)return;const source=layer.getSource(),declutter=layer.getDeclutter(),sourceTileGrid=source.getTileGrid(),tileExtent=source.getTileGridForProjection(projection).getTileCoordExtent(tile.wrappedTileCoord),sourceTiles=source.getSourceTiles(pixelRatio,projection,tile),layerUid=(0,util.v6)(layer);delete tile.hitDetectionImageData[layerUid],tile.executorGroups[layerUid]=[],declutter&&(tile.declutterExecutorGroups[layerUid]=[]),builderState.dirty=!1;for(let t=0,tt=sourceTiles.length;t<tt;++t){const sourceTile=sourceTiles[t];if(sourceTile.getState()!=TileState_LOADED)continue;const sourceTileCoord=sourceTile.tileCoord,sourceTileExtent=sourceTileGrid.getTileCoordExtent(sourceTileCoord),sharedExtent=(0,ol_extent._N)(tileExtent,sourceTileExtent),builderExtent=(0,ol_extent.r)(sharedExtent,layer.getRenderBuffer()*resolution,this.tmpExtent),bufferedExtent=(0,ol_extent.aI)(sourceTileExtent,sharedExtent)?null:builderExtent,builderGroup=new canvas_BuilderGroup(0,builderExtent,resolution,pixelRatio),declutterBuilderGroup=declutter?new canvas_BuilderGroup(0,sharedExtent,resolution,pixelRatio):void 0,squaredTolerance=getSquaredTolerance(resolution,pixelRatio),render=function(feature){let styles;const styleFunction=feature.getStyleFunction()||layer.getStyleFunction();if(styleFunction&&(styles=styleFunction(feature,resolution)),styles){const dirty=this.renderFeature(feature,squaredTolerance,styles,builderGroup,declutterBuilderGroup);builderState.dirty=builderState.dirty||dirty}},features=sourceTile.getFeatures();renderOrder&&renderOrder!==builderState.renderedRenderOrder&&features.sort(renderOrder);for(let i=0,ii=features.length;i<ii;++i){const feature=features[i];bufferedExtent&&!(0,ol_extent.HY)(bufferedExtent,feature.getGeometry().getExtent())||render.call(this,feature)}const executorGroupInstructions=builderGroup.finish(),replayExtent="vector"!==layer.getRenderMode()&&declutter&&1===sourceTiles.length?null:sharedExtent,renderingReplayGroup=new canvas_ExecutorGroup(replayExtent,resolution,pixelRatio,source.getOverlaps(),executorGroupInstructions,layer.getRenderBuffer());if(tile.executorGroups[layerUid].push(renderingReplayGroup),declutterBuilderGroup){const declutterExecutorGroup=new canvas_ExecutorGroup(null,resolution,pixelRatio,source.getOverlaps(),declutterBuilderGroup.finish(),layer.getRenderBuffer());tile.declutterExecutorGroups[layerUid].push(declutterExecutorGroup)}}builderState.renderedRevision=revision,builderState.renderedRenderOrder=renderOrder,builderState.renderedResolution=resolution}forEachFeatureAtCoordinate(coordinate,frameState,hitTolerance,callback,matches){const resolution=frameState.viewState.resolution,rotation=frameState.viewState.rotation;hitTolerance=null==hitTolerance?0:hitTolerance;const layer=this.getLayer(),tileGrid=layer.getSource().getTileGridForProjection(frameState.viewState.projection),hitExtent=(0,ol_extent.Tr)([coordinate]);(0,ol_extent.r)(hitExtent,resolution*hitTolerance,hitExtent);const features={},featureCallback=function(feature,geometry,distanceSq){let key=feature.getId();void 0===key&&(key=(0,util.v6)(feature));const match=features[key];if(match){if(!0!==match&&distanceSq<match.distanceSq){if(0===distanceSq)return features[key]=!0,matches.splice(matches.lastIndexOf(match),1),callback(feature,layer,geometry);match.geometry=geometry,match.distanceSq=distanceSq}}else{if(0===distanceSq)return features[key]=!0,callback(feature,layer,geometry);matches.push(features[key]={feature,layer,geometry,distanceSq,callback})}},renderedTiles=this.renderedTiles;let found;for(let i=0,ii=renderedTiles.length;!found&&i<ii;++i){const tile=renderedTiles[i],tileExtent=tileGrid.getTileCoordExtent(tile.wrappedTileCoord);if(!(0,ol_extent.HY)(tileExtent,hitExtent))continue;const layerUid=(0,util.v6)(layer),executorGroups=[tile.executorGroups[layerUid]],declutterExecutorGroups=tile.declutterExecutorGroups[layerUid];declutterExecutorGroups&&executorGroups.push(declutterExecutorGroups),executorGroups.some((executorGroups=>{const declutteredFeatures=executorGroups===declutterExecutorGroups?frameState.declutterTree.all().map((item=>item.value)):null;for(let t=0,tt=executorGroups.length;t<tt;++t){const executorGroup=executorGroups[t];if(found=executorGroup.forEachFeatureAtCoordinate(coordinate,resolution,rotation,hitTolerance,featureCallback,declutteredFeatures),found)return!0}}))}return found}getFeatures(pixel){return new Promise(((resolve,reject)=>{const layer=this.getLayer(),layerUid=(0,util.v6)(layer),source=layer.getSource(),projection=this.renderedProjection,projectionExtent=projection.getExtent(),resolution=this.renderedResolution,tileGrid=source.getTileGridForProjection(projection),coordinate=(0,ol_transform.Bb)(this.renderedPixelToCoordinateTransform_,pixel.slice()),tileCoord=tileGrid.getTileCoordForCoordAndResolution(coordinate,resolution);let tile;for(let i=0,ii=this.renderedTiles.length;i<ii;++i)if(tileCoord.toString()===this.renderedTiles[i].tileCoord.toString()){if(tile=this.renderedTiles[i],tile.getState()===TileState_LOADED){const extent=tileGrid.getTileCoordExtent(tile.tileCoord);source.getWrapX()&&projection.canWrapX()&&!(0,ol_extent.ms)(projectionExtent,extent)&&(0,ol_coordinate.Li)(coordinate,projection);break}tile=void 0}if(!tile||tile.loadingSourceTiles>0)return void resolve([]);const extent=tileGrid.getTileCoordExtent(tile.wrappedTileCoord),corner=(0,ol_extent.Py)(extent),tilePixel=[(coordinate[0]-corner[0])/resolution,(corner[1]-coordinate[1])/resolution],features=tile.getSourceTiles().reduce((function(accumulator,sourceTile){return accumulator.concat(sourceTile.getFeatures())}),[]);let hitDetectionImageData=tile.hitDetectionImageData[layerUid];if(!hitDetectionImageData){const tileSize=(0,ol_size.xq)(tileGrid.getTileSize(tileGrid.getZForResolution(resolution,source.zDirection))),rotation=this.renderedRotation_;hitDetectionImageData=createHitDetectionImageData(tileSize,[this.getRenderTransform(tileGrid.getTileCoordCenter(tile.wrappedTileCoord),resolution,0,.5,.5*tileSize[0],.5*tileSize[1],0)],features,layer.getStyleFunction(),tileGrid.getTileCoordExtent(tile.wrappedTileCoord),tile.getReplayState(layer).renderedResolution,rotation),tile.hitDetectionImageData[layerUid]=hitDetectionImageData}resolve(hitDetect(tilePixel,features,hitDetectionImageData))}))}handleFontsChanged(){const layer=this.getLayer();layer.getVisible()&&void 0!==this.renderedLayerRevision_&&layer.changed()}handleStyleImageChange_(event){this.renderIfReadyAndVisible()}renderDeclutter(frameState){const context=this.context,alpha=context.globalAlpha;context.globalAlpha=this.getLayer().getOpacity();const viewHints=frameState.viewHints,hifi=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]),tiles=this.renderedTiles;for(let i=0,ii=tiles.length;i<ii;++i){const tile=tiles[i],declutterExecutorGroups=tile.declutterExecutorGroups[(0,util.v6)(this.getLayer())];if(declutterExecutorGroups)for(let j=declutterExecutorGroups.length-1;j>=0;--j)declutterExecutorGroups[j].execute(this.context,1,this.getTileRenderTransform(tile,frameState),frameState.viewState.rotation,hifi,void 0,frameState.declutterTree)}context.globalAlpha=alpha}getTileRenderTransform(tile,frameState){const pixelRatio=frameState.pixelRatio,viewState=frameState.viewState,center=viewState.center,resolution=viewState.resolution,rotation=viewState.rotation,size=frameState.size,width=Math.round(size[0]*pixelRatio),height=Math.round(size[1]*pixelRatio),tileGrid=this.getLayer().getSource().getTileGridForProjection(frameState.viewState.projection),tileCoord=tile.tileCoord,tileExtent=tileGrid.getTileCoordExtent(tile.wrappedTileCoord),worldOffset=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent)[0]-tileExtent[0];return(0,ol_transform.lw)((0,ol_transform.hs)(this.inversePixelTransform.slice(),1/pixelRatio,1/pixelRatio),this.getRenderTransform(center,resolution,rotation,pixelRatio,width,height,worldOffset))}postRender(context,frameState){const viewHints=frameState.viewHints,hifi=!(viewHints[ViewHint_ANIMATING]||viewHints[ViewHint_INTERACTING]);this.renderedPixelToCoordinateTransform_=frameState.pixelToCoordinateTransform.slice(),this.renderedRotation_=frameState.viewState.rotation;const layer=this.getLayer(),renderMode=layer.getRenderMode(),alpha=context.globalAlpha;context.globalAlpha=layer.getOpacity();const replayTypes=VECTOR_REPLAYS[renderMode],viewState=frameState.viewState,rotation=viewState.rotation,tileSource=layer.getSource(),z=tileSource.getTileGridForProjection(viewState.projection).getZForResolution(viewState.resolution,tileSource.zDirection),tiles=this.renderedTiles,clips=[],clipZs=[];let ready=!0;for(let i=tiles.length-1;i>=0;--i){const tile=tiles[i];ready=ready&&!tile.getReplayState(layer).dirty;const executorGroups=tile.executorGroups[(0,util.v6)(layer)].filter((group=>group.hasExecutors(replayTypes)));if(0===executorGroups.length)continue;const transform=this.getTileRenderTransform(tile,frameState),currentZ=tile.tileCoord[0];let contextSaved=!1;const currentClip=executorGroups[0].getClipCoords(transform);if(currentClip){for(let j=0,jj=clips.length;j<jj;++j)if(z!==currentZ&&currentZ<clipZs[j]){const clip=clips[j];(0,ol_extent.HY)([currentClip[0],currentClip[3],currentClip[4],currentClip[7]],[clip[0],clip[3],clip[4],clip[7]])&&(contextSaved||(context.save(),contextSaved=!0),context.beginPath(),context.moveTo(currentClip[0],currentClip[1]),context.lineTo(currentClip[2],currentClip[3]),context.lineTo(currentClip[4],currentClip[5]),context.lineTo(currentClip[6],currentClip[7]),context.moveTo(clip[6],clip[7]),context.lineTo(clip[4],clip[5]),context.lineTo(clip[2],clip[3]),context.lineTo(clip[0],clip[1]),context.clip())}clips.push(currentClip),clipZs.push(currentZ)}for(let t=0,tt=executorGroups.length;t<tt;++t){executorGroups[t].execute(context,1,transform,rotation,hifi,replayTypes)}contextSaved&&context.restore()}context.globalAlpha=alpha,this.ready=ready,super.postRender(context,frameState)}renderFeature(feature,squaredTolerance,styles,builderGroup,declutterBuilderGroup){if(!styles)return!1;let loading=!1;if(Array.isArray(styles))for(let i=0,ii=styles.length;i<ii;++i)loading=renderFeature(builderGroup,feature,styles[i],squaredTolerance,this.boundHandleStyleImageChange_,void 0,declutterBuilderGroup)||loading;else loading=renderFeature(builderGroup,feature,styles,squaredTolerance,this.boundHandleStyleImageChange_,void 0,declutterBuilderGroup);return loading}tileImageNeedsRender_(tile){const layer=this.getLayer();if("vector"===layer.getRenderMode())return!1;const replayState=tile.getReplayState(layer),revision=layer.getRevision(),resolution=tile.wantedResolution;return replayState.renderedTileResolution!==resolution||replayState.renderedTileRevision!==revision}renderTileImage_(tile,frameState){const layer=this.getLayer(),replayState=tile.getReplayState(layer),revision=layer.getRevision(),executorGroups=tile.executorGroups[(0,util.v6)(layer)];replayState.renderedTileRevision=revision;const tileCoord=tile.wrappedTileCoord,z=tileCoord[0],source=layer.getSource();let pixelRatio=frameState.pixelRatio;const projection=frameState.viewState.projection,tileGrid=source.getTileGridForProjection(projection),tileResolution=tileGrid.getResolution(tile.tileCoord[0]),renderPixelRatio=frameState.pixelRatio/tile.wantedResolution*tileResolution,resolution=tileGrid.getResolution(z),context=tile.getContext(layer);pixelRatio=Math.round(Math.max(pixelRatio,renderPixelRatio/pixelRatio));const size=source.getTilePixelSize(z,pixelRatio,projection);context.canvas.width=size[0],context.canvas.height=size[1];const renderScale=pixelRatio/renderPixelRatio;if(1!==renderScale){const canvasTransform=(0,ol_transform.cL)(this.tmpTransform_);(0,ol_transform.hs)(canvasTransform,renderScale,renderScale),context.setTransform.apply(context,canvasTransform)}const tileExtent=tileGrid.getTileCoordExtent(tileCoord,this.tmpExtent),pixelScale=renderPixelRatio/resolution,transform=(0,ol_transform.cL)(this.tmpTransform_);(0,ol_transform.hs)(transform,pixelScale,-pixelScale),(0,ol_transform.Tl)(transform,-tileExtent[0],-tileExtent[3]);for(let i=0,ii=executorGroups.length;i<ii;++i){executorGroups[i].execute(context,renderScale,transform,0,!0,IMAGE_REPLAYS[layer.getRenderMode()])}replayState.renderedTileResolution=tile.wantedResolution}};const VectorTile=class VectorTile_VectorTileLayer extends BaseVector{constructor(options){options=options||{};const baseOptions=Object.assign({},options);delete baseOptions.preload,delete baseOptions.useInterimTilesOnError,super(baseOptions),this.on,this.once,this.un;const renderMode=options.renderMode||"hybrid";(0,asserts.v)("hybrid"==renderMode||"vector"==renderMode,"`renderMode` must be `'hybrid'` or `'vector'`"),this.renderMode_=renderMode,this.setPreload(options.preload?options.preload:0),this.setUseInterimTilesOnError(void 0===options.useInterimTilesOnError||options.useInterimTilesOnError),this.getBackground,this.setBackground}createRenderer(){return new canvas_VectorTileLayer(this)}getFeatures(pixel){return super.getFeatures(pixel)}getRenderMode(){return this.renderMode_}getPreload(){return this.get(TileProperty_PRELOAD)}getUseInterimTilesOnError(){return this.get(TileProperty_USE_INTERIM_TILES_ON_ERROR)}setPreload(preload){this.set(TileProperty_PRELOAD,preload)}setUseInterimTilesOnError(useInterimTilesOnError){this.set(TileProperty_USE_INTERIM_TILES_ON_ERROR,useInterimTilesOnError)}};class ResponseError extends Error{constructor(response){super("Unexpected response status: "+response.status),this.name="ResponseError",this.response=response}}class ClientError extends Error{constructor(client){super("Failed to issue request"),this.name="ClientError",this.client=client}}function getJSON(url){return new Promise((function(resolve,reject){const client=new XMLHttpRequest;client.addEventListener("load",(function onLoad(event){const client=event.target;if(!client.status||client.status>=200&&client.status<300){let data;try{data=JSON.parse(client.responseText)}catch(err){const message="Error parsing response text as JSON: "+err.message;return void reject(new Error(message))}resolve(data)}else reject(new ResponseError(client))})),client.addEventListener("error",(function onError(event){reject(new ClientError(event.target))})),client.open("GET",url),client.setRequestHeader("Accept","application/json"),client.send()}))}function resolveUrl(base,url){return url.includes("://")?url:new URL(url,base).href}const knownMapMediaTypes={"image/png":!0,"image/jpeg":!0,"image/gif":!0,"image/webp":!0},knownVectorMediaTypes={"application/vnd.mapbox-vector-tile":!0,"application/geo+json":!0};function parseTileMatrixSet(sourceInfo,tileMatrixSet,tileUrlTemplate,tileMatrixSetLimits){let projection=sourceInfo.projection;if(!projection&&(projection=(0,ol_proj.Jt)(tileMatrixSet.crs),!projection))throw new Error(`Unsupported CRS: ${tileMatrixSet.crs}`);const backwards="en"!==projection.getAxisOrientation().substr(0,2),matrices=tileMatrixSet.tileMatrices,matrixLookup={};for(let i=0;i<matrices.length;++i){const matrix=matrices[i];matrixLookup[matrix.id]=matrix}const limitLookup={},matrixIds=[];if(tileMatrixSetLimits)for(let i=0;i<tileMatrixSetLimits.length;++i){const limit=tileMatrixSetLimits[i],id=limit.tileMatrix;matrixIds.push(id),limitLookup[id]=limit}else for(let i=0;i<matrices.length;++i){const id=matrices[i].id;matrixIds.push(id)}const length=matrixIds.length,origins=new Array(length),resolutions=new Array(length),sizes=new Array(length),tileSizes=new Array(length),extent=[-1/0,-1/0,1/0,1/0];for(let i=0;i<length;++i){const id=matrixIds[i],matrix=matrixLookup[id],origin=matrix.pointOfOrigin;origins[i]=backwards?[origin[1],origin[0]]:origin,resolutions[i]=matrix.cellSize,sizes[i]=[matrix.matrixWidth,matrix.matrixHeight],tileSizes[i]=[matrix.tileWidth,matrix.tileHeight];const limit=limitLookup[id];if(limit){const tileMapWidth=matrix.cellSize*matrix.tileWidth,minX=origins[i][0]+limit.minTileCol*tileMapWidth,maxX=origins[i][0]+(limit.maxTileCol+1)*tileMapWidth,tileMapHeight=matrix.cellSize*matrix.tileHeight;let minY,maxY;"bottomLeft"===matrix.cornerOfOrigin?(minY=origins[i][1]+limit.minTileRow*tileMapHeight,maxY=origins[i][1]+(limit.maxTileRow+1)*tileMapHeight):(minY=origins[i][1]-(limit.maxTileRow+1)*tileMapHeight,maxY=origins[i][1]-limit.minTileRow*tileMapHeight),(0,ol_extent._N)(extent,[minX,minY,maxX,maxY],extent)}}const tileGrid=new TileGrid.A({origins,resolutions,sizes,tileSizes,extent:tileMatrixSetLimits?extent:void 0}),context=sourceInfo.context,base=sourceInfo.url;return{grid:tileGrid,urlTemplate:tileUrlTemplate,urlFunction:function tileUrlFunction(tileCoord,pixelRatio,projection){if(!tileCoord)return;const id=matrixIds[tileCoord[0]],matrix=matrixLookup[id],upsideDown="bottomLeft"===matrix.cornerOfOrigin,localContext={tileMatrix:id,tileCol:tileCoord[1],tileRow:upsideDown?-tileCoord[2]-1:tileCoord[2]};if(tileMatrixSetLimits){const limit=limitLookup[matrix.id];if(localContext.tileCol<limit.minTileCol||localContext.tileCol>limit.maxTileCol||localContext.tileRow<limit.minTileRow||localContext.tileRow>limit.maxTileRow)return}Object.assign(localContext,context);const url=tileUrlTemplate.replace(/\{(\w+?)\}/g,(function(m,p){return localContext[p]}));return resolveUrl(base,url)}}}function parseTileSetMetadata(sourceInfo,tileSet){const tileMatrixSetLimits=tileSet.tileMatrixSetLimits;let tileUrlTemplate;if("map"===tileSet.dataType)tileUrlTemplate=function getMapTileUrlTemplate(links,mediaType){let tileUrlTemplate,fallbackUrlTemplate;for(let i=0;i<links.length;++i){const link=links[i];if("item"===link.rel){if(link.type===mediaType){tileUrlTemplate=link.href;break}(knownMapMediaTypes[link.type]||!fallbackUrlTemplate&&link.type.startsWith("image/"))&&(fallbackUrlTemplate=link.href)}}if(!tileUrlTemplate){if(!fallbackUrlTemplate)throw new Error('Could not find "item" link');tileUrlTemplate=fallbackUrlTemplate}return tileUrlTemplate}(tileSet.links,sourceInfo.mediaType);else{if("vector"!==tileSet.dataType)throw new Error('Expected tileset data type to be "map" or "vector"');tileUrlTemplate=function getVectorTileUrlTemplate(links,mediaType,supportedMediaTypes){let tileUrlTemplate,fallbackUrlTemplate;const hrefLookup={};for(let i=0;i<links.length;++i){const link=links[i];if(hrefLookup[link.type]=link.href,"item"===link.rel){if(link.type===mediaType){tileUrlTemplate=link.href;break}knownVectorMediaTypes[link.type]&&(fallbackUrlTemplate=link.href)}}if(!tileUrlTemplate&&supportedMediaTypes)for(let i=0;i<supportedMediaTypes.length;++i){const supportedMediaType=supportedMediaTypes[i];if(hrefLookup[supportedMediaType]){tileUrlTemplate=hrefLookup[supportedMediaType];break}}if(!tileUrlTemplate){if(!fallbackUrlTemplate)throw new Error('Could not find "item" link');tileUrlTemplate=fallbackUrlTemplate}return tileUrlTemplate}(tileSet.links,sourceInfo.mediaType,sourceInfo.supportedMediaTypes)}if(tileSet.tileMatrixSet)return parseTileMatrixSet(sourceInfo,tileSet.tileMatrixSet,tileUrlTemplate,tileMatrixSetLimits);const tileMatrixSetLink=tileSet.links.find((link=>"http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme"===link.rel));if(!tileMatrixSetLink)throw new Error("Expected http://www.opengis.net/def/rel/ogc/1.0/tiling-scheme link or tileMatrixSet");const tileMatrixSetDefinition=tileMatrixSetLink.href;return getJSON(resolveUrl(sourceInfo.url,tileMatrixSetDefinition)).then((function(tileMatrixSet){return parseTileMatrixSet(sourceInfo,tileMatrixSet,tileUrlTemplate,tileMatrixSetLimits)}))}function getTileSetInfo(sourceInfo){return getJSON(sourceInfo.url).then((function(tileSet){return parseTileSetMetadata(sourceInfo,tileSet)}))}const source_OGCMapTile=class OGCMapTile extends source_TileImage{constructor(options){super({attributions:options.attributions,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,interpolate:options.interpolate,projection:options.projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,state:"loading",tileLoadFunction:options.tileLoadFunction,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition});getTileSetInfo({url:options.url,projection:this.getProjection(),mediaType:options.mediaType,context:options.context||null}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(tileSetInfo){this.tileGrid=tileSetInfo.grid,this.setTileUrlFunction(tileSetInfo.urlFunction,tileSetInfo.urlTemplate),this.setState("ready")}handleError_(error){(0,ol_console.z3)(error),this.setState("error")}};const ol_VectorTile=class VectorTile_VectorTile extends ol_Tile{constructor(tileCoord,state,src,format,tileLoadFunction,options){super(tileCoord,state,options),this.extent=null,this.format_=format,this.features_=null,this.loader_,this.projection=null,this.resolution,this.tileLoadFunction_=tileLoadFunction,this.url_=src,this.key=src}getFormat(){return this.format_}getFeatures(){return this.features_}load(){this.state==TileState_IDLE&&(this.setState(TileState_LOADING),this.tileLoadFunction_(this,this.url_),this.loader_&&this.loader_(this.extent,this.resolution,this.projection))}onLoad(features,dataProjection){this.setFeatures(features)}onError(){this.setState(TileState_ERROR)}setFeatures(features){this.features_=features,this.setState(TileState_LOADED)}setLoader(loader){this.loader_=loader}},VectorRenderTile_canvasPool=[];const ol_VectorRenderTile=class VectorRenderTile extends ol_Tile{constructor(tileCoord,state,urlTileCoord,getSourceTiles){super(tileCoord,state,{transition:0}),this.context_={},this.executorGroups={},this.declutterExecutorGroups={},this.loadingSourceTiles=0,this.hitDetectionImageData={},this.replayState_={},this.sourceTiles=[],this.errorTileKeys={},this.wantedResolution,this.getSourceTiles=getSourceTiles.bind(void 0,this),this.wrappedTileCoord=urlTileCoord}getContext(layer){const key=(0,util.v6)(layer);return key in this.context_||(this.context_[key]=(0,dom.Y)(1,1,VectorRenderTile_canvasPool)),this.context_[key]}hasContext(layer){return(0,util.v6)(layer)in this.context_}getImage(layer){return this.hasContext(layer)?this.getContext(layer).canvas:null}getReplayState(layer){const key=(0,util.v6)(layer);return key in this.replayState_||(this.replayState_[key]={dirty:!1,renderedRenderOrder:null,renderedResolution:NaN,renderedRevision:-1,renderedTileResolution:NaN,renderedTileRevision:-1,renderedTileZ:-1}),this.replayState_[key]}load(){this.getSourceTiles()}release(){for(const key in this.context_){const context=this.context_[key];(0,dom.Yg)(context),VectorRenderTile_canvasPool.push(context.canvas),delete this.context_[key]}super.release()}};const source_VectorTile=class source_VectorTile_VectorTile extends source_UrlTile{constructor(options){const projection=options.projection||"EPSG:3857",extent=options.extent||extentFromProjection(projection),tileGrid=options.tileGrid||createXYZ({extent,maxResolution:options.maxResolution,maxZoom:void 0!==options.maxZoom?options.maxZoom:22,minZoom:options.minZoom,tileSize:options.tileSize||512});super({attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,cacheSize:options.cacheSize,interpolate:!0,opaque:!1,projection,state:options.state,tileGrid,tileLoadFunction:options.tileLoadFunction?options.tileLoadFunction:defaultLoadFunction,tileUrlFunction:options.tileUrlFunction,url:options.url,urls:options.urls,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,zDirection:void 0===options.zDirection?1:options.zDirection}),this.format_=options.format?options.format:null,this.sourceTileCache=new ol_TileCache(this.tileCache.highWaterMark),this.overlaps_=null==options.overlaps||options.overlaps,this.tileClass=options.tileClass?options.tileClass:ol_VectorTile,this.tileGrids_={}}getFeaturesInExtent(extent){const features=[],tileCache=this.tileCache;if(0===tileCache.getCount())return features;const z=(0,tilecoord.K)(tileCache.peekFirstKey())[0],tileGrid=this.tileGrid;return tileCache.forEach((function(tile){if(tile.tileCoord[0]!==z||tile.getState()!==TileState_LOADED)return;const sourceTiles=tile.getSourceTiles();for(let i=0,ii=sourceTiles.length;i<ii;++i){const sourceTile=sourceTiles[i],tileCoord=sourceTile.tileCoord;if((0,ol_extent.HY)(extent,tileGrid.getTileCoordExtent(tileCoord))){const tileFeatures=sourceTile.getFeatures();if(tileFeatures)for(let j=0,jj=tileFeatures.length;j<jj;++j){const candidate=tileFeatures[j],geometry=candidate.getGeometry();(0,ol_extent.HY)(extent,geometry.getExtent())&&features.push(candidate)}}}})),features}getOverlaps(){return this.overlaps_}clear(){this.tileCache.clear(),this.sourceTileCache.clear()}expireCache(projection,usedTiles){const tileCache=this.getTileCacheForProjection(projection),usedSourceTiles=Object.keys(usedTiles).reduce(((acc,key)=>{const cacheKey=(0,tilecoord.gr)(key),tile=tileCache.peek(cacheKey);if(tile){const sourceTiles=tile.sourceTiles;for(let i=0,ii=sourceTiles.length;i<ii;++i)acc[sourceTiles[i].getKey()]=!0}return acc}),{});super.expireCache(projection,usedTiles),this.sourceTileCache.expireCache(usedSourceTiles)}getSourceTiles(pixelRatio,projection,tile){if(tile.getState()===TileState_IDLE){tile.setState(TileState_LOADING);const urlTileCoord=tile.wrappedTileCoord,tileGrid=this.getTileGridForProjection(projection),extent=tileGrid.getTileCoordExtent(urlTileCoord),z=urlTileCoord[0],resolution=tileGrid.getResolution(z);(0,ol_extent.r)(extent,-resolution,extent);const sourceTileGrid=this.tileGrid,sourceExtent=sourceTileGrid.getExtent();sourceExtent&&(0,ol_extent._N)(extent,sourceExtent,extent);const sourceZ=sourceTileGrid.getZForResolution(resolution,this.zDirection);sourceTileGrid.forEachTileCoord(extent,sourceZ,(sourceTileCoord=>{const tileUrl=this.tileUrlFunction(sourceTileCoord,pixelRatio,projection),sourceTile=this.sourceTileCache.containsKey(tileUrl)?this.sourceTileCache.get(tileUrl):new this.tileClass(sourceTileCoord,tileUrl?TileState_IDLE:TileState_EMPTY,tileUrl,this.format_,this.tileLoadFunction);tile.sourceTiles.push(sourceTile);const sourceTileState=sourceTile.getState();if(sourceTileState<TileState_LOADED){const listenChange=event=>{this.handleTileChange(event);const state=sourceTile.getState();if(state===TileState_LOADED||state===TileState_ERROR){const sourceTileKey=sourceTile.getKey();sourceTileKey in tile.errorTileKeys?sourceTile.getState()===TileState_LOADED&&delete tile.errorTileKeys[sourceTileKey]:tile.loadingSourceTiles--,state===TileState_ERROR?tile.errorTileKeys[sourceTileKey]=!0:sourceTile.removeEventListener(EventType.A.CHANGE,listenChange),0===tile.loadingSourceTiles&&tile.setState((0,obj.p)(tile.errorTileKeys)?TileState_LOADED:TileState_ERROR)}};sourceTile.addEventListener(EventType.A.CHANGE,listenChange),tile.loadingSourceTiles++}sourceTileState===TileState_IDLE&&(sourceTile.extent=sourceTileGrid.getTileCoordExtent(sourceTileCoord),sourceTile.projection=projection,sourceTile.resolution=sourceTileGrid.getResolution(sourceTileCoord[0]),this.sourceTileCache.set(tileUrl,sourceTile),sourceTile.load())})),tile.loadingSourceTiles||tile.setState(tile.sourceTiles.some((sourceTile=>sourceTile.getState()===TileState_ERROR))?TileState_ERROR:TileState_LOADED)}return tile.sourceTiles}getTile(z,x,y,pixelRatio,projection){const coordKey=(0,tilecoord.dp)(z,x,y),key=this.getKey();let tile;if(this.tileCache.containsKey(coordKey)&&(tile=this.tileCache.get(coordKey),tile.key===key))return tile;const tileCoord=[z,x,y];let urlTileCoord=this.getTileCoordForTileUrlFunction(tileCoord,projection);const sourceExtent=this.getTileGrid().getExtent(),tileGrid=this.getTileGridForProjection(projection);if(urlTileCoord&&sourceExtent){const tileExtent=tileGrid.getTileCoordExtent(urlTileCoord);(0,ol_extent.r)(tileExtent,-tileGrid.getResolution(z),tileExtent),(0,ol_extent.HY)(sourceExtent,tileExtent)||(urlTileCoord=null)}let empty=!0;if(null!==urlTileCoord){const sourceTileGrid=this.tileGrid,resolution=tileGrid.getResolution(z),sourceZ=sourceTileGrid.getZForResolution(resolution,1),extent=tileGrid.getTileCoordExtent(urlTileCoord);(0,ol_extent.r)(extent,-resolution,extent),sourceTileGrid.forEachTileCoord(extent,sourceZ,(sourceTileCoord=>{empty=empty&&!this.tileUrlFunction(sourceTileCoord,pixelRatio,projection)}))}const newTile=new ol_VectorRenderTile(tileCoord,empty?TileState_EMPTY:TileState_IDLE,urlTileCoord,this.getSourceTiles.bind(this,pixelRatio,projection));return newTile.key=key,tile?(newTile.interimTile=tile,newTile.refreshInterimChain(),this.tileCache.replace(coordKey,newTile)):this.tileCache.set(coordKey,newTile),newTile}getTileGridForProjection(projection){const code=projection.getCode();let tileGrid=this.tileGrids_[code];if(!tileGrid){const sourceTileGrid=this.tileGrid,resolutions=sourceTileGrid.getResolutions().slice(),origins=resolutions.map((function(resolution,z){return sourceTileGrid.getOrigin(z)})),tileSizes=resolutions.map((function(resolution,z){return sourceTileGrid.getTileSize(z)})),length=common.L+1;for(let z=resolutions.length;z<length;++z)resolutions.push(resolutions[z-1]/2),origins.push(origins[z-1]),tileSizes.push(tileSizes[z-1]);tileGrid=new TileGrid.A({extent:sourceTileGrid.getExtent(),origins,resolutions,tileSizes}),this.tileGrids_[code]=tileGrid}return tileGrid}getTilePixelRatio(pixelRatio){return pixelRatio}getTilePixelSize(z,pixelRatio,projection){const tileGrid=this.getTileGridForProjection(projection),tileSize=(0,ol_size.xq)(tileGrid.getTileSize(z),this.tmpSize);return[Math.round(tileSize[0]*pixelRatio),Math.round(tileSize[1]*pixelRatio)]}updateCacheSize(tileCount,projection){super.updateCacheSize(2*tileCount,projection),this.sourceTileCache.highWaterMark=this.getTileCacheForProjection(projection).highWaterMark}};function defaultLoadFunction(tile,url){tile.setLoader((function(extent,resolution,projection){loadFeaturesXhr(url,tile.getFormat(),extent,resolution,projection,tile.onLoad.bind(tile),tile.onError.bind(tile))}))}const source_OGCVectorTile=class OGCVectorTile extends source_VectorTile{constructor(options){super({attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,cacheSize:options.cacheSize,format:options.format,overlaps:options.overlaps,projection:options.projection,tileClass:options.tileClass,transition:options.transition,wrapX:options.wrapX,zDirection:options.zDirection,state:"loading"});getTileSetInfo({url:options.url,projection:this.getProjection(),mediaType:options.mediaType,supportedMediaTypes:options.format.supportedMediaTypes,context:options.context||null}).then(this.handleTileSetInfo_.bind(this)).catch(this.handleError_.bind(this))}handleTileSetInfo_(tileSetInfo){this.tileGrid=tileSetInfo.grid,this.setTileUrlFunction(tileSetInfo.urlFunction,tileSetInfo.urlTemplate),this.setState("ready")}handleError_(error){(0,ol_console.z3)(error),this.setState("error")}};const source_WMTS=class WMTS extends source_TileImage{constructor(options){const requestEncoding=void 0!==options.requestEncoding?options.requestEncoding:"KVP",tileGrid=options.tileGrid;let urls=options.urls;void 0===urls&&void 0!==options.url&&(urls=expandUrl(options.url)),super({attributions:options.attributions,attributionsCollapsible:options.attributionsCollapsible,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,interpolate:options.interpolate,projection:options.projection,reprojectionErrorThreshold:options.reprojectionErrorThreshold,tileClass:options.tileClass,tileGrid,tileLoadFunction:options.tileLoadFunction,tilePixelRatio:options.tilePixelRatio,urls,wrapX:void 0!==options.wrapX&&options.wrapX,transition:options.transition,zDirection:options.zDirection}),this.version_=void 0!==options.version?options.version:"1.0.0",this.format_=void 0!==options.format?options.format:"image/jpeg",this.dimensions_=void 0!==options.dimensions?options.dimensions:{},this.layer_=options.layer,this.matrixSet_=options.matrixSet,this.style_=options.style,this.requestEncoding_=requestEncoding,this.setKey(this.getKeyForDimensions_()),urls&&urls.length>0&&(this.tileUrlFunction=createFromTileUrlFunctions(urls.map(this.createFromWMTSTemplate.bind(this))))}setUrls(urls){this.urls=urls;const key=urls.join("\n");this.setTileUrlFunction(createFromTileUrlFunctions(urls.map(this.createFromWMTSTemplate.bind(this))),key)}getDimensions(){return this.dimensions_}getFormat(){return this.format_}getLayer(){return this.layer_}getMatrixSet(){return this.matrixSet_}getRequestEncoding(){return this.requestEncoding_}getStyle(){return this.style_}getVersion(){return this.version_}getKeyForDimensions_(){const res=this.urls?this.urls.slice(0):[];for(const key in this.dimensions_)res.push(key+"-"+this.dimensions_[key]);return res.join("/")}updateDimensions(dimensions){Object.assign(this.dimensions_,dimensions),this.setKey(this.getKeyForDimensions_())}createFromWMTSTemplate(template){const requestEncoding=this.requestEncoding_,context={layer:this.layer_,style:this.style_,tilematrixset:this.matrixSet_};"KVP"==requestEncoding&&Object.assign(context,{Service:"WMTS",Request:"GetTile",Version:this.version_,Format:this.format_}),template="KVP"==requestEncoding?appendParams(template,context):template.replace(/\{(\w+?)\}/g,(function(m,p){return p.toLowerCase()in context?context[p.toLowerCase()]:m}));const tileGrid=this.tileGrid,dimensions=this.dimensions_;return function(tileCoord,pixelRatio,projection){if(!tileCoord)return;const localContext={TileMatrix:tileGrid.getMatrixId(tileCoord[0]),TileCol:tileCoord[1],TileRow:tileCoord[2]};Object.assign(localContext,dimensions);let url=template;return url="KVP"==requestEncoding?appendParams(url,localContext):url.replace(/\{(\w+?)\}/g,(function(m,p){return localContext[p]})),url}}};var format_Feature=__webpack_require__("./node_modules/ol/format/Feature.js"),LineString=__webpack_require__("./node_modules/ol/geom/LineString.js"),MultiLineString=__webpack_require__("./node_modules/ol/geom/MultiLineString.js"),MultiPoint=__webpack_require__("./node_modules/ol/geom/MultiPoint.js"),MultiPolygon=__webpack_require__("./node_modules/ol/geom/MultiPolygon.js"),node_modules_pbf=__webpack_require__("./node_modules/pbf/index.js"),pbf_default=__webpack_require__.n(node_modules_pbf),Point=__webpack_require__("./node_modules/ol/geom/Point.js"),Projection=__webpack_require__("./node_modules/ol/proj/Projection.js"),orient=__webpack_require__("./node_modules/ol/geom/flat/orient.js");class MVT extends format_Feature.Ay{constructor(options){super(),options=options||{},this.dataProjection=new Projection.A({code:"",units:"tile-pixels"}),this.featureClass_=options.featureClass?options.featureClass:Feature.Ay,this.geometryName_=options.geometryName,this.layerName_=options.layerName?options.layerName:"layer",this.layers_=options.layers?options.layers:null,this.idProperty_=options.idProperty,this.supportedMediaTypes=["application/vnd.mapbox-vector-tile","application/x-protobuf"]}readRawGeometry_(pbf,feature,flatCoordinates,ends){pbf.pos=feature.geometry;const end=pbf.readVarint()+pbf.pos;let cmd=1,length=0,x=0,y=0,coordsLen=0,currentEnd=0;for(;pbf.pos<end;){if(!length){const cmdLen=pbf.readVarint();cmd=7&cmdLen,length=cmdLen>>3}if(length--,1===cmd||2===cmd)x+=pbf.readSVarint(),y+=pbf.readSVarint(),1===cmd&&coordsLen>currentEnd&&(ends.push(coordsLen),currentEnd=coordsLen),flatCoordinates.push(x,y),coordsLen+=2;else{if(7!==cmd)throw new Error("Invalid command found in the PBF");coordsLen>currentEnd&&(flatCoordinates.push(flatCoordinates[currentEnd],flatCoordinates[currentEnd+1]),coordsLen+=2)}}coordsLen>currentEnd&&(ends.push(coordsLen),currentEnd=coordsLen)}createFeature_(pbf,rawFeature,options){const type=rawFeature.type;if(0===type)return null;let feature;const values=rawFeature.properties;let id;this.idProperty_?(id=values[this.idProperty_],delete values[this.idProperty_]):id=rawFeature.id,values[this.layerName_]=rawFeature.layer.name;const flatCoordinates=[],ends=[];this.readRawGeometry_(pbf,rawFeature,flatCoordinates,ends);const geometryType=function getGeometryType(type,numEnds){let geometryType;1===type?geometryType=1===numEnds?"Point":"MultiPoint":2===type?geometryType=1===numEnds?"LineString":"MultiLineString":3===type&&(geometryType="Polygon");return geometryType}(type,ends.length);if(this.featureClass_===Feature.Ay)feature=new this.featureClass_(geometryType,flatCoordinates,ends,2,values,id),feature.transform(options.dataProjection);else{let geom;if("Polygon"==geometryType){const endss=(0,orient.yJ)(flatCoordinates,ends);geom=endss.length>1?new MultiPolygon.A(flatCoordinates,"XY",endss):new Polygon.Ay(flatCoordinates,"XY",ends)}else geom="Point"===geometryType?new Point.A(flatCoordinates,"XY"):"LineString"===geometryType?new LineString.A(flatCoordinates,"XY"):"MultiPoint"===geometryType?new MultiPoint.A(flatCoordinates,"XY"):"MultiLineString"===geometryType?new MultiLineString.A(flatCoordinates,"XY",ends):null;feature=new(0,this.featureClass_),this.geometryName_&&feature.setGeometryName(this.geometryName_);const geometry=(0,format_Feature.hX)(geom,!1,options);feature.setGeometry(geometry),void 0!==id&&feature.setId(id),feature.setProperties(values,!0)}return feature}getType(){return"arraybuffer"}readFeatures(source,options){const layers=this.layers_;options=this.adaptOptions(options);const dataProjection=(0,ol_proj.Jt)(options.dataProjection);dataProjection.setWorldExtent(options.extent),options.dataProjection=dataProjection;const pbf=new(pbf_default())(source),pbfLayers=pbf.readFields(layersPBFReader,{}),features=[];for(const name in pbfLayers){if(layers&&!layers.includes(name))continue;const pbfLayer=pbfLayers[name],extent=pbfLayer?[0,0,pbfLayer.extent,pbfLayer.extent]:null;dataProjection.setExtent(extent);for(let i=0,ii=pbfLayer.length;i<ii;++i){const rawFeature=readRawFeature(pbf,pbfLayer,i),feature=this.createFeature_(pbf,rawFeature,options);null!==feature&&features.push(feature)}}return features}readProjection(source){return this.dataProjection}setLayers(layers){this.layers_=layers}}function layersPBFReader(tag,layers,pbf){if(3===tag){const layer={keys:[],values:[],features:[]},end=pbf.readVarint()+pbf.pos;pbf.readFields(layerPBFReader,layer,end),layer.length=layer.features.length,layer.length&&(layers[layer.name]=layer)}}function layerPBFReader(tag,layer,pbf){if(15===tag)layer.version=pbf.readVarint();else if(1===tag)layer.name=pbf.readString();else if(5===tag)layer.extent=pbf.readVarint();else if(2===tag)layer.features.push(pbf.pos);else if(3===tag)layer.keys.push(pbf.readString());else if(4===tag){let value=null;const end=pbf.readVarint()+pbf.pos;for(;pbf.pos<end;)value=1===(tag=pbf.readVarint()>>3)?pbf.readString():2===tag?pbf.readFloat():3===tag?pbf.readDouble():4===tag?pbf.readVarint64():5===tag?pbf.readVarint():6===tag?pbf.readSVarint():7===tag?pbf.readBoolean():null;layer.values.push(value)}}function featurePBFReader(tag,feature,pbf){if(1==tag)feature.id=pbf.readVarint();else if(2==tag){const end=pbf.readVarint()+pbf.pos;for(;pbf.pos<end;){const key=feature.layer.keys[pbf.readVarint()],value=feature.layer.values[pbf.readVarint()];feature.properties[key]=value}}else 3==tag?feature.type=pbf.readVarint():4==tag&&(feature.geometry=pbf.pos)}function readRawFeature(pbf,layer,i){pbf.pos=layer.features[i];const end=pbf.readVarint()+pbf.pos,feature={layer,type:0,properties:{}};return pbf.readFields(featurePBFReader,feature,end),feature}const format_MVT=MVT;var ogc_client_dist=__webpack_require__("./node_modules/@camptocamp/ogc-client/dist/index.js");const source_TileJSON=class TileJSON_TileJSON extends source_TileImage{constructor(options){if(super({attributions:options.attributions,cacheSize:options.cacheSize,crossOrigin:options.crossOrigin,interpolate:options.interpolate,projection:(0,ol_proj.Jt)("EPSG:3857"),reprojectionErrorThreshold:options.reprojectionErrorThreshold,state:"loading",tileLoadFunction:options.tileLoadFunction,wrapX:void 0===options.wrapX||options.wrapX,transition:options.transition,zDirection:options.zDirection}),this.tileJSON_=null,this.tileSize_=options.tileSize,options.url)if(options.jsonp)!function jsonp(url,callback,errback,callbackParam){const script=document.createElement("script"),key="olc_"+(0,util.v6)(callback);function cleanup(){delete window[key],script.parentNode.removeChild(script)}script.async=!0,script.src=url+(url.includes("?")?"&":"?")+(callbackParam||"callback")+"="+key;const timer=setTimeout((function(){cleanup(),errback&&errback()}),1e4);window[key]=function(data){clearTimeout(timer),cleanup(),callback(data)},document.head.appendChild(script)}(options.url,this.handleTileJSONResponse.bind(this),this.handleTileJSONError.bind(this));else{const client=new XMLHttpRequest;client.addEventListener("load",this.onXHRLoad_.bind(this)),client.addEventListener("error",this.onXHRError_.bind(this)),client.open("GET",options.url),client.send()}else{if(!options.tileJSON)throw new Error("Either `url` or `tileJSON` options must be provided");this.handleTileJSONResponse(options.tileJSON)}}onXHRLoad_(event){const client=event.target;if(!client.status||client.status>=200&&client.status<300){let response;try{response=JSON.parse(client.responseText)}catch(err){return void this.handleTileJSONError()}this.handleTileJSONResponse(response)}else this.handleTileJSONError()}onXHRError_(event){this.handleTileJSONError()}getTileJSON(){return this.tileJSON_}handleTileJSONResponse(tileJSON){const epsg4326Projection=(0,ol_proj.Jt)("EPSG:4326"),sourceProjection=this.getProjection();let extent;if(void 0!==tileJSON.bounds){const transform=(0,ol_proj.FO)(epsg4326Projection,sourceProjection);extent=(0,ol_extent.NW)(tileJSON.bounds,transform)}const gridExtent=extentFromProjection(sourceProjection),minZoom=tileJSON.minzoom||0,tileGrid=createXYZ({extent:gridExtent,maxZoom:tileJSON.maxzoom||22,minZoom,tileSize:this.tileSize_});if(this.tileGrid=tileGrid,this.tileUrlFunction=createFromTemplates(tileJSON.tiles,tileGrid),tileJSON.attribution&&!this.getAttributions()){const attributionExtent=void 0!==extent?extent:gridExtent;this.setAttributions((function(frameState){return(0,ol_extent.HY)(attributionExtent,frameState.extent)?[tileJSON.attribution]:null}))}this.tileJSON_=tileJSON,this.setState("ready")}handleTileJSONError(){this.setState("error")}};var Units=__webpack_require__("./node_modules/ol/proj/Units.js");function getDefaultExportFromCjs(x){return x&&x.__esModule&&Object.prototype.hasOwnProperty.call(x,"default")?x.default:x}var parseCSSColor_1,kCSSColorTable={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function clamp_css_byte(i){return(i=Math.round(i))<0?0:i>255?255:i}function clamp_css_float(f){return f<0?0:f>1?1:f}function parse_css_int(str){return"%"===str[str.length-1]?clamp_css_byte(parseFloat(str)/100*255):clamp_css_byte(parseInt(str))}function parse_css_float(str){return"%"===str[str.length-1]?clamp_css_float(parseFloat(str)/100):clamp_css_float(parseFloat(str))}function css_hue_to_rgb(m1,m2,h){return h<0?h+=1:h>1&&(h-=1),6*h<1?m1+(m2-m1)*h*6:2*h<1?m2:3*h<2?m1+(m2-m1)*(2/3-h)*6:m1}try{parseCSSColor_1={}.parseCSSColor=function parseCSSColor(css_str){var iv,str=css_str.replace(/ /g,"").toLowerCase();if(str in kCSSColorTable)return kCSSColorTable[str].slice();if("#"===str[0])return 4===str.length?(iv=parseInt(str.substr(1),16))>=0&&iv<=4095?[(3840&iv)>>4|(3840&iv)>>8,240&iv|(240&iv)>>4,15&iv|(15&iv)<<4,1]:null:7===str.length&&(iv=parseInt(str.substr(1),16))>=0&&iv<=16777215?[(16711680&iv)>>16,(65280&iv)>>8,255&iv,1]:null;var op=str.indexOf("("),ep=str.indexOf(")");if(-1!==op&&ep+1===str.length){var fname=str.substr(0,op),params=str.substr(op+1,ep-(op+1)).split(","),alpha=1;switch(fname){case"rgba":if(4!==params.length)return null;alpha=parse_css_float(params.pop());case"rgb":return 3!==params.length?null:[parse_css_int(params[0]),parse_css_int(params[1]),parse_css_int(params[2]),alpha];case"hsla":if(4!==params.length)return null;alpha=parse_css_float(params.pop());case"hsl":if(3!==params.length)return null;var h=(parseFloat(params[0])%360+360)%360/360,s=parse_css_float(params[1]),l=parse_css_float(params[2]),m2=l<=.5?l*(s+1):l+s-l*s,m1=2*l-m2;return[clamp_css_byte(255*css_hue_to_rgb(m1,m2,h+1/3)),clamp_css_byte(255*css_hue_to_rgb(m1,m2,h)),clamp_css_byte(255*css_hue_to_rgb(m1,m2,h-1/3)),alpha];default:return null}}return null}}catch(e){}class Color{constructor(r,g,b,a=1){this.r=r,this.g=g,this.b=b,this.a=a}static parse(input){if(!input)return;if(input instanceof Color)return input;if("string"!=typeof input)return;const rgba=parseCSSColor_1(input);return rgba?new Color(rgba[0]/255*rgba[3],rgba[1]/255*rgba[3],rgba[2]/255*rgba[3],rgba[3]):void 0}toString(){const[r,g,b,a]=this.toArray();return`rgba(${Math.round(r)},${Math.round(g)},${Math.round(b)},${a})`}toArray(){const{r,g,b,a}=this;return 0===a?[0,0,0,0]:[255*r/a,255*g/a,255*b/a,a]}toArray01(){const{r,g,b,a}=this;return 0===a?[0,0,0,0]:[r/a,g/a,b/a,a]}toArray01PremultipliedAlpha(){const{r,g,b,a}=this;return[r,g,b,a]}}Color.black=new Color(0,0,0,1),Color.white=new Color(1,1,1,1),Color.transparent=new Color(0,0,0,0),Color.red=new Color(1,0,0,1),Color.blue=new Color(0,0,1,1);var Color$1=Color;function convertLiteral(value){return"object"==typeof value?["literal",value]:value}function convertFunction(parameters,propertySpec){let stops=parameters.stops;if(!stops)return function convertIdentityFunction(parameters,propertySpec){const get=["get",parameters.property];if(void 0===parameters.default)return"string"===propertySpec.type?["string",get]:get;if("enum"===propertySpec.type)return["match",get,Object.keys(propertySpec.values),get,parameters.default];{const expression=["color"===propertySpec.type?"to-color":propertySpec.type,get,convertLiteral(parameters.default)];return"array"===propertySpec.type&&expression.splice(1,0,propertySpec.value,propertySpec.length||null),expression}}(parameters,propertySpec);const zoomAndFeatureDependent=stops&&"object"==typeof stops[0][0],featureDependent=zoomAndFeatureDependent||void 0!==parameters.property,zoomDependent=zoomAndFeatureDependent||!featureDependent;return stops=stops.map((stop=>!featureDependent&&propertySpec.tokens&&"string"==typeof stop[1]?[stop[0],convertTokenString(stop[1])]:[stop[0],convertLiteral(stop[1])])),zoomAndFeatureDependent?function convertZoomAndPropertyFunction(parameters,propertySpec,stops){const featureFunctionParameters={},featureFunctionStops={},zoomStops=[];for(let s=0;s<stops.length;s++){const stop=stops[s],zoom=stop[0].zoom;void 0===featureFunctionParameters[zoom]&&(featureFunctionParameters[zoom]={zoom,type:parameters.type,property:parameters.property,default:parameters.default},featureFunctionStops[zoom]=[],zoomStops.push(zoom)),featureFunctionStops[zoom].push([stop[0].value,stop[1]])}const functionType=getFunctionType({},propertySpec);if("exponential"===functionType){const expression=[getInterpolateOperator(parameters),["linear"],["zoom"]];for(const z of zoomStops){appendStopPair(expression,z,convertPropertyFunction(featureFunctionParameters[z],propertySpec,featureFunctionStops[z]),!1)}return expression}{const expression=["step",["zoom"]];for(const z of zoomStops){appendStopPair(expression,z,convertPropertyFunction(featureFunctionParameters[z],propertySpec,featureFunctionStops[z]),!0)}return fixupDegenerateStepCurve(expression),expression}}(parameters,propertySpec,stops):zoomDependent?function convertZoomFunction(parameters,propertySpec,stops,input=["zoom"]){const type=getFunctionType(parameters,propertySpec);let expression,isStep=!1;if("interval"===type)expression=["step",input],isStep=!0;else{if("exponential"!==type)throw new Error(`Unknown zoom function type "${type}"`);{const base=void 0!==parameters.base?parameters.base:1;expression=[getInterpolateOperator(parameters),1===base?["linear"]:["exponential",base],input]}}for(const stop of stops)appendStopPair(expression,stop[0],stop[1],isStep);return fixupDegenerateStepCurve(expression),expression}(parameters,propertySpec,stops):convertPropertyFunction(parameters,propertySpec,stops)}function getInterpolateOperator(parameters){switch(parameters.colorSpace){case"hcl":return"interpolate-hcl";case"lab":return"interpolate-lab";default:return"interpolate"}}function getFallback(parameters,propertySpec){const defaultValue=convertLiteral(function coalesce(a,b){return void 0!==a?a:void 0!==b?b:void 0}(parameters.default,propertySpec.default));return void 0===defaultValue&&"resolvedImage"===propertySpec.type?"":defaultValue}function convertPropertyFunction(parameters,propertySpec,stops){const type=getFunctionType(parameters,propertySpec),get=["get",parameters.property];if("categorical"===type&&"boolean"==typeof stops[0][0]){const expression=["case"];for(const stop of stops)expression.push(["==",get,stop[0]],stop[1]);return expression.push(getFallback(parameters,propertySpec)),expression}if("categorical"===type){const expression=["match",get];for(const stop of stops)appendStopPair(expression,stop[0],stop[1],!1);return expression.push(getFallback(parameters,propertySpec)),expression}if("interval"===type){const expression=["step",["number",get]];for(const stop of stops)appendStopPair(expression,stop[0],stop[1],!0);return fixupDegenerateStepCurve(expression),void 0===parameters.default?expression:["case",["==",["typeof",get],"number"],expression,convertLiteral(parameters.default)]}if("exponential"===type){const base=void 0!==parameters.base?parameters.base:1,expression=[getInterpolateOperator(parameters),1===base?["linear"]:["exponential",base],["number",get]];for(const stop of stops)appendStopPair(expression,stop[0],stop[1],!1);return void 0===parameters.default?expression:["case",["==",["typeof",get],"number"],expression,convertLiteral(parameters.default)]}throw new Error(`Unknown property function type ${type}`)}function fixupDegenerateStepCurve(expression){"step"===expression[0]&&3===expression.length&&(expression.push(0),expression.push(expression[3]))}function appendStopPair(curve,input,output,isStep){curve.length>3&&input===curve[curve.length-2]||(isStep&&2===curve.length||curve.push(input),curve.push(output))}function getFunctionType(parameters,propertySpec){return parameters.type?parameters.type:propertySpec.expression.interpolated?"exponential":"interval"}function convertTokenString(s){const result=["concat"],re=/{([^{}]+)}/g;let pos=0;for(let match=re.exec(s);null!==match;match=re.exec(s)){const literal=s.slice(pos,re.lastIndex-match[0].length);pos=re.lastIndex,literal.length>0&&result.push(literal),result.push(["get",match[1]])}if(1===result.length)return s;if(pos<s.length)result.push(s.slice(pos));else if(2===result.length)return["to-string",result[1]];return result}class ParsingError extends Error{constructor(key,message){super(message),this.message=message,this.key=key}}var ParsingError$1=ParsingError;class Scope{constructor(parent,bindings=[]){this.parent=parent,this.bindings={};for(const[name,expression]of bindings)this.bindings[name]=expression}concat(bindings){return new Scope(this,bindings)}get(name){if(this.bindings[name])return this.bindings[name];if(this.parent)return this.parent.get(name);throw new Error(`${name} not found in scope.`)}has(name){return!!this.bindings[name]||!!this.parent&&this.parent.has(name)}}var Scope$1=Scope;const NullType={kind:"null"},dist_NumberType={kind:"number"},dist_StringType={kind:"string"},dist_BooleanType={kind:"boolean"},dist_ColorType={kind:"color"},ObjectType={kind:"object"},ValueType={kind:"value"},CollatorType={kind:"collator"},FormattedType={kind:"formatted"},ResolvedImageType={kind:"resolvedImage"};function array$1(itemType,N){return{kind:"array",itemType,N}}function toString$1(type){if("array"===type.kind){const itemType=toString$1(type.itemType);return"number"==typeof type.N?`array<${itemType}, ${type.N}>`:"value"===type.itemType.kind?"array":`array<${itemType}>`}return type.kind}const valueMemberTypes=[NullType,dist_NumberType,dist_StringType,dist_BooleanType,dist_ColorType,FormattedType,ObjectType,array$1(ValueType),ResolvedImageType];function checkSubtype(expected,t){if("error"===t.kind)return null;if("array"===expected.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!checkSubtype(expected.itemType,t.itemType))&&("number"!=typeof expected.N||expected.N===t.N))return null}else{if(expected.kind===t.kind)return null;if("value"===expected.kind)for(const memberType of valueMemberTypes)if(!checkSubtype(memberType,t))return null}return`Expected ${toString$1(expected)} but found ${toString$1(t)} instead.`}function isValidType(provided,allowedTypes){return allowedTypes.some((t=>t.kind===provided.kind))}function isValidNativeType(provided,allowedTypes){return allowedTypes.some((t=>"null"===t?null===provided:"array"===t?Array.isArray(provided):"object"===t?provided&&!Array.isArray(provided)&&"object"==typeof provided:t===typeof provided))}class Collator{constructor(caseSensitive,diacriticSensitive,locale){this.sensitivity=caseSensitive?diacriticSensitive?"variant":"case":diacriticSensitive?"accent":"base",this.locale=locale,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(lhs,rhs){return this.collator.compare(lhs,rhs)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class FormattedSection{constructor(text,image,scale,fontStack,textColor){this.text=text.normalize?text.normalize():text,this.image=image,this.scale=scale,this.fontStack=fontStack,this.textColor=textColor}}class Formatted{constructor(sections){this.sections=sections}static fromString(unformatted){return new Formatted([new FormattedSection(unformatted,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some((section=>0!==section.text.length||section.image&&0!==section.image.name.length))}static factory(text){return text instanceof Formatted?text:Formatted.fromString(text)}toString(){return 0===this.sections.length?"":this.sections.map((section=>section.text)).join("")}serialize(){const serialized=["format"];for(const section of this.sections){if(section.image){serialized.push(["image",section.image.name]);continue}serialized.push(section.text);const options={};section.fontStack&&(options["text-font"]=["literal",section.fontStack.split(",")]),section.scale&&(options["font-scale"]=section.scale),section.textColor&&(options["text-color"]=["rgba"].concat(section.textColor.toArray())),serialized.push(options)}return serialized}}class ResolvedImage{constructor(options){this.name=options.name,this.available=options.available}toString(){return this.name}static fromString(name){return name?new ResolvedImage({name,available:!1}):null}serialize(){return["image",this.name]}}function validateRGBA(r,g,b,a){if(!("number"==typeof r&&r>=0&&r<=255&&"number"==typeof g&&g>=0&&g<=255&&"number"==typeof b&&b>=0&&b<=255)){return`Invalid rgba value [${("number"==typeof a?[r,g,b,a]:[r,g,b]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}return void 0===a||"number"==typeof a&&a>=0&&a<=1?null:`Invalid rgba value [${[r,g,b,a].join(", ")}]: 'a' must be between 0 and 1.`}function isValue(mixed){if(null===mixed)return!0;if("string"==typeof mixed)return!0;if("boolean"==typeof mixed)return!0;if("number"==typeof mixed)return!0;if(mixed instanceof Color$1)return!0;if(mixed instanceof Collator)return!0;if(mixed instanceof Formatted)return!0;if(mixed instanceof ResolvedImage)return!0;if(Array.isArray(mixed)){for(const item of mixed)if(!isValue(item))return!1;return!0}if("object"==typeof mixed){for(const key in mixed)if(!isValue(mixed[key]))return!1;return!0}return!1}function typeOf(value){if(null===value)return NullType;if("string"==typeof value)return dist_StringType;if("boolean"==typeof value)return dist_BooleanType;if("number"==typeof value)return dist_NumberType;if(value instanceof Color$1)return dist_ColorType;if(value instanceof Collator)return CollatorType;if(value instanceof Formatted)return FormattedType;if(value instanceof ResolvedImage)return ResolvedImageType;if(Array.isArray(value)){const length=value.length;let itemType;for(const item of value){const t=typeOf(item);if(itemType){if(itemType===t)continue;itemType=ValueType;break}itemType=t}return array$1(itemType||ValueType,length)}return ObjectType}function dist_toString(value){const type=typeof value;return null===value?"":"string"===type||"number"===type||"boolean"===type?String(value):value instanceof Color$1||value instanceof Formatted||value instanceof ResolvedImage?value.toString():JSON.stringify(value)}class Literal{constructor(type,value){this.type=type,this.value=value}static parse(args,context){if(2!==args.length)return context.error(`'literal' expression requires exactly one argument, but found ${args.length-1} instead.`);if(!isValue(args[1]))return context.error("invalid value");const value=args[1];let type=typeOf(value);const expected=context.expectedType;return"array"!==type.kind||0!==type.N||!expected||"array"!==expected.kind||"number"==typeof expected.N&&0!==expected.N||(type=expected),new Literal(type,value)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Color$1?["rgba"].concat(this.value.toArray()):this.value instanceof Formatted?this.value.serialize():this.value}}var Literal$1=Literal;var RuntimeError$1=class RuntimeError{constructor(message){this.name="ExpressionEvaluationError",this.message=message}toJSON(){return this.message}};const types$2={string:dist_StringType,number:dist_NumberType,boolean:dist_BooleanType,object:ObjectType};class Assertion{constructor(type,args){this.type=type,this.args=args}static parse(args,context){if(args.length<2)return context.error("Expected at least one argument.");let type,i=1;const name=args[0];if("array"===name){let itemType,N;if(args.length>2){const type=args[1];if("string"!=typeof type||!(type in types$2)||"object"===type)return context.error('The item type argument of "array" must be one of string, number, boolean',1);itemType=types$2[type],i++}else itemType=ValueType;if(args.length>3){if(null!==args[2]&&("number"!=typeof args[2]||args[2]<0||args[2]!==Math.floor(args[2])))return context.error('The length argument to "array" must be a positive integer literal',2);N=args[2],i++}type=array$1(itemType,N)}else type=types$2[name];const parsed=[];for(;i<args.length;i++){const input=context.parse(args[i],i,ValueType);if(!input)return null;parsed.push(input)}return new Assertion(type,parsed)}evaluate(ctx){for(let i=0;i<this.args.length;i++){const value=this.args[i].evaluate(ctx);if(!checkSubtype(this.type,typeOf(value)))return value;if(i===this.args.length-1)throw new RuntimeError$1(`Expected value to be of type ${toString$1(this.type)}, but found ${toString$1(typeOf(value))} instead.`)}return null}eachChild(fn){this.args.forEach(fn)}outputDefined(){return this.args.every((arg=>arg.outputDefined()))}serialize(){const type=this.type,serialized=[type.kind];if("array"===type.kind){const itemType=type.itemType;if("string"===itemType.kind||"number"===itemType.kind||"boolean"===itemType.kind){serialized.push(itemType.kind);const N=type.N;("number"==typeof N||this.args.length>1)&&serialized.push(N)}}return serialized.concat(this.args.map((arg=>arg.serialize())))}}var Assertion$1=Assertion;class FormatExpression{constructor(sections){this.type=FormattedType,this.sections=sections}static parse(args,context){if(args.length<2)return context.error("Expected at least one argument.");const firstArg=args[1];if(!Array.isArray(firstArg)&&"object"==typeof firstArg)return context.error("First argument must be an image or text section.");const sections=[];let nextTokenMayBeObject=!1;for(let i=1;i<=args.length-1;++i){const arg=args[i];if(nextTokenMayBeObject&&"object"==typeof arg&&!Array.isArray(arg)){nextTokenMayBeObject=!1;let scale=null;if(arg["font-scale"]&&(scale=context.parse(arg["font-scale"],1,dist_NumberType),!scale))return null;let font=null;if(arg["text-font"]&&(font=context.parse(arg["text-font"],1,array$1(dist_StringType)),!font))return null;let textColor=null;if(arg["text-color"]&&(textColor=context.parse(arg["text-color"],1,dist_ColorType),!textColor))return null;const lastExpression=sections[sections.length-1];lastExpression.scale=scale,lastExpression.font=font,lastExpression.textColor=textColor}else{const content=context.parse(args[i],1,ValueType);if(!content)return null;const kind=content.type.kind;if("string"!==kind&&"value"!==kind&&"null"!==kind&&"resolvedImage"!==kind)return context.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");nextTokenMayBeObject=!0,sections.push({content,scale:null,font:null,textColor:null})}}return new FormatExpression(sections)}evaluate(ctx){return new Formatted(this.sections.map((section=>{const evaluatedContent=section.content.evaluate(ctx);return typeOf(evaluatedContent)===ResolvedImageType?new FormattedSection("",evaluatedContent,null,null,null):new FormattedSection(dist_toString(evaluatedContent),null,section.scale?section.scale.evaluate(ctx):null,section.font?section.font.evaluate(ctx).join(","):null,section.textColor?section.textColor.evaluate(ctx):null)})))}eachChild(fn){for(const section of this.sections)fn(section.content),section.scale&&fn(section.scale),section.font&&fn(section.font),section.textColor&&fn(section.textColor)}outputDefined(){return!1}serialize(){const serialized=["format"];for(const section of this.sections){serialized.push(section.content.serialize());const options={};section.scale&&(options["font-scale"]=section.scale.serialize()),section.font&&(options["text-font"]=section.font.serialize()),section.textColor&&(options["text-color"]=section.textColor.serialize()),serialized.push(options)}return serialized}}class ImageExpression{constructor(input){this.type=ResolvedImageType,this.input=input}static parse(args,context){if(2!==args.length)return context.error("Expected two arguments.");const name=context.parse(args[1],1,dist_StringType);return name?new ImageExpression(name):context.error("No image name provided.")}evaluate(ctx){const evaluatedImageName=this.input.evaluate(ctx),value=ResolvedImage.fromString(evaluatedImageName);return value&&ctx.availableImages&&(value.available=ctx.availableImages.indexOf(evaluatedImageName)>-1),value}eachChild(fn){fn(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const types$1={"to-boolean":dist_BooleanType,"to-color":dist_ColorType,"to-number":dist_NumberType,"to-string":dist_StringType};class Coercion{constructor(type,args){this.type=type,this.args=args}static parse(args,context){if(args.length<2)return context.error("Expected at least one argument.");const name=args[0];if(("to-boolean"===name||"to-string"===name)&&2!==args.length)return context.error("Expected one argument.");const type=types$1[name],parsed=[];for(let i=1;i<args.length;i++){const input=context.parse(args[i],i,ValueType);if(!input)return null;parsed.push(input)}return new Coercion(type,parsed)}evaluate(ctx){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(ctx));if("color"===this.type.kind){let input,error;for(const arg of this.args){if(input=arg.evaluate(ctx),error=null,input instanceof Color$1)return input;if("string"==typeof input){const c=ctx.parseColor(input);if(c)return c}else if(Array.isArray(input)&&(error=input.length<3||input.length>4?`Invalid rbga value ${JSON.stringify(input)}: expected an array containing either three or four numeric values.`:validateRGBA(input[0],input[1],input[2],input[3]),!error))return new Color$1(input[0]/255,input[1]/255,input[2]/255,input[3])}throw new RuntimeError$1(error||`Could not parse color from value '${"string"==typeof input?input:String(JSON.stringify(input))}'`)}if("number"===this.type.kind){let value=null;for(const arg of this.args){if(value=arg.evaluate(ctx),null===value)return 0;const num=Number(value);if(!isNaN(num))return num}throw new RuntimeError$1(`Could not convert ${JSON.stringify(value)} to number.`)}return"formatted"===this.type.kind?Formatted.fromString(dist_toString(this.args[0].evaluate(ctx))):"resolvedImage"===this.type.kind?ResolvedImage.fromString(dist_toString(this.args[0].evaluate(ctx))):dist_toString(this.args[0].evaluate(ctx))}eachChild(fn){this.args.forEach(fn)}outputDefined(){return this.args.every((arg=>arg.outputDefined()))}serialize(){if("formatted"===this.type.kind)return new FormatExpression([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ImageExpression(this.args[0]).serialize();const serialized=[`to-${this.type.kind}`];return this.eachChild((child=>{serialized.push(child.serialize())})),serialized}}var Coercion$1=Coercion;const geometryTypes=["Unknown","Point","LineString","Polygon"];var EvaluationContext$1=class EvaluationContext{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?geometryTypes[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const c=this.featureDistanceData.center,scale=this.featureDistanceData.scale,{x,y}=this.featureTileCoord,dX=x*scale-c[0],dY=y*scale-c[1];return this.featureDistanceData.bearing[0]*dX+this.featureDistanceData.bearing[1]*dY}return 0}parseColor(input){let cached=this._parseColorCache[input];return cached||(cached=this._parseColorCache[input]=Color$1.parse(input)),cached}};class CompoundExpression{constructor(name,type,evaluate,args){this.name=name,this.type=type,this._evaluate=evaluate,this.args=args}evaluate(ctx){return this._evaluate(ctx,this.args)}eachChild(fn){this.args.forEach(fn)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((arg=>arg.serialize())))}static parse(args,context){const op=args[0],definition=CompoundExpression.definitions[op];if(!definition)return context.error(`Unknown expression "${op}". If you wanted a literal array, use ["literal", [...]].`,0);const type=Array.isArray(definition)?definition[0]:definition.type,availableOverloads=Array.isArray(definition)?[[definition[1],definition[2]]]:definition.overloads,overloads=availableOverloads.filter((([signature])=>!Array.isArray(signature)||signature.length===args.length-1));let signatureContext=null;for(const[params,evaluate]of overloads){signatureContext=new ParsingContext$1(context.registry,context.path,null,context.scope);const parsedArgs=[];let argParseFailed=!1;for(let i=1;i<args.length;i++){const arg=args[i],expectedType=Array.isArray(params)?params[i-1]:params.type,parsed=signatureContext.parse(arg,1+parsedArgs.length,expectedType);if(!parsed){argParseFailed=!0;break}parsedArgs.push(parsed)}if(!argParseFailed)if(Array.isArray(params)&&params.length!==parsedArgs.length)signatureContext.error(`Expected ${params.length} arguments, but found ${parsedArgs.length} instead.`);else{for(let i=0;i<parsedArgs.length;i++){const expected=Array.isArray(params)?params[i]:params.type,arg=parsedArgs[i];signatureContext.concat(i+1).checkSubtype(expected,arg.type)}if(0===signatureContext.errors.length)return new CompoundExpression(op,type,evaluate,parsedArgs)}}if(1===overloads.length)context.errors.push(...signatureContext.errors);else{const signatures=(overloads.length?overloads:availableOverloads).map((([params])=>function stringifySignature(signature){return Array.isArray(signature)?`(${signature.map(toString$1).join(", ")})`:`(${toString$1(signature.type)}...)`}(params))).join(" | "),actualTypes=[];for(let i=1;i<args.length;i++){const parsed=context.parse(args[i],1+actualTypes.length);if(!parsed)return null;actualTypes.push(toString$1(parsed.type))}context.error(`Expected arguments of type ${signatures}, but found (${actualTypes.join(", ")}) instead.`)}return null}static register(registry,definitions){CompoundExpression.definitions=definitions;for(const name in definitions)registry[name]=CompoundExpression}}var CompoundExpression$1=CompoundExpression;class CollatorExpression{constructor(caseSensitive,diacriticSensitive,locale){this.type=CollatorType,this.locale=locale,this.caseSensitive=caseSensitive,this.diacriticSensitive=diacriticSensitive}static parse(args,context){if(2!==args.length)return context.error("Expected one argument.");const options=args[1];if("object"!=typeof options||Array.isArray(options))return context.error("Collator options argument must be an object.");const caseSensitive=context.parse(void 0!==options["case-sensitive"]&&options["case-sensitive"],1,dist_BooleanType);if(!caseSensitive)return null;const diacriticSensitive=context.parse(void 0!==options["diacritic-sensitive"]&&options["diacritic-sensitive"],1,dist_BooleanType);if(!diacriticSensitive)return null;let locale=null;return options.locale&&(locale=context.parse(options.locale,1,dist_StringType),!locale)?null:new CollatorExpression(caseSensitive,diacriticSensitive,locale)}evaluate(ctx){return new Collator(this.caseSensitive.evaluate(ctx),this.diacriticSensitive.evaluate(ctx),this.locale?this.locale.evaluate(ctx):null)}eachChild(fn){fn(this.caseSensitive),fn(this.diacriticSensitive),this.locale&&fn(this.locale)}outputDefined(){return!1}serialize(){const options={};return options["case-sensitive"]=this.caseSensitive.serialize(),options["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(options.locale=this.locale.serialize()),["collator",options]}}function updateBBox(bbox,coord){bbox[0]=Math.min(bbox[0],coord[0]),bbox[1]=Math.min(bbox[1],coord[1]),bbox[2]=Math.max(bbox[2],coord[0]),bbox[3]=Math.max(bbox[3],coord[1])}function boxWithinBox(bbox1,bbox2){return!(bbox1[0]<=bbox2[0])&&(!(bbox1[2]>=bbox2[2])&&(!(bbox1[1]<=bbox2[1])&&!(bbox1[3]>=bbox2[3])))}function getTileCoordinates(p,canonical){const x=function mercatorXfromLng(lng){return(180+lng)/360}(p[0]),y=function mercatorYfromLat(lat){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+lat*Math.PI/360)))/360}(p[1]),tilesAtZoom=Math.pow(2,canonical.z);return[Math.round(x*tilesAtZoom*8192),Math.round(y*tilesAtZoom*8192)]}function onBoundary(p,p1,p2){const x1=p[0]-p1[0],y1=p[1]-p1[1],x2=p[0]-p2[0],y2=p[1]-p2[1];return x1*y2-x2*y1==0&&x1*x2<=0&&y1*y2<=0}function rayIntersect(p,p1,p2){return p1[1]>p[1]!=p2[1]>p[1]&&p[0]<(p2[0]-p1[0])*(p[1]-p1[1])/(p2[1]-p1[1])+p1[0]}function pointWithinPolygon(point,rings){let inside=!1;for(let i=0,len=rings.length;i<len;i++){const ring=rings[i];for(let j=0,len2=ring.length;j<len2-1;j++){if(onBoundary(point,ring[j],ring[j+1]))return!1;rayIntersect(point,ring[j],ring[j+1])&&(inside=!inside)}}return inside}function pointWithinPolygons(point,polygons){for(let i=0;i<polygons.length;i++)if(pointWithinPolygon(point,polygons[i]))return!0;return!1}function twoSided(p1,p2,q1,q2){const x1=p1[0]-q1[0],y1=p1[1]-q1[1],x2=p2[0]-q1[0],y2=p2[1]-q1[1],x3=q2[0]-q1[0],y3=q2[1]-q1[1],det1=x1*y3-x3*y1,det2=x2*y3-x3*y2;return det1>0&&det2<0||det1<0&&det2>0}function lineIntersectLine(a,b,c,d){const vectorP=[b[0]-a[0],b[1]-a[1]];return 0!==function perp(v1,v2){return v1[0]*v2[1]-v1[1]*v2[0]}([d[0]-c[0],d[1]-c[1]],vectorP)&&!(!twoSided(a,b,c,d)||!twoSided(c,d,a,b))}function lineIntersectPolygon(p1,p2,polygon){for(const ring of polygon)for(let j=0;j<ring.length-1;++j)if(lineIntersectLine(p1,p2,ring[j],ring[j+1]))return!0;return!1}function lineStringWithinPolygon(line,polygon){for(let i=0;i<line.length;++i)if(!pointWithinPolygon(line[i],polygon))return!1;for(let i=0;i<line.length-1;++i)if(lineIntersectPolygon(line[i],line[i+1],polygon))return!1;return!0}function lineStringWithinPolygons(line,polygons){for(let i=0;i<polygons.length;i++)if(lineStringWithinPolygon(line,polygons[i]))return!0;return!1}function getTilePolygon(coordinates,bbox,canonical){const polygon=[];for(let i=0;i<coordinates.length;i++){const ring=[];for(let j=0;j<coordinates[i].length;j++){const coord=getTileCoordinates(coordinates[i][j],canonical);updateBBox(bbox,coord),ring.push(coord)}polygon.push(ring)}return polygon}function getTilePolygons(coordinates,bbox,canonical){const polygons=[];for(let i=0;i<coordinates.length;i++){const polygon=getTilePolygon(coordinates[i],bbox,canonical);polygons.push(polygon)}return polygons}function updatePoint(p,bbox,polyBBox,worldSize){if(p[0]<polyBBox[0]||p[0]>polyBBox[2]){const halfWorldSize=.5*worldSize;let shift=p[0]-polyBBox[0]>halfWorldSize?-worldSize:polyBBox[0]-p[0]>halfWorldSize?worldSize:0;0===shift&&(shift=p[0]-polyBBox[2]>halfWorldSize?-worldSize:polyBBox[2]-p[0]>halfWorldSize?worldSize:0),p[0]+=shift}updateBBox(bbox,p)}function getTilePoints(geometry,pointBBox,polyBBox,canonical){const worldSize=8192*Math.pow(2,canonical.z),shifts=[8192*canonical.x,8192*canonical.y],tilePoints=[];if(!geometry)return tilePoints;for(const points of geometry)for(const point of points){const p=[point.x+shifts[0],point.y+shifts[1]];updatePoint(p,pointBBox,polyBBox,worldSize),tilePoints.push(p)}return tilePoints}function getTileLines(geometry,lineBBox,polyBBox,canonical){const worldSize=8192*Math.pow(2,canonical.z),shifts=[8192*canonical.x,8192*canonical.y],tileLines=[];if(!geometry)return tileLines;for(const line of geometry){const tileLine=[];for(const point of line){const p=[point.x+shifts[0],point.y+shifts[1]];updateBBox(lineBBox,p),tileLine.push(p)}tileLines.push(tileLine)}if(lineBBox[2]-lineBBox[0]<=worldSize/2){!function resetBBox(bbox){bbox[0]=bbox[1]=1/0,bbox[2]=bbox[3]=-1/0}(lineBBox);for(const line of tileLines)for(const p of line)updatePoint(p,lineBBox,polyBBox,worldSize)}return tileLines}class Within{constructor(geojson,geometries){this.type=dist_BooleanType,this.geojson=geojson,this.geometries=geometries}static parse(args,context){if(2!==args.length)return context.error(`'within' expression requires exactly one argument, but found ${args.length-1} instead.`);if(isValue(args[1])){const geojson=args[1];if("FeatureCollection"===geojson.type)for(let i=0;i<geojson.features.length;++i){const type=geojson.features[i].geometry.type;if("Polygon"===type||"MultiPolygon"===type)return new Within(geojson,geojson.features[i].geometry)}else if("Feature"===geojson.type){const type=geojson.geometry.type;if("Polygon"===type||"MultiPolygon"===type)return new Within(geojson,geojson.geometry)}else if("Polygon"===geojson.type||"MultiPolygon"===geojson.type)return new Within(geojson,geojson)}return context.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(ctx){if(null!=ctx.geometry()&&null!=ctx.canonicalID()){if("Point"===ctx.geometryType())return function pointsWithinPolygons(ctx,polygonGeometry){const pointBBox=[1/0,1/0,-1/0,-1/0],polyBBox=[1/0,1/0,-1/0,-1/0],canonical=ctx.canonicalID();if(!canonical)return!1;if("Polygon"===polygonGeometry.type){const tilePolygon=getTilePolygon(polygonGeometry.coordinates,polyBBox,canonical),tilePoints=getTilePoints(ctx.geometry(),pointBBox,polyBBox,canonical);if(!boxWithinBox(pointBBox,polyBBox))return!1;for(const point of tilePoints)if(!pointWithinPolygon(point,tilePolygon))return!1}if("MultiPolygon"===polygonGeometry.type){const tilePolygons=getTilePolygons(polygonGeometry.coordinates,polyBBox,canonical),tilePoints=getTilePoints(ctx.geometry(),pointBBox,polyBBox,canonical);if(!boxWithinBox(pointBBox,polyBBox))return!1;for(const point of tilePoints)if(!pointWithinPolygons(point,tilePolygons))return!1}return!0}(ctx,this.geometries);if("LineString"===ctx.geometryType())return function linesWithinPolygons(ctx,polygonGeometry){const lineBBox=[1/0,1/0,-1/0,-1/0],polyBBox=[1/0,1/0,-1/0,-1/0],canonical=ctx.canonicalID();if(!canonical)return!1;if("Polygon"===polygonGeometry.type){const tilePolygon=getTilePolygon(polygonGeometry.coordinates,polyBBox,canonical),tileLines=getTileLines(ctx.geometry(),lineBBox,polyBBox,canonical);if(!boxWithinBox(lineBBox,polyBBox))return!1;for(const line of tileLines)if(!lineStringWithinPolygon(line,tilePolygon))return!1}if("MultiPolygon"===polygonGeometry.type){const tilePolygons=getTilePolygons(polygonGeometry.coordinates,polyBBox,canonical),tileLines=getTileLines(ctx.geometry(),lineBBox,polyBBox,canonical);if(!boxWithinBox(lineBBox,polyBBox))return!1;for(const line of tileLines)if(!lineStringWithinPolygons(line,tilePolygons))return!1}return!0}(ctx,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var Within$1=Within;function isFeatureConstant(e){if(e instanceof CompoundExpression$1){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Within$1)return!1;let result=!0;return e.eachChild((arg=>{result&&!isFeatureConstant(arg)&&(result=!1)})),result}function isStateConstant(e){if(e instanceof CompoundExpression$1&&"feature-state"===e.name)return!1;let result=!0;return e.eachChild((arg=>{result&&!isStateConstant(arg)&&(result=!1)})),result}function isGlobalPropertyConstant(e,properties){if(e instanceof CompoundExpression$1&&properties.indexOf(e.name)>=0)return!1;let result=!0;return e.eachChild((arg=>{result&&!isGlobalPropertyConstant(arg,properties)&&(result=!1)})),result}class Var{constructor(name,boundExpression){this.type=boundExpression.type,this.name=name,this.boundExpression=boundExpression}static parse(args,context){if(2!==args.length||"string"!=typeof args[1])return context.error("'var' expression requires exactly one string literal argument.");const name=args[1];return context.scope.has(name)?new Var(name,context.scope.get(name)):context.error(`Unknown variable "${name}". Make sure "${name}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(ctx){return this.boundExpression.evaluate(ctx)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Var$1=Var;class ParsingContext{constructor(registry,path=[],expectedType,scope=new Scope$1,errors=[]){this.registry=registry,this.path=path,this.key=path.map((part=>`[${part}]`)).join(""),this.scope=scope,this.errors=errors,this.expectedType=expectedType}parse(expr,index,expectedType,bindings,options={}){return index?this.concat(index,expectedType,bindings)._parse(expr,options):this._parse(expr,options)}_parse(expr,options){function annotate(parsed,type,typeAnnotation){return"assert"===typeAnnotation?new Assertion$1(type,[parsed]):"coerce"===typeAnnotation?new Coercion$1(type,[parsed]):parsed}if(null!==expr&&"string"!=typeof expr&&"boolean"!=typeof expr&&"number"!=typeof expr||(expr=["literal",expr]),Array.isArray(expr)){if(0===expr.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const op=expr[0];if("string"!=typeof op)return this.error(`Expression name must be a string, but found ${typeof op} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const Expr=this.registry[op];if(Expr){let parsed=Expr.parse(expr,this);if(!parsed)return null;if(this.expectedType){const expected=this.expectedType,actual=parsed.type;if("string"!==expected.kind&&"number"!==expected.kind&&"boolean"!==expected.kind&&"object"!==expected.kind&&"array"!==expected.kind||"value"!==actual.kind)if("color"!==expected.kind&&"formatted"!==expected.kind&&"resolvedImage"!==expected.kind||"value"!==actual.kind&&"string"!==actual.kind){if(this.checkSubtype(expected,actual))return null}else parsed=annotate(parsed,expected,options.typeAnnotation||"coerce");else parsed=annotate(parsed,expected,options.typeAnnotation||"assert")}if(!(parsed instanceof Literal$1)&&"resolvedImage"!==parsed.type.kind&&isConstant(parsed)){const ec=new EvaluationContext$1;try{parsed=new Literal$1(parsed.type,parsed.evaluate(ec))}catch(e){return this.error(e.message),null}}return parsed}return this.error(`Unknown expression "${op}". If you wanted a literal array, use ["literal", [...]].`,0)}return void 0===expr?this.error("'undefined' value invalid. Use null instead."):"object"==typeof expr?this.error('Bare objects invalid. Use ["literal", {...}] instead.'):this.error(`Expected an array, but found ${typeof expr} instead.`)}concat(index,expectedType,bindings){const path="number"==typeof index?this.path.concat(index):this.path,scope=bindings?this.scope.concat(bindings):this.scope;return new ParsingContext(this.registry,path,expectedType||null,scope,this.errors)}error(error,...keys){const key=`${this.key}${keys.map((k=>`[${k}]`)).join("")}`;this.errors.push(new ParsingError$1(key,error))}checkSubtype(expected,t){const error=checkSubtype(expected,t);return error&&this.error(error),error}}var ParsingContext$1=ParsingContext;function isConstant(expression){if(expression instanceof Var$1)return isConstant(expression.boundExpression);if(expression instanceof CompoundExpression$1&&"error"===expression.name)return!1;if(expression instanceof CollatorExpression)return!1;if(expression instanceof Within$1)return!1;const isTypeAnnotation=expression instanceof Coercion$1||expression instanceof Assertion$1;let childrenConstant=!0;return expression.eachChild((child=>{childrenConstant=isTypeAnnotation?childrenConstant&&isConstant(child):childrenConstant&&child instanceof Literal$1})),!!childrenConstant&&(isFeatureConstant(expression)&&isGlobalPropertyConstant(expression,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"]))}function findStopLessThanOrEqualTo(stops,input){const lastIndex=stops.length-1;let currentValue,nextValue,lowerIndex=0,upperIndex=lastIndex,currentIndex=0;for(;lowerIndex<=upperIndex;)if(currentIndex=Math.floor((lowerIndex+upperIndex)/2),currentValue=stops[currentIndex],nextValue=stops[currentIndex+1],currentValue<=input){if(currentIndex===lastIndex||input<nextValue)return currentIndex;lowerIndex=currentIndex+1}else{if(!(currentValue>input))throw new RuntimeError$1("Input is not a number.");upperIndex=currentIndex-1}return 0}class Step{constructor(type,input,stops){this.type=type,this.input=input,this.labels=[],this.outputs=[];for(const[label,expression]of stops)this.labels.push(label),this.outputs.push(expression)}static parse(args,context){if(args.length-1<4)return context.error(`Expected at least 4 arguments, but found only ${args.length-1}.`);if((args.length-1)%2!=0)return context.error("Expected an even number of arguments.");const input=context.parse(args[1],1,dist_NumberType);if(!input)return null;const stops=[];let outputType=null;context.expectedType&&"value"!==context.expectedType.kind&&(outputType=context.expectedType);for(let i=1;i<args.length;i+=2){const label=1===i?-1/0:args[i],value=args[i+1],labelKey=i,valueKey=i+1;if("number"!=typeof label)return context.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',labelKey);if(stops.length&&stops[stops.length-1][0]>=label)return context.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',labelKey);const parsed=context.parse(value,valueKey,outputType);if(!parsed)return null;outputType=outputType||parsed.type,stops.push([label,parsed])}return new Step(outputType,input,stops)}evaluate(ctx){const labels=this.labels,outputs=this.outputs;if(1===labels.length)return outputs[0].evaluate(ctx);const value=this.input.evaluate(ctx);if(value<=labels[0])return outputs[0].evaluate(ctx);const stopCount=labels.length;if(value>=labels[stopCount-1])return outputs[stopCount-1].evaluate(ctx);return outputs[findStopLessThanOrEqualTo(labels,value)].evaluate(ctx)}eachChild(fn){fn(this.input);for(const expression of this.outputs)fn(expression)}outputDefined(){return this.outputs.every((out=>out.outputDefined()))}serialize(){const serialized=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&serialized.push(this.labels[i]),serialized.push(this.outputs[i].serialize());return serialized}}var Step$1=Step,unitbezier=UnitBezier;function UnitBezier(p1x,p1y,p2x,p2y){this.cx=3*p1x,this.bx=3*(p2x-p1x)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*p1y,this.by=3*(p2y-p1y)-this.cy,this.ay=1-this.cy-this.by,this.p1x=p1x,this.p1y=p2y,this.p2x=p2x,this.p2y=p2y}UnitBezier.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},UnitBezier.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},UnitBezier.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},UnitBezier.prototype.solveCurveX=function(x,epsilon){var t0,t1,t2,x2,i;for(void 0===epsilon&&(epsilon=1e-6),t2=x,i=0;i<8;i++){if(x2=this.sampleCurveX(t2)-x,Math.abs(x2)<epsilon)return t2;var d2=this.sampleCurveDerivativeX(t2);if(Math.abs(d2)<1e-6)break;t2-=x2/d2}if((t2=x)<(t0=0))return t0;if(t2>(t1=1))return t1;for(;t0<t1;){if(x2=this.sampleCurveX(t2),Math.abs(x2-x)<epsilon)return t2;x>x2?t0=t2:t1=t2,t2=.5*(t1-t0)+t0}return t2},UnitBezier.prototype.solve=function(x,epsilon){return this.sampleCurveY(this.solveCurveX(x,epsilon))};var UnitBezier$1=getDefaultExportFromCjs(unitbezier);function number(a,b,t){return a*(1-t)+b*t}var interpolate=Object.freeze({__proto__:null,number,color:function color(from,to,t){return new Color$1(number(from.r,to.r,t),number(from.g,to.g,t),number(from.b,to.b,t),number(from.a,to.a,t))},array:function dist_array(from,to,t){return from.map(((d,i)=>number(d,to[i],t)))}});const t0=4/29,t1=6/29,t2=3*t1*t1,t3=t1*t1*t1,deg2rad$1=Math.PI/180,rad2deg=180/Math.PI;function xyz2lab(t){return t>t3?Math.pow(t,1/3):t/t2+t0}function lab2xyz(t){return t>t1?t*t*t:t2*(t-t0)}function xyz2rgb(x){return 255*(x<=.0031308?12.92*x:1.055*Math.pow(x,1/2.4)-.055)}function rgb2xyz(x){return(x/=255)<=.04045?x/12.92:Math.pow((x+.055)/1.055,2.4)}function rgbToLab(rgbColor){const b=rgb2xyz(rgbColor.r),a=rgb2xyz(rgbColor.g),l=rgb2xyz(rgbColor.b),x=xyz2lab((.4124564*b+.3575761*a+.1804375*l)/.95047),y=xyz2lab((.2126729*b+.7151522*a+.072175*l)/1);return{l:116*y-16,a:500*(x-y),b:200*(y-xyz2lab((.0193339*b+.119192*a+.9503041*l)/1.08883)),alpha:rgbColor.a}}function labToRgb(labColor){let y=(labColor.l+16)/116,x=isNaN(labColor.a)?y:y+labColor.a/500,z=isNaN(labColor.b)?y:y-labColor.b/200;return y=1*lab2xyz(y),x=.95047*lab2xyz(x),z=1.08883*lab2xyz(z),new Color$1(xyz2rgb(3.2404542*x-1.5371385*y-.4985314*z),xyz2rgb(-.969266*x+1.8760108*y+.041556*z),xyz2rgb(.0556434*x-.2040259*y+1.0572252*z),labColor.alpha)}function interpolateHue(a,b,t){const d=b-a;return a+t*(d>180||d<-180?d-360*Math.round(d/360):d)}const lab={forward:rgbToLab,reverse:labToRgb,interpolate:function interpolateLab(from,to,t){return{l:number(from.l,to.l,t),a:number(from.a,to.a,t),b:number(from.b,to.b,t),alpha:number(from.alpha,to.alpha,t)}}},hcl={forward:function rgbToHcl(rgbColor){const{l,a,b}=rgbToLab(rgbColor),h=Math.atan2(b,a)*rad2deg;return{h:h<0?h+360:h,c:Math.sqrt(a*a+b*b),l,alpha:rgbColor.a}},reverse:function hclToRgb(hclColor){const h=hclColor.h*deg2rad$1,c=hclColor.c;return labToRgb({l:hclColor.l,a:Math.cos(h)*c,b:Math.sin(h)*c,alpha:hclColor.alpha})},interpolate:function interpolateHcl(from,to,t){return{h:interpolateHue(from.h,to.h,t),c:number(from.c,to.c,t),l:number(from.l,to.l,t),alpha:number(from.alpha,to.alpha,t)}}};class Interpolate{constructor(type,operator,interpolation,input,stops){this.type=type,this.operator=operator,this.interpolation=interpolation,this.input=input,this.labels=[],this.outputs=[];for(const[label,expression]of stops)this.labels.push(label),this.outputs.push(expression)}static interpolationFactor(interpolation,input,lower,upper){let t=0;if("exponential"===interpolation.name)t=exponentialInterpolation(input,interpolation.base,lower,upper);else if("linear"===interpolation.name)t=exponentialInterpolation(input,1,lower,upper);else if("cubic-bezier"===interpolation.name){const c=interpolation.controlPoints;t=new UnitBezier$1(c[0],c[1],c[2],c[3]).solve(exponentialInterpolation(input,1,lower,upper))}return t}static parse(args,context){let[operator,interpolation,input,...rest]=args;if(!Array.isArray(interpolation)||0===interpolation.length)return context.error("Expected an interpolation type expression.",1);if("linear"===interpolation[0])interpolation={name:"linear"};else if("exponential"===interpolation[0]){const base=interpolation[1];if("number"!=typeof base)return context.error("Exponential interpolation requires a numeric base.",1,1);interpolation={name:"exponential",base}}else{if("cubic-bezier"!==interpolation[0])return context.error(`Unknown interpolation type ${String(interpolation[0])}`,1,0);{const controlPoints=interpolation.slice(1);if(4!==controlPoints.length||controlPoints.some((t=>"number"!=typeof t||t<0||t>1)))return context.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);interpolation={name:"cubic-bezier",controlPoints}}}if(args.length-1<4)return context.error(`Expected at least 4 arguments, but found only ${args.length-1}.`);if((args.length-1)%2!=0)return context.error("Expected an even number of arguments.");if(input=context.parse(input,2,dist_NumberType),!input)return null;const stops=[];let outputType=null;"interpolate-hcl"===operator||"interpolate-lab"===operator?outputType=dist_ColorType:context.expectedType&&"value"!==context.expectedType.kind&&(outputType=context.expectedType);for(let i=0;i<rest.length;i+=2){const label=rest[i],value=rest[i+1],labelKey=i+3,valueKey=i+4;if("number"!=typeof label)return context.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',labelKey);if(stops.length&&stops[stops.length-1][0]>=label)return context.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',labelKey);const parsed=context.parse(value,valueKey,outputType);if(!parsed)return null;outputType=outputType||parsed.type,stops.push([label,parsed])}return"number"===outputType.kind||"color"===outputType.kind||"array"===outputType.kind&&"number"===outputType.itemType.kind&&"number"==typeof outputType.N?new Interpolate(outputType,operator,interpolation,input,stops):context.error(`Type ${toString$1(outputType)} is not interpolatable.`)}evaluate(ctx){const labels=this.labels,outputs=this.outputs;if(1===labels.length)return outputs[0].evaluate(ctx);const value=this.input.evaluate(ctx);if(value<=labels[0])return outputs[0].evaluate(ctx);const stopCount=labels.length;if(value>=labels[stopCount-1])return outputs[stopCount-1].evaluate(ctx);const index=findStopLessThanOrEqualTo(labels,value),lower=labels[index],upper=labels[index+1],t=Interpolate.interpolationFactor(this.interpolation,value,lower,upper),outputLower=outputs[index].evaluate(ctx),outputUpper=outputs[index+1].evaluate(ctx);return"interpolate"===this.operator?interpolate[this.type.kind.toLowerCase()](outputLower,outputUpper,t):"interpolate-hcl"===this.operator?hcl.reverse(hcl.interpolate(hcl.forward(outputLower),hcl.forward(outputUpper),t)):lab.reverse(lab.interpolate(lab.forward(outputLower),lab.forward(outputUpper),t))}eachChild(fn){fn(this.input);for(const expression of this.outputs)fn(expression)}outputDefined(){return this.outputs.every((out=>out.outputDefined()))}serialize(){let interpolation;interpolation="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const serialized=[this.operator,interpolation,this.input.serialize()];for(let i=0;i<this.labels.length;i++)serialized.push(this.labels[i],this.outputs[i].serialize());return serialized}}function exponentialInterpolation(input,base,lowerValue,upperValue){const difference=upperValue-lowerValue,progress=input-lowerValue;return 0===difference?0:1===base?progress/difference:(Math.pow(base,progress)-1)/(Math.pow(base,difference)-1)}var Interpolate$1=Interpolate;class Coalesce{constructor(type,args){this.type=type,this.args=args}static parse(args,context){if(args.length<2)return context.error("Expectected at least one argument.");let outputType=null;const expectedType=context.expectedType;expectedType&&"value"!==expectedType.kind&&(outputType=expectedType);const parsedArgs=[];for(const arg of args.slice(1)){const parsed=context.parse(arg,1+parsedArgs.length,outputType,void 0,{typeAnnotation:"omit"});if(!parsed)return null;outputType=outputType||parsed.type,parsedArgs.push(parsed)}const needsAnnotation=expectedType&&parsedArgs.some((arg=>checkSubtype(expectedType,arg.type)));return new Coalesce(needsAnnotation?ValueType:outputType,parsedArgs)}evaluate(ctx){let firstImage,result=null,argCount=0;for(const arg of this.args){if(argCount++,result=arg.evaluate(ctx),result&&result instanceof ResolvedImage&&!result.available&&(firstImage||(firstImage=result),result=null,argCount===this.args.length))return firstImage;if(null!==result)break}return result}eachChild(fn){this.args.forEach(fn)}outputDefined(){return this.args.every((arg=>arg.outputDefined()))}serialize(){const serialized=["coalesce"];return this.eachChild((child=>{serialized.push(child.serialize())})),serialized}}var Coalesce$1=Coalesce;class Let{constructor(bindings,result){this.type=result.type,this.bindings=[].concat(bindings),this.result=result}evaluate(ctx){return this.result.evaluate(ctx)}eachChild(fn){for(const binding of this.bindings)fn(binding[1]);fn(this.result)}static parse(args,context){if(args.length<4)return context.error(`Expected at least 3 arguments, but found ${args.length-1} instead.`);const bindings=[];for(let i=1;i<args.length-1;i+=2){const name=args[i];if("string"!=typeof name)return context.error(`Expected string, but found ${typeof name} instead.`,i);if(/[^a-zA-Z0-9_]/.test(name))return context.error("Variable names must contain only alphanumeric characters or '_'.",i);const value=context.parse(args[i+1],i+1);if(!value)return null;bindings.push([name,value])}const result=context.parse(args[args.length-1],args.length-1,context.expectedType,bindings);return result?new Let(bindings,result):null}outputDefined(){return this.result.outputDefined()}serialize(){const serialized=["let"];for(const[name,expr]of this.bindings)serialized.push(name,expr.serialize());return serialized.push(this.result.serialize()),serialized}}var Let$1=Let;class At{constructor(type,index,input){this.type=type,this.index=index,this.input=input}static parse(args,context){if(3!==args.length)return context.error(`Expected 2 arguments, but found ${args.length-1} instead.`);const index=context.parse(args[1],1,dist_NumberType),input=context.parse(args[2],2,array$1(context.expectedType||ValueType));if(!index||!input)return null;const t=input.type;return new At(t.itemType,index,input)}evaluate(ctx){const index=this.index.evaluate(ctx),array=this.input.evaluate(ctx);if(index<0)throw new RuntimeError$1(`Array index out of bounds: ${index} < 0.`);if(index>=array.length)throw new RuntimeError$1(`Array index out of bounds: ${index} > ${array.length-1}.`);if(index!==Math.floor(index))throw new RuntimeError$1(`Array index must be an integer, but found ${index} instead.`);return array[index]}eachChild(fn){fn(this.index),fn(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var At$1=At;class In{constructor(needle,haystack){this.type=dist_BooleanType,this.needle=needle,this.haystack=haystack}static parse(args,context){if(3!==args.length)return context.error(`Expected 2 arguments, but found ${args.length-1} instead.`);const needle=context.parse(args[1],1,ValueType),haystack=context.parse(args[2],2,ValueType);return needle&&haystack?isValidType(needle.type,[dist_BooleanType,dist_StringType,dist_NumberType,NullType,ValueType])?new In(needle,haystack):context.error(`Expected first argument to be of type boolean, string, number or null, but found ${toString$1(needle.type)} instead`):null}evaluate(ctx){const needle=this.needle.evaluate(ctx),haystack=this.haystack.evaluate(ctx);if(null==haystack)return!1;if(!isValidNativeType(needle,["boolean","string","number","null"]))throw new RuntimeError$1(`Expected first argument to be of type boolean, string, number or null, but found ${toString$1(typeOf(needle))} instead.`);if(!isValidNativeType(haystack,["string","array"]))throw new RuntimeError$1(`Expected second argument to be of type array or string, but found ${toString$1(typeOf(haystack))} instead.`);return haystack.indexOf(needle)>=0}eachChild(fn){fn(this.needle),fn(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var In$1=In;class IndexOf{constructor(needle,haystack,fromIndex){this.type=dist_NumberType,this.needle=needle,this.haystack=haystack,this.fromIndex=fromIndex}static parse(args,context){if(args.length<=2||args.length>=5)return context.error(`Expected 3 or 4 arguments, but found ${args.length-1} instead.`);const needle=context.parse(args[1],1,ValueType),haystack=context.parse(args[2],2,ValueType);if(!needle||!haystack)return null;if(!isValidType(needle.type,[dist_BooleanType,dist_StringType,dist_NumberType,NullType,ValueType]))return context.error(`Expected first argument to be of type boolean, string, number or null, but found ${toString$1(needle.type)} instead`);if(4===args.length){const fromIndex=context.parse(args[3],3,dist_NumberType);return fromIndex?new IndexOf(needle,haystack,fromIndex):null}return new IndexOf(needle,haystack)}evaluate(ctx){const needle=this.needle.evaluate(ctx),haystack=this.haystack.evaluate(ctx);if(!isValidNativeType(needle,["boolean","string","number","null"]))throw new RuntimeError$1(`Expected first argument to be of type boolean, string, number or null, but found ${toString$1(typeOf(needle))} instead.`);if(!isValidNativeType(haystack,["string","array"]))throw new RuntimeError$1(`Expected second argument to be of type array or string, but found ${toString$1(typeOf(haystack))} instead.`);if(this.fromIndex){const fromIndex=this.fromIndex.evaluate(ctx);return haystack.indexOf(needle,fromIndex)}return haystack.indexOf(needle)}eachChild(fn){fn(this.needle),fn(this.haystack),this.fromIndex&&fn(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const fromIndex=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),fromIndex]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var IndexOf$1=IndexOf;class Match{constructor(inputType,outputType,input,cases,outputs,otherwise){this.inputType=inputType,this.type=outputType,this.input=input,this.cases=cases,this.outputs=outputs,this.otherwise=otherwise}static parse(args,context){if(args.length<5)return context.error(`Expected at least 4 arguments, but found only ${args.length-1}.`);if(args.length%2!=1)return context.error("Expected an even number of arguments.");let inputType,outputType;context.expectedType&&"value"!==context.expectedType.kind&&(outputType=context.expectedType);const cases={},outputs=[];for(let i=2;i<args.length-1;i+=2){let labels=args[i];const value=args[i+1];Array.isArray(labels)||(labels=[labels]);const labelContext=context.concat(i);if(0===labels.length)return labelContext.error("Expected at least one branch label.");for(const label of labels){if("number"!=typeof label&&"string"!=typeof label)return labelContext.error("Branch labels must be numbers or strings.");if("number"==typeof label&&Math.abs(label)>Number.MAX_SAFE_INTEGER)return labelContext.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof label&&Math.floor(label)!==label)return labelContext.error("Numeric branch labels must be integer values.");if(inputType){if(labelContext.checkSubtype(inputType,typeOf(label)))return null}else inputType=typeOf(label);if(void 0!==cases[String(label)])return labelContext.error("Branch labels must be unique.");cases[String(label)]=outputs.length}const result=context.parse(value,i,outputType);if(!result)return null;outputType=outputType||result.type,outputs.push(result)}const input=context.parse(args[1],1,ValueType);if(!input)return null;const otherwise=context.parse(args[args.length-1],args.length-1,outputType);return otherwise?"value"!==input.type.kind&&context.concat(1).checkSubtype(inputType,input.type)?null:new Match(inputType,outputType,input,cases,outputs,otherwise):null}evaluate(ctx){const input=this.input.evaluate(ctx);return(typeOf(input)===this.inputType&&this.outputs[this.cases[input]]||this.otherwise).evaluate(ctx)}eachChild(fn){fn(this.input),this.outputs.forEach(fn),fn(this.otherwise)}outputDefined(){return this.outputs.every((out=>out.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const serialized=["match",this.input.serialize()],sortedLabels=Object.keys(this.cases).sort(),groupedByOutput=[],outputLookup={};for(const label of sortedLabels){const outputIndex=outputLookup[this.cases[label]];void 0===outputIndex?(outputLookup[this.cases[label]]=groupedByOutput.length,groupedByOutput.push([this.cases[label],[label]])):groupedByOutput[outputIndex][1].push(label)}const coerceLabel=label=>"number"===this.inputType.kind?Number(label):label;for(const[outputIndex,labels]of groupedByOutput)1===labels.length?serialized.push(coerceLabel(labels[0])):serialized.push(labels.map(coerceLabel)),serialized.push(this.outputs[outputIndex].serialize());return serialized.push(this.otherwise.serialize()),serialized}}var Match$1=Match;class Case{constructor(type,branches,otherwise){this.type=type,this.branches=branches,this.otherwise=otherwise}static parse(args,context){if(args.length<4)return context.error(`Expected at least 3 arguments, but found only ${args.length-1}.`);if(args.length%2!=0)return context.error("Expected an odd number of arguments.");let outputType;context.expectedType&&"value"!==context.expectedType.kind&&(outputType=context.expectedType);const branches=[];for(let i=1;i<args.length-1;i+=2){const test=context.parse(args[i],i,dist_BooleanType);if(!test)return null;const result=context.parse(args[i+1],i+1,outputType);if(!result)return null;branches.push([test,result]),outputType=outputType||result.type}const otherwise=context.parse(args[args.length-1],args.length-1,outputType);return otherwise?new Case(outputType,branches,otherwise):null}evaluate(ctx){for(const[test,expression]of this.branches)if(test.evaluate(ctx))return expression.evaluate(ctx);return this.otherwise.evaluate(ctx)}eachChild(fn){for(const[test,expression]of this.branches)fn(test),fn(expression);fn(this.otherwise)}outputDefined(){return this.branches.every((([_,out])=>out.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const serialized=["case"];return this.eachChild((child=>{serialized.push(child.serialize())})),serialized}}var Case$1=Case;class Slice{constructor(type,input,beginIndex,endIndex){this.type=type,this.input=input,this.beginIndex=beginIndex,this.endIndex=endIndex}static parse(args,context){if(args.length<=2||args.length>=5)return context.error(`Expected 3 or 4 arguments, but found ${args.length-1} instead.`);const input=context.parse(args[1],1,ValueType),beginIndex=context.parse(args[2],2,dist_NumberType);if(!input||!beginIndex)return null;if(!isValidType(input.type,[array$1(ValueType),dist_StringType,ValueType]))return context.error(`Expected first argument to be of type array or string, but found ${toString$1(input.type)} instead`);if(4===args.length){const endIndex=context.parse(args[3],3,dist_NumberType);return endIndex?new Slice(input.type,input,beginIndex,endIndex):null}return new Slice(input.type,input,beginIndex)}evaluate(ctx){const input=this.input.evaluate(ctx),beginIndex=this.beginIndex.evaluate(ctx);if(!isValidNativeType(input,["string","array"]))throw new RuntimeError$1(`Expected first argument to be of type array or string, but found ${toString$1(typeOf(input))} instead.`);if(this.endIndex){const endIndex=this.endIndex.evaluate(ctx);return input.slice(beginIndex,endIndex)}return input.slice(beginIndex)}eachChild(fn){fn(this.input),fn(this.beginIndex),this.endIndex&&fn(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const endIndex=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),endIndex]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var Slice$1=Slice;function isComparableType(op,type){return"=="===op||"!="===op?"boolean"===type.kind||"string"===type.kind||"number"===type.kind||"null"===type.kind||"value"===type.kind:"string"===type.kind||"number"===type.kind||"value"===type.kind}function eqCollate(ctx,a,b,c){return 0===c.compare(a,b)}function makeComparison(op,compareBasic,compareWithCollator){const isOrderComparison="=="!==op&&"!="!==op;return class Comparison{constructor(lhs,rhs,collator){this.type=dist_BooleanType,this.lhs=lhs,this.rhs=rhs,this.collator=collator,this.hasUntypedArgument="value"===lhs.type.kind||"value"===rhs.type.kind}static parse(args,context){if(3!==args.length&&4!==args.length)return context.error("Expected two or three arguments.");const op=args[0];let lhs=context.parse(args[1],1,ValueType);if(!lhs)return null;if(!isComparableType(op,lhs.type))return context.concat(1).error(`"${op}" comparisons are not supported for type '${toString$1(lhs.type)}'.`);let rhs=context.parse(args[2],2,ValueType);if(!rhs)return null;if(!isComparableType(op,rhs.type))return context.concat(2).error(`"${op}" comparisons are not supported for type '${toString$1(rhs.type)}'.`);if(lhs.type.kind!==rhs.type.kind&&"value"!==lhs.type.kind&&"value"!==rhs.type.kind)return context.error(`Cannot compare types '${toString$1(lhs.type)}' and '${toString$1(rhs.type)}'.`);isOrderComparison&&("value"===lhs.type.kind&&"value"!==rhs.type.kind?lhs=new Assertion$1(rhs.type,[lhs]):"value"!==lhs.type.kind&&"value"===rhs.type.kind&&(rhs=new Assertion$1(lhs.type,[rhs])));let collator=null;if(4===args.length){if("string"!==lhs.type.kind&&"string"!==rhs.type.kind&&"value"!==lhs.type.kind&&"value"!==rhs.type.kind)return context.error("Cannot use collator to compare non-string types.");if(collator=context.parse(args[3],3,CollatorType),!collator)return null}return new Comparison(lhs,rhs,collator)}evaluate(ctx){const lhs=this.lhs.evaluate(ctx),rhs=this.rhs.evaluate(ctx);if(isOrderComparison&&this.hasUntypedArgument){const lt=typeOf(lhs),rt=typeOf(rhs);if(lt.kind!==rt.kind||"string"!==lt.kind&&"number"!==lt.kind)throw new RuntimeError$1(`Expected arguments for "${op}" to be (string, string) or (number, number), but found (${lt.kind}, ${rt.kind}) instead.`)}if(this.collator&&!isOrderComparison&&this.hasUntypedArgument){const lt=typeOf(lhs),rt=typeOf(rhs);if("string"!==lt.kind||"string"!==rt.kind)return compareBasic(ctx,lhs,rhs)}return this.collator?compareWithCollator(ctx,lhs,rhs,this.collator.evaluate(ctx)):compareBasic(ctx,lhs,rhs)}eachChild(fn){fn(this.lhs),fn(this.rhs),this.collator&&fn(this.collator)}outputDefined(){return!0}serialize(){const serialized=[op];return this.eachChild((child=>{serialized.push(child.serialize())})),serialized}}}const Equals=makeComparison("==",(function eq(ctx,a,b){return a===b}),eqCollate),NotEquals=makeComparison("!=",(function neq(ctx,a,b){return a!==b}),(function neqCollate(ctx,a,b,c){return!eqCollate(0,a,b,c)})),LessThan=makeComparison("<",(function lt(ctx,a,b){return a<b}),(function ltCollate(ctx,a,b,c){return c.compare(a,b)<0})),GreaterThan=makeComparison(">",(function gt(ctx,a,b){return a>b}),(function gtCollate(ctx,a,b,c){return c.compare(a,b)>0})),LessThanOrEqual=makeComparison("<=",(function lteq(ctx,a,b){return a<=b}),(function lteqCollate(ctx,a,b,c){return c.compare(a,b)<=0})),GreaterThanOrEqual=makeComparison(">=",(function gteq(ctx,a,b){return a>=b}),(function gteqCollate(ctx,a,b,c){return c.compare(a,b)>=0}));class NumberFormat{constructor(number,locale,currency,unit,minFractionDigits,maxFractionDigits){this.type=dist_StringType,this.number=number,this.locale=locale,this.currency=currency,this.unit=unit,this.minFractionDigits=minFractionDigits,this.maxFractionDigits=maxFractionDigits}static parse(args,context){if(3!==args.length)return context.error("Expected two arguments.");const number=context.parse(args[1],1,dist_NumberType);if(!number)return null;const options=args[2];if("object"!=typeof options||Array.isArray(options))return context.error("NumberFormat options argument must be an object.");let locale=null;if(options.locale&&(locale=context.parse(options.locale,1,dist_StringType),!locale))return null;let currency=null;if(options.currency&&(currency=context.parse(options.currency,1,dist_StringType),!currency))return null;let unit=null;if(options.unit&&(unit=context.parse(options.unit,1,dist_StringType),!unit))return null;let minFractionDigits=null;if(options["min-fraction-digits"]&&(minFractionDigits=context.parse(options["min-fraction-digits"],1,dist_NumberType),!minFractionDigits))return null;let maxFractionDigits=null;return options["max-fraction-digits"]&&(maxFractionDigits=context.parse(options["max-fraction-digits"],1,dist_NumberType),!maxFractionDigits)?null:new NumberFormat(number,locale,currency,unit,minFractionDigits,maxFractionDigits)}evaluate(ctx){return new Intl.NumberFormat(this.locale?this.locale.evaluate(ctx):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(ctx):void 0,unit:this.unit?this.unit.evaluate(ctx):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(ctx):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(ctx):void 0}).format(this.number.evaluate(ctx))}eachChild(fn){fn(this.number),this.locale&&fn(this.locale),this.currency&&fn(this.currency),this.unit&&fn(this.unit),this.minFractionDigits&&fn(this.minFractionDigits),this.maxFractionDigits&&fn(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const options={};return this.locale&&(options.locale=this.locale.serialize()),this.currency&&(options.currency=this.currency.serialize()),this.unit&&(options.unit=this.unit.serialize()),this.minFractionDigits&&(options["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(options["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),options]}}class Length{constructor(input){this.type=dist_NumberType,this.input=input}static parse(args,context){if(2!==args.length)return context.error(`Expected 1 argument, but found ${args.length-1} instead.`);const input=context.parse(args[1],1);return input?"array"!==input.type.kind&&"string"!==input.type.kind&&"value"!==input.type.kind?context.error(`Expected argument of type string or array, but found ${toString$1(input.type)} instead.`):new Length(input):null}evaluate(ctx){const input=this.input.evaluate(ctx);if("string"==typeof input)return input.length;if(Array.isArray(input))return input.length;throw new RuntimeError$1(`Expected value to be of type string or array, but found ${toString$1(typeOf(input))} instead.`)}eachChild(fn){fn(this.input)}outputDefined(){return!1}serialize(){const serialized=["length"];return this.eachChild((child=>{serialized.push(child.serialize())})),serialized}}const expressions={"==":Equals,"!=":NotEquals,">":GreaterThan,"<":LessThan,">=":GreaterThanOrEqual,"<=":LessThanOrEqual,array:Assertion$1,at:At$1,boolean:Assertion$1,case:Case$1,coalesce:Coalesce$1,collator:CollatorExpression,format:FormatExpression,image:ImageExpression,in:In$1,"index-of":IndexOf$1,interpolate:Interpolate$1,"interpolate-hcl":Interpolate$1,"interpolate-lab":Interpolate$1,length:Length,let:Let$1,literal:Literal$1,match:Match$1,number:Assertion$1,"number-format":NumberFormat,object:Assertion$1,slice:Slice$1,step:Step$1,string:Assertion$1,"to-boolean":Coercion$1,"to-color":Coercion$1,"to-number":Coercion$1,"to-string":Coercion$1,var:Var$1,within:Within$1};function rgba(ctx,[r,g,b,a]){r=r.evaluate(ctx),g=g.evaluate(ctx),b=b.evaluate(ctx);const alpha=a?a.evaluate(ctx):1,error=validateRGBA(r,g,b,alpha);if(error)throw new RuntimeError$1(error);return new Color$1(r/255*alpha,g/255*alpha,b/255*alpha,alpha)}function dist_has(key,obj){return key in obj}function dist_get(key,obj){const v=obj[key];return void 0===v?null:v}function varargs(type){return{type}}CompoundExpression$1.register(expressions,{error:[{kind:"error"},[dist_StringType],(ctx,[v])=>{throw new RuntimeError$1(v.evaluate(ctx))}],typeof:[dist_StringType,[ValueType],(ctx,[v])=>toString$1(typeOf(v.evaluate(ctx)))],"to-rgba":[array$1(dist_NumberType,4),[dist_ColorType],(ctx,[v])=>v.evaluate(ctx).toArray()],rgb:[dist_ColorType,[dist_NumberType,dist_NumberType,dist_NumberType],rgba],rgba:[dist_ColorType,[dist_NumberType,dist_NumberType,dist_NumberType,dist_NumberType],rgba],has:{type:dist_BooleanType,overloads:[[[dist_StringType],(ctx,[key])=>dist_has(key.evaluate(ctx),ctx.properties())],[[dist_StringType,ObjectType],(ctx,[key,obj])=>dist_has(key.evaluate(ctx),obj.evaluate(ctx))]]},get:{type:ValueType,overloads:[[[dist_StringType],(ctx,[key])=>dist_get(key.evaluate(ctx),ctx.properties())],[[dist_StringType,ObjectType],(ctx,[key,obj])=>dist_get(key.evaluate(ctx),obj.evaluate(ctx))]]},"feature-state":[ValueType,[dist_StringType],(ctx,[key])=>dist_get(key.evaluate(ctx),ctx.featureState||{})],properties:[ObjectType,[],ctx=>ctx.properties()],"geometry-type":[dist_StringType,[],ctx=>ctx.geometryType()],id:[ValueType,[],ctx=>ctx.id()],zoom:[dist_NumberType,[],ctx=>ctx.globals.zoom],pitch:[dist_NumberType,[],ctx=>ctx.globals.pitch||0],"distance-from-center":[dist_NumberType,[],ctx=>ctx.distanceFromCenter()],"heatmap-density":[dist_NumberType,[],ctx=>ctx.globals.heatmapDensity||0],"line-progress":[dist_NumberType,[],ctx=>ctx.globals.lineProgress||0],"sky-radial-progress":[dist_NumberType,[],ctx=>ctx.globals.skyRadialProgress||0],accumulated:[ValueType,[],ctx=>void 0===ctx.globals.accumulated?null:ctx.globals.accumulated],"+":[dist_NumberType,varargs(dist_NumberType),(ctx,args)=>{let result=0;for(const arg of args)result+=arg.evaluate(ctx);return result}],"*":[dist_NumberType,varargs(dist_NumberType),(ctx,args)=>{let result=1;for(const arg of args)result*=arg.evaluate(ctx);return result}],"-":{type:dist_NumberType,overloads:[[[dist_NumberType,dist_NumberType],(ctx,[a,b])=>a.evaluate(ctx)-b.evaluate(ctx)],[[dist_NumberType],(ctx,[a])=>-a.evaluate(ctx)]]},"/":[dist_NumberType,[dist_NumberType,dist_NumberType],(ctx,[a,b])=>a.evaluate(ctx)/b.evaluate(ctx)],"%":[dist_NumberType,[dist_NumberType,dist_NumberType],(ctx,[a,b])=>a.evaluate(ctx)%b.evaluate(ctx)],ln2:[dist_NumberType,[],()=>Math.LN2],pi:[dist_NumberType,[],()=>Math.PI],e:[dist_NumberType,[],()=>Math.E],"^":[dist_NumberType,[dist_NumberType,dist_NumberType],(ctx,[b,e])=>Math.pow(b.evaluate(ctx),e.evaluate(ctx))],sqrt:[dist_NumberType,[dist_NumberType],(ctx,[x])=>Math.sqrt(x.evaluate(ctx))],log10:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.log(n.evaluate(ctx))/Math.LN10],ln:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.log(n.evaluate(ctx))],log2:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.log(n.evaluate(ctx))/Math.LN2],sin:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.sin(n.evaluate(ctx))],cos:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.cos(n.evaluate(ctx))],tan:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.tan(n.evaluate(ctx))],asin:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.asin(n.evaluate(ctx))],acos:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.acos(n.evaluate(ctx))],atan:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.atan(n.evaluate(ctx))],min:[dist_NumberType,varargs(dist_NumberType),(ctx,args)=>Math.min(...args.map((arg=>arg.evaluate(ctx))))],max:[dist_NumberType,varargs(dist_NumberType),(ctx,args)=>Math.max(...args.map((arg=>arg.evaluate(ctx))))],abs:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.abs(n.evaluate(ctx))],round:[dist_NumberType,[dist_NumberType],(ctx,[n])=>{const v=n.evaluate(ctx);return v<0?-Math.round(-v):Math.round(v)}],floor:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.floor(n.evaluate(ctx))],ceil:[dist_NumberType,[dist_NumberType],(ctx,[n])=>Math.ceil(n.evaluate(ctx))],"filter-==":[dist_BooleanType,[dist_StringType,ValueType],(ctx,[k,v])=>ctx.properties()[k.value]===v.value],"filter-id-==":[dist_BooleanType,[ValueType],(ctx,[v])=>ctx.id()===v.value],"filter-type-==":[dist_BooleanType,[dist_StringType],(ctx,[v])=>ctx.geometryType()===v.value],"filter-<":[dist_BooleanType,[dist_StringType,ValueType],(ctx,[k,v])=>{const a=ctx.properties()[k.value],b=v.value;return typeof a==typeof b&&a<b}],"filter-id-<":[dist_BooleanType,[ValueType],(ctx,[v])=>{const a=ctx.id(),b=v.value;return typeof a==typeof b&&a<b}],"filter->":[dist_BooleanType,[dist_StringType,ValueType],(ctx,[k,v])=>{const a=ctx.properties()[k.value],b=v.value;return typeof a==typeof b&&a>b}],"filter-id->":[dist_BooleanType,[ValueType],(ctx,[v])=>{const a=ctx.id(),b=v.value;return typeof a==typeof b&&a>b}],"filter-<=":[dist_BooleanType,[dist_StringType,ValueType],(ctx,[k,v])=>{const a=ctx.properties()[k.value],b=v.value;return typeof a==typeof b&&a<=b}],"filter-id-<=":[dist_BooleanType,[ValueType],(ctx,[v])=>{const a=ctx.id(),b=v.value;return typeof a==typeof b&&a<=b}],"filter->=":[dist_BooleanType,[dist_StringType,ValueType],(ctx,[k,v])=>{const a=ctx.properties()[k.value],b=v.value;return typeof a==typeof b&&a>=b}],"filter-id->=":[dist_BooleanType,[ValueType],(ctx,[v])=>{const a=ctx.id(),b=v.value;return typeof a==typeof b&&a>=b}],"filter-has":[dist_BooleanType,[ValueType],(ctx,[k])=>k.value in ctx.properties()],"filter-has-id":[dist_BooleanType,[],ctx=>null!==ctx.id()&&void 0!==ctx.id()],"filter-type-in":[dist_BooleanType,[array$1(dist_StringType)],(ctx,[v])=>v.value.indexOf(ctx.geometryType())>=0],"filter-id-in":[dist_BooleanType,[array$1(ValueType)],(ctx,[v])=>v.value.indexOf(ctx.id())>=0],"filter-in-small":[dist_BooleanType,[dist_StringType,array$1(ValueType)],(ctx,[k,v])=>v.value.indexOf(ctx.properties()[k.value])>=0],"filter-in-large":[dist_BooleanType,[dist_StringType,array$1(ValueType)],(ctx,[k,v])=>function binarySearch(v,a,i,j){for(;i<=j;){const m=i+j>>1;if(a[m]===v)return!0;a[m]>v?j=m-1:i=m+1}return!1}(ctx.properties()[k.value],v.value,0,v.value.length-1)],all:{type:dist_BooleanType,overloads:[[[dist_BooleanType,dist_BooleanType],(ctx,[a,b])=>a.evaluate(ctx)&&b.evaluate(ctx)],[varargs(dist_BooleanType),(ctx,args)=>{for(const arg of args)if(!arg.evaluate(ctx))return!1;return!0}]]},any:{type:dist_BooleanType,overloads:[[[dist_BooleanType,dist_BooleanType],(ctx,[a,b])=>a.evaluate(ctx)||b.evaluate(ctx)],[varargs(dist_BooleanType),(ctx,args)=>{for(const arg of args)if(arg.evaluate(ctx))return!0;return!1}]]},"!":[dist_BooleanType,[dist_BooleanType],(ctx,[b])=>!b.evaluate(ctx)],"is-supported-script":[dist_BooleanType,[dist_StringType],(ctx,[s])=>{const isSupportedScript=ctx.globals&&ctx.globals.isSupportedScript;return!isSupportedScript||isSupportedScript(s.evaluate(ctx))}],upcase:[dist_StringType,[dist_StringType],(ctx,[s])=>s.evaluate(ctx).toUpperCase()],downcase:[dist_StringType,[dist_StringType],(ctx,[s])=>s.evaluate(ctx).toLowerCase()],concat:[dist_StringType,varargs(ValueType),(ctx,args)=>args.map((arg=>dist_toString(arg.evaluate(ctx)))).join("")],"resolved-locale":[dist_StringType,[CollatorType],(ctx,[collator])=>collator.evaluate(ctx).resolvedLocale()]});var definitions=expressions;function success(value){return{result:"success",value}}function error(value){return{result:"error",value}}function isFunction(value){return"object"==typeof value&&null!==value&&!Array.isArray(value)}class StyleExpression{constructor(expression,propertySpec){this.expression=expression,this._warningHistory={},this._evaluator=new EvaluationContext$1,this._defaultValue=propertySpec?function getDefaultValue(spec){return"color"===spec.type&&(isFunction(spec.default)||Array.isArray(spec.default))?new Color$1(0,0,0,0):"color"===spec.type?Color$1.parse(spec.default)||null:void 0===spec.default?null:spec.default}(propertySpec):null,this._enumValues=propertySpec&&"enum"===propertySpec.type?propertySpec.values:null}evaluateWithoutErrorHandling(globals,feature,featureState,canonical,availableImages,formattedSection,featureTileCoord,featureDistanceData){return this._evaluator.globals=globals,this._evaluator.feature=feature,this._evaluator.featureState=featureState,this._evaluator.canonical=canonical||null,this._evaluator.availableImages=availableImages||null,this._evaluator.formattedSection=formattedSection,this._evaluator.featureTileCoord=featureTileCoord||null,this._evaluator.featureDistanceData=featureDistanceData||null,this.expression.evaluate(this._evaluator)}evaluate(globals,feature,featureState,canonical,availableImages,formattedSection,featureTileCoord,featureDistanceData){this._evaluator.globals=globals,this._evaluator.feature=feature||null,this._evaluator.featureState=featureState||null,this._evaluator.canonical=canonical||null,this._evaluator.availableImages=availableImages||null,this._evaluator.formattedSection=formattedSection||null,this._evaluator.featureTileCoord=featureTileCoord||null,this._evaluator.featureDistanceData=featureDistanceData||null;try{const val=this.expression.evaluate(this._evaluator);if(null==val||"number"==typeof val&&val!=val)return this._defaultValue;if(this._enumValues&&!(val in this._enumValues))throw new RuntimeError$1(`Expected value to be one of ${Object.keys(this._enumValues).map((v=>JSON.stringify(v))).join(", ")}, but found ${JSON.stringify(val)} instead.`);return val}catch(e){return this._warningHistory[e.message]||(this._warningHistory[e.message]=!0,"undefined"!=typeof console&&console.warn(e.message)),this._defaultValue}}}function createExpression(expression,propertySpec){const parser=new ParsingContext$1(definitions,[],propertySpec?function getExpectedType(spec){const types={color:dist_ColorType,string:dist_StringType,number:dist_NumberType,enum:dist_StringType,boolean:dist_BooleanType,formatted:FormattedType,resolvedImage:ResolvedImageType};if("array"===spec.type)return array$1(types[spec.value]||ValueType,spec.length);return types[spec.type]}(propertySpec):void 0),parsed=parser.parse(expression,void 0,void 0,void 0,propertySpec&&"string"===propertySpec.type?{typeAnnotation:"coerce"}:void 0);return parsed?success(new StyleExpression(parsed,propertySpec)):error(parser.errors)}class ZoomConstantExpression{constructor(kind,expression){this.kind=kind,this._styleExpression=expression,this.isStateDependent="constant"!==kind&&!isStateConstant(expression.expression)}evaluateWithoutErrorHandling(globals,feature,featureState,canonical,availableImages,formattedSection){return this._styleExpression.evaluateWithoutErrorHandling(globals,feature,featureState,canonical,availableImages,formattedSection)}evaluate(globals,feature,featureState,canonical,availableImages,formattedSection){return this._styleExpression.evaluate(globals,feature,featureState,canonical,availableImages,formattedSection)}}class ZoomDependentExpression{constructor(kind,expression,zoomStops,interpolationType){this.kind=kind,this.zoomStops=zoomStops,this._styleExpression=expression,this.isStateDependent="camera"!==kind&&!isStateConstant(expression.expression),this.interpolationType=interpolationType}evaluateWithoutErrorHandling(globals,feature,featureState,canonical,availableImages,formattedSection){return this._styleExpression.evaluateWithoutErrorHandling(globals,feature,featureState,canonical,availableImages,formattedSection)}evaluate(globals,feature,featureState,canonical,availableImages,formattedSection){return this._styleExpression.evaluate(globals,feature,featureState,canonical,availableImages,formattedSection)}interpolationFactor(input,lower,upper){return this.interpolationType?Interpolate$1.interpolationFactor(this.interpolationType,input,lower,upper):0}}function createPropertyExpression(expression,propertySpec){if("error"===(expression=createExpression(expression,propertySpec)).result)return expression;const parsed=expression.value.expression,isFeatureConstant$1=isFeatureConstant(parsed);if(!isFeatureConstant$1&&!function supportsPropertyExpression(spec){return"data-driven"===spec["property-type"]}(propertySpec))return error([new ParsingError$1("","data expressions not supported")]);const isZoomConstant=isGlobalPropertyConstant(parsed,["zoom","pitch","distance-from-center"]);if(!isZoomConstant&&!function supportsZoomExpression(spec){return!!spec.expression&&spec.expression.parameters.indexOf("zoom")>-1}(propertySpec))return error([new ParsingError$1("","zoom expressions not supported")]);const zoomCurve=findZoomCurve(parsed);if(!zoomCurve&&!isZoomConstant)return error([new ParsingError$1("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')]);if(zoomCurve instanceof ParsingError$1)return error([zoomCurve]);if(zoomCurve instanceof Interpolate$1&&!function supportsInterpolation(spec){return!!spec.expression&&spec.expression.interpolated}(propertySpec))return error([new ParsingError$1("",'"interpolate" expressions cannot be used with this property')]);if(!zoomCurve)return success(new ZoomConstantExpression(isFeatureConstant$1?"constant":"source",expression.value));const interpolationType=zoomCurve instanceof Interpolate$1?zoomCurve.interpolation:void 0;return success(new ZoomDependentExpression(isFeatureConstant$1?"camera":"composite",expression.value,zoomCurve.labels,interpolationType))}function findZoomCurve(expression){let result=null;if(expression instanceof Let$1)result=findZoomCurve(expression.result);else if(expression instanceof Coalesce$1){for(const arg of expression.args)if(result=findZoomCurve(arg),result)break}else(expression instanceof Step$1||expression instanceof Interpolate$1)&&expression.input instanceof CompoundExpression$1&&"zoom"===expression.input.name&&(result=expression);return result instanceof ParsingError$1||expression.eachChild((child=>{const childResult=findZoomCurve(child);childResult instanceof ParsingError$1?result=childResult:!result&&childResult?result=new ParsingError$1("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):result&&childResult&&result!==childResult&&(result=new ParsingError$1("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),result}function deepUnbundle(value){if(Array.isArray(value))return value.map(deepUnbundle);if(value instanceof Object&&!(value instanceof Number||value instanceof String||value instanceof Boolean)){const unbundledValue={};for(const key in value)unbundledValue[key]=deepUnbundle(value[key]);return unbundledValue}return function unbundle(value){return value instanceof Number||value instanceof String||value instanceof Boolean?value.valueOf():value}(value)}var spec={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},fog:{type:"fog"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},projection:{type:"projection"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{},sky:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_sky:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"},"fill-extrusion-edge-radius":{type:"number",private:!0,default:0,minimum:0,maximum:1,"property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_symbol:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature","pitch","distance-from-center"]}},filter_fill:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_line:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_circle:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},"filter_fill-extrusion":{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_heatmap:{type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},expression_name:{type:"enum",values:{let:{group:"Variable binding"},var:{group:"Variable binding"},literal:{group:"Types"},array:{group:"Types"},at:{group:"Lookup"},in:{group:"Lookup"},"index-of":{group:"Lookup"},slice:{group:"Lookup"},case:{group:"Decision"},match:{group:"Decision"},coalesce:{group:"Decision"},step:{group:"Ramps, scales, curves"},interpolate:{group:"Ramps, scales, curves"},"interpolate-hcl":{group:"Ramps, scales, curves"},"interpolate-lab":{group:"Ramps, scales, curves"},ln2:{group:"Math"},pi:{group:"Math"},e:{group:"Math"},typeof:{group:"Types"},string:{group:"Types"},number:{group:"Types"},boolean:{group:"Types"},object:{group:"Types"},collator:{group:"Types"},format:{group:"Types"},image:{group:"Types"},"number-format":{group:"Types"},"to-string":{group:"Types"},"to-number":{group:"Types"},"to-boolean":{group:"Types"},"to-rgba":{group:"Color"},"to-color":{group:"Types"},rgb:{group:"Color"},rgba:{group:"Color"},get:{group:"Lookup"},has:{group:"Lookup"},length:{group:"Lookup"},properties:{group:"Feature data"},"feature-state":{group:"Feature data"},"geometry-type":{group:"Feature data"},id:{group:"Feature data"},zoom:{group:"Camera"},pitch:{group:"Camera"},"distance-from-center":{group:"Camera"},"heatmap-density":{group:"Heatmap"},"line-progress":{group:"Feature data"},"sky-radial-progress":{group:"sky"},accumulated:{group:"Feature data"},"+":{group:"Math"},"*":{group:"Math"},"-":{group:"Math"},"/":{group:"Math"},"%":{group:"Math"},"^":{group:"Math"},sqrt:{group:"Math"},log10:{group:"Math"},ln:{group:"Math"},log2:{group:"Math"},sin:{group:"Math"},cos:{group:"Math"},tan:{group:"Math"},asin:{group:"Math"},acos:{group:"Math"},atan:{group:"Math"},min:{group:"Math"},max:{group:"Math"},round:{group:"Math"},abs:{group:"Math"},ceil:{group:"Math"},floor:{group:"Math"},distance:{group:"Math"},"==":{group:"Decision"},"!=":{group:"Decision"},">":{group:"Decision"},"<":{group:"Decision"},">=":{group:"Decision"},"<=":{group:"Decision"},all:{group:"Decision"},any:{group:"Decision"},"!":{group:"Decision"},within:{group:"Decision"},"is-supported-script":{group:"String"},upcase:{group:"String"},downcase:{group:"String"},concat:{group:"String"},"resolved-locale":{group:"String"}}},fog:{range:{type:"array",default:[.5,10],minimum:-20,maximum:20,length:2,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"high-color":{type:"color","property-type":"data-constant",default:"#245cdf",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"space-color":{type:"color","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"horizon-blend":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],4,.2,7,.1],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"star-intensity":{type:"number","property-type":"data-constant",default:["interpolate",["linear"],["zoom"],5,.35,6,0],minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},projection:{name:{type:"enum",values:{albers:{},equalEarth:{},equirectangular:{},lambertConformalConic:{},mercator:{},naturalEarth:{},winkelTripel:{},globe:{}},default:"mercator",required:!0},center:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-180,-90],maximum:[180,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]},parallels:{type:"array",length:2,value:"number","property-type":"data-constant",minimum:[-90,-90],maximum:[90,90],transition:!1,requires:[{name:["albers","lambertConformalConic"]}]}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number","property-type":"data-constant",default:1,minimum:0,maximum:1e3,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["source"]}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-ambient-occlusion-intensity":{"property-type":"data-constant",type:"number",private:!0,default:0,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0},"fill-extrusion-ambient-occlusion-radius":{"property-type":"data-constant",type:"number",private:!0,default:3,minimum:0,expression:{interpolated:!0,parameters:["zoom"]},transition:!0,requires:["fill-extrusion-edge-radius"]}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!1,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{type:"array",value:"number",length:2,default:[0,0],minimum:[0,0],maximum:[1,1],transition:!1,requires:[{source:"geojson",has:{lineMetrics:!0}}],"property-type":"constant"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_sky:{"sky-type":{type:"enum",values:{gradient:{},atmosphere:{}},default:"atmosphere",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{type:"array",value:"number",length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,requires:[{"sky-type":"atmosphere"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{type:"number",requires:[{"sky-type":"atmosphere"}],default:10,minimum:0,maximum:100,transition:!1,"property-type":"data-constant"},"sky-gradient-center":{type:"array",requires:[{"sky-type":"gradient"}],value:"number",default:[0,0],length:2,units:"degrees",minimum:[0,0],maximum:[360,180],transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{type:"number",requires:[{"sky-type":"gradient"}],default:90,minimum:0,maximum:180,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"sky-gradient":{type:"color",default:["interpolate",["linear"],["sky-radial-progress"],.8,"#87ceeb",1,"white"],transition:!1,requires:[{"sky-type":"gradient"}],expression:{interpolated:!0,parameters:["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{type:"color",default:"white",transition:!1,requires:[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};function isExpressionFilter(filter){if(!0===filter||!1===filter)return!0;if(!Array.isArray(filter)||0===filter.length)return!1;switch(filter[0]){case"has":return filter.length>=2&&"$id"!==filter[1]&&"$type"!==filter[1];case"in":return filter.length>=3&&("string"!=typeof filter[1]||Array.isArray(filter[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==filter.length||Array.isArray(filter[1])||Array.isArray(filter[2]);case"any":case"all":for(const f of filter.slice(1))if(!isExpressionFilter(f)&&"boolean"!=typeof f)return!1;return!0;default:return!0}}function createFilter(filter,layerType="fill"){if(null==filter)return{filter:()=>!0,needGeometry:!1,needFeature:!1};isExpressionFilter(filter)||(filter=convertFilter(filter));const filterExp=filter;let staticFilter=!0;try{staticFilter=function extractStaticFilter(filter){if(!isDynamicFilter(filter))return filter;let result=deepUnbundle(filter);return unionDynamicBranches(result),result=collapseDynamicBooleanExpressions(result),result}(filterExp)}catch(e){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(filterExp,null,2)}\n        `)}const filterSpec=spec[`filter_${layerType}`],compiledStaticFilter=createExpression(staticFilter,filterSpec);let filterFunc=null;if("error"===compiledStaticFilter.result)throw new Error(compiledStaticFilter.value.map((err=>`${err.key}: ${err.message}`)).join(", "));filterFunc=(globalProperties,feature,canonical)=>compiledStaticFilter.value.evaluate(globalProperties,feature,{},canonical);let dynamicFilterFunc=null,needFeature=null;if(staticFilter!==filterExp){const compiledDynamicFilter=createExpression(filterExp,filterSpec);if("error"===compiledDynamicFilter.result)throw new Error(compiledDynamicFilter.value.map((err=>`${err.key}: ${err.message}`)).join(", "));dynamicFilterFunc=(globalProperties,feature,canonical,featureTileCoord,featureDistanceData)=>compiledDynamicFilter.value.evaluate(globalProperties,feature,{},canonical,void 0,void 0,featureTileCoord,featureDistanceData),needFeature=!isFeatureConstant(compiledDynamicFilter.value.expression)}return{filter:filterFunc,dynamicFilter:dynamicFilterFunc||void 0,needGeometry:geometryNeeded(staticFilter),needFeature:!!needFeature}}function collapseDynamicBooleanExpressions(expression){if(!Array.isArray(expression))return expression;const collapsed=function collapsedExpression(expression){if(dynamicConditionExpressions.has(expression[0]))for(let i=1;i<expression.length;i++){if(isDynamicFilter(expression[i]))return!0}return expression}(expression);return!0===collapsed?collapsed:collapsed.map((subExpression=>collapseDynamicBooleanExpressions(subExpression)))}function unionDynamicBranches(filter){let isBranchingDynamically=!1;const branches=[];if("case"===filter[0]){for(let i=1;i<filter.length-1;i+=2)isBranchingDynamically=isBranchingDynamically||isDynamicFilter(filter[i]),branches.push(filter[i+1]);branches.push(filter[filter.length-1])}else if("match"===filter[0]){isBranchingDynamically=isBranchingDynamically||isDynamicFilter(filter[1]);for(let i=2;i<filter.length-1;i+=2)branches.push(filter[i+1]);branches.push(filter[filter.length-1])}else if("step"===filter[0]){isBranchingDynamically=isBranchingDynamically||isDynamicFilter(filter[1]);for(let i=1;i<filter.length-1;i+=2)branches.push(filter[i+1])}isBranchingDynamically&&(filter.length=0,filter.push("any",...branches));for(let i=1;i<filter.length;i++)unionDynamicBranches(filter[i])}function isDynamicFilter(filter){if(!Array.isArray(filter))return!1;if(function isRootExpressionDynamic(expression){return"pitch"===expression||"distance-from-center"===expression}(filter[0]))return!0;for(let i=1;i<filter.length;i++){if(isDynamicFilter(filter[i]))return!0}return!1}const dynamicConditionExpressions=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function compare(a,b){return a<b?-1:a>b?1:0}function geometryNeeded(filter){if(!Array.isArray(filter))return!1;if("within"===filter[0])return!0;for(let index=1;index<filter.length;index++)if(geometryNeeded(filter[index]))return!0;return!1}function convertFilter(filter){if(!filter)return!0;const op=filter[0];if(filter.length<=1)return"any"!==op;return"=="===op?convertComparisonOp(filter[1],filter[2],"=="):"!="===op?convertNegation(convertComparisonOp(filter[1],filter[2],"==")):"<"===op||">"===op||"<="===op||">="===op?convertComparisonOp(filter[1],filter[2],op):"any"===op?function convertDisjunctionOp(filters){return["any"].concat(filters.map(convertFilter))}(filter.slice(1)):"all"===op?["all"].concat(filter.slice(1).map(convertFilter)):"none"===op?["all"].concat(filter.slice(1).map(convertFilter).map(convertNegation)):"in"===op?convertInOp(filter[1],filter.slice(2)):"!in"===op?convertNegation(convertInOp(filter[1],filter.slice(2))):"has"===op?convertHasOp(filter[1]):"!has"===op?convertNegation(convertHasOp(filter[1])):"within"!==op||filter}function convertComparisonOp(property,value,op){switch(property){case"$type":return[`filter-type-${op}`,value];case"$id":return[`filter-id-${op}`,value];default:return[`filter-${op}`,property,value]}}function convertInOp(property,values){if(0===values.length)return!1;switch(property){case"$type":return["filter-type-in",["literal",values]];case"$id":return["filter-id-in",["literal",values]];default:return values.length>200&&!values.some((v=>typeof v!=typeof values[0]))?["filter-in-large",property,["literal",values.sort(compare)]]:["filter-in-small",property,["literal",values]]}}function convertHasOp(property){switch(property){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",property]}}function convertNegation(filter){return["!",filter]}var refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function deref(layer,parent){const result={};for(const k in layer)"ref"!==k&&(result[k]=layer[k]);return refProperties.forEach((k=>{k in parent&&(result[k]=parent[k])})),result}function derefLayers(layers){layers=layers.slice();const map=Object.create(null);for(let i=0;i<layers.length;i++)map[layers[i].id]=layers[i];for(let i=0;i<layers.length;i++)"ref"in layers[i]&&(layers[i]=deref(layers[i],map[layers[i].ref]));return layers}var fontWeights={thin:100,hairline:100,"ultra-light":200,"extra-light":200,light:300,book:300,regular:400,normal:400,plain:400,roman:400,standard:400,medium:500,"semi-bold":600,"demi-bold":600,bold:700,"extra-bold":800,"ultra-bold":800,heavy:900,black:900,"heavy-black":900,fat:900,poster:900,"ultra-black":950,"extra-black":950},italicRE=/(italic|oblique)$/i,fontCache={},mb2css=getDefaultExportFromCjs((function(fonts,size,lineHeight){var cssData=fontCache[fonts];if(!cssData){Array.isArray(fonts)||(fonts=[fonts]);for(var haveWeight,haveStyle,weight=400,style="normal",fontFamilies=[],i=0,ii=fonts.length;i<ii;++i){var parts=fonts[i].split(" "),maybeWeight=parts[parts.length-1].toLowerCase();for(var w in"normal"==maybeWeight||"italic"==maybeWeight||"oblique"==maybeWeight?(style=haveStyle?style:maybeWeight,haveStyle=!0,parts.pop(),maybeWeight=parts[parts.length-1].toLowerCase()):italicRE.test(maybeWeight)&&(maybeWeight=maybeWeight.replace(italicRE,""),style=haveStyle?style:parts[parts.length-1].replace(maybeWeight,""),haveStyle=!0),fontWeights){var previousPart=parts.length>1?parts[parts.length-2].toLowerCase():"";if(maybeWeight==w||maybeWeight==w.replace("-","")||previousPart+"-"+maybeWeight==w){weight=haveWeight?weight:fontWeights[w],parts.pop(),previousPart&&w.startsWith(previousPart)&&parts.pop();break}}haveWeight||"number"!=typeof maybeWeight||(weight=maybeWeight,haveWeight=!0);var fontFamily=parts.join(" ").replace("Klokantech Noto Sans","Noto Sans");-1!==fontFamily.indexOf(" ")&&(fontFamily='"'+fontFamily+'"'),fontFamilies.push(fontFamily)}cssData=fontCache[fonts]=[style,weight,fontFamilies]}return cssData[0]+" "+cssData[1]+" "+size+"px"+(lineHeight?"/"+lineHeight:"")+" "+cssData[2]}));function getMapboxPath(url){return 0!==url.indexOf("mapbox://")?"":url.slice(9)}function normalizeStyleUrl(url,token){const mapboxPath=getMapboxPath(url);if(!mapboxPath)return decodeURI(new URL(url,location.href).href);if(0!==mapboxPath.indexOf("styles/"))throw new Error(`unexpected style url: ${url}`);return`https://api.mapbox.com/styles/v1/${mapboxPath.slice(7)}?&access_token=${token}`}function normalizeSourceUrl(url,token,tokenParam,styleUrl){const urlObject=new URL(url,styleUrl),mapboxPath=getMapboxPath(url);if(!mapboxPath)return token?(urlObject.searchParams.has(tokenParam)||urlObject.searchParams.set(tokenParam,token),decodeURI(urlObject.href)):decodeURI(urlObject.href);if("mapbox.satellite"===mapboxPath){return`https://api.mapbox.com/v4/${mapboxPath}/{z}/{x}/{y}${window.devicePixelRatio>=1.5?"@2x":""}.webp?access_token=${token}`}return`https://{a-d}.tiles.mapbox.com/v4/${mapboxPath}/{z}/{x}/{y}.vector.pbf?access_token=${token}`}const functionCacheByStyleId={},filterCacheByStyleId={};let styleId=0;function getStyleId(glStyle){return glStyle.id||(glStyle.id=styleId++),glStyle.id}function getStyleFunctionKey(glStyle,olLayer){return getStyleId(glStyle)+"."+(0,util.v6)(olLayer)}function getFunctionCache(glStyle){let functionCache=functionCacheByStyleId[glStyle.id];return functionCache||(functionCache={},functionCacheByStyleId[getStyleId(glStyle)]=functionCache),functionCache}function getFilterCache(glStyle){let filterCache=filterCacheByStyleId[glStyle.id];return filterCache||(filterCache={},filterCacheByStyleId[getStyleId(glStyle)]=filterCache),filterCache}function deg2rad(degrees){return degrees*Math.PI/180}const defaultResolutions=function(){const resolutions=[];for(let res=78271.51696402048;resolutions.length<=24;res/=2)resolutions.push(res);return resolutions}();function createCanvas(width,height){if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&"undefined"!=typeof OffscreenCanvas)return new OffscreenCanvas(width,height);const canvas=document.createElement("canvas");return canvas.width=width,canvas.height=height,canvas}function getZoomForResolution(resolution,resolutions){let i=0;const ii=resolutions.length;for(;i<ii;++i){if(resolutions[i]<resolution&&i+1<ii){const zoomFactor=resolutions[i]/resolutions[i+1];return i+Math.log(resolutions[i]/resolution)/Math.log(zoomFactor)}}return ii-1}function getResolutionForZoom(zoom,resolutions){const base=Math.floor(zoom),factor=Math.pow(2,zoom-base);return resolutions[base]/factor}const pendingRequests={};function fetchResource(resourceType,url,options={},metadata){if(url in pendingRequests)return metadata&&(metadata.request=pendingRequests[url][0]),pendingRequests[url][1];const transformedRequest=options.transformRequest&&options.transformRequest(url,resourceType)||url,pendingRequest=(0,functions.hq)((()=>transformedRequest)).then((transformedRequest=>(transformedRequest instanceof Request||(transformedRequest=new Request(transformedRequest)),transformedRequest.headers.get("Accept")||transformedRequest.headers.set("Accept","application/json"),metadata&&(metadata.request=transformedRequest),fetch(transformedRequest).then((function(response){return delete pendingRequests[url],response.ok?response.json():Promise.reject(new Error("Error fetching source "+url))})).catch((function(error){return delete pendingRequests[url],Promise.reject(new Error("Error fetching source "+url))})))));return pendingRequests[url]=[transformedRequest,pendingRequest],pendingRequest}function getGlStyle(glStyleOrUrl,options){if("string"!=typeof glStyleOrUrl)return Promise.resolve(glStyleOrUrl);if(!glStyleOrUrl.trim().startsWith("{"))return fetchResource("Style",glStyleOrUrl=normalizeStyleUrl(glStyleOrUrl,options.accessToken),options);try{const glStyle=JSON.parse(glStyleOrUrl);return Promise.resolve(glStyle)}catch(error){return Promise.reject(error)}}const tilejsonCache={};function getTileJson(glSource,styleUrl,options={}){const cacheKey=[styleUrl,JSON.stringify(glSource)].toString();let promise=tilejsonCache[cacheKey];if(!promise||options.transformRequest){let tileLoadFunction;options.transformRequest&&(tileLoadFunction=(tile,src)=>{const transformedRequest=options.transformRequest&&options.transformRequest(src,"Tiles")||src;if(tile instanceof ol_VectorTile)tile.setLoader(((extent,resolution,projection)=>{(0,functions.hq)((()=>transformedRequest)).then((transformedRequest=>{fetch(transformedRequest).then((response=>response.arrayBuffer())).then((data=>{const features=tile.getFormat().readFeatures(data,{extent,featureProjection:projection});tile.setFeatures(features)})).catch((e=>tile.setState(TileState_ERROR)))}))}));else{const img=tile.getImage();(0,functions.hq)((()=>transformedRequest)).then((transformedRequest=>{transformedRequest instanceof Request?fetch(transformedRequest).then((response=>response.blob())).then((blob=>{const url=URL.createObjectURL(blob);img.addEventListener("load",(()=>URL.revokeObjectURL(url))),img.addEventListener("error",(()=>URL.revokeObjectURL(url))),img.src=url})).catch((e=>tile.setState(TileState_ERROR))):img.src=transformedRequest}))}});const url=glSource.url;if(url&&!glSource.tiles){const normalizedSourceUrl=normalizeSourceUrl(url,options.accessToken,options.accessTokenParam||"access_token",styleUrl||location.href);if(url.startsWith("mapbox://"))promise=Promise.resolve({tileJson:Object.assign({},glSource,{url:void 0,tiles:expandUrl(normalizedSourceUrl)}),tileLoadFunction});else{const metadata={};promise=fetchResource("Source",normalizedSourceUrl,options,metadata).then((function(tileJson){return tileJson.tiles=tileJson.tiles.map((function(tileUrl){return"tms"===tileJson.scheme&&(tileUrl=tileUrl.replace("{y}","{-y}")),normalizeSourceUrl(tileUrl,options.accessToken,options.accessTokenParam||"access_token",metadata.request.url)})),Promise.resolve({tileJson,tileLoadFunction})}))}}else glSource=Object.assign({},glSource,{tiles:glSource.tiles.map((function(tileUrl){return"tms"===glSource.scheme&&(tileUrl=tileUrl.replace("{y}","{-y}")),normalizeSourceUrl(tileUrl,options.accessToken,options.accessTokenParam||"access_token",styleUrl||location.href)}))}),promise=Promise.resolve({tileJson:Object.assign({},glSource),tileLoadFunction});tilejsonCache[cacheKey]=promise}return promise}function drawIconHalo(spriteImage,spriteImageData,haloWidth,haloColor){const imgSize=[2*haloWidth*spriteImageData.pixelRatio+spriteImageData.width,2*haloWidth*spriteImageData.pixelRatio+spriteImageData.height],imageCanvas=createCanvas(imgSize[0],imgSize[1]),imageContext=imageCanvas.getContext("2d");imageContext.drawImage(spriteImage,spriteImageData.x,spriteImageData.y,spriteImageData.width,spriteImageData.height,haloWidth*spriteImageData.pixelRatio,haloWidth*spriteImageData.pixelRatio,spriteImageData.width,spriteImageData.height);const imageData=imageContext.getImageData(0,0,imgSize[0],imgSize[1]);imageContext.globalCompositeOperation="destination-over",imageContext.fillStyle=`rgba(${255*haloColor.r},${255*haloColor.g},${255*haloColor.b},${haloColor.a})`;const data=imageData.data;for(let i=0,ii=imageData.width;i<ii;++i)for(let j=0,jj=imageData.height;j<jj;++j){data[4*(j*ii+i)+3]>0&&imageContext.arc(i,j,haloWidth*spriteImageData.pixelRatio,0,2*Math.PI)}return imageContext.fill(),imageCanvas}function smoothstep(min,max,value){const x=Math.max(0,Math.min(1,(value-min)/(max-min)));return x*x*(3-2*x)}function drawSDF(image,area,color){const imageCanvas=createCanvas(area.width,area.height),imageContext=imageCanvas.getContext("2d");imageContext.drawImage(image,area.x,area.y,area.width,area.height,0,0,area.width,area.height);const imageData=imageContext.getImageData(0,0,area.width,area.height),data=imageData.data;for(let i=0,ii=imageData.width;i<ii;++i)for(let j=0,jj=imageData.height;j<jj;++j){const index=4*(j*ii+i),buffer=.75,gamma=.1,alpha=smoothstep(buffer-gamma,buffer+gamma,data[index+3]/255);alpha>0?(data[index+0]=Math.round(255*color.r*alpha),data[index+1]=Math.round(255*color.g*alpha),data[index+2]=Math.round(255*color.b*alpha),data[index+3]=Math.round(255*alpha)):data[index+3]=0}return imageContext.putImageData(imageData,0,0),imageCanvas}const hairSpacePool=Array(256).join("");function applyLetterSpacing(text,letterSpacing){if(letterSpacing>=.05){let textWithLetterSpacing="";const lines=text.split("\n"),joinSpaceString=hairSpacePool.slice(0,Math.round(letterSpacing/.1));for(let l=0,ll=lines.length;l<ll;++l)l>0&&(textWithLetterSpacing+="\n"),textWithLetterSpacing+=lines[l].split("").join(joinSpaceString);return textWithLetterSpacing}return text}let measureContext;function getMeasureContext(){return measureContext||(measureContext=createCanvas(1,1).getContext("2d")),measureContext}function measureText(text,letterSpacing){return getMeasureContext().measureText(text).width+(text.length-1)*letterSpacing}const measureCache={};function wrapText(text,font,em,letterSpacing){if(-1!==text.indexOf("\n")){const hardLines=text.split("\n"),lines=[];for(let i=0,ii=hardLines.length;i<ii;++i)lines.push(wrapText(hardLines[i],font,em,letterSpacing));return lines.join("\n")}const key=em+","+font+","+text+","+letterSpacing;let wrappedText=measureCache[key];if(!wrappedText){const words=text.split(" ");if(words.length>1){const ctx=getMeasureContext();ctx.font=font;const maxWidth=ctx.measureText("M").width*em;let line="";const lines=[];for(let i=0,ii=words.length;i<ii;++i){const word=words[i],testLine=line+(line?" ":"")+word;measureText(testLine,letterSpacing)<=maxWidth?line=testLine:(line&&lines.push(line),line=word)}line&&lines.push(line);for(let i=0,ii=lines.length;i<ii&&ii>1;++i){const line=lines[i];if(measureText(line,letterSpacing)<.35*maxWidth){const prevWidth=i>0?measureText(lines[i-1],letterSpacing):1/0,nextWidth=i<ii-1?measureText(lines[i+1],letterSpacing):1/0;lines.splice(i,1),ii-=1,prevWidth<nextWidth?(lines[i-1]+=" "+line,i-=1):lines[i]=line+" "+lines[i]}}for(let i=0,ii=lines.length-1;i<ii;++i){const line=lines[i],next=lines[i+1];if(measureText(line,letterSpacing)>.7*maxWidth&&measureText(next,letterSpacing)<.6*maxWidth){const lineWords=line.split(" "),lastWord=lineWords.pop();measureText(lastWord,letterSpacing)<.2*maxWidth&&(lines[i]=lineWords.join(" "),lines[i+1]=lastWord+" "+next),ii-=1}}wrappedText=lines.join("\n")}else wrappedText=text;wrappedText=applyLetterSpacing(wrappedText,letterSpacing),measureCache[key]=wrappedText}return wrappedText}const fontFamilyRegEx=/font-family: ?([^;]*);/,stripQuotesRegEx=/("|')/g;let loadedFontFamilies;function hasFontFamily(family){if(!loadedFontFamilies){loadedFontFamilies={};const styleSheets=document.styleSheets;for(let i=0,ii=styleSheets.length;i<ii;++i){const styleSheet=styleSheets[i];try{const cssRules=styleSheet.rules||styleSheet.cssRules;if(cssRules)for(let j=0,jj=cssRules.length;j<jj;++j){const cssRule=cssRules[j];if(5==cssRule.type){const match=cssRule.cssText.match(fontFamilyRegEx);loadedFontFamilies[match[1].replace(stripQuotesRegEx,"")]=!0}}}catch(e){}}}return family in loadedFontFamilies}const processedFontFamilies={};const types={Point:1,MultiPoint:1,LineString:2,MultiLineString:2,Polygon:3,MultiPolygon:3},dist_anchor={center:[.5,.5],left:[0,.5],right:[1,.5],top:[.5,0],bottom:[.5,1],"top-left":[0,0],"top-right":[1,0],"bottom-left":[0,1],"bottom-right":[1,1]},emptyObj$1={},zoomObj={zoom:0};let renderFeatureCoordinates,dist_renderFeature;function getValue(layer,layoutOrPaint,property,zoom,feature,functionCache,featureState){const layerId=layer.id;functionCache||(functionCache={},console.warn("No functionCache provided to getValue()")),functionCache[layerId]||(functionCache[layerId]={});const functions=functionCache[layerId];if(!functions[property]){let value=(layer[layoutOrPaint]||emptyObj$1)[property];const propertySpec=spec[`${layoutOrPaint}_${layer.type}`][property];void 0===value&&(value=propertySpec.default);let isExpr=function isExpression(expression){return Array.isArray(expression)&&expression.length>0&&"string"==typeof expression[0]&&expression[0]in definitions}(value);if(!isExpr&&isFunction(value)&&(value=convertFunction(value,propertySpec),isExpr=!0),isExpr){const compiledExpression=function(rawExpression,propertySpec){const compiledExpression=createPropertyExpression(rawExpression,propertySpec);if("error"===compiledExpression.result)throw new Error(compiledExpression.value.map((err=>`${err.key}: ${err.message}`)).join(", "));return compiledExpression.value}(value,propertySpec);functions[property]=compiledExpression.evaluate.bind(compiledExpression)}else"color"==propertySpec.type&&(value=Color$1.parse(value)),functions[property]=function(){return value}}return zoomObj.zoom=zoom,functions[property](zoomObj,feature,featureState)}function getDeclutterMode(layer,zoom,feature,prefix,functionCache){if(!getValue(layer,"layout",`${prefix}-allow-overlap`,zoom,feature,functionCache))return"declutter";return getValue(layer,"layout",`${prefix}-ignore-placement`,zoom,feature,functionCache)?"none":"obstacle"}function evaluateFilter(layerId,filter,feature,zoom,filterCache){return filterCache||console.warn("No filterCache provided to evaluateFilter()"),layerId in filterCache||(filterCache[layerId]=createFilter(filter).filter),zoomObj.zoom=zoom,filterCache[layerId](zoomObj,feature)}let renderTransparentEnabled=!1;function colorWithOpacity(color,opacity){if(color){if(!renderTransparentEnabled&&(0===color.a||0===opacity))return;const a=color.a;return opacity=void 0===opacity?1:opacity,0===a?"transparent":"rgba("+Math.round(255*color.r/a)+","+Math.round(255*color.g/a)+","+Math.round(255*color.b/a)+","+a*opacity+")"}return color}const templateRegEx=/\{[^{}}]*\}/g;function fromTemplate(text,properties){return text.replace(templateRegEx,(function(match){return properties[match.slice(1,-1)]||""}))}let recordLayer=!1;const styleFunctionArgs={};function stylefunction(olLayer,glStyle,sourceOrLayers,resolutions=defaultResolutions,spriteData=void 0,spriteImageUrl=void 0,getFonts=void 0,getImage=void 0){if("string"==typeof glStyle&&(glStyle=JSON.parse(glStyle)),8!=glStyle.version)throw new Error("glStyle version 8 required.");let spriteImage,spriteImageSize,spriteImageUnSDFed;if(styleFunctionArgs[getStyleFunctionKey(glStyle,olLayer)]=Array.from(arguments),spriteImageUrl)if("undefined"!=typeof Image){const img=new Image;let blobUrl;(0,functions.hq)((()=>spriteImageUrl)).then((spriteImageUrl=>{spriteImageUrl instanceof Request?fetch(spriteImageUrl).then((response=>response.blob())).then((blob=>{blobUrl=URL.createObjectURL(blob),img.src=blobUrl})).catch((()=>{})):(img.crossOrigin="anonymous",img.src=spriteImageUrl,blobUrl&&URL.revokeObjectURL(blobUrl))})),img.onload=function(){spriteImage=img,spriteImageSize=[img.width,img.height],olLayer.changed(),img.onload=null}}else if("undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope){const worker=self;worker.postMessage({action:"loadImage",src:spriteImageUrl}),worker.addEventListener("message",(function handler(event){"imageLoaded"===event.data.action&&event.data.src===spriteImageUrl&&(spriteImage=event.data.image,spriteImageSize=[spriteImage.width,spriteImage.height])}))}const allLayers=derefLayers(glStyle.layers),layersBySourceLayer={},mapboxLayers=[],iconImageCache={},patternCache={},functionCache=getFunctionCache(glStyle),filterCache=getFilterCache(glStyle);let mapboxSource;for(let i=0,ii=allLayers.length;i<ii;++i){const layer=allLayers[i],layerId=layer.id;if("string"==typeof sourceOrLayers&&layer.source==sourceOrLayers||Array.isArray(sourceOrLayers)&&-1!==sourceOrLayers.indexOf(layerId)){const sourceLayer=layer["source-layer"];if(mapboxSource){if(layer.source!==mapboxSource)throw new Error(`Layer "${layerId}" does not use source "${mapboxSource}`)}else{mapboxSource=layer.source;const source=glStyle.sources[mapboxSource];if(!source)throw new Error(`Source "${mapboxSource}" is not defined`);const type=source.type;if("vector"!==type&&"geojson"!==type)throw new Error(`Source "${mapboxSource}" is not of type "vector" or "geojson", but "${type}"`)}let layers=layersBySourceLayer[sourceLayer];layers||(layers=[],layersBySourceLayer[sourceLayer]=layers),layers.push({layer,index:i}),mapboxLayers.push(layerId)}}const textHalo=new Stroke.A,textColor=new Fill.A,styles=[],styleFunction=function(feature,resolution,onlyLayer){const properties=feature.getProperties(),layers=layersBySourceLayer[properties.layer];if(!layers)return;let zoom=resolutions.indexOf(resolution);-1==zoom&&(zoom=getZoomForResolution(resolution,resolutions));const type=types[feature.getGeometry().getType()],f={id:feature.getId(),properties,type},featureState=olLayer.get("mapbox-featurestate")[feature.getId()];let featureBelongsToLayer,stylesLength=-1;for(let i=0,ii=layers.length;i<ii;++i){const layerData=layers[i],layer=layerData.layer,layerId=layer.id;if(void 0!==onlyLayer&&onlyLayer!==layerId)continue;const layout=layer.layout||emptyObj$1,paint=layer.paint||emptyObj$1;if("none"===layout.visibility||"minzoom"in layer&&zoom<layer.minzoom||"maxzoom"in layer&&zoom>=layer.maxzoom)continue;const filter=layer.filter;if(!filter||evaluateFilter(layerId,filter,f,zoom,filterCache)){let color,opacity,fill,stroke,strokeColor,style;featureBelongsToLayer=layer;const index=layerData.index;if(3==type&&("fill"==layer.type||"fill-extrusion"==layer.type))if(opacity=getValue(layer,"paint",layer.type+"-opacity",zoom,f,functionCache,featureState),layer.type+"-pattern"in paint){const fillIcon=getValue(layer,"paint",layer.type+"-pattern",zoom,f,functionCache,featureState);if(fillIcon){const icon="string"==typeof fillIcon?fromTemplate(fillIcon,properties):fillIcon.toString();if(spriteImage&&spriteData&&spriteData[icon]){++stylesLength,style=styles[stylesLength],style&&style.getFill()&&!style.getStroke()&&!style.getText()||(style=new Style.Ay({fill:new Fill.A}),styles[stylesLength]=style),fill=style.getFill(),style.setZIndex(index);const icon_cache_key=icon+"."+opacity;let pattern=patternCache[icon_cache_key];if(!pattern){const spriteImageData=spriteData[icon],canvas=createCanvas(spriteImageData.width,spriteImageData.height),ctx=canvas.getContext("2d");ctx.globalAlpha=opacity,ctx.drawImage(spriteImage,spriteImageData.x,spriteImageData.y,spriteImageData.width,spriteImageData.height,0,0,spriteImageData.width,spriteImageData.height),pattern=ctx.createPattern(canvas,"repeat"),patternCache[icon_cache_key]=pattern}fill.setColor(pattern)}}}else color=colorWithOpacity(getValue(layer,"paint",layer.type+"-color",zoom,f,functionCache,featureState),opacity),layer.type+"-outline-color"in paint&&(strokeColor=colorWithOpacity(getValue(layer,"paint",layer.type+"-outline-color",zoom,f,functionCache,featureState),opacity)),strokeColor||(strokeColor=color),(color||strokeColor)&&(++stylesLength,style=styles[stylesLength],(!style||color&&!style.getFill()||!color&&style.getFill()||strokeColor&&!style.getStroke()||!strokeColor&&style.getStroke()||style.getText())&&(style=new Style.Ay({fill:color?new Fill.A:void 0,stroke:strokeColor?new Stroke.A:void 0}),styles[stylesLength]=style),color&&(fill=style.getFill(),fill.setColor(color)),strokeColor&&(stroke=style.getStroke(),stroke.setColor(strokeColor),stroke.setWidth(.5)),style.setZIndex(index));if(1!=type&&"line"==layer.type){color="line-pattern"in paint?void 0:colorWithOpacity(getValue(layer,"paint","line-color",zoom,f,functionCache,featureState),getValue(layer,"paint","line-opacity",zoom,f,functionCache,featureState));const width=getValue(layer,"paint","line-width",zoom,f,functionCache,featureState);color&&width>0&&(++stylesLength,style=styles[stylesLength],style&&style.getStroke()&&!style.getFill()&&!style.getText()||(style=new Style.Ay({stroke:new Stroke.A}),styles[stylesLength]=style),stroke=style.getStroke(),stroke.setLineCap(getValue(layer,"layout","line-cap",zoom,f,functionCache,featureState)),stroke.setLineJoin(getValue(layer,"layout","line-join",zoom,f,functionCache,featureState)),stroke.setMiterLimit(getValue(layer,"layout","line-miter-limit",zoom,f,functionCache,featureState)),stroke.setColor(color),stroke.setWidth(width),stroke.setLineDash(paint["line-dasharray"]?getValue(layer,"paint","line-dasharray",zoom,f,functionCache,featureState).map((function(x){return x*width})):null),style.setZIndex(index))}let icon,iconImg,skipLabel,label,font,textLineHeight,textSize,letterSpacing,maxTextWidth,hasImage=!1,text=null,placementAngle=0;if((1==type||2==type)&&"icon-image"in layout){const iconImage=getValue(layer,"layout","icon-image",zoom,f,functionCache,featureState);if(iconImage){let styleGeom;icon="string"==typeof iconImage?fromTemplate(iconImage,properties):iconImage.toString();const imageElement=getImage?getImage(olLayer,icon):void 0;if(spriteImage&&spriteData&&spriteData[icon]||imageElement){const iconRotationAlignment=getValue(layer,"layout","icon-rotation-alignment",zoom,f,functionCache,featureState);if(2==type){const geom=feature.getGeometry();if(geom.getFlatMidpoint||geom.getFlatMidpoints){const extent=geom.getExtent();if(Math.sqrt(Math.max(Math.pow((extent[2]-extent[0])/resolution,2),Math.pow((extent[3]-extent[1])/resolution,2)))>150){const midpoint="MultiLineString"===geom.getType()?geom.getFlatMidpoints():geom.getFlatMidpoint();dist_renderFeature||(renderFeatureCoordinates=[NaN,NaN],dist_renderFeature=new Feature.Ay("Point",renderFeatureCoordinates,[],2,{},void 0)),styleGeom=dist_renderFeature,renderFeatureCoordinates[0]=midpoint[0],renderFeatureCoordinates[1]=midpoint[1];if("line"===getValue(layer,"layout","symbol-placement",zoom,f,functionCache,featureState)&&"map"===iconRotationAlignment){const stride=geom.getStride(),coordinates=geom.getFlatCoordinates();for(let i=0,ii=coordinates.length-stride;i<ii;i+=stride){const x1=coordinates[i],y1=coordinates[i+1],x2=coordinates[i+stride],y2=coordinates[i+stride+1],minX=Math.min(x1,x2),minY=Math.min(y1,y2),maxX=Math.max(x1,x2),maxY=Math.max(y1,y2);if(midpoint[0]>=minX&&midpoint[0]<=maxX&&midpoint[1]>=minY&&midpoint[1]<=maxY){placementAngle=Math.atan2(y1-y2,x2-x1);break}}}}}}if(2!==type||styleGeom){const iconSize=getValue(layer,"layout","icon-size",zoom,f,functionCache,featureState),iconColor=void 0!==paint["icon-color"]?getValue(layer,"paint","icon-color",zoom,f,functionCache,featureState):null;if(!iconColor||0!==iconColor.a){const haloColor=getValue(layer,"paint","icon-halo-color",zoom,f,functionCache,featureState),haloWidth=getValue(layer,"paint","icon-halo-width",zoom,f,functionCache,featureState);let iconCacheKey=`${icon}.${iconSize}.${haloWidth}.${haloColor}`;if(null!==iconColor&&(iconCacheKey+=`.${iconColor}`),iconImg=iconImageCache[iconCacheKey],!iconImg){const declutterMode=getDeclutterMode(layer,zoom,f,"icon",functionCache);let displacement;"icon-offset"in layout&&(displacement=getValue(layer,"layout","icon-offset",zoom,f,functionCache,featureState).slice(0),displacement[0]*=iconSize,displacement[1]*=-iconSize);let color=iconColor?[255*iconColor.r,255*iconColor.g,255*iconColor.b,iconColor.a]:void 0;if(imageElement){const iconOptions={color,rotateWithView:"map"===iconRotationAlignment,displacement,declutterMode,scale:iconSize};"string"==typeof imageElement?iconOptions.src=imageElement:(iconOptions.img=imageElement,iconOptions.imgSize=[imageElement.width,imageElement.height]),iconImg=new style_Icon(iconOptions)}else{const spriteImageData=spriteData[icon];let img,size,offset;haloWidth?spriteImageData.sdf?(img=drawIconHalo(drawSDF(spriteImage,spriteImageData,iconColor||[0,0,0,1]),{x:0,y:0,width:spriteImageData.width,height:spriteImageData.height,pixelRatio:spriteImageData.pixelRatio},haloWidth,haloColor),color=void 0):img=drawIconHalo(spriteImage,spriteImageData,haloWidth,haloColor):(spriteImageData.sdf?(spriteImageUnSDFed||(spriteImageUnSDFed=drawSDF(spriteImage,{x:0,y:0,width:spriteImageSize[0],height:spriteImageSize[1]},{r:1,g:1,b:1,a:1})),img=spriteImageUnSDFed):img=spriteImage,size=[spriteImageData.width,spriteImageData.height],offset=[spriteImageData.x,spriteImageData.y]),iconImg=new style_Icon({color,img,imgSize:spriteImageSize,size,offset,rotateWithView:"map"===iconRotationAlignment,scale:iconSize/spriteImageData.pixelRatio,displacement,declutterMode})}iconImageCache[iconCacheKey]=iconImg}}iconImg&&(++stylesLength,style=styles[stylesLength],style&&style.getImage()&&!style.getFill()&&!style.getStroke()||(style=new Style.Ay,styles[stylesLength]=style),style.setGeometry(styleGeom),iconImg.setRotation(placementAngle+deg2rad(getValue(layer,"layout","icon-rotate",zoom,f,functionCache,featureState))),iconImg.setOpacity(getValue(layer,"paint","icon-opacity",zoom,f,functionCache,featureState)),iconImg.setAnchor(dist_anchor[getValue(layer,"layout","icon-anchor",zoom,f,functionCache,featureState)]),style.setImage(iconImg),text=style.getText(),style.setText(void 0),style.setZIndex(index),hasImage=!0,skipLabel=!1)}else skipLabel=!0}}}if(1==type&&"circle"===layer.type){++stylesLength,style=styles[stylesLength],style&&style.getImage()&&!style.getFill()&&!style.getStroke()||(style=new Style.Ay,styles[stylesLength]=style);const circleRadius="circle-radius"in paint?getValue(layer,"paint","circle-radius",zoom,f,functionCache,featureState):5,circleStrokeColor=colorWithOpacity(getValue(layer,"paint","circle-stroke-color",zoom,f,functionCache,featureState),getValue(layer,"paint","circle-stroke-opacity",zoom,f,functionCache,featureState)),circleTranslate=getValue(layer,"paint","circle-translate",zoom,f,functionCache,featureState),circleColor=colorWithOpacity(getValue(layer,"paint","circle-color",zoom,f,functionCache,featureState),getValue(layer,"paint","circle-opacity",zoom,f,functionCache,featureState)),circleStrokeWidth=getValue(layer,"paint","circle-stroke-width",zoom,f,functionCache,featureState),cache_key=circleRadius+"."+circleStrokeColor+"."+circleColor+"."+circleStrokeWidth+"."+circleTranslate[0]+"."+circleTranslate[1];iconImg=iconImageCache[cache_key],iconImg||(iconImg=new Circle.A({radius:circleRadius,displacement:[circleTranslate[0],-circleTranslate[1]],stroke:circleStrokeColor&&circleStrokeWidth>0?new Stroke.A({width:circleStrokeWidth,color:circleStrokeColor}):void 0,fill:circleColor?new Fill.A({color:circleColor}):void 0,declutterMode:"none"}),iconImageCache[cache_key]=iconImg),style.setImage(iconImg),text=style.getText(),style.setText(void 0),style.setGeometry(void 0),style.setZIndex(index),hasImage=!0}if("text-field"in layout){textSize=Math.round(getValue(layer,"layout","text-size",zoom,f,functionCache,featureState));const fontArray=getValue(layer,"layout","text-font",zoom,f,functionCache,featureState);textLineHeight=getValue(layer,"layout","text-line-height",zoom,f,functionCache,featureState),font=mb2css(getFonts?getFonts(fontArray,glStyle.metadata?glStyle.metadata["ol:webfonts"]:void 0):fontArray,textSize,textLineHeight),font.includes("sans-serif")||(font+=",sans-serif"),letterSpacing=getValue(layer,"layout","text-letter-spacing",zoom,f,functionCache,featureState),maxTextWidth=getValue(layer,"layout","text-max-width",zoom,f,functionCache,featureState);const textField=getValue(layer,"layout","text-field",zoom,f,functionCache,featureState);label="object"==typeof textField&&textField.sections?1===textField.sections.length?textField.toString():textField.sections.reduce(((acc,chunk,i)=>{const fonts=chunk.fontStack?chunk.fontStack.split(","):fontArray,chunkFont=mb2css(getFonts?getFonts(fonts):fonts,textSize*(chunk.scale||1),textLineHeight);let text=chunk.text;if("\n"===text)return acc.push("\n",""),acc;if(2!=type){text=wrapText(text,chunkFont,maxTextWidth,letterSpacing).split("\n");for(let i=0,ii=text.length;i<ii;++i)i>0&&acc.push("\n",""),acc.push(text[i],chunkFont);return acc}acc.push(applyLetterSpacing(text,letterSpacing),chunkFont)}),[]):fromTemplate(textField,properties).trim(),opacity=getValue(layer,"paint","text-opacity",zoom,f,functionCache,featureState)}if(label&&opacity&&!skipLabel){hasImage||(++stylesLength,style=styles[stylesLength],style&&style.getText()&&!style.getFill()&&!style.getStroke()||(style=new Style.Ay,styles[stylesLength]=style),style.setImage(void 0),style.setGeometry(void 0));const declutterMode=getDeclutterMode(layer,zoom,f,"text",functionCache);style.getText()||style.setText(text),text=style.getText(),(!text||"getDeclutterMode"in text&&text.getDeclutterMode()!==declutterMode)&&(text=new style_Text({padding:[2,2,2,2],declutterMode}),style.setText(text));const textTransform=getValue(layer,"layout","text-transform",zoom,f,functionCache,featureState);"uppercase"==textTransform?label=Array.isArray(label)?label.map(((t,i)=>i%2?t:t.toUpperCase())):label.toUpperCase():"lowercase"==textTransform&&(label=Array.isArray(label)?label.map(((t,i)=>i%2?t:t.toLowerCase())):label.toLowerCase());const wrappedLabel=Array.isArray(label)?label:2==type?applyLetterSpacing(label,letterSpacing):wrapText(label,font,maxTextWidth,letterSpacing);text.setText(wrappedLabel),text.setFont(font),text.setRotation(deg2rad(getValue(layer,"layout","text-rotate",zoom,f,functionCache,featureState)));const textAnchor=getValue(layer,"layout","text-anchor",zoom,f,functionCache,featureState),placement=hasImage||1==type?"point":getValue(layer,"layout","symbol-placement",zoom,f,functionCache,featureState);let textAlign;if("line-center"===placement?(text.setPlacement("line"),textAlign="center"):text.setPlacement(placement),"line"===placement&&"function"==typeof text.setRepeat){const symbolSpacing=getValue(layer,"layout","symbol-spacing",zoom,f,functionCache,featureState);text.setRepeat(2*symbolSpacing)}text.setOverflow("point"===placement);let textHaloWidth=getValue(layer,"paint","text-halo-width",zoom,f,functionCache,featureState);const textOffset=getValue(layer,"layout","text-offset",zoom,f,functionCache,featureState),textTranslate=getValue(layer,"paint","text-translate",zoom,f,functionCache,featureState);let vOffset=0,hOffset=0;if("point"==placement){textAlign="center",-1!==textAnchor.indexOf("left")?(textAlign="left",hOffset=textHaloWidth):-1!==textAnchor.indexOf("right")&&(textAlign="right",hOffset=-textHaloWidth);const textRotationAlignment=getValue(layer,"layout","text-rotation-alignment",zoom,f,functionCache,featureState);text.setRotateWithView("map"==textRotationAlignment)}else text.setMaxAngle(deg2rad(getValue(layer,"layout","text-max-angle",zoom,f,functionCache,featureState))*label.length/wrappedLabel.length),text.setRotateWithView(!1);text.setTextAlign(textAlign);let textBaseline="middle";0==textAnchor.indexOf("bottom")?(textBaseline="bottom",vOffset=-textHaloWidth-.5*(textLineHeight-1)*textSize):0==textAnchor.indexOf("top")&&(textBaseline="top",vOffset=textHaloWidth+.5*(textLineHeight-1)*textSize),text.setTextBaseline(textBaseline);const textJustify=getValue(layer,"layout","text-justify",zoom,f,functionCache,featureState);text.setJustify("auto"===textJustify?void 0:textJustify),text.setOffsetX(textOffset[0]*textSize+hOffset+textTranslate[0]),text.setOffsetY(textOffset[1]*textSize+vOffset+textTranslate[1]),textColor.setColor(colorWithOpacity(getValue(layer,"paint","text-color",zoom,f,functionCache,featureState),opacity)),text.setFill(textColor);const haloColor=colorWithOpacity(getValue(layer,"paint","text-halo-color",zoom,f,functionCache,featureState),opacity);if(haloColor&&textHaloWidth>0){textHalo.setColor(haloColor),textHaloWidth*=2;const halfTextSize=.5*textSize;textHalo.setWidth(textHaloWidth<=halfTextSize?textHaloWidth:halfTextSize),text.setStroke(textHalo)}else text.setStroke(void 0);const textPadding=getValue(layer,"layout","text-padding",zoom,f,functionCache,featureState),padding=text.getPadding();textPadding!==padding[0]&&(padding[0]=textPadding,padding[1]=textPadding,padding[2]=textPadding,padding[3]=textPadding),style.setZIndex(index)}}}return stylesLength>-1?(styles.length=stylesLength+1,recordLayer&&("set"in feature?feature.set("mapbox-layer",featureBelongsToLayer):feature.getProperties()["mapbox-layer"]=featureBelongsToLayer),styles):void 0};return olLayer.setStyle(styleFunction),olLayer.set("mapbox-source",mapboxSource),olLayer.set("mapbox-layers",mapboxLayers),olLayer.set("mapbox-featurestate",olLayer.get("mapbox-featurestate")||{}),styleFunction}function getTileResolutions(projection,tileSize=512){return projection.getExtent()?createXYZ({extent:projection.getExtent(),tileSize,maxZoom:22}).getResolutions():defaultResolutions}function completeOptions(styleUrl,options){if(!options.accessToken){options=Object.assign({},options);new URL(styleUrl).searchParams.forEach(((value,key)=>{options.accessToken=value,options.accessTokenParam=key}))}return options}function applyStyle(layer,glStyle,sourceOrLayersOrOptions="",optionsOrPath={},resolutions=void 0){let styleUrl,sourceId,options,sourceOrLayers,updateSource=!0;return"string"==typeof sourceOrLayersOrOptions||Array.isArray(sourceOrLayersOrOptions)?sourceOrLayers=sourceOrLayersOrOptions:(options=sourceOrLayersOrOptions,sourceOrLayers=options.source||options.layers,optionsOrPath=options),"string"==typeof optionsOrPath?(styleUrl=optionsOrPath,options={}):(styleUrl=optionsOrPath.styleUrl,options=optionsOrPath),!1===options.updateSource&&(updateSource=!1),resolutions||(resolutions=options.resolutions),styleUrl||"string"!=typeof glStyle||glStyle.trim().startsWith("{")||(styleUrl=glStyle),styleUrl&&(styleUrl=styleUrl.startsWith("data:")?location.href:normalizeStyleUrl(styleUrl,options.accessToken),options=completeOptions(styleUrl,options)),new Promise((function(resolve,reject){getGlStyle(glStyle,options).then((function(glStyle){if(8!=glStyle.version)return reject(new Error("glStyle version 8 required."));if(!(layer instanceof Vector||layer instanceof VectorTile))return reject(new Error("Can only apply to VectorLayer or VectorTileLayer"));const type=layer instanceof VectorTile?"vector":"geojson";if(sourceOrLayers?sourceId=Array.isArray(sourceOrLayers)?glStyle.layers.find((function(layer){return layer.id===sourceOrLayers[0]})).source:sourceOrLayers:(sourceId=Object.keys(glStyle.sources).find((function(key){return glStyle.sources[key].type===type})),sourceOrLayers=sourceId),!sourceId)return reject(new Error(`No ${type} source found in the glStyle.`));function assignSource(){if(!updateSource)return Promise.resolve();if(layer instanceof VectorTile)return setupVectorSource(glStyle.sources[sourceId],styleUrl,options).then((function(source){const targetSource=layer.getSource();targetSource?source!==targetSource&&(targetSource.setTileUrlFunction(source.getTileUrlFunction()),"function"==typeof targetSource.setUrls&&"function"==typeof source.getUrls&&targetSource.setUrls(source.getUrls()),targetSource.format_||(targetSource.format_=source.format_),targetSource.getAttributions()||targetSource.setAttributions(source.getAttributions()),targetSource.getTileLoadFunction()===defaultLoadFunction&&targetSource.setTileLoadFunction(source.getTileLoadFunction()),(0,ol_proj.tI)(targetSource.getProjection(),source.getProjection())&&(targetSource.tileGrid=source.getTileGrid())):layer.setSource(source);const tileGrid=layer.getSource().getTileGrid();!isFinite(layer.getMaxResolution())&&!isFinite(layer.getMinZoom())&&tileGrid.getMinZoom()>0&&layer.setMaxResolution(getResolutionForZoom(Math.max(0,tileGrid.getMinZoom()-1e-12),tileGrid.getResolutions()))}));const glSource=glStyle.sources[sourceId];let source=layer.getSource();source&&source.get("mapbox-source")===glSource||(source=setupGeoJSONSource(glSource,styleUrl,options));const targetSource=layer.getSource();return targetSource?source!==targetSource&&(targetSource.getAttributions()||targetSource.setAttributions(source.getAttributions()),targetSource.format_||(targetSource.format_=source.getFormat()),targetSource.url_=source.getUrl()):layer.setSource(source),Promise.resolve()}let spriteScale,spriteData,spriteImageUrl,style;function onChange(){if(style||glStyle.sprite&&!spriteData)style?(layer.setStyle(style),assignSource().then(resolve).catch(reject)):reject(new Error("Something went wrong trying to apply style."));else{if(options.projection&&!resolutions){const units=(0,ol_proj.Jt)(options.projection).getUnits();"m"!==units&&(resolutions=defaultResolutions.map((resolution=>resolution/Units.I[units])))}style=stylefunction(layer,glStyle,sourceOrLayers,resolutions,spriteData,spriteImageUrl,((fonts,templateUrl=options.webfonts)=>function getFonts(fonts,templateUrl="https://cdn.jsdelivr.net/npm/@fontsource/{font-family}/{fontweight}{-fontstyle}.css"){const fontsKey=fonts.toString();if(fontsKey in processedFontFamilies)return processedFontFamilies[fontsKey];const fontDescriptions=[];for(let i=0,ii=fonts.length;i<ii;++i){fonts[i]=fonts[i].replace("Arial Unicode MS","Arial");const font=fonts[i],cssFont=mb2css(font,1);(0,render_canvas.fZ)(cssFont);const parts=cssFont.split(" ");fontDescriptions.push([parts.slice(3).join(" ").replace(/"/g,""),parts[1],parts[0]])}for(let i=0,ii=fontDescriptions.length;i<ii;++i){const fontDescription=fontDescriptions[i],family=fontDescription[0];if(!hasFontFamily(family)&&100!==render_canvas.yY.get(`${fontDescription[2]}\n${fontDescription[1]} \n${family}`)){const fontUrl=templateUrl.replace("{font-family}",family.replace(/ /g,"-").toLowerCase()).replace("{Font+Family}",family.replace(/ /g,"+")).replace("{fontweight}",fontDescription[1]).replace("{-fontstyle}",fontDescription[2].replace("normal","").replace(/(.+)/,"-$1")).replace("{fontstyle}",fontDescription[2]);if(!document.querySelector('link[href="'+fontUrl+'"]')){const markup=document.createElement("link");markup.href=fontUrl,markup.rel="stylesheet",document.head.appendChild(markup)}}}return processedFontFamilies[fontsKey]=fonts,fonts}(fonts,templateUrl)),options.getImage),layer.getStyle()?assignSource().then(resolve).catch(reject):reject(new Error(`Nothing to show for source [${sourceId}]`))}}if(glStyle.sprite){const sprite=new URL(function normalizeSpriteUrl(url,token,styleUrl){const mapboxPath=getMapboxPath(url);if(!mapboxPath)return decodeURI(new URL(url,styleUrl).href);if(0!==mapboxPath.indexOf("sprites/"))throw new Error(`unexpected sprites url: ${url}`);return`https://api.mapbox.com/styles/v1/${mapboxPath.slice(8)}/sprite?access_token=${token}`}(glStyle.sprite,options.accessToken,styleUrl||location.href));spriteScale=window.devicePixelRatio>=1.5?.5:1;const sizeFactor=.5==spriteScale?"@2x":"";let spriteUrl=sprite.origin+sprite.pathname+sizeFactor+".json"+sprite.search;new Promise((function(resolve,reject){fetchResource("Sprite",spriteUrl,options).then(resolve).catch((function(error){spriteUrl=sprite.origin+sprite.pathname+".json"+sprite.search,fetchResource("Sprite",spriteUrl,options).then(resolve).catch(reject)}))})).then((function(spritesJson){if(void 0===spritesJson&&reject(new Error("No sprites found.")),spriteData=spritesJson,spriteImageUrl=sprite.origin+sprite.pathname+sizeFactor+".png"+sprite.search,options.transformRequest){const transformed=options.transformRequest(spriteImageUrl,"SpriteImage")||spriteImageUrl;(transformed instanceof Request||transformed instanceof Promise)&&(spriteImageUrl=transformed)}onChange()})).catch((function(err){reject(new Error(`Sprites cannot be loaded: ${spriteUrl}: ${err.message}`))}))}else onChange()})).catch(reject)}))}const emptyObj={};function applyBackground(mapOrLayer,glStyle,options={}){return getGlStyle(glStyle,options).then((function(glStyle){!function setFirstBackground(mapOrLayer,glStyle,options){glStyle.layers.some((function(layer){if("background"===layer.type){if(mapOrLayer instanceof layer_Layer)return mapOrLayer.setBackground((function(resolution){return getBackgroundColor(layer,resolution,options,{})})),!0;if(mapOrLayer instanceof ol_Map||mapOrLayer instanceof Group)return mapOrLayer.getLayers().insertAt(0,setupBackgroundLayer(layer,options,{})),!0}}))}(mapOrLayer,glStyle,options)}))}function sourceOptionsFromTileJSON(glSource,tileJSON,options){const tileJSONSource=new source_TileJSON({tileJSON,tileSize:glSource.tileSize||tileJSON.tileSize||512}),tileJSONDoc=tileJSONSource.getTileJSON(),tileGrid=tileJSONSource.getTileGrid(),projection=(0,ol_proj.Jt)(options.projection||"EPSG:3857"),extent=function extentFromTileJSON(tileJSON,projection){const bounds=tileJSON.bounds;if(bounds){const ll=(0,ol_proj.Rb)([bounds[0],bounds[1]],projection),tr=(0,ol_proj.Rb)([bounds[2],bounds[3]],projection);return[ll[0],ll[1],tr[0],tr[1]]}return(0,ol_proj.Jt)(projection).getExtent()}(tileJSONDoc,projection),projectionExtent=projection.getExtent(),minZoom=tileJSONDoc.minzoom||0,maxZoom=tileJSONDoc.maxzoom||22,sourceOptions={attributions:tileJSONSource.getAttributions(),projection,tileGrid:new TileGrid.A({origin:projectionExtent?(0,ol_extent.Py)(projectionExtent):tileGrid.getOrigin(0),extent:extent||tileGrid.getExtent(),minZoom,resolutions:getTileResolutions(projection,tileJSON.tileSize).slice(0,maxZoom+1),tileSize:tileGrid.getTileSize(0)})};return Array.isArray(tileJSONDoc.tiles)?sourceOptions.urls=tileJSONDoc.tiles:sourceOptions.url=tileJSONDoc.tiles,sourceOptions}function getBackgroundColor(glLayer,resolution,options,functionCache){const background={id:glLayer.id,type:glLayer.type},layout=glLayer.layout||{},paint=glLayer.paint||{};background.paint=paint;const zoom=getZoomForResolution(resolution,options.resolutions||defaultResolutions);let opacity;const bg=getValue(background,"paint","background-color",zoom,emptyObj,functionCache);return void 0!==paint["background-opacity"]&&(opacity=getValue(background,"paint","background-opacity",zoom,emptyObj,functionCache)),"none"==layout.visibility?void 0:colorWithOpacity(bg,opacity)}function setupBackgroundLayer(glLayer,options,functionCache){const div=document.createElement("div");return div.className="ol-mapbox-style-background",div.style.position="absolute",div.style.width="100%",div.style.height="100%",new layer_Layer({source:new source_Source({}),render(frameState){const color=getBackgroundColor(glLayer,frameState.viewState.resolution,options,functionCache);return div.style.backgroundColor=color,div}})}function setupVectorSource(glSource,styleUrl,options){return new Promise((function(resolve,reject){getTileJson(glSource,styleUrl,options).then((function({tileJson,tileLoadFunction}){const sourceOptions=sourceOptionsFromTileJSON(glSource,tileJson,options);sourceOptions.tileLoadFunction=tileLoadFunction,sourceOptions.format=new format_MVT,resolve(new source_VectorTile(sourceOptions))})).catch(reject)}))}function getBboxTemplate(projection){return`{bbox-${(projection?projection.getCode():"EPSG:3857").toLowerCase().replace(/[^a-z0-9]/g,"-")}}`}function setupGeoJSONSource(glSource,styleUrl,options){const geoJsonFormat=options.projection?new GeoJSON.A({dataProjection:options.projection}):new GeoJSON.A,data=glSource.data,sourceOptions={};if("string"==typeof data){const geoJsonUrl=normalizeSourceUrl(data,options.accessToken,options.accessTokenParam||"access_token",styleUrl||location.href);if(/\{bbox-[0-9a-z-]+\}/.test(geoJsonUrl)){const extentUrl=(extent,resolution,projection)=>{const bboxTemplate=getBboxTemplate(projection);return geoJsonUrl.replace(bboxTemplate,`${extent.join(",")}`)},source=new source_Vector({attributions:glSource.attribution,format:geoJsonFormat,loader:(extent,resolution,projection,success,failure)=>{fetchResource("GeoJSON","function"==typeof extentUrl?extentUrl(extent,resolution,projection):extentUrl,options).then((json=>{const features=source.getFormat().readFeatures(json,{featureProjection:projection});source.addFeatures(features),success(features)})).catch((response=>{source.removeLoadedExtent(extent),failure()}))},strategy:bbox});return source.set("mapbox-source",glSource),source}const source=new source_Vector({attributions:glSource.attribution,format:geoJsonFormat,url:geoJsonUrl,loader:(extent,resolution,projection,success,failure)=>{fetchResource("GeoJSON",geoJsonUrl,options).then((json=>{const features=source.getFormat().readFeatures(json,{featureProjection:projection});source.addFeatures(features),success(features)})).catch((response=>{source.removeLoadedExtent(extent),failure()}))}});return source}sourceOptions.features=geoJsonFormat.readFeatures(data,{featureProjection:(0,ol_proj.Tf)()||"EPSG:3857"});const source=new source_Vector(Object.assign({attributions:glSource.attribution,format:geoJsonFormat},sourceOptions));return source.set("mapbox-source",glSource),source}class ErrorEvent extends Event.Ay{constructor(error){super(EventType.A.ERROR),this.error=error}}class MapboxVectorLayer extends VectorTile{constructor(options){const declutter=!("declutter"in options)||options.declutter,source=new source_VectorTile({state:"loading",format:new format_MVT});super({source,background:!1===options.background?null:options.background,declutter,className:options.className,opacity:options.opacity,visible:options.visible,zIndex:options.zIndex,minResolution:options.minResolution,maxResolution:options.maxResolution,minZoom:options.minZoom,maxZoom:options.maxZoom,renderOrder:options.renderOrder,renderBuffer:options.renderBuffer,renderMode:options.renderMode,map:options.map,updateWhileAnimating:options.updateWhileAnimating,updateWhileInteracting:options.updateWhileInteracting,preload:options.preload,useInterimTilesOnError:options.useInterimTilesOnError,properties:options.properties}),options.accessToken&&(this.accessToken=options.accessToken);const promises=[applyStyle(this,options.styleUrl,options.layers||options.source,{accessToken:this.accessToken})];void 0===this.getBackground()&&promises.push(applyBackground(this,options.styleUrl,{accessToken:this.accessToken})),Promise.all(promises).then((()=>{source.setState("ready")})).catch((error=>{this.dispatchEvent(new ErrorEvent(error));this.getSource().setState("error")}))}}var __awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const GEOJSON=new GeoJSON.A,WFS_MAX_FEATURES=1e4;function createLayer(layerModel){var _a,_b,_c,_d,_e;return __awaiter(this,void 0,void 0,(function*(){const{type}=layerModel;let layer;switch(type){case"xyz":layer=new layer_Tile({source:new source_XYZ({url:layerModel.url,attributions:layerModel.attributions})});break;case"wms":layer=new layer_Tile({source:new source_TileWMS({url:(0,dist.jc)(layerModel.url,["request","service"]),params:Object.assign({LAYERS:layerModel.name},layerModel.style&&{STYLES:layerModel.style}),gutter:20,attributions:layerModel.attributions})});break;case"wmts":{const olLayer=new layer_Tile({});return new ogc_client_dist.bf(layerModel.url).isReady().then((endpoint=>__awaiter(this,void 0,void 0,(function*(){var _f;const layerName=null!==(_f=endpoint.getSingleLayerName())&&void 0!==_f?_f:layerModel.name,layer=endpoint.getLayerByName(layerName),matrixSet=layer.matrixSets[0],tileGrid=yield endpoint.getOpenLayersTileGrid(layer.name);if(null===tileGrid)return void console.warn("A WMTS tile grid could not be created",layerModel);const resourceUrl=layer.resourceLinks[0],dimensions=endpoint.getDefaultDimensions(layer.name);olLayer.setSource(new source_WMTS({layer:layer.name,style:layer.defaultStyle,matrixSet:matrixSet.identifier,format:resourceUrl.format,url:resourceUrl.url,requestEncoding:resourceUrl.encoding,tileGrid,projection:matrixSet.crs,dimensions,attributions:layerModel.attributions}))})))),olLayer}case"wfs":{const olLayer=new Vector({style:null!==(_a=layerModel.style)&&void 0!==_a?_a:defaultStyle});new ogc_client_dist.ym(layerModel.url).isReady().then((endpoint=>{var _a;const featureType=null!==(_a=endpoint.getSingleFeatureTypeName())&&void 0!==_a?_a:layerModel.featureType;olLayer.setSource(new source_Vector({format:new GeoJSON.A,url:function(extent){return endpoint.getFeatureUrl(featureType,{maxFeatures:WFS_MAX_FEATURES,asJson:!0,outputCrs:"EPSG:3857",extent,extentCrs:"EPSG:3857"})},strategy:bbox,attributions:layerModel.attributions}))})),layer=olLayer;break}case"maplibre-style":layer=new MapboxVectorLayer({styleUrl:layerModel.styleUrl,accessToken:layerModel.accessToken});break;case"geojson":if(void 0!==layerModel.url)layer=new Vector({source:new source_Vector({format:new GeoJSON.A,url:layerModel.url,attributions:layerModel.attributions}),style:null!==(_b=layerModel.style)&&void 0!==_b?_b:defaultStyle});else{let geojson=layerModel.data;if("string"==typeof geojson)try{geojson=JSON.parse(geojson)}catch(e){console.warn("A layer could not be created",layerModel,e),geojson={type:"FeatureCollection",features:[]}}const features=GEOJSON.readFeatures(geojson,{featureProjection:"EPSG:3857",dataProjection:"EPSG:4326"});layer=new Vector({source:new source_Vector({features,attributions:layerModel.attributions}),style:null!==(_c=layerModel.style)&&void 0!==_c?_c:defaultStyle})}break;case"ogcapi":{const ogcEndpoint=new ogc_client_dist.TL(layerModel.url);let layerUrl;layerModel.useTiles?"vector"===layerModel.useTiles?(layerUrl=yield ogcEndpoint.getVectorTilesetUrl(layerModel.collection,layerModel.tileMatrixSet),layer=new VectorTile({source:new source_OGCVectorTile({url:layerUrl,format:new format_MVT,attributions:layerModel.attributions})})):"map"===layerModel.useTiles&&(layerUrl=yield ogcEndpoint.getMapTilesetUrl(layerModel.collection,layerModel.tileMatrixSet),layer=new layer_Tile({source:new source_OGCMapTile({url:layerUrl,attributions:layerModel.attributions})})):(layerUrl=yield ogcEndpoint.getCollectionItemsUrl(layerModel.collection,layerModel.options),layer=new Vector({source:new source_Vector({format:new GeoJSON.A,url:layerUrl,attributions:layerModel.attributions}),style:null!==(_d=layerModel.style)&&void 0!==_d?_d:defaultStyle}));break}default:throw new Error(`Unrecognized layer type: ${JSON.stringify(layerModel)}`)}if(!layer)throw new Error(`Layer could not be created for type: ${layerModel.type}`);return void 0!==layerModel.visibility&&layer.setVisible(layerModel.visibility),void 0!==layerModel.opacity&&layer.setOpacity(layerModel.opacity),void 0!==layerModel.attributions&&(null===(_e=layer.getSource())||void 0===_e||_e.setAttributions(layerModel.attributions)),layer.set("label",layerModel.label),layer}))}function createView(viewModel,map){if(null===viewModel)return new ol_View({center:[0,0],zoom:0});const view=new ol_View(Object.assign(Object.assign(Object.assign({},"maxExtent"in viewModel&&{extent:viewModel.maxExtent}),"maxZoom"in viewModel&&{maxZoom:viewModel.maxZoom}),{multiWorld:!1,constrainResolution:!0}));if("geometry"in viewModel){const geom=GEOJSON.readGeometry(viewModel.geometry);view.fit(geom,{size:map.getSize()})}else if("extent"in viewModel)view.fit(viewModel.extent,{size:map.getSize()});else{const{center:centerInViewProj,zoom}=viewModel,center=centerInViewProj?(0,ol_proj.Rb)(centerInViewProj,"EPSG:3857"):[0,0];view.setCenter(center),view.setZoom(void 0!==zoom?zoom:0)}return view}function createMapFromContext(context,target){return __awaiter(this,void 0,void 0,(function*(){const map=new ol_Map({target});return yield function resetMapFromContext(map,context){return __awaiter(this,void 0,void 0,(function*(){map.setView(createView(context.view,map)),map.getLayers().clear();for(const layerModel of context.layers){const layer=yield createLayer(layerModel);map.addLayer(layer)}return map}))}(map,context)}))}var apply_context_diff_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const apply_context_diff_GEOJSON=new GeoJSON.A;function applyContextDiffToMap(map,contextDiff){return apply_context_diff_awaiter(this,void 0,void 0,(function*(){const layers=map.getLayers();if(contextDiff.layersRemoved.length>0){const removed=contextDiff.layersRemoved.sort(((a,b)=>b.position-a.position));for(const layerRemoved of removed)layers.item(layerRemoved.position).dispose(),layers.removeAt(layerRemoved.position)}if((yield Promise.all(contextDiff.layersAdded.map((layerAdded=>createLayer(layerAdded.layer))))).forEach(((layer,index)=>{const position=contextDiff.layersAdded[index].position;position>=layers.getLength()?layers.push(layer):layers.insertAt(position,layer)})),contextDiff.layersReordered.length>0){const reordered=contextDiff.layersReordered.sort(((a,b)=>a.newPosition-b.newPosition)),olLayers=reordered.map((layer=>layers.item(layer.previousPosition))),layersArray=layers.getArray();for(let i=0;i<reordered.length;i++)layersArray[reordered[i].newPosition]=olLayers[i];map.setLayers([...layersArray])}for(const layerChanged of contextDiff.layersChanged)layers.item(layerChanged.position).dispose(),createLayer(layerChanged.layer).then((layer=>{layers.setAt(layerChanged.position,layer)}));if(void 0!==contextDiff.viewChanges){const{viewChanges}=contextDiff,view=map.getView(),projection=view.getProjection();if(null===viewChanges)return map.setView(createView(viewChanges,map)),map;if(viewChanges.maxZoom&&view.setMaxZoom(viewChanges.maxZoom),"geometry"in viewChanges){const geom=apply_context_diff_GEOJSON.readGeometry(viewChanges.geometry,{dataProjection:"EPSG:4326",featureProjection:projection});view.fit(geom,{size:map.getSize()})}else if("extent"in viewChanges)view.fit((0,ol_proj.DI)(viewChanges.extent,"EPSG:4326",projection),{size:map.getSize()});else{const{center:centerInViewProj,zoom}=viewChanges,center=centerInViewProj?(0,ol_proj.Rb)(centerInViewProj,projection):[0,0];view.setCenter(center),view.setZoom(zoom)}}return map}))}const source_ImageWMS=class ImageWMS extends source_Image{constructor(options){super({attributions:(options=options||{}).attributions,interpolate:options.interpolate,projection:options.projection,resolutions:options.resolutions}),this.crossOrigin_=void 0!==options.crossOrigin?options.crossOrigin:null,this.url_=options.url,this.imageLoadFunction_=void 0!==options.imageLoadFunction?options.imageLoadFunction:defaultImageLoadFunction,this.params_=options.params,this.serverType_=options.serverType,this.hidpi_=void 0===options.hidpi||options.hidpi,this.renderedRevision_=0,this.ratio_=void 0!==options.ratio?options.ratio:1.5,this.loaderProjection_=null}getFeatureInfoUrl(coordinate,resolution,projection,params){const projectionObj=(0,ol_proj.Jt)(projection),sourceProjectionObj=this.getProjection();sourceProjectionObj&&sourceProjectionObj!==projectionObj&&(resolution=calculateSourceResolution(sourceProjectionObj,projectionObj,coordinate,resolution),coordinate=(0,ol_proj.pd)(coordinate,projectionObj,sourceProjectionObj));return function getFeatureInfoUrl(options,coordinate,resolution){if(void 0===options.url)return;const projectionObj=(0,ol_proj.Jt)(options.projection||"EPSG:3857"),extent=(0,ol_extent.Bg)(coordinate,resolution,0,GETFEATUREINFO_IMAGE_SIZE),baseParams={QUERY_LAYERS:options.params.LAYERS,INFO_FORMAT:"application/json"};Object.assign(baseParams,getRequestParams(options.params,"GetFeatureInfo"),options.params);const x=(0,math.RI)((coordinate[0]-extent[0])/resolution,4),y=(0,math.RI)((extent[3]-coordinate[1])/resolution,4),v13=compareVersions(baseParams.VERSION,"1.3")>=0;return baseParams[v13?"I":"X"]=x,baseParams[v13?"J":"Y"]=y,getRequestUrl(options.url,extent,GETFEATUREINFO_IMAGE_SIZE,projectionObj,baseParams)}({url:this.url_,params:{...this.params_,...params},projection:sourceProjectionObj||projectionObj},coordinate,resolution)}getLegendUrl(resolution,params){return function getLegendUrl(options,resolution){if(void 0===options.url)return;const baseParams={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetLegendGraphic",FORMAT:"image/png"};if(void 0===options.params||void 0===options.params.LAYER){const layers=options.params.LAYERS;if(Array.isArray(layers)&&1!==layers.length)return;baseParams.LAYER=layers}if(void 0!==resolution){const mpu=(0,ol_proj.Jt)(options.projection||"EPSG:3857").getMetersPerUnit()||1,pixelSize=28e-5;baseParams.SCALE=resolution*mpu/pixelSize}return Object.assign(baseParams,options.params),appendParams(options.url,baseParams)}({url:this.url_,params:{...this.params_,...params}},resolution)}getParams(){return this.params_}getImageInternal(extent,resolution,pixelRatio,projection){return void 0===this.url_?null:(this.loader&&this.loaderProjection_===projection||(this.loaderProjection_=projection,this.loader=function createLoader(options){const hidpi=void 0===options.hidpi||options.hidpi,projection=(0,ol_proj.Jt)(options.projection||"EPSG:3857"),ratio=options.ratio||1.5,load=options.load||decode;return(extent,resolution,pixelRatio)=>{extent=getRequestExtent(extent,resolution,pixelRatio,ratio),1==pixelRatio||hidpi&&void 0!==options.serverType||(pixelRatio=1);const src=getImageSrc(extent,resolution,pixelRatio,projection,options.url,getRequestParams(options.params,"GetMap"),options.serverType),image=new Image;return null!==options.crossOrigin&&(image.crossOrigin=options.crossOrigin),load(image,src).then((image=>({image,extent,pixelRatio})))}}({crossOrigin:this.crossOrigin_,params:this.params_,projection,serverType:this.serverType_,hidpi:this.hidpi_,url:this.url_,ratio:this.ratio_,load:(image,src)=>(this.image.setImage(image),this.imageLoadFunction_(this.image,src),decode(image))})),super.getImageInternal(extent,resolution,pixelRatio,projection))}getImageLoadFunction(){return this.imageLoadFunction_}getUrl(){return this.url_}setImageLoadFunction(imageLoadFunction){this.imageLoadFunction_=imageLoadFunction,this.changed()}setUrl(url){url!=this.url_&&(this.url_=url,this.loader=null,this.changed())}updateParams(params){Object.assign(this.params_,params),this.changed()}changed(){this.image=null,super.changed()}};var lodash_throttle=__webpack_require__("./node_modules/lodash.throttle/index.js"),lodash_throttle_default=__webpack_require__.n(lodash_throttle),register_events_awaiter=function(thisArg,_arguments,P,generator){return new(P||(P=Promise))((function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator.throw(value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):function adopt(value){return value instanceof P?value:new P((function(resolve){resolve(value)}))}(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())}))};const register_events_GEOJSON=new GeoJSON.A;function getFeaturesFromVectorSources(olMap,pixel){const olFeatures=olMap.getFeaturesAtPixel(pixel),{features}=register_events_GEOJSON.writeFeaturesObject(olFeatures);return features||[]}const getFeaturesFromWmsSourcesThrottled=lodash_throttle_default()((function getFeaturesFromWmsSources(olMap,coordinate){const wmsSources=olMap.getLayers().getArray().filter((layer=>layer instanceof layer_Layer&&(layer.getSource()instanceof source_TileWMS||layer.getSource()instanceof source_ImageWMS))).map((layer=>layer.getSource()));if(!wmsSources.length)return Promise.resolve([]);const gfiUrls=wmsSources.reduce(((urls,source)=>{const gfiUrl=function getGFIUrl(source,map,coordinate){var _a;const view=map.getView(),projection=view.getProjection(),resolution=view.getResolution(),params=Object.assign(Object.assign({},source.getParams()),{INFO_FORMAT:"application/json"});return null!==(_a=source.getFeatureInfoUrl(coordinate,resolution,projection,params))&&void 0!==_a?_a:null}(source,olMap,coordinate);return gfiUrl?[...urls,gfiUrl]:urls}),[]);return Promise.all(gfiUrls.map((url=>fetch(url).then((response=>response.json())).then((collection=>collection.features))))).then((features=>features.flat()))}),250);function readFeaturesAtPixel(map,event){return register_events_awaiter(this,void 0,void 0,(function*(){return[...getFeaturesFromVectorSources(map,event.pixel),...yield getFeaturesFromWmsSourcesThrottled(map,event.coordinate)]}))}function listen(map,eventType,callback){switch(eventType){case dist.QS:!function registerFeatureClickEvent(map){map.get(dist.QS)||(map.on("click",(event=>register_events_awaiter(this,void 0,void 0,(function*(){const features=yield readFeaturesAtPixel(map,event);map.dispatchEvent({type:dist.QS,features})})))),map.set(dist.QS,!0))}(map),map.on(eventType,(event=>{callback(event)}));break;case dist.UH:!function registerFeatureHoverEvent(map){map.get(dist.UH)||(map.on("pointermove",(event=>register_events_awaiter(this,void 0,void 0,(function*(){const features=yield readFeaturesAtPixel(map,event);map.dispatchEvent({type:dist.UH,features})})))),map.set(dist.UH,!0))}(map),map.on(eventType,(event=>{callback(event)}));break;case dist.fD:map.on("click",(event=>{const coordinate=(0,ol_proj.WP)(event.coordinate,map.getView().getProjection());callback({type:"map-click",coordinate})}));break;default:throw new Error(`Unrecognized event type: ${eventType}`)}}},"./node_modules/color-name/index.js":module=>{"use strict";module.exports={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]}},"./node_modules/ieee754/index.js":(__unused_webpack_module,exports)=>{exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},"./node_modules/lodash.throttle/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{var reTrim=/^\s+|\s+$/g,reIsBadHex=/^[-+]0x[0-9a-f]+$/i,reIsBinary=/^0b[01]+$/i,reIsOctal=/^0o[0-7]+$/i,freeParseInt=parseInt,freeGlobal="object"==typeof __webpack_require__.g&&__webpack_require__.g&&__webpack_require__.g.Object===Object&&__webpack_require__.g,freeSelf="object"==typeof self&&self&&self.Object===Object&&self,root=freeGlobal||freeSelf||Function("return this")(),objectToString=Object.prototype.toString,nativeMax=Math.max,nativeMin=Math.min,now=function(){return root.Date.now()};function debounce(func,wait,options){var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&time-lastInvokeTime>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,function remainingWait(time){var result=wait-(time-lastCallTime);return maxing?nativeMin(result,maxWait-(time-lastInvokeTime)):result}(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxWait=(maxing="maxWait"in options)?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0},debounced.flush=function flush(){return void 0===timerId?result:trailingEdge(now())},debounced}function isObject(value){var type=typeof value;return!!value&&("object"==type||"function"==type)}function toNumber(value){if("number"==typeof value)return value;if(function isSymbol(value){return"symbol"==typeof value||function isObjectLike(value){return!!value&&"object"==typeof value}(value)&&"[object Symbol]"==objectToString.call(value)}(value))return NaN;if(isObject(value)){var other="function"==typeof value.valueOf?value.valueOf():value;value=isObject(other)?other+"":other}if("string"!=typeof value)return 0===value?value:+value;value=value.replace(reTrim,"");var isBinary=reIsBinary.test(value);return isBinary||reIsOctal.test(value)?freeParseInt(value.slice(2),isBinary?2:8):reIsBadHex.test(value)?NaN:+value}module.exports=function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError("Expected a function");return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading,maxWait:wait,trailing})}},"./node_modules/ol/Collection.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _Object_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/Object.js"),_CollectionEventType_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/CollectionEventType.js"),_events_Event_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/events/Event.js");const Property_LENGTH="length";class CollectionEvent extends _events_Event_js__WEBPACK_IMPORTED_MODULE_0__.Ay{constructor(type,element,index){super(type),this.element=element,this.index=index}}class Collection extends _Object_js__WEBPACK_IMPORTED_MODULE_1__.A{constructor(array,options){if(super(),this.on,this.once,this.un,options=options||{},this.unique_=!!options.unique,this.array_=array||[],this.unique_)for(let i=0,ii=this.array_.length;i<ii;++i)this.assertUnique_(this.array_[i],i);this.updateLength_()}clear(){for(;this.getLength()>0;)this.pop()}extend(arr){for(let i=0,ii=arr.length;i<ii;++i)this.push(arr[i]);return this}forEach(f){const array=this.array_;for(let i=0,ii=array.length;i<ii;++i)f(array[i],i,array)}getArray(){return this.array_}item(index){return this.array_[index]}getLength(){return this.get(Property_LENGTH)}insertAt(index,elem){if(index<0||index>this.getLength())throw new Error("Index out of bounds: "+index);this.unique_&&this.assertUnique_(elem),this.array_.splice(index,0,elem),this.updateLength_(),this.dispatchEvent(new CollectionEvent(_CollectionEventType_js__WEBPACK_IMPORTED_MODULE_2__.A.ADD,elem,index))}pop(){return this.removeAt(this.getLength()-1)}push(elem){this.unique_&&this.assertUnique_(elem);const n=this.getLength();return this.insertAt(n,elem),this.getLength()}remove(elem){const arr=this.array_;for(let i=0,ii=arr.length;i<ii;++i)if(arr[i]===elem)return this.removeAt(i)}removeAt(index){if(index<0||index>=this.getLength())return;const prev=this.array_[index];return this.array_.splice(index,1),this.updateLength_(),this.dispatchEvent(new CollectionEvent(_CollectionEventType_js__WEBPACK_IMPORTED_MODULE_2__.A.REMOVE,prev,index)),prev}setAt(index,elem){if(index>=this.getLength())return void this.insertAt(index,elem);if(index<0)throw new Error("Index out of bounds: "+index);this.unique_&&this.assertUnique_(elem,index);const prev=this.array_[index];this.array_[index]=elem,this.dispatchEvent(new CollectionEvent(_CollectionEventType_js__WEBPACK_IMPORTED_MODULE_2__.A.REMOVE,prev,index)),this.dispatchEvent(new CollectionEvent(_CollectionEventType_js__WEBPACK_IMPORTED_MODULE_2__.A.ADD,elem,index))}updateLength_(){this.set(Property_LENGTH,this.array_.length)}assertUnique_(elem,except){for(let i=0,ii=this.array_.length;i<ii;++i)if(this.array_[i]===elem&&i!==except)throw new Error("Duplicate item added to a unique collection")}}const __WEBPACK_DEFAULT_EXPORT__=Collection},"./node_modules/ol/CollectionEventType.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={ADD:"add",REMOVE:"remove"}},"./node_modules/ol/ImageState.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});const __WEBPACK_DEFAULT_EXPORT__={IDLE:0,LOADING:1,LOADED:2,ERROR:3,EMPTY:4}},"./node_modules/ol/MapBrowserEventType.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _events_EventType_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/events/EventType.js");const __WEBPACK_DEFAULT_EXPORT__={SINGLECLICK:"singleclick",CLICK:_events_EventType_js__WEBPACK_IMPORTED_MODULE_0__.A.CLICK,DBLCLICK:_events_EventType_js__WEBPACK_IMPORTED_MODULE_0__.A.DBLCLICK,POINTERDRAG:"pointerdrag",POINTERMOVE:"pointermove",POINTERDOWN:"pointerdown",POINTERUP:"pointerup",POINTEROVER:"pointerover",POINTEROUT:"pointerout",POINTERENTER:"pointerenter",POINTERLEAVE:"pointerleave",POINTERCANCEL:"pointercancel"}},"./node_modules/ol/color.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{_j:()=>asArray,oJ:()=>asString,sH:()=>fromString,$C:()=>isStringColor,cD:()=>lchaToRgba,S8:()=>normalize,eE:()=>rgbaToLcha,dI:()=>color_toString,fu:()=>withAlpha});const rgb={name:"rgb",min:[0,0,0],max:[255,255,255],channel:["red","green","blue"],alias:["RGB"]};var xyz={name:"xyz",min:[0,0,0],channel:["X","Y","Z"],alias:["XYZ","ciexyz","cie1931"],whitepoint:{2:{A:[109.85,100,35.585],C:[98.074,100,118.232],D50:[96.422,100,82.521],D55:[95.682,100,92.149],D65:[95.045592705167,100,108.9057750759878],D75:[94.972,100,122.638],F2:[99.187,100,67.395],F7:[95.044,100,108.755],F11:[100.966,100,64.37],E:[100,100,100]},10:{A:[111.144,100,35.2],C:[97.285,100,116.145],D50:[96.72,100,81.427],D55:[95.799,100,90.926],D65:[94.811,100,107.304],D75:[94.416,100,120.641],F2:[103.28,100,69.026],F7:[95.792,100,107.687],F11:[103.866,100,65.627],E:[100,100,100]}}};xyz.max=xyz.whitepoint[2].D65,xyz.rgb=function(_xyz,white){white=white||xyz.whitepoint[2].E;var r,g,b,x=_xyz[0]/white[0],y=_xyz[1]/white[1],z=_xyz[2]/white[2];return g=-.96924363628087*x+1.87596750150772*y+.041555057407175*z,b=.055630079696993*x+-.20397695888897*y+1.056971514242878*z,r=(r=3.240969941904521*x+-1.537383177570093*y+-.498610760293*z)>.0031308?1.055*Math.pow(r,1/2.4)-.055:r*=12.92,g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g*=12.92,b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:b*=12.92,[255*(r=Math.min(Math.max(0,r),1)),255*(g=Math.min(Math.max(0,g),1)),255*(b=Math.min(Math.max(0,b),1))]},rgb.xyz=function(rgb,white){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,y=.21263900587151*(r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92)+.71516867876775*(g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92)+.072192315360733*(b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92),z=.019330818715591*r+.11919477979462*g+.95053215224966*b;return[(.41239079926595*r+.35758433938387*g+.18048078840183*b)*(white=white||xyz.whitepoint[2].E)[0],y*white[1],z*white[2]]};const color_space_xyz=xyz,luv={name:"luv",min:[0,-134,-140],max:[100,224,122],channel:["lightness","u","v"],alias:["LUV","cieluv","cie1976"],xyz:function(arg,i,o){var _u,_v,l,u,v,y,xn,yn,zn;if(l=arg[0],u=arg[1],v=arg[2],0===l)return[0,0,0];return i=i||"D65",o=o||2,_u=u/(13*l)+4*(xn=color_space_xyz.whitepoint[o][i][0])/(xn+15*(yn=color_space_xyz.whitepoint[o][i][1])+3*(zn=color_space_xyz.whitepoint[o][i][2]))||0,_v=v/(13*l)+9*yn/(xn+15*yn+3*zn)||0,[9*(y=l>8?yn*Math.pow((l+16)/116,3):yn*l*.0011070564598794539)*_u/(4*_v)||0,y,y*(12-3*_u-20*_v)/(4*_v)||0]}};color_space_xyz.luv=function(arg,i,o){var _u,_v,l,x,y,z,xn,yn,zn,un,vn;i=i||"D65",o=o||2,un=4*(xn=color_space_xyz.whitepoint[o][i][0])/(xn+15*(yn=color_space_xyz.whitepoint[o][i][1])+3*(zn=color_space_xyz.whitepoint[o][i][2])),vn=9*yn/(xn+15*yn+3*zn),_u=4*(x=arg[0])/(x+15*(y=arg[1])+3*(z=arg[2]))||0,_v=9*y/(x+15*y+3*z)||0;var yr=y/yn;return[l=yr<=.008856451679035631?903.2962962962961*yr:116*Math.pow(yr,1/3)-16,13*l*(_u-un),13*l*(_v-vn)]};var lchuv={name:"lchuv",channel:["lightness","chroma","hue"],alias:["LCHuv","cielchuv"],min:[0,0,0],max:[100,100,360],luv:function(luv){var hr,l=luv[0],c=luv[1];return hr=luv[2]/360*2*Math.PI,[l,c*Math.cos(hr),c*Math.sin(hr)]},xyz:function(arg){return luv.xyz(lchuv.luv(arg))}};const color_space_lchuv=lchuv;luv.lchuv=function(luv){var l=luv[0],u=luv[1],v=luv[2],c=Math.sqrt(u*u+v*v),h=360*Math.atan2(v,u)/2/Math.PI;return h<0&&(h+=360),[l,c,h]},color_space_xyz.lchuv=function(arg){return luv.lchuv(color_space_xyz.luv(arg))};var color_name=__webpack_require__("./node_modules/color-name/index.js"),color_name_default=__webpack_require__.n(color_name);const color_parse=function parse(cstr){var m,space,parts=[],alpha=1;if("number"==typeof cstr)return{space:"rgb",values:[cstr>>>16,(65280&cstr)>>>8,255&cstr],alpha:1};if("number"==typeof cstr)return{space:"rgb",values:[cstr>>>16,(65280&cstr)>>>8,255&cstr],alpha:1};if(cstr=String(cstr).toLowerCase(),color_name_default()[cstr])parts=color_name_default()[cstr].slice(),space="rgb";else if("transparent"===cstr)alpha=0,space="rgb",parts=[0,0,0];else if("#"===cstr[0]){var base=cstr.slice(1),size=base.length;alpha=1,size<=4?(parts=[parseInt(base[0]+base[0],16),parseInt(base[1]+base[1],16),parseInt(base[2]+base[2],16)],4===size&&(alpha=parseInt(base[3]+base[3],16)/255)):(parts=[parseInt(base[0]+base[1],16),parseInt(base[2]+base[3],16),parseInt(base[4]+base[5],16)],8===size&&(alpha=parseInt(base[6]+base[7],16)/255)),parts[0]||(parts[0]=0),parts[1]||(parts[1]=0),parts[2]||(parts[2]=0),space="rgb"}else if(m=/^((?:rgba?|hs[lvb]a?|hwba?|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms|oklch|oklab|color))\s*\(([^\)]*)\)/.exec(cstr)){var name=m[1],dims="cmyk"===(space=name.replace(/a$/,""))?4:"gray"===space?1:3;parts=m[2].trim().split(/\s*[,\/]\s*|\s+/),"color"===space&&(space=parts.shift()),alpha=(parts=parts.map((function(x,i){if("%"===x[x.length-1])return x=parseFloat(x)/100,3===i?x:"rgb"===space?255*x:"h"===space[0]?100*x:"l"!==space[0]||i?"lab"===space?125*x:"lch"===space?i<2?150*x:360*x:"o"!==space[0]||i?"oklab"===space?.4*x:"oklch"===space?i<2?.4*x:360*x:x:x:100*x;if("h"===space[i]||2===i&&"h"===space[space.length-1]){if(void 0!==baseHues[x])return baseHues[x];if(x.endsWith("deg"))return parseFloat(x);if(x.endsWith("turn"))return 360*parseFloat(x);if(x.endsWith("grad"))return 360*parseFloat(x)/400;if(x.endsWith("rad"))return 180*parseFloat(x)/Math.PI}return"none"===x?0:parseFloat(x)}))).length>dims?parts.pop():1}else/[0-9](?:\s|\/|,)/.test(cstr)&&(parts=cstr.match(/([0-9]+)/g).map((function(value){return parseFloat(value)})),space=cstr.match(/([a-z])/gi)?.join("")?.toLowerCase()||"rgb");return{space,values:parts,alpha}};var baseHues={red:0,orange:60,yellow:120,green:180,blue:240,purple:300};const hsl={name:"hsl",min:[0,0,0],max:[360,100,100],channel:["hue","saturation","lightness"],alias:["HSL"],rgb:function(hsl){var t1,t2,t3,rgb,val,h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100,i=0;if(0===s)return[val=255*l,val,val];for(t1=2*l-(t2=l<.5?l*(1+s):l+s-l*s),rgb=[0,0,0];i<3;)(t3=h+1/3*-(i-1))<0?t3++:t3>1&&t3--,val=6*t3<1?t1+6*(t2-t1)*t3:2*t3<1?t2:3*t3<2?t1+(t2-t1)*(2/3-t3)*6:t1,rgb[i++]=255*val;return rgb}};rgb.hsl=function(rgb){var h,l,r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min;return max===min?h=0:r===max?h=(g-b)/delta:g===max?h=2+(b-r)/delta:b===max&&(h=4+(r-g)/delta),(h=Math.min(60*h,360))<0&&(h+=360),l=(min+max)/2,[h,100*(max===min?0:l<=.5?delta/(max+min):delta/(2-max-min)),100*l]};var math=__webpack_require__("./node_modules/ol/math.js");function asString(color){return"string"==typeof color?color:color_toString(color)}const MAX_CACHE_SIZE=1024,cache={};let cacheSize=0;function withAlpha(color){if(4===color.length)return color;const output=color.slice();return output[3]=1,output}function rgbaToLcha(color){const output=color_space_xyz.lchuv(rgb.xyz(color));return output[3]=color[3],output}function lchaToRgba(color){const output=color_space_xyz.rgb(color_space_lchuv.xyz(color));return output[3]=color[3],output}function fromString(s){if(cache.hasOwnProperty(s))return cache[s];if(cacheSize>=MAX_CACHE_SIZE){let i=0;for(const key in cache)3&i++||(delete cache[key],--cacheSize)}const color=function rgba(color){var values;Array.isArray(color)&&color.raw&&(color=String.raw(...arguments)),color instanceof Number&&(color=+color);var parsed=color_parse(color);if(!parsed.space)return[];const min="h"===parsed.space[0]?hsl.min:rgb.min,max="h"===parsed.space[0]?hsl.max:rgb.max;return(values=Array(3))[0]=Math.min(Math.max(parsed.values[0],min[0]),max[0]),values[1]=Math.min(Math.max(parsed.values[1],min[1]),max[1]),values[2]=Math.min(Math.max(parsed.values[2],min[2]),max[2]),"h"===parsed.space[0]&&(values=hsl.rgb(values)),values.push(Math.min(Math.max(parsed.alpha,0),1)),values}(s);if(4!==color.length)throw new Error('Failed to parse "'+s+'" as color');for(const c of color)if(isNaN(c))throw new Error('Failed to parse "'+s+'" as color');return normalize(color),cache[s]=color,++cacheSize,color}function asArray(color){return Array.isArray(color)?color:fromString(color)}function normalize(color){return color[0]=(0,math.qE)(color[0]+.5|0,0,255),color[1]=(0,math.qE)(color[1]+.5|0,0,255),color[2]=(0,math.qE)(color[2]+.5|0,0,255),color[3]=(0,math.qE)(color[3],0,1),color}function color_toString(color){let r=color[0];r!=(0|r)&&(r=r+.5|0);let g=color[1];g!=(0|g)&&(g=g+.5|0);let b=color[2];b!=(0|b)&&(b=b+.5|0);return"rgba("+r+","+g+","+b+","+(void 0===color[3]?1:Math.round(100*color[3])/100)+")"}function isStringColor(s){try{return fromString(s),!0}catch(_){return!1}}},"./node_modules/ol/colorlike.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{F:()=>asColorLike});var _color_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/color.js");function asColorLike(color){return Array.isArray(color)?(0,_color_js__WEBPACK_IMPORTED_MODULE_0__.dI)(color):color}},"./node_modules/ol/css.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{$N:()=>CLASS_CONTROL,K5:()=>getFontParameters,Si:()=>CLASS_HIDDEN,XI:()=>CLASS_UNSELECTABLE,nT:()=>CLASS_COLLAPSED});const CLASS_HIDDEN="ol-hidden",CLASS_UNSELECTABLE="ol-unselectable",CLASS_CONTROL="ol-control",CLASS_COLLAPSED="ol-collapsed",fontRegEx=new RegExp(["^\\s*(?=(?:(?:[-a-z]+\\s*){0,2}(italic|oblique))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(small-caps))?)","(?=(?:(?:[-a-z]+\\s*){0,2}(bold(?:er)?|lighter|[1-9]00 ))?)","(?:(?:normal|\\1|\\2|\\3)\\s*){0,3}((?:xx?-)?","(?:small|large)|medium|smaller|larger|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx]))","(?:\\s*\\/\\s*(normal|[\\.\\d]+(?:\\%|in|[cem]m|ex|p[ctx])?))","?\\s*([-,\\\"\\'\\sa-z]+?)\\s*$"].join(""),"i"),fontRegExMatchIndex=["style","variant","weight","size","lineHeight","family"],getFontParameters=function(fontSpec){const match=fontSpec.match(fontRegEx);if(!match)return null;const style={lineHeight:"normal",size:"1.2em",style:"normal",weight:"normal",variant:"normal"};for(let i=0,ii=fontRegExMatchIndex.length;i<ii;++i){const value=match[i+1];void 0!==value&&(style[fontRegExMatchIndex[i]]=value)}return style.families=style.family.split(/,\s?/),style}},"./node_modules/ol/dom.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{WM:()=>replaceChildren,Y:()=>createCanvasContext2D,Yg:()=>releaseCanvas,bf:()=>removeNode,fo:()=>replaceNode,gS:()=>removeChildren});var _has_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/has.js");function createCanvasContext2D(width,height,canvasPool,settings){let canvas;return canvas=canvasPool&&canvasPool.length?canvasPool.shift():_has_js__WEBPACK_IMPORTED_MODULE_0__.Wl?new OffscreenCanvas(width||300,height||300):document.createElement("canvas"),width&&(canvas.width=width),height&&(canvas.height=height),canvas.getContext("2d",settings)}function releaseCanvas(context){const canvas=context.canvas;canvas.width=1,canvas.height=1,context.clearRect(0,0,1,1)}function replaceNode(newNode,oldNode){const parent=oldNode.parentNode;parent&&parent.replaceChild(newNode,oldNode)}function removeNode(node){return node&&node.parentNode?node.parentNode.removeChild(node):null}function removeChildren(node){for(;node.lastChild;)node.removeChild(node.lastChild)}function replaceChildren(node,children){const oldChildren=node.childNodes;for(let i=0;;++i){const oldChild=oldChildren[i],newChild=children[i];if(!oldChild&&!newChild)break;oldChild!==newChild&&(oldChild?newChild?node.insertBefore(newChild,oldChild):(node.removeChild(oldChild),--i):node.appendChild(newChild))}}},"./node_modules/ol/easing.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";function easeIn(t){return Math.pow(t,3)}function easeOut(t){return 1-easeIn(1-t)}function inAndOut(t){return 3*t*t-2*t*t*t}function linear(t){return t}__webpack_require__.d(__webpack_exports__,{T9:()=>inAndOut,a6:()=>easeIn,sn:()=>linear,vT:()=>easeOut})},"./node_modules/ol/events/condition.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A4:()=>mouseOnly,GB:()=>platformModifierKey,Gk:()=>always,IO:()=>altShiftKeysOnly,Kg:()=>shiftKeyOnly,Q7:()=>all,TS:()=>noModifierKeys,at:()=>mouseActionButton,eL:()=>focusWithTabindex,fs:()=>primaryAction,k5:()=>platformModifierKeyOnly,tE:()=>targetNotEditable});var _functions_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/functions.js"),_has_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/has.js"),_asserts_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/asserts.js");function all(var_args){const conditions=arguments;return function(event){let pass=!0;for(let i=0,ii=conditions.length;i<ii&&(pass=pass&&conditions[i](event),pass);++i);return pass}}const altShiftKeysOnly=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},focusWithTabindex=function(event){return!event.map.getTargetElement().hasAttribute("tabindex")||function(event){const targetElement=event.map.getTargetElement(),activeElement=event.map.getOwnerDocument().activeElement;return targetElement.contains(activeElement)}(event)},always=_functions_js__WEBPACK_IMPORTED_MODULE_0__.rT,mouseActionButton=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return 0==originalEvent.button&&!(_has_js__WEBPACK_IMPORTED_MODULE_1__.j&&_has_js__WEBPACK_IMPORTED_MODULE_1__.ew&&originalEvent.ctrlKey)},noModifierKeys=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&!originalEvent.shiftKey},platformModifierKeyOnly=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&(_has_js__WEBPACK_IMPORTED_MODULE_1__.ew?originalEvent.metaKey:originalEvent.ctrlKey)&&!originalEvent.shiftKey},platformModifierKey=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return _has_js__WEBPACK_IMPORTED_MODULE_1__.ew?originalEvent.metaKey:originalEvent.ctrlKey},shiftKeyOnly=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent;return!originalEvent.altKey&&!(originalEvent.metaKey||originalEvent.ctrlKey)&&originalEvent.shiftKey},targetNotEditable=function(mapBrowserEvent){const originalEvent=mapBrowserEvent.originalEvent,tagName=originalEvent.target.tagName;return"INPUT"!==tagName&&"SELECT"!==tagName&&"TEXTAREA"!==tagName&&!originalEvent.target.isContentEditable},mouseOnly=function(mapBrowserEvent){const pointerEvent=mapBrowserEvent.originalEvent;return(0,_asserts_js__WEBPACK_IMPORTED_MODULE_2__.v)(void 0!==pointerEvent,"mapBrowserEvent must originate from a pointer event"),"mouse"==pointerEvent.pointerType},primaryAction=function(mapBrowserEvent){const pointerEvent=mapBrowserEvent.originalEvent;return(0,_asserts_js__WEBPACK_IMPORTED_MODULE_2__.v)(void 0!==pointerEvent,"mapBrowserEvent must originate from a pointer event"),pointerEvent.isPrimary&&0===pointerEvent.button}},"./node_modules/ol/interaction/DragPan.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _Pointer_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/interaction/Pointer.js"),_functions_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/functions.js"),_events_condition_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/events/condition.js"),_easing_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/ol/easing.js"),_coordinate_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/ol/coordinate.js");class DragPan extends _Pointer_js__WEBPACK_IMPORTED_MODULE_0__.A{constructor(options){super({stopDown:_functions_js__WEBPACK_IMPORTED_MODULE_1__.W8}),options=options||{},this.kinetic_=options.kinetic,this.lastCentroid=null,this.lastPointersCount_,this.panning_=!1;const condition=options.condition?options.condition:(0,_events_condition_js__WEBPACK_IMPORTED_MODULE_2__.Q7)(_events_condition_js__WEBPACK_IMPORTED_MODULE_2__.TS,_events_condition_js__WEBPACK_IMPORTED_MODULE_2__.fs);this.condition_=options.onFocusOnly?(0,_events_condition_js__WEBPACK_IMPORTED_MODULE_2__.Q7)(_events_condition_js__WEBPACK_IMPORTED_MODULE_2__.eL,condition):condition,this.noKinetic_=!1}handleDragEvent(mapBrowserEvent){const map=mapBrowserEvent.map;this.panning_||(this.panning_=!0,map.getView().beginInteraction());const targetPointers=this.targetPointers,centroid=map.getEventPixel((0,_Pointer_js__WEBPACK_IMPORTED_MODULE_0__.v)(targetPointers));if(targetPointers.length==this.lastPointersCount_){if(this.kinetic_&&this.kinetic_.update(centroid[0],centroid[1]),this.lastCentroid){const delta=[this.lastCentroid[0]-centroid[0],centroid[1]-this.lastCentroid[1]],view=mapBrowserEvent.map.getView();(0,_coordinate_js__WEBPACK_IMPORTED_MODULE_3__.hs)(delta,view.getResolution()),(0,_coordinate_js__WEBPACK_IMPORTED_MODULE_3__.e$)(delta,view.getRotation()),view.adjustCenterInternal(delta)}}else this.kinetic_&&this.kinetic_.begin();this.lastCentroid=centroid,this.lastPointersCount_=targetPointers.length,mapBrowserEvent.originalEvent.preventDefault()}handleUpEvent(mapBrowserEvent){const map=mapBrowserEvent.map,view=map.getView();if(0===this.targetPointers.length){if(!this.noKinetic_&&this.kinetic_&&this.kinetic_.end()){const distance=this.kinetic_.getDistance(),angle=this.kinetic_.getAngle(),center=view.getCenterInternal(),centerpx=map.getPixelFromCoordinateInternal(center),dest=map.getCoordinateFromPixelInternal([centerpx[0]-distance*Math.cos(angle),centerpx[1]-distance*Math.sin(angle)]);view.animateInternal({center:view.getConstrainedCenter(dest),duration:500,easing:_easing_js__WEBPACK_IMPORTED_MODULE_4__.vT})}return this.panning_&&(this.panning_=!1,view.endInteraction()),!1}return this.kinetic_&&this.kinetic_.begin(),this.lastCentroid=null,!0}handleDownEvent(mapBrowserEvent){if(this.targetPointers.length>0&&this.condition_(mapBrowserEvent)){const view=mapBrowserEvent.map.getView();return this.lastCentroid=null,view.getAnimating()&&view.cancelAnimations(),this.kinetic_&&this.kinetic_.begin(),this.noKinetic_=this.targetPointers.length>1,!0}return!1}}const __WEBPACK_DEFAULT_EXPORT__=DragPan},"./node_modules/ol/interaction/Interaction.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>interaction_Interaction,e4:()=>pan,D2:()=>zoomByDelta});var ol_Object=__webpack_require__("./node_modules/ol/Object.js");const Property_ACTIVE="active";var easing=__webpack_require__("./node_modules/ol/easing.js");class Interaction extends ol_Object.A{constructor(options){super(),this.on,this.once,this.un,options&&options.handleEvent&&(this.handleEvent=options.handleEvent),this.map_=null,this.setActive(!0)}getActive(){return this.get(Property_ACTIVE)}getMap(){return this.map_}handleEvent(mapBrowserEvent){return!0}setActive(active){this.set(Property_ACTIVE,active)}setMap(map){this.map_=map}}function pan(view,delta,duration){const currentCenter=view.getCenterInternal();if(currentCenter){const center=[currentCenter[0]+delta[0],currentCenter[1]+delta[1]];view.animateInternal({duration:void 0!==duration?duration:250,easing:easing.sn,center:view.getConstrainedCenter(center)})}}function zoomByDelta(view,delta,anchor,duration){const currentZoom=view.getZoom();if(void 0===currentZoom)return;const newZoom=view.getConstrainedZoom(currentZoom+delta),newResolution=view.getResolutionForZoom(newZoom);view.getAnimating()&&view.cancelAnimations(),view.animate({resolution:newResolution,anchor,duration:void 0!==duration?duration:250,easing:easing.vT})}const interaction_Interaction=Interaction},"./node_modules/ol/interaction/MouseWheelZoom.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _events_EventType_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/events/EventType.js"),_Interaction_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/interaction/Interaction.js"),_has_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/ol/has.js"),_events_condition_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/events/condition.js"),_math_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/ol/math.js");class MouseWheelZoom extends _Interaction_js__WEBPACK_IMPORTED_MODULE_0__.Ay{constructor(options){super(options=options||{}),this.totalDelta_=0,this.lastDelta_=0,this.maxDelta_=void 0!==options.maxDelta?options.maxDelta:1,this.duration_=void 0!==options.duration?options.duration:250,this.timeout_=void 0!==options.timeout?options.timeout:80,this.useAnchor_=void 0===options.useAnchor||options.useAnchor,this.constrainResolution_=void 0!==options.constrainResolution&&options.constrainResolution;const condition=options.condition?options.condition:_events_condition_js__WEBPACK_IMPORTED_MODULE_1__.Gk;this.condition_=options.onFocusOnly?(0,_events_condition_js__WEBPACK_IMPORTED_MODULE_1__.Q7)(_events_condition_js__WEBPACK_IMPORTED_MODULE_1__.eL,condition):condition,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_,this.mode_=void 0,this.trackpadEventGap_=400,this.trackpadTimeoutId_,this.deltaPerZoom_=300}endInteraction_(){this.trackpadTimeoutId_=void 0;const map=this.getMap();if(!map)return;map.getView().endInteraction(void 0,this.lastDelta_?this.lastDelta_>0?1:-1:0,this.lastAnchor_)}handleEvent(mapBrowserEvent){if(!this.condition_(mapBrowserEvent))return!0;if(mapBrowserEvent.type!==_events_EventType_js__WEBPACK_IMPORTED_MODULE_2__.A.WHEEL)return!0;const map=mapBrowserEvent.map,wheelEvent=mapBrowserEvent.originalEvent;let delta;if(wheelEvent.preventDefault(),this.useAnchor_&&(this.lastAnchor_=mapBrowserEvent.coordinate),mapBrowserEvent.type==_events_EventType_js__WEBPACK_IMPORTED_MODULE_2__.A.WHEEL&&(delta=wheelEvent.deltaY,_has_js__WEBPACK_IMPORTED_MODULE_3__._p&&wheelEvent.deltaMode===WheelEvent.DOM_DELTA_PIXEL&&(delta/=_has_js__WEBPACK_IMPORTED_MODULE_3__.cr),wheelEvent.deltaMode===WheelEvent.DOM_DELTA_LINE&&(delta*=40)),0===delta)return!1;this.lastDelta_=delta;const now=Date.now();void 0===this.startTime_&&(this.startTime_=now),(!this.mode_||now-this.startTime_>this.trackpadEventGap_)&&(this.mode_=Math.abs(delta)<4?"trackpad":"wheel");const view=map.getView();if("trackpad"===this.mode_&&!view.getConstrainResolution()&&!this.constrainResolution_)return this.trackpadTimeoutId_?clearTimeout(this.trackpadTimeoutId_):(view.getAnimating()&&view.cancelAnimations(),view.beginInteraction()),this.trackpadTimeoutId_=setTimeout(this.endInteraction_.bind(this),this.timeout_),view.adjustZoom(-delta/this.deltaPerZoom_,this.lastAnchor_),this.startTime_=now,!1;this.totalDelta_+=delta;const timeLeft=Math.max(this.timeout_-(now-this.startTime_),0);return clearTimeout(this.timeoutId_),this.timeoutId_=setTimeout(this.handleWheelZoom_.bind(this,map),timeLeft),!1}handleWheelZoom_(map){const view=map.getView();view.getAnimating()&&view.cancelAnimations();let delta=-(0,_math_js__WEBPACK_IMPORTED_MODULE_4__.qE)(this.totalDelta_,-this.maxDelta_*this.deltaPerZoom_,this.maxDelta_*this.deltaPerZoom_)/this.deltaPerZoom_;(view.getConstrainResolution()||this.constrainResolution_)&&(delta=delta?delta>0?1:-1:0),(0,_Interaction_js__WEBPACK_IMPORTED_MODULE_0__.D2)(view,delta,this.lastAnchor_,this.duration_),this.mode_=void 0,this.totalDelta_=0,this.lastAnchor_=null,this.startTime_=void 0,this.timeoutId_=void 0}setMouseAnchor(useAnchor){this.useAnchor_=useAnchor,useAnchor||(this.lastAnchor_=null)}}const __WEBPACK_DEFAULT_EXPORT__=MouseWheelZoom},"./node_modules/ol/interaction/Pointer.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__,v:()=>centroid});var _Interaction_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/interaction/Interaction.js"),_MapBrowserEventType_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/MapBrowserEventType.js");class PointerInteraction extends _Interaction_js__WEBPACK_IMPORTED_MODULE_0__.Ay{constructor(options){super(options=options||{}),options.handleDownEvent&&(this.handleDownEvent=options.handleDownEvent),options.handleDragEvent&&(this.handleDragEvent=options.handleDragEvent),options.handleMoveEvent&&(this.handleMoveEvent=options.handleMoveEvent),options.handleUpEvent&&(this.handleUpEvent=options.handleUpEvent),options.stopDown&&(this.stopDown=options.stopDown),this.handlingDownUpSequence=!1,this.targetPointers=[]}getPointerCount(){return this.targetPointers.length}handleDownEvent(mapBrowserEvent){return!1}handleDragEvent(mapBrowserEvent){}handleEvent(mapBrowserEvent){if(!mapBrowserEvent.originalEvent)return!0;let stopEvent=!1;if(this.updateTrackedPointers_(mapBrowserEvent),this.handlingDownUpSequence){if(mapBrowserEvent.type==_MapBrowserEventType_js__WEBPACK_IMPORTED_MODULE_1__.A.POINTERDRAG)this.handleDragEvent(mapBrowserEvent),mapBrowserEvent.originalEvent.preventDefault();else if(mapBrowserEvent.type==_MapBrowserEventType_js__WEBPACK_IMPORTED_MODULE_1__.A.POINTERUP){const handledUp=this.handleUpEvent(mapBrowserEvent);this.handlingDownUpSequence=handledUp&&this.targetPointers.length>0}}else if(mapBrowserEvent.type==_MapBrowserEventType_js__WEBPACK_IMPORTED_MODULE_1__.A.POINTERDOWN){const handled=this.handleDownEvent(mapBrowserEvent);this.handlingDownUpSequence=handled,stopEvent=this.stopDown(handled)}else mapBrowserEvent.type==_MapBrowserEventType_js__WEBPACK_IMPORTED_MODULE_1__.A.POINTERMOVE&&this.handleMoveEvent(mapBrowserEvent);return!stopEvent}handleMoveEvent(mapBrowserEvent){}handleUpEvent(mapBrowserEvent){return!1}stopDown(handled){return handled}updateTrackedPointers_(mapBrowserEvent){mapBrowserEvent.activePointers&&(this.targetPointers=mapBrowserEvent.activePointers)}}function centroid(pointerEvents){const length=pointerEvents.length;let clientX=0,clientY=0;for(let i=0;i<length;i++)clientX+=pointerEvents[i].clientX,clientY+=pointerEvents[i].clientY;return{clientX:clientX/length,clientY:clientY/length}}const __WEBPACK_DEFAULT_EXPORT__=PointerInteraction},"./node_modules/ol/interaction/defaults.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{N:()=>defaults});var Collection=__webpack_require__("./node_modules/ol/Collection.js"),Interaction=__webpack_require__("./node_modules/ol/interaction/Interaction.js"),MapBrowserEventType=__webpack_require__("./node_modules/ol/MapBrowserEventType.js");class DoubleClickZoom extends Interaction.Ay{constructor(options){super(),options=options||{},this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:250}handleEvent(mapBrowserEvent){let stopEvent=!1;if(mapBrowserEvent.type==MapBrowserEventType.A.DBLCLICK){const browserEvent=mapBrowserEvent.originalEvent,map=mapBrowserEvent.map,anchor=mapBrowserEvent.coordinate,delta=browserEvent.shiftKey?-this.delta_:this.delta_,view=map.getView();(0,Interaction.D2)(view,delta,anchor,this.duration_),browserEvent.preventDefault(),stopEvent=!0}return!stopEvent}}const interaction_DoubleClickZoom=DoubleClickZoom;var DragPan=__webpack_require__("./node_modules/ol/interaction/DragPan.js"),Pointer=__webpack_require__("./node_modules/ol/interaction/Pointer.js"),functions=__webpack_require__("./node_modules/ol/functions.js"),events_condition=__webpack_require__("./node_modules/ol/events/condition.js"),rotationconstraint=__webpack_require__("./node_modules/ol/rotationconstraint.js");class DragRotate extends Pointer.A{constructor(options){options=options||{},super({stopDown:functions.W8}),this.condition_=options.condition?options.condition:events_condition.IO,this.lastAngle_=void 0,this.duration_=void 0!==options.duration?options.duration:250}handleDragEvent(mapBrowserEvent){if(!(0,events_condition.A4)(mapBrowserEvent))return;const map=mapBrowserEvent.map,view=map.getView();if(view.getConstraints().rotation===rotationconstraint.b8)return;const size=map.getSize(),offset=mapBrowserEvent.pixel,theta=Math.atan2(size[1]/2-offset[1],offset[0]-size[0]/2);if(void 0!==this.lastAngle_){const delta=theta-this.lastAngle_;view.adjustRotationInternal(-delta)}this.lastAngle_=theta}handleUpEvent(mapBrowserEvent){if(!(0,events_condition.A4)(mapBrowserEvent))return!0;return mapBrowserEvent.map.getView().endInteraction(this.duration_),!1}handleDownEvent(mapBrowserEvent){if(!(0,events_condition.A4)(mapBrowserEvent))return!1;if((0,events_condition.at)(mapBrowserEvent)&&this.condition_(mapBrowserEvent)){return mapBrowserEvent.map.getView().beginInteraction(),this.lastAngle_=void 0,!0}return!1}}const interaction_DragRotate=DragRotate;var Event=__webpack_require__("./node_modules/ol/events/Event.js"),Disposable=__webpack_require__("./node_modules/ol/Disposable.js"),Polygon=__webpack_require__("./node_modules/ol/geom/Polygon.js");class RenderBox extends Disposable.A{constructor(className){super(),this.geometry_=null,this.element_=document.createElement("div"),this.element_.style.position="absolute",this.element_.style.pointerEvents="auto",this.element_.className="ol-box "+className,this.map_=null,this.startPixel_=null,this.endPixel_=null}disposeInternal(){this.setMap(null)}render_(){const startPixel=this.startPixel_,endPixel=this.endPixel_,style=this.element_.style;style.left=Math.min(startPixel[0],endPixel[0])+"px",style.top=Math.min(startPixel[1],endPixel[1])+"px",style.width=Math.abs(endPixel[0]-startPixel[0])+"px",style.height=Math.abs(endPixel[1]-startPixel[1])+"px"}setMap(map){if(this.map_){this.map_.getOverlayContainer().removeChild(this.element_);const style=this.element_.style;style.left="inherit",style.top="inherit",style.width="inherit",style.height="inherit"}this.map_=map,this.map_&&this.map_.getOverlayContainer().appendChild(this.element_)}setPixels(startPixel,endPixel){this.startPixel_=startPixel,this.endPixel_=endPixel,this.createOrUpdateGeometry(),this.render_()}createOrUpdateGeometry(){const startPixel=this.startPixel_,endPixel=this.endPixel_,coordinates=[startPixel,[startPixel[0],endPixel[1]],endPixel,[endPixel[0],startPixel[1]]].map(this.map_.getCoordinateFromPixelInternal,this.map_);coordinates[4]=coordinates[0].slice(),this.geometry_?this.geometry_.setCoordinates([coordinates]):this.geometry_=new Polygon.Ay([coordinates])}getGeometry(){return this.geometry_}}const Box=RenderBox,DragBoxEventType_BOXSTART="boxstart",DragBoxEventType_BOXDRAG="boxdrag",DragBoxEventType_BOXEND="boxend",DragBoxEventType_BOXCANCEL="boxcancel";class DragBoxEvent extends Event.Ay{constructor(type,coordinate,mapBrowserEvent){super(type),this.coordinate=coordinate,this.mapBrowserEvent=mapBrowserEvent}}class DragBox extends Pointer.A{constructor(options){super(),this.on,this.once,this.un,options=options||{},this.box_=new Box(options.className||"ol-dragbox"),this.minArea_=void 0!==options.minArea?options.minArea:64,options.onBoxEnd&&(this.onBoxEnd=options.onBoxEnd),this.startPixel_=null,this.condition_=options.condition?options.condition:events_condition.at,this.boxEndCondition_=options.boxEndCondition?options.boxEndCondition:this.defaultBoxEndCondition}defaultBoxEndCondition(mapBrowserEvent,startPixel,endPixel){const width=endPixel[0]-startPixel[0],height=endPixel[1]-startPixel[1];return width*width+height*height>=this.minArea_}getGeometry(){return this.box_.getGeometry()}handleDragEvent(mapBrowserEvent){this.box_.setPixels(this.startPixel_,mapBrowserEvent.pixel),this.dispatchEvent(new DragBoxEvent(DragBoxEventType_BOXDRAG,mapBrowserEvent.coordinate,mapBrowserEvent))}handleUpEvent(mapBrowserEvent){this.box_.setMap(null);const completeBox=this.boxEndCondition_(mapBrowserEvent,this.startPixel_,mapBrowserEvent.pixel);return completeBox&&this.onBoxEnd(mapBrowserEvent),this.dispatchEvent(new DragBoxEvent(completeBox?DragBoxEventType_BOXEND:DragBoxEventType_BOXCANCEL,mapBrowserEvent.coordinate,mapBrowserEvent)),!1}handleDownEvent(mapBrowserEvent){return!!this.condition_(mapBrowserEvent)&&(this.startPixel_=mapBrowserEvent.pixel,this.box_.setMap(mapBrowserEvent.map),this.box_.setPixels(this.startPixel_,this.startPixel_),this.dispatchEvent(new DragBoxEvent(DragBoxEventType_BOXSTART,mapBrowserEvent.coordinate,mapBrowserEvent)),!0)}onBoxEnd(event){}}const interaction_DragBox=DragBox;var easing=__webpack_require__("./node_modules/ol/easing.js");const interaction_DragZoom=class DragZoom extends interaction_DragBox{constructor(options){super({condition:(options=options||{}).condition?options.condition:events_condition.Kg,className:options.className||"ol-dragzoom",minArea:options.minArea}),this.duration_=void 0!==options.duration?options.duration:200,this.out_=void 0!==options.out&&options.out}onBoxEnd(event){const view=this.getMap().getView();let geometry=this.getGeometry();if(this.out_){const rotatedExtent=view.rotatedExtentForGeometry(geometry),resolution=view.getResolutionForExtentInternal(rotatedExtent),factor=view.getResolution()/resolution;geometry=geometry.clone(),geometry.scale(factor*factor)}view.fitInternal(geometry,{duration:this.duration_,easing:easing.vT})}};var EventType=__webpack_require__("./node_modules/ol/events/EventType.js");const Key_LEFT="ArrowLeft",Key_UP="ArrowUp",Key_RIGHT="ArrowRight",Key_DOWN="ArrowDown";var coordinate=__webpack_require__("./node_modules/ol/coordinate.js");class KeyboardPan extends Interaction.Ay{constructor(options){super(),options=options||{},this.defaultCondition_=function(mapBrowserEvent){return(0,events_condition.TS)(mapBrowserEvent)&&(0,events_condition.tE)(mapBrowserEvent)},this.condition_=void 0!==options.condition?options.condition:this.defaultCondition_,this.duration_=void 0!==options.duration?options.duration:100,this.pixelDelta_=void 0!==options.pixelDelta?options.pixelDelta:128}handleEvent(mapBrowserEvent){let stopEvent=!1;if(mapBrowserEvent.type==EventType.A.KEYDOWN){const keyEvent=mapBrowserEvent.originalEvent,key=keyEvent.key;if(this.condition_(mapBrowserEvent)&&(key==Key_DOWN||key==Key_LEFT||key==Key_RIGHT||key==Key_UP)){const view=mapBrowserEvent.map.getView(),mapUnitsDelta=view.getResolution()*this.pixelDelta_;let deltaX=0,deltaY=0;key==Key_DOWN?deltaY=-mapUnitsDelta:key==Key_LEFT?deltaX=-mapUnitsDelta:key==Key_RIGHT?deltaX=mapUnitsDelta:deltaY=mapUnitsDelta;const delta=[deltaX,deltaY];(0,coordinate.e$)(delta,view.getRotation()),(0,Interaction.e4)(view,delta,this.duration_),keyEvent.preventDefault(),stopEvent=!0}}return!stopEvent}}const interaction_KeyboardPan=KeyboardPan;class KeyboardZoom extends Interaction.Ay{constructor(options){super(),options=options||{},this.condition_=options.condition?options.condition:function(mapBrowserEvent){return!(0,events_condition.GB)(mapBrowserEvent)&&(0,events_condition.tE)(mapBrowserEvent)},this.delta_=options.delta?options.delta:1,this.duration_=void 0!==options.duration?options.duration:100}handleEvent(mapBrowserEvent){let stopEvent=!1;if(mapBrowserEvent.type==EventType.A.KEYDOWN||mapBrowserEvent.type==EventType.A.KEYPRESS){const keyEvent=mapBrowserEvent.originalEvent,key=keyEvent.key;if(this.condition_(mapBrowserEvent)&&("+"===key||"-"===key)){const map=mapBrowserEvent.map,delta="+"===key?this.delta_:-this.delta_,view=map.getView();(0,Interaction.D2)(view,delta,void 0,this.duration_),keyEvent.preventDefault(),stopEvent=!0}}return!stopEvent}}const interaction_KeyboardZoom=KeyboardZoom;const ol_Kinetic=class Kinetic{constructor(decay,minVelocity,delay){this.decay_=decay,this.minVelocity_=minVelocity,this.delay_=delay,this.points_=[],this.angle_=0,this.initialVelocity_=0}begin(){this.points_.length=0,this.angle_=0,this.initialVelocity_=0}update(x,y){this.points_.push(x,y,Date.now())}end(){if(this.points_.length<6)return!1;const delay=Date.now()-this.delay_,lastIndex=this.points_.length-3;if(this.points_[lastIndex+2]<delay)return!1;let firstIndex=lastIndex-3;for(;firstIndex>0&&this.points_[firstIndex+2]>delay;)firstIndex-=3;const duration=this.points_[lastIndex+2]-this.points_[firstIndex+2];if(duration<1e3/60)return!1;const dx=this.points_[lastIndex]-this.points_[firstIndex],dy=this.points_[lastIndex+1]-this.points_[firstIndex+1];return this.angle_=Math.atan2(dy,dx),this.initialVelocity_=Math.sqrt(dx*dx+dy*dy)/duration,this.initialVelocity_>this.minVelocity_}getDistance(){return(this.minVelocity_-this.initialVelocity_)/this.decay_}getAngle(){return this.angle_}};var MouseWheelZoom=__webpack_require__("./node_modules/ol/interaction/MouseWheelZoom.js");class PinchRotate extends Pointer.A{constructor(options){const pointerOptions=options=options||{};pointerOptions.stopDown||(pointerOptions.stopDown=functions.W8),super(pointerOptions),this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.threshold_=void 0!==options.threshold?options.threshold:.3,this.duration_=void 0!==options.duration?options.duration:250}handleDragEvent(mapBrowserEvent){let rotationDelta=0;const touch0=this.targetPointers[0],touch1=this.targetPointers[1],angle=Math.atan2(touch1.clientY-touch0.clientY,touch1.clientX-touch0.clientX);if(void 0!==this.lastAngle_){const delta=angle-this.lastAngle_;this.rotationDelta_+=delta,!this.rotating_&&Math.abs(this.rotationDelta_)>this.threshold_&&(this.rotating_=!0),rotationDelta=delta}this.lastAngle_=angle;const map=mapBrowserEvent.map,view=map.getView();view.getConstraints().rotation!==rotationconstraint.b8&&(this.anchor_=map.getCoordinateFromPixelInternal(map.getEventPixel((0,Pointer.v)(this.targetPointers))),this.rotating_&&(map.render(),view.adjustRotationInternal(rotationDelta,this.anchor_)))}handleUpEvent(mapBrowserEvent){if(this.targetPointers.length<2){return mapBrowserEvent.map.getView().endInteraction(this.duration_),!1}return!0}handleDownEvent(mapBrowserEvent){if(this.targetPointers.length>=2){const map=mapBrowserEvent.map;return this.anchor_=null,this.lastAngle_=void 0,this.rotating_=!1,this.rotationDelta_=0,this.handlingDownUpSequence||map.getView().beginInteraction(),!0}return!1}}const interaction_PinchRotate=PinchRotate;class PinchZoom extends Pointer.A{constructor(options){const pointerOptions=options=options||{};pointerOptions.stopDown||(pointerOptions.stopDown=functions.W8),super(pointerOptions),this.anchor_=null,this.duration_=void 0!==options.duration?options.duration:400,this.lastDistance_=void 0,this.lastScaleDelta_=1}handleDragEvent(mapBrowserEvent){let scaleDelta=1;const touch0=this.targetPointers[0],touch1=this.targetPointers[1],dx=touch0.clientX-touch1.clientX,dy=touch0.clientY-touch1.clientY,distance=Math.sqrt(dx*dx+dy*dy);void 0!==this.lastDistance_&&(scaleDelta=this.lastDistance_/distance),this.lastDistance_=distance;const map=mapBrowserEvent.map,view=map.getView();1!=scaleDelta&&(this.lastScaleDelta_=scaleDelta),this.anchor_=map.getCoordinateFromPixelInternal(map.getEventPixel((0,Pointer.v)(this.targetPointers))),map.render(),view.adjustResolutionInternal(scaleDelta,this.anchor_)}handleUpEvent(mapBrowserEvent){if(this.targetPointers.length<2){const view=mapBrowserEvent.map.getView(),direction=this.lastScaleDelta_>1?1:-1;return view.endInteraction(this.duration_,direction),!1}return!0}handleDownEvent(mapBrowserEvent){if(this.targetPointers.length>=2){const map=mapBrowserEvent.map;return this.anchor_=null,this.lastDistance_=void 0,this.lastScaleDelta_=1,this.handlingDownUpSequence||map.getView().beginInteraction(),!0}return!1}}const interaction_PinchZoom=PinchZoom;function defaults(options){options=options||{};const interactions=new Collection.A,kinetic=new ol_Kinetic(-.005,.05,100);(void 0===options.altShiftDragRotate||options.altShiftDragRotate)&&interactions.push(new interaction_DragRotate);(void 0===options.doubleClickZoom||options.doubleClickZoom)&&interactions.push(new interaction_DoubleClickZoom({delta:options.zoomDelta,duration:options.zoomDuration}));(void 0===options.dragPan||options.dragPan)&&interactions.push(new DragPan.A({onFocusOnly:options.onFocusOnly,kinetic}));(void 0===options.pinchRotate||options.pinchRotate)&&interactions.push(new interaction_PinchRotate);(void 0===options.pinchZoom||options.pinchZoom)&&interactions.push(new interaction_PinchZoom({duration:options.zoomDuration}));(void 0===options.keyboard||options.keyboard)&&(interactions.push(new interaction_KeyboardPan),interactions.push(new interaction_KeyboardZoom({delta:options.zoomDelta,duration:options.zoomDuration})));(void 0===options.mouseWheelZoom||options.mouseWheelZoom)&&interactions.push(new MouseWheelZoom.A({onFocusOnly:options.onFocusOnly,duration:options.zoomDuration}));return(void 0===options.shiftDragZoom||options.shiftDragZoom)&&interactions.push(new interaction_DragZoom({duration:options.zoomDuration})),interactions}},"./node_modules/ol/render/canvas.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Jw:()=>drawImageOrLabel,M8:()=>defaultTextBaseline,MY:()=>defaultTextAlign,NT:()=>defaultStrokeStyle,Oq:()=>defaultLineDash,TA:()=>measureAndCacheTextWidth,Tq:()=>defaultPadding,ZV:()=>defaultFont,_K:()=>defaultLineJoin,_m:()=>defaultLineCap,aq:()=>defaultLineWidth,eL:()=>defaultMiterLimit,fZ:()=>registerFont,jT:()=>getTextDimensions,qY:()=>defaultFillStyle,vk:()=>defaultLineDashOffset,yY:()=>checkedFonts});var _Object_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/Object.js"),_has_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/ol/has.js"),_obj_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/obj.js"),_dom_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/ol/dom.js"),_css_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/css.js");const defaultFont="10px sans-serif",defaultFillStyle="#000",defaultLineCap="round",defaultLineDash=[],defaultLineDashOffset=0,defaultLineJoin="round",defaultMiterLimit=10,defaultStrokeStyle="#000",defaultTextAlign="center",defaultTextBaseline="middle",defaultPadding=[0,0,0,0],defaultLineWidth=1,checkedFonts=new _Object_js__WEBPACK_IMPORTED_MODULE_0__.A;let measureFont,measureContext=null;const textHeights={},registerFont=function(){const referenceFonts=["monospace","serif"],len=referenceFonts.length,text="wmytzilWMYTZIL@#/&?$%10";let interval,referenceWidth;function isAvailable(fontStyle,fontWeight,fontFamily){let available=!0;for(let i=0;i<len;++i){const referenceFont=referenceFonts[i];if(referenceWidth=measureTextWidth(fontStyle+" "+fontWeight+" 32px "+referenceFont,text),fontFamily!=referenceFont){const width=measureTextWidth(fontStyle+" "+fontWeight+" 32px "+fontFamily+","+referenceFont,text);available=available&&width!=referenceWidth}}return!!available}function check(){let done=!0;const fonts=checkedFonts.getKeys();for(let i=0,ii=fonts.length;i<ii;++i){const font=fonts[i];checkedFonts.get(font)<100&&(isAvailable.apply(this,font.split("\n"))?((0,_obj_js__WEBPACK_IMPORTED_MODULE_1__.I)(textHeights),measureContext=null,measureFont=void 0,checkedFonts.set(font,100)):(checkedFonts.set(font,checkedFonts.get(font)+1,!0),done=!1))}done&&(clearInterval(interval),interval=void 0)}return function(fontSpec){const font=(0,_css_js__WEBPACK_IMPORTED_MODULE_2__.K5)(fontSpec);if(!font)return;const families=font.families;for(let i=0,ii=families.length;i<ii;++i){const family=families[i],key=font.style+"\n"+font.weight+"\n"+family;void 0===checkedFonts.get(key)&&(checkedFonts.set(key,100,!0),isAvailable(font.style,font.weight,family)||(checkedFonts.set(key,0,!0),void 0===interval&&(interval=setInterval(check,32))))}}}(),measureTextHeight=function(){let measureElement;return function(fontSpec){let height=textHeights[fontSpec];if(null==height){if(_has_js__WEBPACK_IMPORTED_MODULE_3__.Wl){const font=(0,_css_js__WEBPACK_IMPORTED_MODULE_2__.K5)(fontSpec),metrics=measureText(fontSpec,"g");height=(isNaN(Number(font.lineHeight))?1.2:Number(font.lineHeight))*(metrics.actualBoundingBoxAscent+metrics.actualBoundingBoxDescent)}else measureElement||(measureElement=document.createElement("div"),measureElement.innerHTML="M",measureElement.style.minHeight="0",measureElement.style.maxHeight="none",measureElement.style.height="auto",measureElement.style.padding="0",measureElement.style.border="none",measureElement.style.position="absolute",measureElement.style.display="block",measureElement.style.left="-99999px"),measureElement.style.font=fontSpec,document.body.appendChild(measureElement),height=measureElement.offsetHeight,document.body.removeChild(measureElement);textHeights[fontSpec]=height}return height}}();function measureText(font,text){return measureContext||(measureContext=(0,_dom_js__WEBPACK_IMPORTED_MODULE_4__.Y)(1,1)),font!=measureFont&&(measureContext.font=font,measureFont=measureContext.font),measureContext.measureText(text)}function measureTextWidth(font,text){return measureText(font,text).width}function measureAndCacheTextWidth(font,text,cache){if(text in cache)return cache[text];const width=text.split("\n").reduce(((prev,curr)=>Math.max(prev,measureTextWidth(font,curr))),0);return cache[text]=width,width}function getTextDimensions(baseStyle,chunks){const widths=[],heights=[],lineWidths=[];let width=0,lineWidth=0,height=0,lineHeight=0;for(let i=0,ii=chunks.length;i<=ii;i+=2){const text=chunks[i];if("\n"===text||i===ii){width=Math.max(width,lineWidth),lineWidths.push(lineWidth),lineWidth=0,height+=lineHeight;continue}const font=chunks[i+1]||baseStyle.font,currentWidth=measureTextWidth(font,text);widths.push(currentWidth),lineWidth+=currentWidth;const currentHeight=measureTextHeight(font);heights.push(currentHeight),lineHeight=Math.max(lineHeight,currentHeight)}return{width,height,widths,heights,lineWidths}}function drawImageOrLabel(context,transform,opacity,labelOrImage,originX,originY,w,h,x,y,scale){context.save(),1!==opacity&&(context.globalAlpha*=opacity),transform&&context.transform.apply(context,transform),labelOrImage.contextInstructions?(context.translate(x,y),context.scale(scale[0],scale[1]),function executeLabelInstructions(label,context){const contextInstructions=label.contextInstructions;for(let i=0,ii=contextInstructions.length;i<ii;i+=2)Array.isArray(contextInstructions[i+1])?context[contextInstructions[i]].apply(context,contextInstructions[i+1]):context[contextInstructions[i]]=contextInstructions[i+1]}(labelOrImage,context)):scale[0]<0||scale[1]<0?(context.translate(x,y),context.scale(scale[0],scale[1]),context.drawImage(labelOrImage,originX,originY,w,h,0,0,w,h)):context.drawImage(labelOrImage,originX,originY,w,h,x,y,w*scale[0],h*scale[1]),context.restore()}},"./node_modules/ol/rotationconstraint.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{a$:()=>createSnapToN,b8:()=>disable,cq:()=>createSnapToZero,dv:()=>none});var _math_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/math.js");function disable(rotation){if(void 0!==rotation)return 0}function none(rotation){if(void 0!==rotation)return rotation}function createSnapToN(n){const theta=2*Math.PI/n;return function(rotation,isMoving){return isMoving?rotation:void 0!==rotation?rotation=Math.floor(rotation/theta+.5)*theta:void 0}}function createSnapToZero(tolerance){const t=void 0===tolerance?(0,_math_js__WEBPACK_IMPORTED_MODULE_0__.eh)(5):tolerance;return function(rotation,isMoving){return isMoving||void 0===rotation?rotation:Math.abs(rotation)<=t?0:rotation}}},"./node_modules/ol/style/Circle.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _RegularShape_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/style/RegularShape.js");class CircleStyle extends _RegularShape_js__WEBPACK_IMPORTED_MODULE_0__.A{constructor(options){super({points:1/0,fill:(options=options||{radius:5}).fill,radius:options.radius,stroke:options.stroke,scale:void 0!==options.scale?options.scale:1,rotation:void 0!==options.rotation?options.rotation:0,rotateWithView:void 0!==options.rotateWithView&&options.rotateWithView,displacement:void 0!==options.displacement?options.displacement:[0,0],declutterMode:options.declutterMode})}clone(){const scale=this.getScale(),style=new CircleStyle({fill:this.getFill()?this.getFill().clone():void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,radius:this.getRadius(),scale:Array.isArray(scale)?scale.slice():scale,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return style.setOpacity(this.getOpacity()),style}setRadius(radius){this.radius_=radius,this.render()}}const __WEBPACK_DEFAULT_EXPORT__=CircleStyle},"./node_modules/ol/style/Fill.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class Fill{constructor(options){options=options||{},this.color_=void 0!==options.color?options.color:null}clone(){const color=this.getColor();return new Fill({color:Array.isArray(color)?color.slice():color||void 0})}getColor(){return this.color_}setColor(color){this.color_=color}}const __WEBPACK_DEFAULT_EXPORT__=Fill},"./node_modules/ol/style/Image.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _util_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/util.js"),_size_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/size.js");class ImageStyle{constructor(options){this.opacity_=options.opacity,this.rotateWithView_=options.rotateWithView,this.rotation_=options.rotation,this.scale_=options.scale,this.scaleArray_=(0,_size_js__WEBPACK_IMPORTED_MODULE_0__.xq)(options.scale),this.displacement_=options.displacement,this.declutterMode_=options.declutterMode}clone(){const scale=this.getScale();return new ImageStyle({opacity:this.getOpacity(),scale:Array.isArray(scale)?scale.slice():scale,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()})}getOpacity(){return this.opacity_}getRotateWithView(){return this.rotateWithView_}getRotation(){return this.rotation_}getScale(){return this.scale_}getScaleArray(){return this.scaleArray_}getDisplacement(){return this.displacement_}getDeclutterMode(){return this.declutterMode_}getAnchor(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getImage(pixelRatio){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getHitDetectionImage(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getPixelRatio(pixelRatio){return 1}getImageState(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getImageSize(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getOrigin(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}getSize(){return(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}setDisplacement(displacement){this.displacement_=displacement}setOpacity(opacity){this.opacity_=opacity}setRotateWithView(rotateWithView){this.rotateWithView_=rotateWithView}setRotation(rotation){this.rotation_=rotation}setScale(scale){this.scale_=scale,this.scaleArray_=(0,_size_js__WEBPACK_IMPORTED_MODULE_0__.xq)(scale)}listenImageChange(listener){(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}load(){(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}unlistenImageChange(listener){(0,_util_js__WEBPACK_IMPORTED_MODULE_1__.b0)()}}const __WEBPACK_DEFAULT_EXPORT__=ImageStyle},"./node_modules/ol/style/RegularShape.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});var _ImageState_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/ImageState.js"),_Image_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/style/Image.js"),_color_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__("./node_modules/ol/color.js"),_colorlike_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__("./node_modules/ol/colorlike.js"),_dom_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/dom.js"),_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/ol/render/canvas.js");class RegularShape extends _Image_js__WEBPACK_IMPORTED_MODULE_0__.A{constructor(options){super({opacity:1,rotateWithView:void 0!==options.rotateWithView&&options.rotateWithView,rotation:void 0!==options.rotation?options.rotation:0,scale:void 0!==options.scale?options.scale:1,displacement:void 0!==options.displacement?options.displacement:[0,0],declutterMode:options.declutterMode}),this.canvases_,this.hitDetectionCanvas_=null,this.fill_=void 0!==options.fill?options.fill:null,this.origin_=[0,0],this.points_=options.points,this.radius_=void 0!==options.radius?options.radius:options.radius1,this.radius2_=options.radius2,this.angle_=void 0!==options.angle?options.angle:0,this.stroke_=void 0!==options.stroke?options.stroke:null,this.size_,this.renderOptions_,this.render()}clone(){const scale=this.getScale(),style=new RegularShape({fill:this.getFill()?this.getFill().clone():void 0,points:this.getPoints(),radius:this.getRadius(),radius2:this.getRadius2(),angle:this.getAngle(),stroke:this.getStroke()?this.getStroke().clone():void 0,rotation:this.getRotation(),rotateWithView:this.getRotateWithView(),scale:Array.isArray(scale)?scale.slice():scale,displacement:this.getDisplacement().slice(),declutterMode:this.getDeclutterMode()});return style.setOpacity(this.getOpacity()),style}getAnchor(){const size=this.size_,displacement=this.getDisplacement(),scale=this.getScaleArray();return[size[0]/2-displacement[0]/scale[0],size[1]/2+displacement[1]/scale[1]]}getAngle(){return this.angle_}getFill(){return this.fill_}setFill(fill){this.fill_=fill,this.render()}getHitDetectionImage(){return this.hitDetectionCanvas_||(this.hitDetectionCanvas_=this.createHitDetectionCanvas_(this.renderOptions_)),this.hitDetectionCanvas_}getImage(pixelRatio){let image=this.canvases_[pixelRatio];if(!image){const renderOptions=this.renderOptions_,context=(0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.Y)(renderOptions.size*pixelRatio,renderOptions.size*pixelRatio);this.draw_(renderOptions,context,pixelRatio),image=context.canvas,this.canvases_[pixelRatio]=image}return image}getPixelRatio(pixelRatio){return pixelRatio}getImageSize(){return this.size_}getImageState(){return _ImageState_js__WEBPACK_IMPORTED_MODULE_2__.A.LOADED}getOrigin(){return this.origin_}getPoints(){return this.points_}getRadius(){return this.radius_}getRadius2(){return this.radius2_}getSize(){return this.size_}getStroke(){return this.stroke_}setStroke(stroke){this.stroke_=stroke,this.render()}listenImageChange(listener){}load(){}unlistenImageChange(listener){}calculateLineJoinSize_(lineJoin,strokeWidth,miterLimit){if(0===strokeWidth||this.points_===1/0||"bevel"!==lineJoin&&"miter"!==lineJoin)return strokeWidth;let r1=this.radius_,r2=void 0===this.radius2_?r1:this.radius2_;if(r1<r2){const tmp=r1;r1=r2,r2=tmp}const points=void 0===this.radius2_?this.points_:2*this.points_,alpha=2*Math.PI/points,a=r2*Math.sin(alpha),d=r1-Math.sqrt(r2*r2-a*a),e=Math.sqrt(a*a+d*d),miterRatio=e/a;if("miter"===lineJoin&&miterRatio<=miterLimit)return miterRatio*strokeWidth;const k=strokeWidth/2/miterRatio,l=strokeWidth/2*(d/e),bevelAdd=Math.sqrt((r1+k)*(r1+k)+l*l)-r1;if(void 0===this.radius2_||"bevel"===lineJoin)return 2*bevelAdd;const aa=r1*Math.sin(alpha),dd=r2-Math.sqrt(r1*r1-aa*aa),innerMiterRatio=Math.sqrt(aa*aa+dd*dd)/aa;if(innerMiterRatio<=miterLimit){const innerLength=innerMiterRatio*strokeWidth/2-r2-r1;return 2*Math.max(bevelAdd,innerLength)}return 2*bevelAdd}createRenderOptions(){let strokeStyle,lineCap=_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__._m,lineJoin=_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__._K,miterLimit=0,lineDash=null,lineDashOffset=0,strokeWidth=0;this.stroke_&&(strokeStyle=(0,_colorlike_js__WEBPACK_IMPORTED_MODULE_4__.F)(this.stroke_.getColor()??_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__.NT),strokeWidth=this.stroke_.getWidth()??_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__.aq,lineDash=this.stroke_.getLineDash(),lineDashOffset=this.stroke_.getLineDashOffset()??0,lineJoin=this.stroke_.getLineJoin()??_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__._K,lineCap=this.stroke_.getLineCap()??_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__._m,miterLimit=this.stroke_.getMiterLimit()??_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__.eL);const add=this.calculateLineJoinSize_(lineJoin,strokeWidth,miterLimit),maxRadius=Math.max(this.radius_,this.radius2_||0);return{strokeStyle,strokeWidth,size:Math.ceil(2*maxRadius+add),lineCap,lineDash,lineDashOffset,lineJoin,miterLimit}}render(){this.renderOptions_=this.createRenderOptions();const size=this.renderOptions_.size;this.canvases_={},this.hitDetectionCanvas_=null,this.size_=[size,size]}draw_(renderOptions,context,pixelRatio){if(context.scale(pixelRatio,pixelRatio),context.translate(renderOptions.size/2,renderOptions.size/2),this.createPath_(context),this.fill_){let color=this.fill_.getColor();null===color&&(color=_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__.qY),context.fillStyle=(0,_colorlike_js__WEBPACK_IMPORTED_MODULE_4__.F)(color),context.fill()}renderOptions.strokeStyle&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineCap=renderOptions.lineCap,context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke())}createHitDetectionCanvas_(renderOptions){let context;if(this.fill_){let color=this.fill_.getColor(),opacity=0;"string"==typeof color&&(color=(0,_color_js__WEBPACK_IMPORTED_MODULE_5__._j)(color)),null===color?opacity=1:Array.isArray(color)&&(opacity=4===color.length?color[3]:1),0===opacity&&(context=(0,_dom_js__WEBPACK_IMPORTED_MODULE_1__.Y)(renderOptions.size,renderOptions.size),this.drawHitDetectionCanvas_(renderOptions,context))}return context?context.canvas:this.getImage(1)}createPath_(context){let points=this.points_;const radius=this.radius_;if(points===1/0)context.arc(0,0,radius,0,2*Math.PI);else{const radius2=void 0===this.radius2_?radius:this.radius2_;void 0!==this.radius2_&&(points*=2);const startAngle=this.angle_-Math.PI/2,step=2*Math.PI/points;for(let i=0;i<points;i++){const angle0=startAngle+i*step,radiusC=i%2==0?radius:radius2;context.lineTo(radiusC*Math.cos(angle0),radiusC*Math.sin(angle0))}context.closePath()}}drawHitDetectionCanvas_(renderOptions,context){context.translate(renderOptions.size/2,renderOptions.size/2),this.createPath_(context),context.fillStyle=_render_canvas_js__WEBPACK_IMPORTED_MODULE_3__.qY,context.fill(),renderOptions.strokeStyle&&(context.strokeStyle=renderOptions.strokeStyle,context.lineWidth=renderOptions.strokeWidth,renderOptions.lineDash&&(context.setLineDash(renderOptions.lineDash),context.lineDashOffset=renderOptions.lineDashOffset),context.lineJoin=renderOptions.lineJoin,context.miterLimit=renderOptions.miterLimit,context.stroke())}}const __WEBPACK_DEFAULT_EXPORT__=RegularShape},"./node_modules/ol/style/Stroke.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{A:()=>__WEBPACK_DEFAULT_EXPORT__});class Stroke{constructor(options){options=options||{},this.color_=void 0!==options.color?options.color:null,this.lineCap_=options.lineCap,this.lineDash_=void 0!==options.lineDash?options.lineDash:null,this.lineDashOffset_=options.lineDashOffset,this.lineJoin_=options.lineJoin,this.miterLimit_=options.miterLimit,this.width_=options.width}clone(){const color=this.getColor();return new Stroke({color:Array.isArray(color)?color.slice():color||void 0,lineCap:this.getLineCap(),lineDash:this.getLineDash()?this.getLineDash().slice():void 0,lineDashOffset:this.getLineDashOffset(),lineJoin:this.getLineJoin(),miterLimit:this.getMiterLimit(),width:this.getWidth()})}getColor(){return this.color_}getLineCap(){return this.lineCap_}getLineDash(){return this.lineDash_}getLineDashOffset(){return this.lineDashOffset_}getLineJoin(){return this.lineJoin_}getMiterLimit(){return this.miterLimit_}getWidth(){return this.width_}setColor(color){this.color_=color}setLineCap(lineCap){this.lineCap_=lineCap}setLineDash(lineDash){this.lineDash_=lineDash}setLineDashOffset(lineDashOffset){this.lineDashOffset_=lineDashOffset}setLineJoin(lineJoin){this.lineJoin_=lineJoin}setMiterLimit(miterLimit){this.miterLimit_=miterLimit}setWidth(width){this.width_=width}}const __WEBPACK_DEFAULT_EXPORT__=Stroke},"./node_modules/ol/style/Style.js":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{"use strict";__webpack_require__.d(__webpack_exports__,{Ay:()=>__WEBPACK_DEFAULT_EXPORT__,d1:()=>createDefaultStyle,mC:()=>toFunction});var _Circle_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__("./node_modules/ol/style/Circle.js"),_Fill_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__("./node_modules/ol/style/Fill.js"),_Stroke_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__("./node_modules/ol/style/Stroke.js"),_asserts_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__("./node_modules/ol/asserts.js");class Style{constructor(options){options=options||{},this.geometry_=null,this.geometryFunction_=defaultGeometryFunction,void 0!==options.geometry&&this.setGeometry(options.geometry),this.fill_=void 0!==options.fill?options.fill:null,this.image_=void 0!==options.image?options.image:null,this.renderer_=void 0!==options.renderer?options.renderer:null,this.hitDetectionRenderer_=void 0!==options.hitDetectionRenderer?options.hitDetectionRenderer:null,this.stroke_=void 0!==options.stroke?options.stroke:null,this.text_=void 0!==options.text?options.text:null,this.zIndex_=options.zIndex}clone(){let geometry=this.getGeometry();return geometry&&"object"==typeof geometry&&(geometry=geometry.clone()),new Style({geometry:geometry??void 0,fill:this.getFill()?this.getFill().clone():void 0,image:this.getImage()?this.getImage().clone():void 0,renderer:this.getRenderer()??void 0,stroke:this.getStroke()?this.getStroke().clone():void 0,text:this.getText()?this.getText().clone():void 0,zIndex:this.getZIndex()})}getRenderer(){return this.renderer_}setRenderer(renderer){this.renderer_=renderer}setHitDetectionRenderer(renderer){this.hitDetectionRenderer_=renderer}getHitDetectionRenderer(){return this.hitDetectionRenderer_}getGeometry(){return this.geometry_}getGeometryFunction(){return this.geometryFunction_}getFill(){return this.fill_}setFill(fill){this.fill_=fill}getImage(){return this.image_}setImage(image){this.image_=image}getStroke(){return this.stroke_}setStroke(stroke){this.stroke_=stroke}getText(){return this.text_}setText(text){this.text_=text}getZIndex(){return this.zIndex_}setGeometry(geometry){"function"==typeof geometry?this.geometryFunction_=geometry:"string"==typeof geometry?this.geometryFunction_=function(feature){return feature.get(geometry)}:geometry?void 0!==geometry&&(this.geometryFunction_=function(){return geometry}):this.geometryFunction_=defaultGeometryFunction,this.geometry_=geometry}setZIndex(zIndex){this.zIndex_=zIndex}}function toFunction(obj){let styleFunction;if("function"==typeof obj)styleFunction=obj;else{let styles;if(Array.isArray(obj))styles=obj;else{(0,_asserts_js__WEBPACK_IMPORTED_MODULE_0__.v)("function"==typeof obj.getZIndex,"Expected an `Style` or an array of `Style`");styles=[obj]}styleFunction=function(){return styles}}return styleFunction}let defaultStyles=null;function createDefaultStyle(feature,resolution){if(!defaultStyles){const fill=new _Fill_js__WEBPACK_IMPORTED_MODULE_1__.A({color:"rgba(255,255,255,0.4)"}),stroke=new _Stroke_js__WEBPACK_IMPORTED_MODULE_2__.A({color:"#3399CC",width:1.25});defaultStyles=[new Style({image:new _Circle_js__WEBPACK_IMPORTED_MODULE_3__.A({fill,stroke,radius:5}),fill,stroke})]}return defaultStyles}function defaultGeometryFunction(feature){return feature.getGeometry()}const __WEBPACK_DEFAULT_EXPORT__=Style},"./node_modules/pbf/index.js":(module,__unused_webpack_exports,__webpack_require__)=>{"use strict";module.exports=Pbf;var ieee754=__webpack_require__("./node_modules/ieee754/index.js");function Pbf(buf){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(buf)?buf:new Uint8Array(buf||0),this.pos=0,this.type=0,this.length=this.buf.length}Pbf.Varint=0,Pbf.Fixed64=1,Pbf.Bytes=2,Pbf.Fixed32=5;var utf8TextDecoder="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function readPackedEnd(pbf){return pbf.type===Pbf.Bytes?pbf.readVarint()+pbf.pos:pbf.pos+1}function toNum(low,high,isSigned){return isSigned?4294967296*high+(low>>>0):4294967296*(high>>>0)+(low>>>0)}function makeRoomForExtraLength(startPos,len,pbf){var extraLen=len<=16383?1:len<=2097151?2:len<=268435455?3:Math.floor(Math.log(len)/(7*Math.LN2));pbf.realloc(extraLen);for(var i=pbf.pos-1;i>=startPos;i--)pbf.buf[i+extraLen]=pbf.buf[i]}function writePackedVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeVarint(arr[i])}function writePackedSVarint(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSVarint(arr[i])}function writePackedFloat(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFloat(arr[i])}function writePackedDouble(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeDouble(arr[i])}function writePackedBoolean(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeBoolean(arr[i])}function writePackedFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed32(arr[i])}function writePackedSFixed32(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed32(arr[i])}function writePackedFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeFixed64(arr[i])}function writePackedSFixed64(arr,pbf){for(var i=0;i<arr.length;i++)pbf.writeSFixed64(arr[i])}function readUInt32(buf,pos){return(buf[pos]|buf[pos+1]<<8|buf[pos+2]<<16)+16777216*buf[pos+3]}function writeInt32(buf,val,pos){buf[pos]=val,buf[pos+1]=val>>>8,buf[pos+2]=val>>>16,buf[pos+3]=val>>>24}function readInt32(buf,pos){return(buf[pos]|buf[pos+1]<<8|buf[pos+2]<<16)+(buf[pos+3]<<24)}Pbf.prototype={destroy:function(){this.buf=null},readFields:function(readField,result,end){for(end=end||this.length;this.pos<end;){var val=this.readVarint(),tag=val>>3,startPos=this.pos;this.type=7&val,readField(tag,result,this),this.pos===startPos&&this.skip(val)}return result},readMessage:function(readField,result){return this.readFields(readField,result,this.readVarint()+this.pos)},readFixed32:function(){var val=readUInt32(this.buf,this.pos);return this.pos+=4,val},readSFixed32:function(){var val=readInt32(this.buf,this.pos);return this.pos+=4,val},readFixed64:function(){var val=readUInt32(this.buf,this.pos)+4294967296*readUInt32(this.buf,this.pos+4);return this.pos+=8,val},readSFixed64:function(){var val=readUInt32(this.buf,this.pos)+4294967296*readInt32(this.buf,this.pos+4);return this.pos+=8,val},readFloat:function(){var val=ieee754.read(this.buf,this.pos,!0,23,4);return this.pos+=4,val},readDouble:function(){var val=ieee754.read(this.buf,this.pos,!0,52,8);return this.pos+=8,val},readVarint:function(isSigned){var val,b,buf=this.buf;return val=127&(b=buf[this.pos++]),b<128?val:(val|=(127&(b=buf[this.pos++]))<<7,b<128?val:(val|=(127&(b=buf[this.pos++]))<<14,b<128?val:(val|=(127&(b=buf[this.pos++]))<<21,b<128?val:function readVarintRemainder(l,s,p){var h,b,buf=p.buf;if(b=buf[p.pos++],h=(112&b)>>4,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<3,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<10,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<17,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(127&b)<<24,b<128)return toNum(l,h,s);if(b=buf[p.pos++],h|=(1&b)<<31,b<128)return toNum(l,h,s);throw new Error("Expected varint not more than 10 bytes")}(val|=(15&(b=buf[this.pos]))<<28,isSigned,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var num=this.readVarint();return num%2==1?(num+1)/-2:num/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var end=this.readVarint()+this.pos,pos=this.pos;return this.pos=end,end-pos>=12&&utf8TextDecoder?function readUtf8TextDecoder(buf,pos,end){return utf8TextDecoder.decode(buf.subarray(pos,end))}(this.buf,pos,end):function readUtf8(buf,pos,end){var str="",i=pos;for(;i<end;){var b1,b2,b3,b0=buf[i],c=null,bytesPerSequence=b0>239?4:b0>223?3:b0>191?2:1;if(i+bytesPerSequence>end)break;1===bytesPerSequence?b0<128&&(c=b0):2===bytesPerSequence?128==(192&(b1=buf[i+1]))&&(c=(31&b0)<<6|63&b1)<=127&&(c=null):3===bytesPerSequence?(b1=buf[i+1],b2=buf[i+2],128==(192&b1)&&128==(192&b2)&&((c=(15&b0)<<12|(63&b1)<<6|63&b2)<=2047||c>=55296&&c<=57343)&&(c=null)):4===bytesPerSequence&&(b1=buf[i+1],b2=buf[i+2],b3=buf[i+3],128==(192&b1)&&128==(192&b2)&&128==(192&b3)&&((c=(15&b0)<<18|(63&b1)<<12|(63&b2)<<6|63&b3)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,bytesPerSequence=1):c>65535&&(c-=65536,str+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),str+=String.fromCharCode(c),i+=bytesPerSequence}return str}(this.buf,pos,end)},readBytes:function(){var end=this.readVarint()+this.pos,buffer=this.buf.subarray(this.pos,end);return this.pos=end,buffer},readPackedVarint:function(arr,isSigned){if(this.type!==Pbf.Bytes)return arr.push(this.readVarint(isSigned));var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readVarint(isSigned));return arr},readPackedSVarint:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readSVarint());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readSVarint());return arr},readPackedBoolean:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readBoolean());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readBoolean());return arr},readPackedFloat:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readFloat());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readFloat());return arr},readPackedDouble:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readDouble());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readDouble());return arr},readPackedFixed32:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readFixed32());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readFixed32());return arr},readPackedSFixed32:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readSFixed32());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readSFixed32());return arr},readPackedFixed64:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readFixed64());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readFixed64());return arr},readPackedSFixed64:function(arr){if(this.type!==Pbf.Bytes)return arr.push(this.readSFixed64());var end=readPackedEnd(this);for(arr=arr||[];this.pos<end;)arr.push(this.readSFixed64());return arr},skip:function(val){var type=7&val;if(type===Pbf.Varint)for(;this.buf[this.pos++]>127;);else if(type===Pbf.Bytes)this.pos=this.readVarint()+this.pos;else if(type===Pbf.Fixed32)this.pos+=4;else{if(type!==Pbf.Fixed64)throw new Error("Unimplemented type: "+type);this.pos+=8}},writeTag:function(tag,type){this.writeVarint(tag<<3|type)},realloc:function(min){for(var length=this.length||16;length<this.pos+min;)length*=2;if(length!==this.length){var buf=new Uint8Array(length);buf.set(this.buf),this.buf=buf,this.length=length}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(val){this.realloc(4),writeInt32(this.buf,val,this.pos),this.pos+=4},writeSFixed32:function(val){this.realloc(4),writeInt32(this.buf,val,this.pos),this.pos+=4},writeFixed64:function(val){this.realloc(8),writeInt32(this.buf,-1&val,this.pos),writeInt32(this.buf,Math.floor(2.3283064365386963e-10*val),this.pos+4),this.pos+=8},writeSFixed64:function(val){this.realloc(8),writeInt32(this.buf,-1&val,this.pos),writeInt32(this.buf,Math.floor(2.3283064365386963e-10*val),this.pos+4),this.pos+=8},writeVarint:function(val){(val=+val||0)>268435455||val<0?function writeBigVarint(val,pbf){var low,high;val>=0?(low=val%4294967296|0,high=val/4294967296|0):(high=~(-val/4294967296),4294967295^(low=~(-val%4294967296))?low=low+1|0:(low=0,high=high+1|0));if(val>=0x10000000000000000||val<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");pbf.realloc(10),function writeBigVarintLow(low,high,pbf){pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos++]=127&low|128,low>>>=7,pbf.buf[pbf.pos]=127&low}(low,0,pbf),function writeBigVarintHigh(high,pbf){var lsb=(7&high)<<4;if(pbf.buf[pbf.pos++]|=lsb|((high>>>=3)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;if(pbf.buf[pbf.pos++]=127&high|((high>>>=7)?128:0),!high)return;pbf.buf[pbf.pos++]=127&high}(high,pbf)}(val,this):(this.realloc(4),this.buf[this.pos++]=127&val|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=127&(val>>>=7)|(val>127?128:0),val<=127||(this.buf[this.pos++]=val>>>7&127))))},writeSVarint:function(val){this.writeVarint(val<0?2*-val-1:2*val)},writeBoolean:function(val){this.writeVarint(Boolean(val))},writeString:function(str){str=String(str),this.realloc(4*str.length),this.pos++;var startPos=this.pos;this.pos=function writeUtf8(buf,str,pos){for(var c,lead,i=0;i<str.length;i++){if((c=str.charCodeAt(i))>55295&&c<57344){if(!lead){c>56319||i+1===str.length?(buf[pos++]=239,buf[pos++]=191,buf[pos++]=189):lead=c;continue}if(c<56320){buf[pos++]=239,buf[pos++]=191,buf[pos++]=189,lead=c;continue}c=lead-55296<<10|c-56320|65536,lead=null}else lead&&(buf[pos++]=239,buf[pos++]=191,buf[pos++]=189,lead=null);c<128?buf[pos++]=c:(c<2048?buf[pos++]=c>>6|192:(c<65536?buf[pos++]=c>>12|224:(buf[pos++]=c>>18|240,buf[pos++]=c>>12&63|128),buf[pos++]=c>>6&63|128),buf[pos++]=63&c|128)}return pos}(this.buf,str,this.pos);var len=this.pos-startPos;len>=128&&makeRoomForExtraLength(startPos,len,this),this.pos=startPos-1,this.writeVarint(len),this.pos+=len},writeFloat:function(val){this.realloc(4),ieee754.write(this.buf,val,this.pos,!0,23,4),this.pos+=4},writeDouble:function(val){this.realloc(8),ieee754.write(this.buf,val,this.pos,!0,52,8),this.pos+=8},writeBytes:function(buffer){var len=buffer.length;this.writeVarint(len),this.realloc(len);for(var i=0;i<len;i++)this.buf[this.pos++]=buffer[i]},writeRawMessage:function(fn,obj){this.pos++;var startPos=this.pos;fn(obj,this);var len=this.pos-startPos;len>=128&&makeRoomForExtraLength(startPos,len,this),this.pos=startPos-1,this.writeVarint(len),this.pos+=len},writeMessage:function(tag,fn,obj){this.writeTag(tag,Pbf.Bytes),this.writeRawMessage(fn,obj)},writePackedVarint:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedVarint,arr)},writePackedSVarint:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedSVarint,arr)},writePackedBoolean:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedBoolean,arr)},writePackedFloat:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedFloat,arr)},writePackedDouble:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedDouble,arr)},writePackedFixed32:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedFixed32,arr)},writePackedSFixed32:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedSFixed32,arr)},writePackedFixed64:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedFixed64,arr)},writePackedSFixed64:function(tag,arr){arr.length&&this.writeMessage(tag,writePackedSFixed64,arr)},writeBytesField:function(tag,buffer){this.writeTag(tag,Pbf.Bytes),this.writeBytes(buffer)},writeFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFixed32(val)},writeSFixed32Field:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeSFixed32(val)},writeFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeFixed64(val)},writeSFixed64Field:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeSFixed64(val)},writeVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeVarint(val)},writeSVarintField:function(tag,val){this.writeTag(tag,Pbf.Varint),this.writeSVarint(val)},writeStringField:function(tag,str){this.writeTag(tag,Pbf.Bytes),this.writeString(str)},writeFloatField:function(tag,val){this.writeTag(tag,Pbf.Fixed32),this.writeFloat(val)},writeDoubleField:function(tag,val){this.writeTag(tag,Pbf.Fixed64),this.writeDouble(val)},writeBooleanField:function(tag,val){this.writeVarintField(tag,Boolean(val))}}},"./node_modules/rbush/rbush.min.js":function(module){module.exports=function(){"use strict";function t(t,r,e,a,h){!function t(n,r,e,a,h){for(;a>e;){if(a-e>600){var o=a-e+1,s=r-e+1,l=Math.log(o),f=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*f*(o-f)/o)*(s-o/2<0?-1:1);t(n,r,Math.max(e,Math.floor(r-s*f/o+u)),Math.min(a,Math.floor(r+(o-s)*f/o+u)),h)}var p=n[r],d=e,x=a;for(i(n,e,r),h(n[a],p)>0&&i(n,e,a);d<x;){for(i(n,d,x),d++,x--;h(n[d],p)<0;)d++;for(;h(n[x],p)>0;)x--}0===h(n[e],p)?i(n,e,x):i(n,++x,a),x<=r&&(e=x+1),r<=x&&(a=x-1)}}(t,r,e||0,a||t.length-1,h||n)}function i(t,i,n){var r=t[i];t[i]=t[n],t[n]=r}function n(t,i){return t<i?-1:t>i?1:0}var r=function(t){void 0===t&&(t=9),this._maxEntries=Math.max(4,t),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()};function e(t,i,n){if(!n)return i.indexOf(t);for(var r=0;r<i.length;r++)if(n(t,i[r]))return r;return-1}function a(t,i){h(t,0,t.children.length,i,t)}function h(t,i,n,r,e){e||(e=p(null)),e.minX=1/0,e.minY=1/0,e.maxX=-1/0,e.maxY=-1/0;for(var a=i;a<n;a++){var h=t.children[a];o(e,t.leaf?r(h):h)}return e}function o(t,i){return t.minX=Math.min(t.minX,i.minX),t.minY=Math.min(t.minY,i.minY),t.maxX=Math.max(t.maxX,i.maxX),t.maxY=Math.max(t.maxY,i.maxY),t}function s(t,i){return t.minX-i.minX}function l(t,i){return t.minY-i.minY}function f(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function u(t){return t.maxX-t.minX+(t.maxY-t.minY)}function m(t,i){return t.minX<=i.minX&&t.minY<=i.minY&&i.maxX<=t.maxX&&i.maxY<=t.maxY}function c(t,i){return i.minX<=t.maxX&&i.minY<=t.maxY&&i.maxX>=t.minX&&i.maxY>=t.minY}function p(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function d(i,n,r,e,a){for(var h=[n,r];h.length;)if(!((r=h.pop())-(n=h.pop())<=e)){var o=n+Math.ceil((r-n)/e/2)*e;t(i,o,n,r,a),h.push(n,o,o,r)}}return r.prototype.all=function(){return this._all(this.data,[])},r.prototype.search=function(t){var i=this.data,n=[];if(!c(t,i))return n;for(var r=this.toBBox,e=[];i;){for(var a=0;a<i.children.length;a++){var h=i.children[a],o=i.leaf?r(h):h;c(t,o)&&(i.leaf?n.push(h):m(t,o)?this._all(h,n):e.push(h))}i=e.pop()}return n},r.prototype.collides=function(t){var i=this.data;if(!c(t,i))return!1;for(var n=[];i;){for(var r=0;r<i.children.length;r++){var e=i.children[r],a=i.leaf?this.toBBox(e):e;if(c(t,a)){if(i.leaf||m(t,a))return!0;n.push(e)}}i=n.pop()}return!1},r.prototype.load=function(t){if(!t||!t.length)return this;if(t.length<this._minEntries){for(var i=0;i<t.length;i++)this.insert(t[i]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(this.data.height<n.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this},r.prototype.insert=function(t){return t&&this._insert(t,this.data.height-1),this},r.prototype.clear=function(){return this.data=p([]),this},r.prototype.remove=function(t,i){if(!t)return this;for(var n,r,a,h=this.data,o=this.toBBox(t),s=[],l=[];h||s.length;){if(h||(h=s.pop(),r=s[s.length-1],n=l.pop(),a=!0),h.leaf){var f=e(t,h.children,i);if(-1!==f)return h.children.splice(f,1),s.push(h),this._condense(s),this}a||h.leaf||!m(h,o)?r?(n++,h=r.children[n],a=!1):h=null:(s.push(h),l.push(n),n=0,r=h,h=h.children[0])}return this},r.prototype.toBBox=function(t){return t},r.prototype.compareMinX=function(t,i){return t.minX-i.minX},r.prototype.compareMinY=function(t,i){return t.minY-i.minY},r.prototype.toJSON=function(){return this.data},r.prototype.fromJSON=function(t){return this.data=t,this},r.prototype._all=function(t,i){for(var n=[];t;)t.leaf?i.push.apply(i,t.children):n.push.apply(n,t.children),t=n.pop();return i},r.prototype._build=function(t,i,n,r){var e,h=n-i+1,o=this._maxEntries;if(h<=o)return a(e=p(t.slice(i,n+1)),this.toBBox),e;r||(r=Math.ceil(Math.log(h)/Math.log(o)),o=Math.ceil(h/Math.pow(o,r-1))),(e=p([])).leaf=!1,e.height=r;var s=Math.ceil(h/o),l=s*Math.ceil(Math.sqrt(o));d(t,i,n,l,this.compareMinX);for(var f=i;f<=n;f+=l){var u=Math.min(f+l-1,n);d(t,f,u,s,this.compareMinY);for(var m=f;m<=u;m+=s){var c=Math.min(m+s-1,u);e.children.push(this._build(t,m,c,r-1))}}return a(e,this.toBBox),e},r.prototype._chooseSubtree=function(t,i,n,r){for(;r.push(i),!i.leaf&&r.length-1!==n;){for(var e=1/0,a=1/0,h=void 0,o=0;o<i.children.length;o++){var s=i.children[o],l=f(s),u=(m=t,c=s,(Math.max(c.maxX,m.maxX)-Math.min(c.minX,m.minX))*(Math.max(c.maxY,m.maxY)-Math.min(c.minY,m.minY))-l);u<a?(a=u,e=l<e?l:e,h=s):u===a&&l<e&&(e=l,h=s)}i=h||i.children[0]}var m,c;return i},r.prototype._insert=function(t,i,n){var r=n?t:this.toBBox(t),e=[],a=this._chooseSubtree(r,this.data,i,e);for(a.children.push(t),o(a,r);i>=0&&e[i].children.length>this._maxEntries;)this._split(e,i),i--;this._adjustParentBBoxes(r,e,i)},r.prototype._split=function(t,i){var n=t[i],r=n.children.length,e=this._minEntries;this._chooseSplitAxis(n,e,r);var h=this._chooseSplitIndex(n,e,r),o=p(n.children.splice(h,n.children.length-h));o.height=n.height,o.leaf=n.leaf,a(n,this.toBBox),a(o,this.toBBox),i?t[i-1].children.push(o):this._splitRoot(n,o)},r.prototype._splitRoot=function(t,i){this.data=p([t,i]),this.data.height=t.height+1,this.data.leaf=!1,a(this.data,this.toBBox)},r.prototype._chooseSplitIndex=function(t,i,n){for(var r,e,a,o,s,l,u,m=1/0,c=1/0,p=i;p<=n-i;p++){var d=h(t,0,p,this.toBBox),x=h(t,p,n,this.toBBox),v=(e=d,a=x,o=void 0,s=void 0,l=void 0,u=void 0,o=Math.max(e.minX,a.minX),s=Math.max(e.minY,a.minY),l=Math.min(e.maxX,a.maxX),u=Math.min(e.maxY,a.maxY),Math.max(0,l-o)*Math.max(0,u-s)),M=f(d)+f(x);v<m?(m=v,r=p,c=M<c?M:c):v===m&&M<c&&(c=M,r=p)}return r||n-i},r.prototype._chooseSplitAxis=function(t,i,n){var r=t.leaf?this.compareMinX:s,e=t.leaf?this.compareMinY:l;this._allDistMargin(t,i,n,r)<this._allDistMargin(t,i,n,e)&&t.children.sort(r)},r.prototype._allDistMargin=function(t,i,n,r){t.children.sort(r);for(var e=this.toBBox,a=h(t,0,i,e),s=h(t,n-i,n,e),l=u(a)+u(s),f=i;f<n-i;f++){var m=t.children[f];o(a,t.leaf?e(m):m),l+=u(a)}for(var c=n-i-1;c>=i;c--){var p=t.children[c];o(s,t.leaf?e(p):p),l+=u(s)}return l},r.prototype._adjustParentBBoxes=function(t,i,n){for(var r=n;r>=0;r--)o(i[r],t)},r.prototype._condense=function(t){for(var i=t.length-1,n=void 0;i>=0;i--)0===t[i].children.length?i>0?(n=t[i-1].children).splice(n.indexOf(t[i]),1):this.clear():a(t[i],this.toBBox)},r}()}}]);