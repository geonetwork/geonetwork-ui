<gn-ui-sticky-header
  [fullHeightPx]="fullHeaderHeight$ | async"
  [minHeightPx]="60"
>
  <ng-template let-expandRatio>
    <header
      class="w-full sm:h-[344px] grid"
      [ngClass]="(thumbnailUrl$ | async) ? 'h-[554px]' : 'h-[344px]'"
    >
      <div
        [style.background]="backgroundCss"
        [style.opacity]="-1 + (1 - expandRatio) * 2 < 1 ? '1' : '0'"
      >
        <div class="h-full w-full container-lg mx-auto px-4">
          <div
            class="h-[60px] py-3 flex flex-row justify-between content-center items-center"
          >
            <gn-ui-button
              (buttonClick)="back()"
              data-cy="backButton"
              type="outline"
              extraClass="bg-transparent"
              [style.--gn-ui-button-color]="foregroundColor"
              [style.--gn-ui-button-height]="'32px'"
              [style.--color-gray-300]="foregroundColor"
            >
              <ng-icon
                name="matArrowBack"
                size="20px"
                class="align-middle"
              ></ng-icon>
              <span class="mx-2 mt-0.5 text-base content-center" translate
                >datahub.search.back</span
              >
            </gn-ui-button>
            <div class="flex flex-row content-center gap-3">
              @if (metadata?.uniqueIdentifier && !isAuthDisabled) {
                <gn-ui-favorite-star
                  [record]="metadata"
                  [displayLabel]="(isMobile$ | async) ? false : true"
                  [displayCount]="false"
                  class="flex text-background content-center"
                  [buttonType]="'outline'"
                  [style.--gn-ui-button-color]="foregroundColor"
                  [style.--gn-ui-button-background]="'none'"
                  [style.--color-gray-300]="foregroundColor"
                ></gn-ui-favorite-star>
              }
              @if (showLanguageSwitcher) {
                <gn-ui-language-switcher
                  [style.--color-main]="foregroundColor"
                  [style.--color-gray-300]="foregroundColor"
                ></gn-ui-language-switcher>
              }
            </div>
          </div>
          <div
            class="py-7 grid gap-3 grid-cols-1 sm:gap-6 sm:grid-cols-3 items-center content-center min-h-[228px]"
          >
            <div class="sm:col-span-2 justify-center">
              <div class="flex flex-col gap-3">
                @if (metadata) {
                  <h1
                    class="font-title text-[28px] max-w-screen-sm line-clamp-3"
                    [style.color]="foregroundColor"
                  >
                    {{ metadata.title }}
                  </h1>
                }
                @if (
                  metadata.kind === 'reuse' && (reuseLinkUrl$ | async);
                  as reuseLink
                ) {
                  <a
                    [href]="reuseLink"
                    class="h-8 max-w-60 w-fit py-1 px-2 gn-ui-btn-primary"
                    target="_blank"
                  >
                    {{ 'reuse.metadata.access' | translate }}
                    <ng-icon
                      class="ml-2 text-[0.9em]"
                      name="iconoirOpenNewWindow"
                    ></ng-icon
                  ></a>
                }
                <div
                  class="flex flex-row flex-wrap items-center gap-4"
                  [style.color]="foregroundColor"
                  data-test="metadataBadges"
                >
                  <gn-ui-kind-badge
                    [styling]="'outline'"
                    [kind]="metadata.kind"
                  ></gn-ui-kind-badge>
                  <gn-ui-geo-data-badge
                    [styling]="'default'"
                    [record]="metadata"
                  ></gn-ui-geo-data-badge>
                  @if (
                    resourceDate &&
                    resourceDate.date &&
                    metadata.kind !== 'service'
                  ) {
                    <div>
                      <p class="text-sm">
                        <span translate>{{ resourceDate.label }}</span
                        >&nbsp;
                        <span [gnUiHumanizeDate]="resourceDate.date"></span>
                      </p>
                    </div>
                  }
                  @if (metadata.kind === 'dataset' && metadata.status) {
                    <div class="flex flex-row gap-4 text-sm">
                      <p>â€¢</p>
                      <p
                        [innerHTML]="
                          'domain.record.status.' + metadata.status | translate
                        "
                      ></p>
                    </div>
                  }
                </div>
              </div>
            </div>
            @if ((thumbnailUrl$ | async) && showOverlay) {
              <gn-ui-image-overlay-preview
                class="block h-[228px] w-full self-center"
                [imageUrl]="thumbnailUrl$ | async"
                (isPlaceholderShown)="showOverlay = !$event"
              >
              </gn-ui-image-overlay-preview>
            }
          </div>
        </div>
      </div>
      @if ((facade.isMetadataLoading$ | async) === false) {
        <datahub-navigation-bar
          [metadata]="metadata"
          [style.display]="-1 + (1 - expandRatio) * 2 < 1 ? 'none' : 'block'"
          [style.pointer-events]="
            -1 + (1 - expandRatio) * 2 < 1 ? 'none' : 'auto'
          "
        ></datahub-navigation-bar>
      }
    </header>
  </ng-template>
</gn-ui-sticky-header>
