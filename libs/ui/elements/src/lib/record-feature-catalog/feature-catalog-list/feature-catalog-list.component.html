<div
  cdkScrollable
  class="h-[562px] relative overflow-y-auto overflow-hidden"
  data-cy="feat-catalog-scrollable"
>
  <div #scrollContainer class="flex flex-col gap-2 py-5 px-5">
    @for (
      featureType of filteredFeatureCatalog?.featureTypes;
      track featureType
    ) {
      <div class="rounded shadow bg-white">
        <gn-ui-expandable-panel
          #expanel
          [collapsed]="filteredFeatureCatalog?.featureTypes?.length !== 1"
          iconColor="black"
        >
          <ng-template #titleTemplate>
            <div class="px-2">
              <div class="text-lg font-bold">{{ featureType.name }}</div>
              @if (featureType.definition) {
                <div class="text-sm">
                  {{ featureType.definition }}
                </div>
              }
            </div>
          </ng-template>
          @if (expanel && !expanel.collapsed) {
            <div
              class="grid gap-0"
              [style.grid-template-columns]="
                getGridTemplateColumns(featureType.attributes)
              "
              data-cy="feature-type-content"
            >
              @for (
                col of getColumnsDefinition(featureType.attributes);
                track trackByColumn(i, col);
                let i = $index
              ) {
                <div
                  class="py-1 px-2 text-sm font-bold text-left border-t break-all"
                  [class.border-l]="i > 0"
                  [class.border-gray-300]="i > 0"
                  [ngClass]="col.class || ''"
                  data-test="column-label"
                >
                  {{ 'feature.catalog.attribute.' + col.key | translate }}
                </div>
              }
              @if (expanel && !expanel.collapsed) {
                @for (row of featureType.attributes; track row) {
                  @for (
                    col of getColumnsDefinition(featureType.attributes);
                    track trackByColumn(i, col);
                    let i = $index
                  ) {
                    <div
                      class="bg-white text-sm font-normal text-left border-t"
                      [class.border-l]="i > 0"
                      [class.border-gray-300]="i > 0"
                      data-test="cell-content"
                    >
                      @if (col.key === 'values') {
                        @if (row.values?.length > 0) {
                          <gn-ui-cell-popin
                            #popinRef
                            [scrollContainer]="scrollContainer"
                            [cdkScrollContainer]="scrollable"
                          >
                            <div
                              cellContent
                              data-cy="values-cell-popin-trigger"
                            >
                              <gn-ui-button
                                type="light"
                                extraClass="bg-transparent border-none"
                                (buttonClick)="popinRef.openOverlay()"
                              >
                                <ng-icon name="iconoirList" size="24"></ng-icon>
                              </gn-ui-button>
                            </div>
                            <div
                              popinContent
                              class="max-h-60 overflow-y-auto min-w-64 py-4 px-6"
                              style="scrollbar-width: thin"
                            >
                              <ul class="list-disc list-inside mr-4">
                                @for (v of row.values; track v) {
                                  <li>
                                    {{ v.label || v.code }}
                                  </li>
                                }
                              </ul>
                            </div>
                          </gn-ui-cell-popin>
                        }
                      } @else {
                        <gn-ui-truncated-text
                          [scrollContainer]="scrollContainer"
                          [cdkScrollContainer]="scrollable"
                          [text]="row[col.key]"
                        ></gn-ui-truncated-text>
                      }
                    </div>
                  }
                }
              }
            </div>
          }
        </gn-ui-expandable-panel>
      </div>
    }
  </div>
</div>
