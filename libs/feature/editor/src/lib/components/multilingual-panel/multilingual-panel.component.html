<div
  class="flex flex-col h-full w-[302px] border-l border-gray-300 py-8 px-3 gap-6 overflow-auto"
  style="background-color: #fafaf9"
>
  <div class="flex flex-row px-2 justify-between">
    <span class="text-3xl font-title text-black/80" translate
      >editor.record.form.multilingual.title</span
    >
    @if (isMultilingual) {
      <button
        [title]="'editor.record.form.multilingual.open' | translate"
        (click)="toggleLanguageSelection()"
        data-test="activateSelection"
      >
        <ng-icon class="mt-1" name="iconoirSettings"></ng-icon>
      </button>
    }
  </div>
  @if (editTranslations || !isMultilingual) {
    <div class="flex flex-col gap-2">
      <gn-ui-check-toggle
        class="p-2"
        [label]="'editor.record.form.multilingual.enable' | translate"
        [color]="'primary'"
        [(value)]="isMultilingual"
        (toggled)="switchMultilingual($event)"
      ></gn-ui-check-toggle>
      @if (isMultilingual) {
        <div class="flex flex-col gap-2">
          <div
            class="flex flex-row justify-between border-t border-gray-300 p-3"
          >
            <span class="mt-2 text-sm text-gray-600" translate
              >editor.record.form.multilingual.activate</span
            >
            <gn-ui-button
              extraClass="w-16 h-8 font-bold"
              type="gray"
              (buttonClick)="validateTranslations()"
              data-test="validateSelection"
              >{{ 'editor.record.form.multilingual.validate' | translate }}
            </gn-ui-button>
          </div>
          @if (supportedLanguages$ | async; as languages) {
            @for (lang of languages; track lang) {
              <div
                class="flex flex-col gap-2 w-full px-2"
                data-test="langAvailable"
                [attr.data-test-lang]="lang"
              >
                <gn-ui-button
                  [extraClass]="getExtraClass(lang)"
                  type="gray"
                  (buttonClick)="toggleLanguage(lang)"
                  [disabled]="lang === _record.defaultLanguage"
                  [title]="getToggleTitle(lang)"
                >
                  <span [class]="getIconClass(lang)"></span>
                  <span class="ml-2">{{ 'language.' + lang | translate }}</span>
                </gn-ui-button>
              </div>
            }
          }
        </div>
      }
    </div>
  }
  @if (!editTranslations && isMultilingual) {
    <div class="flex flex-col gap-2">
      @for (
        recordLang of sortLanguages(recordLanguages);
        track recordLang;
        let i = $index
      ) {
        <gn-ui-button
          extraClass="flex flex-row justify-between bg-white border border-white rounded mb-1 h-[34px] w-full"
          [ngClass]="{
            'mt-8': isFirstUnsupported(i),
            '': true,
          }"
          (buttonClick)="switchFormLang(recordLang)"
          type="outline"
          data-test="langSwitch"
        >
          <div class="flex flex-row gap-2 items-center">
            @if (recordLang === formLanguage) {
              <ng-icon
                class="text-primary mt-1"
                name="iconoirCheckCircle"
              ></ng-icon>
            }
            @if (recordLang !== formLanguage) {
              <ng-icon
                class="text-gray-800 mt-1"
                name="iconoirCircle"
              ></ng-icon>
            }
            @if (recordLang.length === 2) {
              <span [class]="getIconClass(recordLang) + 'mt-1'"></span>
            }
            <span [ngClass]="recordLang === formLanguage ? 'text-black' : ''">{{
              isLangSupported(recordLang)
                ? ('language.' + recordLang | translate)
                : recordLang.toUpperCase()
            }}</span>
          </div>
          <div class="flex flex-row gap-2 items-center">
            @if (recordLang === formLanguage) {
              <span class="text-xs text-base" translate
                >editor.record.form.multilingual.default</span
              >
            }
            <button
              (click)="
                openActionMenu(recordLang, template); $event.stopPropagation()
              "
              cdkOverlayOrigin
              #actionMenuButton
            >
              <ng-icon class="pb-5" name="matMoreHorizOutline"></ng-icon>
            </button>
            <ng-template #template>
              <gn-ui-action-menu
                [canDelete]="recordLang !== _record.defaultLanguage"
                page="record"
                (delete)="confirmDeleteAction(recordLang)"
                (closeActionMenu)="closeActionMenu()"
                (switch)="switchDefaultLang(recordLang)"
              >
              </gn-ui-action-menu>
            </ng-template>
          </div>
        </gn-ui-button>
      }
    </div>
  }
</div>
